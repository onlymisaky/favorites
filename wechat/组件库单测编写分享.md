> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/DooXY6xOEGyThtbkyiUvVw)

å¤§å‚æŠ€æœ¯Â Â åšæŒå‘¨æ›´Â Â ç²¾é€‰å¥½æ–‡
================

> æœ¬æ–‡ä¸ºæ¥è‡ªÂ **å­—èŠ‚è·³åŠ¨ - å›½é™…åŒ–ç”µå•† - S é¡¹ç›®å›¢é˜Ÿ**Â æˆå‘˜çš„æ–‡ç« ï¼Œå·²æˆæƒ ELab å‘å¸ƒã€‚

å•æµ‹çš„æ„ä¹‰
=====

ç»„ä»¶ä½œä¸ºä¸€ç§è¢«é¢‘ç¹å¤ç”¨çš„ä»£ç ï¼Œå‡ºç°çº¿ä¸Š bug çš„æ—¶å€™å½±å“çš„æ˜¯èŒƒå›´æ›´å¹¿çš„ä¸šåŠ¡ï¼Œä¿éšœç»„ä»¶æ¯æ¬¡è¿­ä»£çš„å¯é æ€§å°¤ä¸ºé‡è¦ã€‚

å¯¹ä½¿ç”¨è€…æ¥è¯´ï¼Œç»„ä»¶åº“çš„ä¸°å¯Œçš„å•æµ‹ä»£è¡¨ç€å…¶å¯é æ€§ã€‚

å¯¹ç»„ä»¶å¼€å‘è€…æ¥è¯´ï¼Œå•æµ‹çš„æ²‰æ·€ä¹Ÿè®©æ¯æ¬¡å¯¹æ—§ä»£ç çš„æ”¹åŠ¨æ›´æœ‰ä¿¡å¿ƒã€‚

Jest åŸºç¡€
=======

Jest æ˜¯ React æ¨èçš„æµ‹è¯•æ¡†æ¶ï¼Œä¹Ÿæ˜¯å½“å‰ä¼—å¤šå‰ç«¯ç»„ä»¶åº“çš„å•æµ‹é¦–é€‰ã€‚

å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ ğŸŒ°

```
functionÂ sumÂ (num1,Â num2)Â {Â Â Â Â returnÂ num1Â +Â num2;}
```

ä¸Šé¢æ˜¯ä¸€ä¸ªç®€å•çš„åŠ æ³•å‡½æ•°ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯æ˜¯è¾“å…¥ä¸¤ä¸ªæ•° a å’Œ bï¼ŒæœŸæœ›è¿”å›å®ƒä»¬ç›¸åŠ çš„ç»“æœï¼Œå®ƒçš„å•æµ‹å†™å‡ºæ¥æ˜¯è¿™æ ·çš„ã€‚

```
importÂ sumÂ fromÂ './sum.ts';describe('utilÂ æ–¹æ³•æµ‹è¯•',Â ()Â =>Â {Â Â Â Â Â Â test("sumÂ functionÂ test"ï¼ŒÂ ()Â =>Â {Â Â Â Â Â Â Â Â //Â å¯¹å‡½æ•°è¿›è¡Œè°ƒç”¨ï¼ŒæœŸæœ›ç»“æœæ˜¯Â 3Â Â Â Â Â Â expect(sum(1,Â 2)).toBe(3);Â Â })});
```

ä¸Šé¢æ˜¯å¯¹ sum æ–¹æ³•çš„å•å…ƒæµ‹è¯•çš„ä¾‹å­ï¼Œåœ¨è¯¥æµ‹è¯•ä¸­ï¼Œå¯¹å‡½æ•°è¿›è¡Œè°ƒç”¨ï¼Œä¼ å…¥äº† 1 å’Œ 2ï¼Œå¹¶å¯¹è¿”å›ç»“æœçš„æ­£ç¡®æ€§è¿›è¡ŒéªŒè¯ã€‚é‡Œé¢å‡ºç°äº† describeã€testã€expectã€toBe æ–¹æ³•ï¼Œè¿™äº›æ˜¯ jest ç›¸å…³çš„åŸºç¡€çš„ä¸œè¥¿ï¼Œä¸‹é¢é€ä¸ªä»‹ç»ä¸‹ã€‚

Jest ç›¸å…³æ¦‚å¿µ
---------

describeï¼šæè¿°ä¸€ä¸ªæ¨¡å—

```
describe('buttonPromiseÂ ç»„ä»¶ç›¸å…³æµ‹è¯•',Â ()Â =>Â {Â Â Â Â //Â æ­¤å¤„ç¼–å†™Â buttonPromiseÂ æµ‹è¯•ç”¨ä¾‹});
```

test ï¼šç¼–å†™ä¸€ä¸ªå…·ä½“çš„æµ‹è¯•ç”¨ä¾‹

```
describe('buttonPromiseÂ ç»„ä»¶ç›¸å…³æµ‹è¯•',Â ()Â =>Â {Â Â Â Â Â Â test('æè¿°æµ‹è¯•åŠŸèƒ½ï¼šbuttonpromise loading style',Â ()Â =>Â {Â Â Â Â Â Â //Â æ‰§è¡Œå…·ä½“æµ‹è¯•Â Â })});
```

expectï¼šæ–­è¨€ï¼ŒæœŸæœ›æŸä¸ªç»“æœç¬¦åˆä»€ä¹ˆæ ·çš„é¢„æœŸ

toBeï¼šåŒ¹é…å™¨, å¯¹æŸä¸ªç»“æœè¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸é¢„æœŸä¸€è‡´

```
test('twoÂ plusÂ twoÂ isÂ four',Â ()Â =>Â {Â Â expect(sum(2,Â 2)).toEqual(4);Â //Â æ–­è¨€ç»“æœä¸ºÂ 4ï¼Œé€šè¿‡æµ‹è¯•Â Â expect(sum(2,Â 2)).not.toEqual(5);Â //Â æ–­è¨€ç»“æœä¸ç­‰äºÂ 5ï¼Œé€šè¿‡æµ‹è¯•});
```

Jest æä¾›äº†å¤§é‡çš„å¸¸ç”¨åŒ¹é…å™¨ï¼Œé’ˆå¯¹æ•°å­—ã€å­—ç¬¦ä¸²ã€å‡½æ•°çš„è°ƒç”¨æƒ…å†µã€è°ƒç”¨æ—¶çš„å‚æ•°ç­‰

*   toBeGreaterThan(x: number); æ¯” x æ›´å¤§
    
*   toBeLessThan(x: number); æ¯” x æ›´å°
    
*   toEqual(x: number): æ˜¯å¦ç›¸ç­‰
    
*   toMatch(x: RegExp) å­—ç¬¦ä¸²åŒ¹é…
    
*   toHaveBeenCalledTimes(x: number) å‡½æ•°è¢«è°ƒç”¨ x æ¬¡
    
*   æ›´å¤šåŒ¹é…å™¨
    

Jest æä¾›çš„èƒ½åŠ›
----------

*   æµ‹è¯•æ–­è¨€ã€åŒ¹é…å™¨ï¼Œå¯¹æµ‹è¯•ç”¨ä¾‹ç»“æœè¿›è¡Œåˆ¤æ–­
    
*   æ”¯æŒå¼‚æ­¥å‡½æ•°æµ‹è¯•
    

*   ```
    //Â æ„é€ ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œ2sÂ åè¿”å›Â 1constÂ fetchDataÂ =Â ()Â =>Â newÂ Promise((resolve)Â =>Â {Â Â setTimeout(()Â =>Â {Â Â Â Â resolve(1)Â Â },Â 2000)})test('æ”¯æŒè¿”å›ä¸€ä¸ªÂ promiseï¼Œåœ¨Â resoveÂ ä¸­è¿›è¡Œæµ‹è¯•',Â ()Â =>Â {Â Â Â Â returnÂ fetchData().then(dataÂ =>Â {Â Â Â Â Â Â Â Â expect(data).toBe(1);Â Â Â Â });});test('ç›´æ¥ä½¿ç”¨Â .resolvesÂ /Â .rejectsÂ å¯¹ç»“æœè¿›è¡Œæ–­è¨€',Â ()Â =>Â {Â Â Â Â returnÂ expect(fetchData()).resolves.toBe(1);});test('æ”¯æŒåœ¨æµ‹è¯•ç”¨ä¾‹ä¸­ä½¿ç”¨Â asyncÂ await',Â asyncÂ ()Â =>Â {Â Â constÂ dataÂ =Â awaitÂ fetchData();Â Â expect(data).toBe(1);});
    ```
    

*   Mock èƒ½åŠ›
    

Jest æ”¯æŒå¯¹ä¸€ä¸ªå‡½æ•°ã€æ¨¡å—çš„ mockï¼Œæœ‰äº›æµ‹è¯•åœºæ™¯ç”¨åˆ°äº†å¤–éƒ¨ä¾èµ–ï¼Œè€Œè¿™äº›å¤–éƒ¨ä¾èµ–å¹¶ä¸éœ€è¦å…³å¿ƒå®ƒä»¬çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œåªéœ€è¦å®ƒä»¬è¿”å›ä¸€ä¸ªæ‰§è¡Œåçš„ç»“æœï¼Œè¿™ç§åœºæ™¯ä¸‹å¯ä»¥ä½¿ç”¨ jest çš„ mock åŠŸèƒ½

ä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç å¯¹ axios æ¨¡å—è¿›è¡Œ mock

```
importÂ axiosÂ fromÂ 'axios'//Â å¯¹æ•´ä¸ªÂ axiosÂ æ¨¡å—è¿›è¡ŒÂ mockjest.mock('axios',Â ()Â =>Â {Â Â returnÂ {Â Â Â Â get:Â jest.fn(()Â =>Â Promise.resolve(1))Â Â }})test('è¯•è¯•Â mockÂ axios',Â ()Â =>Â {Â Â returnÂ axios.get('').then(dataÂ =>Â expect(data).toBe(1))})
```

ç”šè‡³å¯ä»¥å¯¹å¼•ç”¨æ–‡ä»¶å†…éƒ¨çš„å…¶ä»–ä¾èµ–åš mock

test.tsx

```
importÂ axiosÂ fromÂ 'axios';importÂ bÂ fromÂ './b';exportÂ defaultÂ asyncÂ ()Â =>Â {Â Â constÂ dataÂ =Â awaitÂ axios.get('./api/v1/user');Â Â returnÂ data;}
```

fn.test.tsx

```
importÂ testFnÂ fromÂ './test'Â //Â testÂ æ–‡ä»¶å†…éƒ¨ä½¿ç”¨åˆ°äº†Â axiosï¼Œåœ¨è¿™é‡Œå¯¹å…¶åšÂ mockjest.mock('axios',Â ()Â =>Â {Â Â returnÂ {Â Â Â Â get:Â jest.fn(()Â =>Â Promise.resolve(1))Â Â }})jest.mock('./b',Â ()Â =>Â {Â Â Â Â returnÂ {Â Â Â Â }});test('è¯•è¯•å¯¹å¼•ç”¨æ–‡ä»¶å†…éƒ¨çš„å…¶ä»–ä¾èµ–åšÂ mock',Â ()Â =>Â {Â Â returnÂ testFn().then(dataÂ =>Â expect(data).toBe(1))})
```

jest æ›´å¤š mock ç›¸å…³çš„çŸ¥è¯†

æµ‹è¯• UI ç»„ä»¶é¢å¤–éœ€è¦çš„å·¥å…·åº“
================

é€šè¿‡ä¸Šé¢å¯ä»¥äº†è§£åˆ° Jest æä¾›äº†å•å…ƒæµ‹è¯•å¸¸ç”¨çš„ä¸€äº›åŸºç¡€èƒ½åŠ›ï¼Œå¯¹æµ‹è¯•ç»“æœçš„æ–­è¨€ã€åŒ¹é…ï¼Œå¯¹å¤–éƒ¨ä¾èµ–çš„ mock ç­‰ï¼Œä½†æ˜¯å¯¹äºç»„ä»¶åº“æ¥è¯´ï¼Œè¿™å¯¹äºå†™ UI ç»„ä»¶å•æµ‹è¿˜ä¸å¤Ÿä¾¿æ·ï¼Œä¾‹å¦‚ï¼Œ

*   å¦‚ä½•å»æ¸²æŸ“ä¸€ä¸ª React ç»„ä»¶ï¼Ÿå°†ç»„ä»¶æ¸²æŸ“å‡ºæ¥æ˜¯æµ‹è¯•å®ƒçš„ç¬¬ä¸€æ­¥
    
*   æ¸²æŸ“åå¸Œæœ›å¯ä»¥æ£€æŸ¥å®ƒåœ¨æŸäº›åœºæ™¯ä¸‹çš„æ ·å¼ï¼Œåˆå¦‚ä½•å»æ“ä½œèŠ‚ç‚¹
    
*   UI ç»„ä»¶çš„æµ‹è¯•ä¼´éšç€ç”¨æˆ·å¯¹å®ƒçš„äº¤äº’ï¼Œè¿™äº›åˆå¦‚ä½•æ“ä½œï¼Ÿ
    

...

é’ˆå¯¹ä¸Šé¢è¿™äº›é—®é¢˜ï¼Œä¸šç•Œå·²æœ‰äº†ç›¸åº”çš„å·¥å…·åº“é…åˆ jest ä¸€èµ·ä½¿ç”¨

@testing-library/react
----------------------

@testing-library/react æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯• react ç»„ä»¶ç›¸å…³çš„åº“ï¼Œæä¾›äº† react ç»„ä»¶**æ¸²æŸ“èƒ½åŠ›ã€**Â **dom**Â **æ“ä½œèƒ½åŠ›**ï¼Œé€šè¿‡å®ƒåœ¨ç¼–å†™ react ç»„ä»¶å•å…ƒæµ‹è¯•çš„æ—¶å€™å¯ä»¥æ›´åŠ å…³æ³¨åŠŸèƒ½æµ‹è¯•æœ¬èº«ï¼Œæ— éœ€ç¼–å†™å¤§é‡ä»£ç å»åšç»„ä»¶çš„åˆå§‹åŒ–ç­‰ã€‚

@testing-library/react æä¾›äº† render apiï¼Œå½“å¼€å§‹å†™ä¸€ä¸ªç»„ä»¶çš„å•æµ‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®ƒå°†ç»„ä»¶æ¸²æŸ“å‡ºæ¥ï¼ŒåŒæ—¶å…¶è¿”å›äº†ä¸€ä¸ª container å¯¹è±¡ï¼Œæ˜¯ç»„ä»¶è¢«æ¸²æŸ“çš„å®¹å™¨æ‰€åœ¨ï¼Œé€šè¿‡ containerï¼Œå¯ä»¥è¿›è¡Œ dom æ“ä½œï¼Œå¦‚ è·å–å¯¹åº”çš„èŠ‚ç‚¹ç­‰ã€‚

```
importÂ {Â renderÂ }Â fromÂ '@testing-library/react';importÂ ButtonPromiseÂ fromÂ '../src';describe('ButtonÂ PromiseÂ ç»„ä»¶æµ‹è¯•',Â ()Â =>Â {Â Â test('æµ‹è¯•Â loadingÂ åŠŸèƒ½',Â asyncÂ ()Â =>Â {Â Â Â Â Â Â Â //Â æ¸²æŸ“ç»„ä»¶Â Â Â Â constÂ {Â containerÂ }Â =Â render(Â Â Â Â Â Â <ButtonPromiseÂ id="test-copy-icon"Â onClick={btnClick}>Â Â Â Â Â Â Â Â æŒ‰é’®Â Â Â Â Â Â </ButtonPromise>,Â Â Â Â );Â Â Â Â Â Â Â Â //Â renderÂ å‡½æ•°æ¸²æŸ“å®Œä¼šè¿”å›å¯¹åº”çš„ç»„ä»¶è¢«æ¸²æŸ“çš„å®¹å™¨èŠ‚ç‚¹ï¼Œé€šè¿‡å®ƒå¯æŸ¥æ‰¾å¯¹åº”çš„Â domÂ Â Â Â constÂ btnÂ =Â container.querySelector('#test-copy-icon');Â Â Â Â Â Â Â Â ...Â åç»­æ“ä½œÂ Â Â });
```

ä¸Šé¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•æ¸²æŸ“ä¸€ä¸ªæŒ‰é’®ç»„ä»¶ï¼Œç»„ä»¶æ¸²æŸ“ä¹‹åï¼Œéœ€è¦ç”¨æˆ·å»ç‚¹å‡»ï¼Œè¿™æ¶‰åŠåˆ°ç”¨æˆ·è¡Œä¸ºçš„æ¨¡æ‹Ÿï¼Œé’ˆå¯¹è¿™ä¸€ç±»åœºæ™¯ï¼Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆæ˜¯Â @testing-library/user-event

@testing-library/user-event
---------------------------

@testing-library/user-event æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºçš„åº“ï¼ŒåŒ…æ‹¬å¯¹ç”¨æˆ·é¼ æ ‡è¡Œä¸ºï¼ˆå•å‡»ã€åŒå‡»ã€é¼ æ ‡ hover ç­‰ï¼‰ã€é”®ç›˜è¡Œä¸ºçš„æ¨¡æ‹Ÿã€‚

ç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨æŒ‰é’®æˆåŠŸæ¸²æŸ“å‡ºæ¥åï¼Œå¯¹å…¶è¿›è¡Œç‚¹å‡»

```
importÂ {Â renderÂ }Â fromÂ '@testing-library/react';importÂ ButtonPromiseÂ fromÂ '../src';describe('ButtonÂ PromiseÂ ç»„ä»¶æµ‹è¯•',Â ()Â =>Â {Â Â test('æµ‹è¯•Â loadingÂ åŠŸèƒ½',Â asyncÂ ()Â =>Â {Â Â Â Â Â Â Â Â //Â userEventÂ åˆå§‹åŒ–Â Â Â Â constÂ userÂ =Â userEvent.setup();Â Â Â Â constÂ {Â containerÂ }Â =Â render(Â Â Â Â Â Â <ButtonPromiseÂ id="test-copy-icon"Â onClick={btnClick}>Â Â Â Â Â Â Â Â æŒ‰é’®Â Â Â Â Â Â </ButtonPromise>,Â Â Â Â );Â Â Â Â Â Â Â //Â renderÂ å‡½æ•°æ¸²æŸ“å®Œä¼šè¿”å›å¯¹åº”çš„ç»„ä»¶è¢«æ¸²æŸ“çš„å®¹å™¨èŠ‚ç‚¹ï¼Œé€šè¿‡å®ƒå¯æŸ¥æ‰¾å¯¹åº”çš„Â domÂ Â Â Â constÂ btnÂ =Â container.querySelector('#test-copy-icon');Â Â Â Â Â Â Â //Â ç‚¹å‡»æŒ‰é’®Â Â Â Â user.click(btn);Â Â });
```

ç”¨æˆ·çš„è¡Œä¸ºé€šå¸¸ä¼´éšç€æ•°æ®çš„å˜åŒ–ã€ç•Œé¢çš„å˜åŒ–ï¼Œè¿™äº›å˜åŒ–æ˜¯æ£€æŸ¥ç»„ä»¶ç»è¿‡ç”¨æˆ·äº¤äº’åæ˜¯å¦æ­£ç¡®çš„åˆ¤æ–­æ ‡å‡†ã€‚æ•°æ®çš„å˜åŒ–é€šè¿‡ jest æä¾›çš„å„ç±»åŒ¹é…å™¨ï¼ˆtoEqualã€toMatch ç­‰ï¼‰å¯ä»¥è¿›è¡Œåˆ¤æ–­ï¼Œç•Œé¢çš„å˜åŒ–åˆ™éœ€è¦é€šè¿‡å¯¹ dom çŠ¶æ€çš„æ£€éªŒã€‚

@testing-library/jest-dom
-------------------------

ç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼Œä¸Šé¢çš„éƒ¨åˆ†å·²ç»åšåˆ°äº†å¯¹ buttonPromise ç»„ä»¶çš„æ¸²æŸ“ï¼Œç‚¹å‡»ï¼Œè€Œè¯¥ç»„ä»¶çš„åŠŸèƒ½ï¼Œæ˜¯æœŸæœ›ç‚¹å‡»åç”¨æˆ·å¯ä»¥çœ‹åˆ° loading æ•ˆæœ.

```
importÂ {Â renderÂ }Â fromÂ '@testing-library/react';importÂ ButtonPromiseÂ fromÂ '../src';describe('ButtonÂ PromiseÂ ç»„ä»¶æµ‹è¯•',Â ()Â =>Â {Â Â test('æµ‹è¯•Â loadingÂ åŠŸèƒ½',Â asyncÂ ()Â =>Â {Â Â Â Â Â Â //Â æ ¹æ®ç»„ä»¶åŠŸèƒ½ï¼Œä¼ å…¥Â onClickÂ çš„å‡½æ•°è¿”å›ä¸€ä¸ªÂ promiseÂ Â Â Â //Â åœ¨Â resolveÂ ä¹‹å‰ï¼ŒæŒ‰é’®ä¼šæœ‰Â loadingÂ æ•ˆæœÂ Â Â Â constÂ btnClickÂ =Â ()Â =>Â newÂ Promise((resolve)Â =>Â {Â Â Â Â Â Â Â Â setTimeout(()Â =>Â {Â Â Â Â Â Â Â Â Â Â Â resolve()Â Â Â Â Â Â Â Â Â },Â 2000);Â Â Â Â })Â Â Â Â Â Â Â Â //Â userEventÂ åˆå§‹åŒ–Â Â Â Â constÂ userÂ =Â userEvent.setup();Â Â Â Â constÂ {Â containerÂ }Â =Â render(Â Â Â Â Â Â <ButtonPromiseÂ id="test-copy-icon"Â onClick={btnClick}>Â Â Â Â Â Â Â Â æŒ‰é’®Â Â Â Â Â Â </ButtonPromise>,Â Â Â Â );Â Â Â Â Â Â Â //Â renderÂ å‡½æ•°æ¸²æŸ“å®Œä¼šè¿”å›å¯¹åº”çš„ç»„ä»¶è¢«æ¸²æŸ“çš„å®¹å™¨èŠ‚ç‚¹ï¼Œé€šè¿‡å®ƒå¯æŸ¥æ‰¾å¯¹åº”çš„Â domÂ Â Â Â constÂ btnÂ =Â container.querySelector('#test-copy-icon');Â Â Â Â Â Â Â //Â ç‚¹å‡»æŒ‰é’®Â Â Â Â user.click(btn);Â Â Â Â Â Â Â Â awaitÂ waitFor(()Â =>Â {Â Â Â Â Â Â //Â æœŸæœ›æŒ‰é’®ä¸Šæœ‰Â loadingÂ æ ·å¼Â Â Â Â Â Â expect(btn).toHaveClass('arco-btn-loading')Â Â Â Â });Â Â });
```

å†™å•å…ƒæµ‹è¯•çš„æ€è·¯
========

é€šè¿‡ä¸Šé¢ jest ä¸ test-library ç›¸å…³çš„åŸºç¡€ä»‹ç»ï¼Œåˆ°æœ€åå®Œæˆäº† button-promise ç»„ä»¶å•å…ƒæµ‹è¯•çš„ç¼–å†™ã€‚

å•æµ‹çš„è¦ç‚¹
-----

*   æ˜ç¡®æµ‹è¯•ç›®çš„ï¼ˆæµ‹ä»€ä¹ˆåŠŸèƒ½ï¼Œä»€ä¹ˆç»“æœæ˜¯æ­£ç¡®çš„ï¼‰
    
*   æ¯ä¸ª test åªåŒ…å«ä¸€ä¸ªæµ‹è¯•ç›®çš„
    
*   å¤šç«™åœ¨ç”¨æˆ·çš„è§†è§’è¿›è¡Œè€ƒè™‘ï¼ˆæŠŠè‡ªå·±å½“ä½œåœ¨ä½¿ç”¨ç»„ä»¶çš„ç”¨æˆ·ï¼Œåšå‡ºæŸäº›è¡Œä¸ºååº”è¯¥çœ‹åˆ°ä»€ä¹ˆï¼‰
    
*   ç”±äº arcoS æ˜¯å¯¹ arco çš„å°è£…ï¼Œå¯¹äºä¸€äº›ç»„ä»¶çš„åŸºç¡€åŠŸèƒ½å¯ä»¥ä¸è¿›è¡Œæµ‹è¯•
    

*   ä¾‹å¦‚ä¸Šé¢çš„ button-promise å·²ç»è¿›å…¥ loading çŠ¶æ€ï¼Œåœ¨è¿›å…¥ loading åï¼ŒæŒ‰é’®çš„å¤šæ¬¡ç‚¹å‡»æ˜¯å¦è¿˜ä¼šè§¦å‘å‡½æ•°è°ƒç”¨ï¼Œè¿™å±äº button ç»„ä»¶åŸºç¡€åŠŸèƒ½ï¼Œåº”è¯¥ç”± arco å»ä¿éšœã€‚
    

æ€è·¯
--

ä»¥ä¸Šé¢ç»„ä»¶åº“ä¸­ button-promise ç»„ä»¶ä¸ºä¾‹

1.  æ¢³ç†å¾…æµ‹è¯•çš„åŠŸèƒ½
    

åŠŸèƒ½ aï¼šonClick ç»‘å®šä¸€ä¸ªè¿”å›äº† promise çš„å‡½æ•°ï¼Œç»„ä»¶å°†è¿›å…¥ loading çŠ¶æ€ï¼Œç›´åˆ° promise è¿›å…¥ resolve çŠ¶æ€ï¼‰

2.  ç¼–å†™æµ‹è¯•ç”¨ä¾‹
    
3.  æ¸²æŸ“å¾…æµ‹è¯•ç»„ä»¶ï¼ˆåƒä½¿ç”¨ç»„ä»¶çš„ç”¨æˆ·ä¸€æ ·ï¼Œæ­£å¸¸åœ°ç»‘å®šä¸€ä¸ª è¿”å›äº† promise çš„å‡½æ•°ï¼‰
    
4.  æ ¹æ®ç»„ä»¶åŠŸèƒ½æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºï¼ˆç‚¹å‡»æŒ‰é’®ï¼‰
    
5.  æ–­è¨€å½“å‰ç»„ä»¶è¡¨ç°ç¬¦åˆé¢„æœŸï¼ˆåˆ¤æ–­ç»„ä»¶ä¸Šæ˜¯å¦å­˜åœ¨ loading æ ·å¼ï¼‰
    
6.  æ–­è¨€ promise è¿›å…¥ resolve çŠ¶æ€åï¼Œloading æ ·å¼æ˜¯å¦æ¶ˆå¤±ï¼ˆåˆ¤æ–­ç»„ä»¶ä¸Š loading æ ·å¼æ˜¯å¦ä¸¢å¤±ï¼‰
    

å®Œæ•´æµç¨‹
----

é€šè¿‡è„šæ‰‹æ¶åˆ›å»ºå®Œç»„ä»¶åï¼Œä¼šäº§ç”Ÿå¯¹åº”çš„æ–‡ä»¶å¤¹Â `__tests__`ï¼Œä»¥åŠå¯¹åº”çš„å•å…ƒæµ‹è¯•æ–‡ä»¶ xxx.test.tsxï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹

```
importÂ {Â renderÂ }Â fromÂ '@testing-library/react';importÂ xxxÂ fromÂ '../src';describe('ç»„ä»¶å',Â ()Â =>Â {Â Â Â Â test('æµ‹è¯•åŠŸèƒ½1',Â ()Â =>Â {Â Â Â Â Â Â //Â åœ¨è¿™é‡Œå†™å•å…ƒæµ‹è¯•Â Â });Â Â Â Â Â test('æµ‹è¯•åŠŸèƒ½2',Â ()Â =>Â {Â Â Â Â Â Â //Â åœ¨è¿™é‡Œå†™å•å…ƒæµ‹è¯•Â Â });
```

ç¼–å†™å®Œæµ‹è¯•ç”¨ä¾‹åï¼Œæ‰§è¡Œ yarn test ï¼ˆå‘½ä»¤å·²åœ¨åˆ›å»ºç»„ä»¶æ—¶è¢«åˆå§‹åŒ–ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°æµ‹è¯•ç»“æœ

æˆåŠŸçš„æµ‹è¯•ç»“æœ

![](https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIonuSvdHYjSZAwUp7oNzHicUPPbQSVopnRSposez6281WFCxQr9al9JeCGvZibJKEFOM7lOCKgUaqzA/640?wx_fmt=png)

å¤±è´¥çš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°æµ‹è¯•ç»“æœæœŸæœ›æœ‰ arco-btn-loading1 çš„ç±»åï¼Œä½†æ˜¯å®é™… received åˆ°çš„ç±»å¹¶æ²¡æœ‰

![](https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIonuSvdHYjSZAwUp7oNzHicUXCgl8OhQaFKFstvNOia3eqGReBIib9C8kKqzYmWQm8SBdsQeMv5IL0wQ/640?wx_fmt=png)

ğŸŒ° Button-group
---------------

*   ç¡®å®šæµ‹è¯•åŠŸèƒ½
    

*   æ”¯æŒä¼ å…¥æ•°ç»„æ¸²æŸ“ä¸‹æ‹‰èœå•
    
*   æ•°ç»„å†…æ”¯æŒå®šä¹‰æ¯ä¸ª item çš„ç‚¹å‡»äº‹ä»¶åŠæ–‡å­—çš„è‡ªå®šä¹‰
    

```
importÂ ButtonGroupÂ fromÂ './src';importÂ {Â render,Â screen,Â waitForÂ }Â fromÂ '@testing-library/react';importÂ userEventÂ fromÂ '@testing-library/user-event';importÂ ReactÂ fromÂ 'react';describe('Button-GroupÂ Test',Â ()Â =>Â {Â Â Â //Â ä¸åŒåŠŸèƒ½éªŒè¯ç¼–å†™ä¸åŒç”¨ä¾‹Â Â test('droplistÂ showÂ correct',Â asyncÂ ()Â =>Â {Â Â Â Â constÂ userÂ =Â userEvent.setup();Â Â Â Â Â //Â æ¸²æŸ“æŒ‰é’®Â Â Â Â constÂ {Â container,Â getByTextÂ }Â =Â render(Â Â Â Â Â Â <ButtonGroupÂ Â Â Â Â Â Â Â title={'æ›´å¤š'}Â Â Â Â Â Â Â Â dropList={[{Â Â Â Â Â Â Â Â Â Â title:Â 'æ‰¹é‡å¯¼å‡º',Â Â Â Â Â Â Â Â },Â {Â Â Â Â Â Â Â Â Â Â render:Â ()Â =>Â <span>æ“ä½œè®°å½•</span>,Â Â Â Â Â Â Â Â }]}Â Â Â Â Â Â Â Â />Â Â Â Â );Â Â Â Â Â Â Â Â Â //Â æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºÂ Â Â Â user.click(getByText('æ›´å¤š'))Â Â Â Â awaitÂ waitFor(()Â =>Â {Â Â Â Â Â Â Â Â Â Â Â Â //Â æœŸæœ›ä¼ å…¥çš„ä¸¤ä¸ªæŒ‰é’®åœ¨ç‚¹å‡»æ›´å¤šåæ­£å¸¸æ¸²æŸ“Â Â Â Â Â Â expect(getByText('æ‰¹é‡å¯¼å‡º')).toBeInTheDocument()Â Â Â Â Â Â expect(getByText('æ“ä½œè®°å½•')).toBeInTheDocument()Â Â Â Â });Â Â })Â Â Â //Â ä¸åŒåŠŸèƒ½éªŒè¯ç¼–å†™ä¸åŒç”¨ä¾‹Â Â test('droplistÂ clickÂ correct',Â asyncÂ ()Â =>Â {Â Â Â Â constÂ userÂ =Â userEvent.setup({Â Â Â Â Â Â pointerEventsCheck:Â 0Â Â Â Â });Â Â Â Â constÂ exportFnÂ =Â jest.fn(()Â =>Â {});Â Â Â Â constÂ {Â getByTextÂ }Â =Â render(Â Â Â Â Â Â <ButtonGroupÂ Â Â Â Â Â Â Â title={'æ›´å¤š'}Â Â Â Â Â Â Â Â dropList={[{Â Â Â Â Â Â Â Â Â Â title:Â 'æ‰¹é‡å¯¼å‡º',Â Â Â Â Â Â Â Â Â Â onClick:Â ()Â =>Â exportFn()Â Â Â Â Â Â Â Â }]}Â Â Â Â Â Â Â Â />Â Â Â Â );Â Â Â Â user.click(getByText('æ›´å¤š'))Â Â Â Â awaitÂ waitFor(()Â =>Â {Â Â Â Â Â Â constÂ exportBtnÂ =Â getByText('æ‰¹é‡å¯¼å‡º');Â Â Â Â Â Â user.click(exportBtn);Â Â Â Â Â Â Â Â Â Â Â Â Â //Â æœŸæœ›Â exportFnÂ å‡½æ•°åœ¨ç‚¹å‡»æ‰¹é‡å¯¼å‡ºåèƒ½å¤Ÿè¢«è°ƒç”¨ä¸€æ¬¡Â Â Â Â Â Â expect(exportFn).toBeCalledTimes(1)Â Â Â Â });Â Â })})
```

æ›´å¤šå­¦ä¹ èµ„æ–™
======

jest å®˜æ–¹æ–‡æ¡£

React Test Library å·¥å…·åº“

â¤ï¸ è°¢è°¢æ”¯æŒ
-------

ä»¥ä¸Šä¾¿æ˜¯æœ¬æ¬¡åˆ†äº«çš„å…¨éƒ¨å†…å®¹ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ© ^_^

å–œæ¬¢çš„è¯åˆ«å¿˜äº† åˆ†äº«ã€ç‚¹èµã€æ”¶è— ä¸‰è¿å“¦~ã€‚

æ¬¢è¿å…³æ³¨å…¬ä¼—å·Â **ELab å›¢é˜Ÿ**Â æ”¶è´§å¤§å‚ä¸€æ‰‹å¥½æ–‡ç« ~

> ä½¿ç”¨ä¸‹æ–¹å†…æ¨ç æˆ–å†…æ¨é“¾æ¥ï¼Œå¯æŠ•é€’Â **å­—èŠ‚è·³åŠ¨ - å›½é™…åŒ–ç”µå•† - S é¡¹ç›®å›¢é˜Ÿ**Â ç›¸å…³å²—ä½
> 
> *   å†…æ¨ç ï¼šWWCM1TA
>     
> *   å†…æ¨é“¾æ¥ï¼šhttps://job.toutiao.com/s/rj1fwQW
>     

- END -