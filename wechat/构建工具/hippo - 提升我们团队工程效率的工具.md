> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/XAJCtO7ccUcDY4iqkpCr4g)

1. èƒŒæ™¯
=====

æˆ‘ä»¬ ShopeePay å›¢é˜Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å‰ç«¯å›¢é˜Ÿï¼ˆ**80**+ æˆå‘˜ï¼‰ï¼Œå›¢é˜Ÿå†…éƒ¨åˆ†å¸ƒç€ react nativeã€javascript npm åŒ…ã€react component npm åŒ…ã€serverlessã€æ™®é€šçš„ react å·¥ç¨‹ç­‰å¤šç§ç±»å‹çš„é¡¹ç›®ï¼Œæ¯ç§é¡¹ç›®ç±»å‹ä¸­çš„æ¯ä¸ªé¡¹ç›®éƒ½æœ‰å®ƒä»¬è‡ªå·±çš„é…ç½®å’Œå·¥ä½œæµã€‚æ¯”å¦‚ä»£ç æ ¼å¼åŒ–é…ç½®ä¸ç»Ÿä¸€ï¼ˆeslintã€prettier å’Œ typescriptï¼‰ï¼Œæ„å»ºå·¥å…·åŠå…¶é…ç½®ä¸ä¸€è‡´ï¼ˆrollupã€webpackã€viteã€tscã€babelã€esbuild ä½¿ç”¨æ··ä¹±ï¼‰ã€‚å¹¶ä¸”è¿™äº›æ··ä¹±ä¼šå¢åŠ ç»´æŠ¤å’Œäº¤æ¥æˆæœ¬å¹¶ä¸”å¯¹æ–°äººä¸å‹å¥½ã€‚

åŸºäºä»¥ä¸Šå› ç´ ï¼Œæˆ‘ä»¬å›¢é˜Ÿå¼€å‘äº† hippoï¼Œæ—¨åœ¨è§£å†³ä»¥ä¸‹é—®é¢˜

*   ä¸åŒé¡¹ç›®æˆ–å›¢é˜Ÿå°ç»„ä½¿ç”¨ä¸åŒçš„ cli å·¥å…·å’Œå·¥ä½œæµå‘½ä»¤ï¼ˆæ¯”å¦‚å¼€å‘é˜¶æ®µä¸€äº›é¡¹ç›®ç§°ä¸º devï¼Œä¸€äº›é¡¹ç›®ç§°ä¸º serveï¼‰ï¼Œä¸åŒçš„ cli æˆ–æ„å»ºå·¥å…·å¸¦æ¥äº†æ··ä¹±
    
*   å½“å›¢é˜Ÿæˆå‘˜éœ€è¦å¼€å‘æ–°é¡¹ç›®æ—¶ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹ä¸¤ç§å½¢å¼
    

*   æ¯æ¬¡éƒ½éœ€è¦è€ƒè™‘ä½¿ç”¨å“ªäº›æŠ€æœ¯æ ˆï¼ŒåŒ…æ‹¬æ„å»ºå·¥å…·é€‰å–å’Œé…ç½®ï¼Œä»£ç æ ¼å¼åŒ–æ ‡å‡†é…ç½®å’Œæµ‹è¯•ç”¨ä¾‹é…ç½®ç­‰ã€‚
    
*   åŸºäºåŸæœ‰é¡¹ç›®æ‹·è´
    

è¿™äº›æ–¹å¼ä¼šè¿›ä¸€æ­¥å¯¼è‡´ â€œç†µå¢â€ï¼Œå¯èƒ½ä¼šé€ æˆä¸€ä¸ªå›¢é˜Ÿä¸­ä¸åŒæˆå‘˜å¼€å‘çš„é¡¹ç›®ç›®å½•ç»“æ„å„ä¸ç›¸åŒï¼Œæ„å»ºå·¥å…·ä¸é…ç½®ä¸ä¸€è‡´çš„é—®é¢˜è¿›ä¸€æ­¥è¢«æ”¾å¤§

*   å½“ä¸€ä¸ªé¡¹ç›®è¶Šæ¥è¶Šå¤§ï¼Œå¼€å‘äººå‘˜çš„æ•°é‡ä¹Ÿåœ¨å¢é•¿æ—¶ï¼Œæˆ‘ä»¬æ— æ³•ä¿æŒä»£ç çš„è´¨é‡ï¼Œå¹¶ç¡®ä¿å®ƒå§‹ç»ˆéµå¾ªæˆ‘ä»¬çš„æœ€ä½³å®è·µ
    

*   æœ‰äº›äººå¯èƒ½ä¼šä½¿ç”¨ eslint ignore ä¿®æ”¹ eslint è§„åˆ™ï¼Œæˆ–è€…å½“ä»–åœ¨ CI pipeline ä¸­çœ‹åˆ° lint é”™è¯¯æ—¶ç›´æ¥å…³é—­è¯¥è§„åˆ™ã€‚
    
*   æœ‰äº›äººå‘ç°äº†ä¸€ä¸ªä¼˜åŒ–ç‚¹ï¼Œä½†æ˜¯ç¡®å‘ç°å¾ˆéš¾ä½¿å®ƒé€‚ç”¨äºæ‰€æœ‰ç›¸åŒç±»å‹çš„é¡¹ç›®
    
*   æœ‰äº›æ ‡å‡†åªå­˜åœ¨äºæ–‡æ¡£ä¸­ï¼Œå¾ˆéš¾ç¡®ä¿æ¯ä¸ªäººéƒ½çŸ¥é“å¹¶éµå¾ªå®ƒä»¬ã€‚
    

2. hippo æ˜¯ä»€ä¹ˆï¼Ÿ
=============

`hippo` æ˜¯ä¸€ä¸ªç”¨äºæé«˜æˆ‘ä»¬å‰ç«¯å›¢é˜Ÿå·¥ç¨‹æ•ˆç‡çš„`å‰ç«¯å·¥ä½œæµå’Œè§„èŒƒ`çš„å·¥å…·ã€‚å®ƒä¸ºæˆ‘ä»¬å›¢é˜Ÿçš„å‰ç«¯å¼€å‘ç»Ÿä¸€å®šä¹‰äº†æ•´ä¸ªå·¥ä½œæµå’Œè§„èŒƒå¹¶æä¾›äº†ä¸€äº›å‘½ä»¤æ¥å¸®åŠ©ä¸åŒçš„é¡¹ç›®ä½¿ç”¨å®ƒå¹¶å®ç°ä¸€å¥—æ ‡å‡†å·¥ä½œæµã€‚

åŒæ—¶ hippo ä¹Ÿæä¾›äº†æ˜“äºæ¨ªå‘æ‰©å±•çš„æ’ä»¶æœºåˆ¶ï¼Œæ–¹ä¾¿å›¢é˜Ÿæ¥å…¥ä¸åŒçš„é¡¹ç›®ç±»å‹ã€‚

ç›®å‰ ShopeePay å›¢é˜Ÿçš„é¡¹ç›®å·¥ä½œæµåˆ†ä¸ºåˆå§‹åŒ–ã€æœ¬åœ°å¼€å‘ã€ä»£ç æ ¡éªŒã€ä»£ç æµ‹è¯•ã€æ‰“åŒ…æ„å»ºå’Œå‘å¸ƒç­‰æ­¥éª¤ã€‚åˆ†åˆ«å¯¹åº”ä»¥ä¸‹å‘½ä»¤

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHp65ZA3IxI96YkS0IwvB9mJlcy9Dvpql1rMtSeqLGI6UTOGwd4YrL0CtQ0yUEWzSfKNfqwz6P7kbA/640?wx_fmt=other)workflow.png

> ä¸ºä»€ä¹ˆç§°ä¹‹ä¸º hippoï¼Ÿ
> 
> hippo å³æ²³é©¬ğŸ¦› ï¼Œæ²³é©¬æ˜¯æ‚é£Ÿæ€§åŠ¨ç‰©ï¼Œä»€ä¹ˆéƒ½èƒ½åƒï¼Œæ‰€ä»¥æˆ‘ä»¬ç§°ä¸º hippo çš„å«ä¹‰æ˜¯æ‰“é€ å›¢é˜Ÿç»Ÿä¸€çš„å·¥å…·é“¾ã€‚

3. hippo æ¶æ„è®¾è®¡
=============

ä¸€å¼ å›¾æ¦‚æ‹¬ hippo æ¶æ„

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHp65ZA3IxI96YkS0IwvB9mJZt2fcwib7SFicvYWdb9z5xtscTCnIggct5iarm7BWKkdym3zogibq0f5fw/640?wx_fmt=other)hippo-attachment.png

hippo æ¶æ„å¤§è‡´åˆ†ä¸ºå››å±‚

*   é¡¶å±‚æ˜¯ `@hippo/cli`, cli åªæä¾›äº†ä¸€ä¸ªåŸºç¡€å†…æ ¸å’Œä¸€äº›åŸºç¡€å‘½ä»¤ï¼ˆæ¯”å¦‚ versionã€help å’Œä¸€äº›ä¸ monorepo ç›¸å…³çš„å‘½ä»¤ï¼‰ï¼Œè´Ÿè´£è·å–å’Œæ³¨å†Œå„ä¸ª toolkit å®ç°çš„å·¥ä½œæµå‘½ä»¤å¹¶ä¸å‘½ä»¤è¡Œç»ˆç«¯äº¤äº’
    
*   ç¬¬äºŒå±‚æ˜¯ `toolkit` ã€‚`toolkit` æ˜¯ç”¨äºæä¾›æŸç§é¡¹ç›®ç±»å‹çš„å·¥ä½œæµå‘½ä»¤ï¼Œé€šå¸¸æ˜¯å¤šä¸ªå‘½ä»¤çš„é›†åˆã€‚ä¸€ä¸ª `toolkit` å¯¹åº”ä¸€ç§é¡¹ç›®ç±»å‹ï¼Œéœ€è¦æŒ‰éœ€å®ç° `@hippo/api` ä¸­çš„æŠ½è±¡å·¥ä½œæµå‘½ä»¤
    
*   ç¬¬ä¸‰å±‚æ˜¯ `@hippo/api`ã€‚å®ƒæ˜¯ hippo æ ¸å¿ƒåŒ…ï¼Œæä¾›äº†ä¸€äº›æ ¸å¿ƒå·¥ä½œæµå‘½ä»¤ï¼ˆcreateã€devã€lintã€buildã€testã€doctor ç­‰ï¼‰çš„æŠ½è±¡å®ç°ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸€äº›æ ¸å¿ƒå·¥å…·æ–¹æ³•ï¼Œæ¯”å¦‚ fs æ“ä½œã€git æ“ä½œã€logger ç­‰ã€‚`@hippo/cli` å’Œ `toolkit` å¯ä»¥ä½¿ç”¨ `@hippo/api` æä¾›çš„å·¥å…·æ–¹æ³•ï¼ŒåŒæ—¶ `toolkit` é’ˆå¯¹è¯¥é¡¹ç›®ç±»å‹æŒ‰éœ€å®ç° `@hippo/api` ä¸­çš„æ ¸å¿ƒå·¥ä½œæµå‘½ä»¤
    
*   æœ€åº•å±‚æ˜¯ `@hippo/api` ä¾èµ–çš„ä¸€äº›ç¬¬ä¸‰æ–¹åŸºç¡€åŒ…
    

> `@hippo/cli` å’Œ `@hippo/api` æœ¬èº«ä¸åŒ…å«ä»»ä½•ä¸ä¸šåŠ¡å¼ºç›¸å…³çš„é€»è¾‘

hippo æ ¸å¿ƒå·¥ä½œæµå¦‚ä¸‹

```
sequenceDiagram
    autonumber
        User->>Hippo: Input a command
        Hippo->>Hippo: Check if there is a valid "type" in "package.json" or "hippo-config.js"
        opt When "type" is valid
            Hippo->>Toolkit: Get the commands
            Toolkit-->Hippo: Return the commands
            Hippo->>Hippo: Register the commands
        end
        Hippo->>User: Return the result
```

4. hippo çš„å®ç°
============

4.1 @hippo/cli
--------------

æˆ‘ä»¬ä½¿ç”¨ clipanion[1] æ¥å®ç° cliã€‚å®˜æ–¹ä»‹ç»å®ƒçš„ä¼˜åŠ¿å¦‚ä¸‹

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHp65ZA3IxI96YkS0IwvB9mJ8Wetcib51wpjuEWksLicpXM0ib4hfkve2xF6icLibbZQ48juqPicx5LvONAg/640?wx_fmt=other)2023-06-30-15-15-05-image.png

åŒæ—¶ berry/yarn3[2] ä¹Ÿåœ¨ä½¿ç”¨å®ƒ

åœ¨ `@hippo/cli` ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å†…ç½®ä¸€äº› monorepo å‘½ä»¤å¹¶æ ¹æ®å½“å‰æ‰§è¡Œå‘½ä»¤çš„ cwd ä» `hippo-config.js` æˆ– `package.json` ä¸­è·å– toolkit type å’Œå¯¹åº”çš„ toolkit å‘½ä»¤å¹¶æ³¨å†Œåˆ° cli ä¸­ï¼Œæ ¸å¿ƒé€»è¾‘å¦‚ä¸‹

```
importÂ {Â Cli,Â Builtins,Â apisÂ }Â fromÂ '@hippo/api';importÂ {Â valuesÂ }Â fromÂ 'lodash';importÂ pkgJsonÂ fromÂ '../package.json';importÂ CloneCommandÂ fromÂ './commands/CloneCommand';importÂ FocusCommandÂ fromÂ './commands/FocusCommand';importÂ CreateCommandÂ fromÂ './commands/CreateCommand';importÂ ListCommandÂ fromÂ './commands/ListCommand';importÂ toolkitÂ fromÂ './utils/toolkit';importÂ {Â HippoToolkitÂ }Â fromÂ './interfaces';constÂ {Â version,Â nameÂ }Â =Â pkgJson;/**Â *Â CheckÂ theÂ versionÂ whenÂ theÂ commandÂ isÂ executedÂ */apis.npm.checkVersionAndLog(name,Â version);constÂ [,Â ,Â ...args]Â =Â process.argv;constÂ cliÂ =Â newÂ Cli({Â Â binaryLabel:Â `ShopeePayÂ Hippo`,Â Â binaryName:Â `hippo`,Â Â binaryVersion:Â version,});cli.register(FocusCommand);cli.register(CreateCommand);cli.register(ListCommand);/**Â *Â FindÂ theÂ currentÂ toolkitÂ andÂ registerÂ itsÂ pluginÂ commandsÂ */constÂ toolkitTypeÂ =Â apis.config.getToolkitType();ifÂ (toolkit.isValidToolkit(toolkitType))Â {Â Â constÂ commandsÂ =Â toolkit.requireModule(Â Â Â Â toolkitTypeÂ asÂ string,Â Â Â Â 'commands'Â Â )Â asÂ HippoToolkit['commands'];Â Â values(commands).forEach((plugin)Â =>Â {Â Â Â Â cli.register(plugin);Â Â });}cli.register(Builtins.HelpCommand);cli.register(Builtins.VersionCommand);cli.runExit(args);
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å†…ç½® cloneã€focusã€createã€listã€help å’Œ version å‘½ä»¤

### clone

æ­¤å‘½ä»¤ä¸»è¦ç”¨äºæé€Ÿ clone ä¸€ä¸ªåºå¤§çš„ monorepo git ä»“åº“ã€‚clone å‘½ä»¤ä½¿ç”¨éƒ¨åˆ† clone çš„æ–¹å¼æ¥æ˜¾è‘—å‡å°‘å¼€å§‹ä½¿ç”¨å­˜å‚¨åº“æ‰€éœ€çš„æ•°æ®é‡ã€‚é€šè¿‡å»¶è¿Ÿä»“åº“æ‰€æœ‰ blob ä¸‹è½½ï¼ˆç›´åˆ°éœ€è¦æ—¶ï¼‰ï¼Œå…è®¸ç”¨æˆ·å¿«é€Ÿå¤„ç†éå¸¸åºå¤§çš„ git ä»“åº“

å†…éƒ¨ä½¿ç”¨äº† microsoft/scalar[3] çš„ clone å‘½ä»¤

### focus

focus å‘½ä»¤ä¸»è¦ç”¨äºæˆ‘ä»¬å›¢é˜Ÿçš„ monorepo ä»“åº“ï¼Œå¯ä»¥æ ¹æ®ä¼ å…¥çš„ workspace æ¥å®‰è£…æ­¤ workspace å’Œå…¶ä¾èµ–çš„ workspace çš„ä¾èµ–ã€‚ç±»ä¼¼äº pnpm ä¸­çš„ pnpm install \--filter ...package\_name[4] å‘½ä»¤ã€‚

*   ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ pnpm å‘½ä»¤ï¼Ÿ
    
    å› ä¸ºæˆ‘ä»¬å›¢é˜Ÿä¸­ä½¿ç”¨ berry/yarn3[5] æ¥ç®¡ç† monorepoï¼Œå®ƒä¹Ÿæ²¡æœ‰æä¾›ç±»ä¼¼äº pnpm install \--filter ...package\_name[6] çš„å‘½ä»¤ã€‚yarn3 åªæä¾›äº† yarn worspaces focus package\_name[7] å‘½ä»¤ï¼Œç„¶è€Œæ­¤å‘½ä»¤å¹¶ä¸ä¼šå®‰è£… package_name ä¾èµ–çš„ workspace çš„ä¾èµ–ï¼Œæ‰€ä»¥æˆ‘ä»¬å®ç°äº† hippo focus å‘½ä»¤æ¥è¾¾åˆ°ä¸ pnpm ä¸€æ ·çš„æ•ˆæœ
    
*   ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ pnpm æ¥ç®¡ç† monorepoï¼Ÿ
    
    å› ä¸ºå½“æ—¶ pnpm æ²¡æœ‰æ”¯æŒ patch å‘½ä»¤ï¼Œè¿™å¯¹äºæˆ‘ä»¬éå¸¸é‡è¦ã€‚ï¼ˆç°åœ¨ pnpm å·²ç»æ”¯æŒ patch å‘½ä»¤äº†ï¼Œåç»­æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°† yarn3 åˆ‡æ¢ä¸º pnpmï¼‰
    

### list

list å‘½ä»¤ä¼šåˆ—å‡º `@hippo/cli` å†…ç½®äº†å“ªäº› toolkit

### help

cli å¸®åŠ©å‘½ä»¤

### version

æŸ¥çœ‹ cli ç‰ˆæœ¬çš„å‘½ä»¤

### create

ç†è®ºä¸Š create å‘½ä»¤åº”è¯¥æ”¾åˆ° toolkit ä¸­ï¼Œä½†æ˜¯åœ¨åˆ›å»ºä¸€ä¸ªé¡¹ç›®ä¹‹å‰ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“ç”¨æˆ·æƒ³è¦åˆ›å»ºå“ªç§ toolkit é¡¹ç›®ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½å°†æ­¤å‘½ä»¤æå‡åˆ° `@hippo/cli`ï¼Œè®©ç”¨æˆ·æ˜ç¡®é€‰æ‹©ä¸€ä¸ª toolkitã€‚åŒæ—¶ä¹Ÿå¯ä»¥å…ˆåœ¨ cli ä¸­æ”¶é›†è¦åˆ›å»ºçš„é¡¹ç›®åç§°ç­‰ä¿¡æ¯ï¼Œæ¥ç€å°†æ”¶é›†çš„é¡¹ç›®ä¿¡æ¯ä¼ å…¥å¹¶è°ƒç”¨å¯¹åº” toolkit ä¸­çš„ create å‘½ä»¤ã€‚æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹

```
importÂ {Â BaseCommand,Â Command,Â Option,Â apis,Â TemplateDataÂ }Â fromÂ '@hippo/api';importÂ {Â findÂ }Â fromÂ 'lodash';classÂ CreateCommandÂ extendsÂ BaseCommandÂ {Â Â ...Â Â asyncÂ run()Â {Â Â Â Â //Â è·å–toolkitåˆ—è¡¨Â Â Â Â constÂ toolkitsÂ =Â toolkit.getList();Â Â Â Â //Â ç”¨æˆ·é€‰æ‹©toolkitÂ Â Â Â constÂ responseÂ =Â awaitÂ prompts({Â Â Â Â Â Â Â Â Â Â type:Â 'select',Â Â Â Â Â Â Â Â Â Â name:Â 'toolkitType',Â Â Â Â Â Â Â Â Â Â message:Â 'PleaseÂ selectÂ theÂ projectÂ typeÂ youÂ wantÂ toÂ use',Â Â Â Â Â Â Â Â Â Â choices:Â toolkits,Â Â Â Â Â Â Â Â Â Â initial:Â 0,Â Â Â Â Â Â Â Â });Â Â Â Â Â constÂ toolkitTypeÂ =Â response.toolkitType;Â Â Â Â Â constÂ targetToolkitÂ =Â find(toolkits,Â {Â value:Â toolkitTypeÂ });Â Â Â Â Â //Â æ”¶é›†é¡¹ç›®åç§°ã€æè¿°ç­‰ä¿¡æ¯Â Â Â Â Â constÂ templateDataÂ =Â awaitÂ CreateCommand.getTemplateData(Â Â Â Â Â Â Â Â targetToolkit?.titleÂ Â Â Â Â Â );Â Â Â Â Â //Â è·å–å¯¹åº”toolkitçš„createå‘½ä»¤å¹¶æ‰§è¡ŒÂ Â Â Â Â constÂ createÂ =Â toolkit.requireModule(toolkitType,Â 'create'Â Â Â Â Â awaitÂ create(templateData);Â Â }}
```

åŒæ—¶ `@hippo/cli` ä¼šæ ¹æ®å½“å‰æ‰§è¡Œå‘½ä»¤çš„ cwd è·å–å¯¹åº”çš„ toolkit å‘½ä»¤å¹¶æ³¨å†Œåˆ° cli ä¸­ï¼Œè¿™æ ·åœ¨ä¸€ä¸ª toolkit é¡¹ç›®ä¸­ï¼Œå½“è°ƒç”¨ hippo buildã€hippo lint ç­‰å·¥ä½œæµå‘½ä»¤æ—¶ï¼Œå°±ä¼šæ‰§è¡Œåˆ°ç›¸åº”çš„ toolkit ä¸­çš„å®ç°çš„å·¥ä½œæµå‘½ä»¤

> å½“ä¸€ä¸ªæ–°çš„ toolkit å¼€å‘å®Œæ¯•åï¼Œ`@hippo/cli` å¯ä»¥å®‰è£…å®ƒä½œä¸ºä¸€ä¸ªå†…ç½® toolkitã€‚ä½†è¿™ç§æ–¹å¼éœ€è¦åœ¨æ¯æ¬¡æ–°å¢ toolkit ä¹‹åä¿®æ”¹ `@hippo/cli` ä»£ç å¹¶ä¸”å‘ç‰ˆï¼ŒåŒæ—¶ä½¿ç”¨æ–¹è¿˜éœ€è¦æ›´æ–°ï¼Œæ•ˆç‡æ¯”è¾ƒä½ã€‚
> 
> æ‰€ä»¥ä¸ºäº†ä¼˜åŒ–æ“ä½œæµç¨‹ï¼Œåœ¨ `toolkit.getList()` å’Œ `toolkit.requireModule` æ–¹æ³•ä¸­æˆ‘ä»¬ä¼šåŒæ—¶ require å½“å‰é¡¹ç›®çš„ node-modules ç›®å½•ä¸­å®‰è£…çš„ toolkitï¼Œè¿™æ„å‘³ç€é¡¹ç›®ä¸­åªéœ€è¦å®‰è£…å¯¹åº”çš„ toolkitï¼Œhippo cli ä¹Ÿä¼š resolve å®ƒä»¬å¹¶ä¸”æ³¨å†Œç›¸åº”çš„å‘½ä»¤

4.2 @hippo/api
--------------

æ­¤åŒ…ä¸»è¦æä¾›äº†ä¸€äº›å·¥å…·æ–¹æ³•å’Œå·¥ä½œæµå‘½ä»¤çš„æŠ½è±¡å®ç°ã€‚æŠ½è±¡å‘½ä»¤æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹

### BaseCommand

```
importÂ {Â Command,Â OptionÂ }Â fromÂ 'clipanion';importÂ {Â $Â }Â fromÂ 'zx';importÂ *Â asÂ apisÂ fromÂ '../utils';exportÂ defaultÂ abstractÂ classÂ BaseCommandÂ extendsÂ CommandÂ {Â Â verboseÂ =Â Option.Boolean('--verbose',Â false,Â {Â hidden:Â trueÂ });Â Â /**Â Â Â *Â SetÂ apisÂ asÂ anÂ propertyÂ Â Â */Â Â apisÂ =Â apis;Â Â asyncÂ execute()Â {Â Â Â Â $.verboseÂ =Â this.verbose;Â Â Â Â awaitÂ this.run();Â Â }Â Â abstractÂ run():Â void;}
```

### BuildCommand

```
importÂ {Â CommandÂ }Â fromÂ 'clipanion';importÂ BaseCommandÂ fromÂ './BaseCommand';exportÂ defaultÂ abstractÂ classÂ BuildCommandÂ extendsÂ BaseCommandÂ {Â Â staticÂ pathsÂ =Â [['build']];Â Â staticÂ usageÂ =Â Command.Usage({Â Â Â Â description:Â 'BuildÂ theÂ resources',Â Â Â Â examples:Â [['BuildÂ theÂ resources',Â '$0Â build']],Â Â });}
```

### TestCommand

```
importÂ {Â argvÂ }Â fromÂ 'zx';importÂ {Â Command,Â OptionÂ }Â fromÂ 'clipanion';importÂ {Â runCLIÂ }Â fromÂ 'jest';importÂ {Â omitÂ }Â fromÂ 'lodash';importÂ typeÂ {Â ConfigÂ }Â fromÂ '@jest/types';importÂ BaseCommandÂ fromÂ './BaseCommand';importÂ {Â fs,Â createLoggerÂ }Â fromÂ '../utils';constÂ {Â CIÂ }Â =Â process.env;exportÂ defaultÂ abstractÂ classÂ TestCommandÂ extendsÂ BaseCommandÂ {Â Â staticÂ pathsÂ =Â [['test']];Â Â staticÂ usageÂ =Â Command.Usage({Â Â Â Â description:Â 'RunÂ unitÂ testÂ usingÂ Jest',Â Â Â Â examples:Â [['RunÂ unitÂ testÂ usingÂ Jest',Â '$0Â test']],Â Â });Â Â loggerÂ =Â createLogger('hippo-test');Â Â /**Â Â Â *Â AllÂ theÂ lastÂ argsÂ toÂ passÂ toÂ "Jest"Â directlyÂ Â Â */Â Â argsÂ =Â Option.Proxy();Â Â /**Â Â Â *Â GetÂ theÂ jestÂ configsÂ Â Â *Â @returnsÂ Â Â */Â Â abstractÂ getJestConfig():Â Promise<Config.InitialOptions>;Â Â asyncÂ run()Â {Â Â Â Â /**Â Â Â Â Â *Â GetÂ theÂ toolkitÂ devÂ functionÂ Â Â Â Â */Â Â Â Â constÂ jestConfigsÂ =Â awaitÂ this.getJestConfig();Â Â Â Â constÂ jestCliArgsÂ =Â omit(argv,Â ['_']);Â Â Â Â ifÂ (jestConfigs)Â {Â Â Â Â Â Â tryÂ {Â Â Â Â Â Â Â Â ifÂ (Â Â Â Â Â Â Â Â Â Â process.env.NODE_ENVÂ ===Â nullÂ ||Â Â Â Â Â Â Â Â Â Â process.env.NODE_ENVÂ ===Â undefinedÂ Â Â Â Â Â Â Â )Â {Â Â Â Â Â Â Â Â Â Â /**Â Â Â Â Â Â Â Â Â Â Â *Â WhenÂ weÂ useÂ jestÂ inÂ normalÂ scenes,Â jestÂ wouldÂ addÂ thisÂ envÂ automaticallyÂ inÂ itsÂ bin(https://github.com/facebook/jest/blob/39667e3680fb463eb8caedfa7e1f9edb3f0b69a2/packages/jest-cli/bin/jest.js#L13).Â Â Â Â Â Â Â Â Â Â Â *Â InÂ hippoÂ weÂ directlyÂ usedÂ runCLIÂ fromÂ jestÂ toÂ runÂ test,Â soÂ thisÂ envÂ variableÂ isÂ nullÂ inÂ hippo.Â Â Â Â Â Â Â Â Â Â Â */Â Â Â Â Â Â Â Â Â Â process.env.NODE_ENVÂ =Â 'test';Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â //Â WeÂ needÂ addÂ someÂ optionsÂ whenÂ itÂ isÂ inÂ "CI"Â environmentÂ Â Â Â Â Â Â Â constÂ ciArgsÂ =Â CIÂ Â Â Â Â Â Â Â Â Â ?Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â maxWorkers:Â 3,Â Â Â Â Â Â Â Â Â Â Â Â Â Â ci:Â true,Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â Â Â :Â {};Â Â Â Â Â Â Â Â constÂ {Â resultsÂ }Â =Â awaitÂ runCLI(Â Â Â Â Â Â Â Â Â Â {Â Â Â Â Â Â Â Â Â Â Â Â config:Â JSON.stringify(jestConfigs),Â Â Â Â Â Â Â Â Â Â Â Â //Â WeÂ don'tÂ collectÂ coverageÂ byÂ defaultÂ Â Â Â Â Â Â Â Â Â Â Â coverage:Â false,Â Â Â Â Â Â Â Â Â Â Â Â ...ciArgs,Â Â Â Â Â Â Â Â Â Â Â Â ...jestCliArgs,Â Â Â Â Â Â Â Â Â Â }Â asÂ Config.Argv,Â Â Â Â Â Â Â Â Â Â [fs.cwd]Â Â Â Â Â Â Â Â );Â Â Â Â Â Â Â Â //Â ExitÂ theÂ processÂ whenÂ theseÂ areÂ failedÂ testsÂ Â Â Â Â Â Â Â constÂ {Â numFailedTestsÂ }Â =Â results;Â Â Â Â Â Â Â Â ifÂ (numFailedTestsÂ >Â 0)Â {Â Â Â Â Â Â Â Â Â Â process.exit(1);Â Â Â Â Â Â Â Â }Â Â Â Â Â Â }Â catchÂ (e)Â {Â Â Â Â Â Â Â Â this.logger.error('%o',Â e);Â Â Â Â Â Â Â Â process.exit(1);Â Â Â Â Â Â }Â Â Â Â }Â Â }}
```

test å‘½ä»¤ä½¿ç”¨ jest æ¥è¿è¡Œï¼ŒåŒæ—¶åœ¨ toolkit test å‘½ä»¤ä¸­åªéœ€è¦ç»§æ‰¿ `@hippo/api`ä¸­çš„ TestCommandï¼Œç„¶åå®ç° `getJestConfig` æ–¹æ³•è¿”å›ç›¸åº”çš„ jest é…ç½®å³å¯

### LintCommand

```
importÂ {Â pathÂ }Â fromÂ 'zx';importÂ {Â Command,Â OptionÂ }Â fromÂ 'clipanion';importÂ *Â asÂ tÂ fromÂ 'typanion';importÂ {Â filterÂ }Â fromÂ 'lodash';importÂ {Â ESLINT_FILE_EXTÂ }Â fromÂ './constant';importÂ eslintCheckÂ fromÂ './eslint';importÂ typeCheckÂ fromÂ './typeCheck';importÂ printÂ fromÂ './print';importÂ BaseCommandÂ fromÂ '../BaseCommand';importÂ {Â createLogger,Â fs,Â gitÂ asÂ getAddedFilesÂ }Â fromÂ '../../utils';importÂ {Â HippoLintConfigÂ }Â fromÂ '../../interfaces';exportÂ defaultÂ abstractÂ classÂ LintCommandÂ extendsÂ BaseCommandÂ {Â Â staticÂ pathsÂ =Â [['lint']];Â Â staticÂ usageÂ =Â Command.Usage({Â Â Â Â description:Â Â Â Â Â Â 'CheckÂ theÂ codeÂ byÂ ESLint,Â tscÂ accordingÂ toÂ theÂ hippoÂ typeÂ setting',Â Â Â Â examples:Â [['LintÂ aÂ workspace',Â '$0Â lint']],Â Â });Â Â /**Â Â Â *Â TagÂ ifÂ itÂ isÂ strictÂ mode(warnÂ messageÂ alsoÂ triggerÂ process.exit)Â Â Â */Â Â strictÂ =Â Option.Boolean('--strict');Â Â /**Â Â Â *Â AutoÂ FixÂ OptionÂ Â Â *Â OnlyÂ worksÂ forÂ 'ESLint'Â Â Â */Â Â fixÂ =Â Option.Boolean('--fix');Â Â /**Â Â Â *Â IfÂ CheckÂ CommitÂ FilesÂ Â Â *Â OnlyÂ worksÂ forÂ 'ESLint'Â Â Â */Â Â checkCommitÂ =Â Option.Boolean('--check-commit');Â Â /**Â Â Â *Â LintÂ SourceÂ OptionÂ Â Â *Â OnlyÂ worksÂ forÂ 'ESLint'Â Â Â */Â Â srcÂ =Â Option.String('--src');Â Â /**Â Â Â *Â LimitÂ theÂ maxÂ warnÂ numbersÂ Â Â */Â Â maxWarningsÂ =Â Option.String('--max-warnings',Â {Â validator:Â t.isNumber()Â });Â Â /**Â Â Â *Â LoggerÂ Â Â */Â Â loggerÂ =Â createLogger('hippo-lint');Â Â /**Â Â Â *Â GetÂ theÂ LintÂ ConfigsÂ Â Â */Â Â abstractÂ getLintConfigs():Â Promise<HippoLintConfig>;Â Â asyncÂ run()Â {Â Â Â Â constÂ lintÂ =Â awaitÂ this.getLintConfigs();Â Â Â Â //Â GetÂ theÂ filesÂ fromÂ gitÂ diffÂ Â Â Â constÂ gitCommittedFilesÂ =Â this.checkCommitÂ Â Â Â Â Â ?Â awaitÂ getAddedFiles()Â Â Â Â Â Â :Â undefined;Â Â Â Â this.logger.debug('TheÂ committedÂ filesÂ areÂ %o',Â gitCommittedFiles);Â Â Â Â /**Â Â Â Â Â *Â ExecuteÂ theÂ typeÂ check.Â IfÂ youÂ don'tÂ addÂ thisÂ pathÂ inÂ config,Â weÂ won'tÂ doÂ anyÂ typeÂ checkÂ Â Â Â Â */Â Â Â Â constÂ tscResultsÂ =Â lint?.lintConfig?.typescriptÂ Â Â Â Â Â ?Â awaitÂ typeCheck(lint.lintConfig.typescript)Â Â Â Â Â Â :Â null;Â Â Â Â /**Â Â Â Â Â *Â GetÂ theÂ eslintÂ filesÂ Â Â Â Â */Â Â Â Â constÂ eslintFilesÂ =Â this.getLintFiles(ESLINT_FILE_EXT,Â gitCommittedFiles);Â Â Â Â this.logger.debug('TheÂ lintÂ fileÂ patternÂ isÂ %o',Â eslintFiles);Â Â Â Â constÂ eslintResultsÂ =Â awaitÂ eslintCheck(Â Â Â Â Â Â {Â Â Â Â Â Â Â Â fix:Â this.fix,Â Â Â Â Â Â Â Â strict:Â this.strict,Â Â Â Â Â Â Â Â eslintrc:Â lint?.lintConfig?.eslintÂ asÂ string,Â Â Â Â Â Â Â Â eslintIgnore:Â lint?.ignorePath?.eslint,Â Â Â Â Â Â },Â Â Â Â Â Â eslintFilesÂ Â Â Â );Â Â Â Â //Â PrintÂ theÂ resultÂ Â Â Â constÂ {Â errorCount,Â warningCountÂ }Â =Â print({Â Â Â Â Â Â eslint:Â eslintResults,Â Â Â Â Â Â tsc:Â tscResults,Â Â Â Â });Â Â Â Â /**Â Â Â Â Â *Â ExitÂ theÂ processÂ whenÂ checkÂ commitÂ andÂ errorCountÂ isÂ notÂ 0Â Â Â Â Â *Â ExitÂ theÂ processÂ whenÂ checkÂ commitÂ andÂ warnCountÂ isÂ notÂ 0Â andÂ itÂ isÂ strictÂ modeÂ Â Â Â Â *Â ExitÂ theÂ processÂ whenÂ theÂ warnÂ countÂ isÂ moreÂ thanÂ theÂ limitÂ Â Â Â Â */Â Â Â Â ifÂ (Â Â Â Â Â Â errorCountÂ >Â 0Â ||Â Â Â Â Â Â (this.strictÂ &&Â warningCountÂ >Â 0)Â ||Â Â Â Â Â Â (this.maxWarningsÂ &&Â warningCountÂ -Â this.maxWarningsÂ >Â 0)Â Â Â Â )Â {Â Â Â Â Â Â process.exit(1);Â Â Â Â }Â Â }Â Â /**Â Â Â *Â GetÂ theÂ lintÂ fileÂ patternÂ forÂ differentÂ pathÂ Â Â *Â @paramÂ {string[]}Â extÂ FileÂ extensionÂ listÂ Â Â *Â @paramÂ {string[]}Â filesÂ FileÂ ListÂ Â Â *Â @returnsÂ Â Â */Â Â getLintFiles(ext:Â string[],Â files?:Â string[])Â {Â Â Â Â ifÂ (filesÂ &&Â files.length)Â {Â Â Â Â Â Â returnÂ filter(files,Â (fileName)Â =>Â ext.includes(path.extname(fileName)));Â Â Â Â }Â Â Â Â constÂ patternÂ =Â `**/*.{${ext.map((e)Â =>Â e.replace(/^./,Â '')).join(',')}}`;Â Â Â Â returnÂ path.resolve(fs.cwd,Â this.srcÂ ||Â fs.cwd,Â pattern);Â Â }}
```

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ `@hippo/api` LintCommand ä¸­ï¼Œå†…éƒ¨ä¼šè°ƒç”¨ Eslint å’Œ Typescript API æ¥æ ¡éªŒä»£ç ï¼Œåœ¨ toolkit lint å‘½ä»¤ä¸­åªéœ€è¦ç»§æ‰¿ `@hippo/api` ä¸­çš„ LintCommandï¼Œç„¶åå®ç° `getLintConfigs` æ–¹æ³•ä¼ å…¥ç›¸åº”çš„ eslint å’Œ typescript é…ç½®æ–‡ä»¶è·¯å¾„å³å¯

å…¶ä»– `@hippo/api` æŠ½è±¡å‘½ä»¤å®ç°é€»è¾‘å¤§åŒå°å¼‚ï¼Œè¿™é‡Œå°±ä¸åœ¨èµ˜è¿°äº†ã€‚

> ä»¥ä¸Šä»£ç åªæ˜¯æ ¸å¿ƒé€»è¾‘ï¼Œä¸åŒ…å«å®Œæ•´çš„é€»è¾‘é“¾è·¯

4.3 @hippo/toolkit-*
--------------------

å¼€å‘çš„ toolkit åç§°å¿…é¡»è¦ä»¥ `@hippo/toolkit-` å¼€å¤´ã€‚toolkit éœ€è¦ä¾èµ– `@hippo/api` å¹¶ä¸”æŒ‰éœ€å®ç°å¯¹åº”çš„å·¥ä½œæµå‘½ä»¤ã€‚æ¯”å¦‚

`BuildCommand`

```
importÂ {Â BuildCommandÂ asÂ BuildBaseCommandÂ }Â fromÂ '@hippo/api';exportÂ defaultÂ classÂ BuildCommandÂ extendsÂ BuildBaseCommandÂ {Â Â loggerÂ =Â this.apis.createLogger('library-build');Â Â asyncÂ run()Â {Â Â Â Â //Â doÂ something...Â Â }}
```

`LintCommand`

```
importÂ {Â LintCommandÂ asÂ LintBaseCommandÂ }Â fromÂ '@hippo/api';importÂ {Â pathÂ }Â fromÂ 'path';exportÂ defaultÂ classÂ LintCommandÂ extendsÂ LintBaseCommandÂ {Â Â asyncÂ getLintConfigs()Â {Â Â Â Â returnÂ {Â Â Â Â Â Â ignorePath:Â {Â Â Â Â Â Â Â Â eslint:Â path.resolve(__dirname,Â '../../configs/.eslintignore'),Â Â Â Â Â Â },Â Â Â Â Â Â lintConfig:Â {Â Â Â Â Â Â Â Â eslint:Â path.resolve(__dirname,Â '../../configs/.eslintrc.yml'),Â Â Â Â Â Â Â Â typescript:Â {Â Â Â Â Â Â Â Â Â Â extends:Â path.resolve(__dirname,Â '../../configs/tsconfig.json'),Â Â Â Â Â Â Â Â },Â Â Â Â Â Â },Â Â Â Â };Â Â }}
```

åŒæ—¶ toolkit é™¤äº†å·¥ä½œæµå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥å®ç°å…¶ä»–éå·¥ä½œæµå‘½ä»¤ã€‚åªéœ€è¦ç»§æ‰¿ `@hippo/api` ä¸­çš„ `BaseCommand` , åŒæ—¶å¯¼å‡ºåˆ° `commands` å±æ€§ä¸­å³å¯ï¼ˆ`@hippo/cli` ä¼šä» toolkit çš„ `commands` å±æ€§ä¸­è·å–æ‰€æœ‰å‘½ä»¤ä¾æ¬¡æ³¨å†Œåˆ° cli ä¸­ï¼‰

```
importÂ {Â BaseCommand,Â Option,Â CommandÂ }Â fromÂ '@hippo/api';exportÂ defaultÂ classÂ OtherCommandÂ extendsÂ BaseCommandÂ {Â Â staticÂ pathsÂ =Â [['other']];Â Â asyncÂ run()Â {Â Â Â Â //Â doÂ something...Â Â }}
```

toolkit çš„å…¥å£æ–‡ä»¶ä¸€èˆ¬å¦‚ä¸‹ï¼š

```
exportÂ constÂ displayNameÂ =Â 'Monorepo';exportÂ constÂ descriptionÂ =Â 'AÂ monorepoÂ project';exportÂ constÂ nameÂ =Â 'monorepo';exportÂ {Â versionÂ }Â fromÂ '../package.json';exportÂ {Â defaultÂ asÂ createÂ }Â fromÂ './create';exportÂ *Â asÂ commandsÂ fromÂ './commands';
```

> ç›®å‰æˆ‘ä»¬å†…ç½®äº† 6 ç§ toolkit
> 
> ![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHp65ZA3IxI96YkS0IwvB9mJQS3w3iceGcfmSWIibo53IgMnvFQnH3g5atgZIv39zoiav3a14QGiaeNAUg/640?wx_fmt=other)2023-06-30-17-36-35-image.png

5. hippo è§„èŒƒ
===========

ä»ä¸Šæ–‡å¾—çŸ¥ï¼Œåœ¨ toolkit lint å‘½ä»¤ä¸­ï¼Œä¸€èˆ¬ä¼šè¿”å›ç›¸åº”çš„ eslint é…ç½®æ–‡ä»¶ï¼Œeslint é…ç½®æ–‡ä»¶å…¶ä¸€èˆ¬ä¸º

```
extends:Â '@hippo/eslint-config/recommended'
```

5.1 @hippo/eslint-config
------------------------

`@hippo/eslint-config` æ˜¯æˆ‘ä»¬æä¾›çš„ä¸€å¥— eslint è§„èŒƒï¼Œç›®å‰æˆ‘ä»¬å›¢é˜Ÿä¸¥æ ¼éµå¾ªæ­¤è§„èŒƒï¼Œå®ƒåŸºäºÂ eslint-config-airbnb-base[8] å¹¶ä¸”ä¿®æ”¹äº†ä¸€äº›æˆ‘ä»¬è®¤ä¸ºä¸åˆç†çš„è§„åˆ™ï¼ŒåŒæ—¶ä¹Ÿç»§æ‰¿äº†æˆ‘ä»¬å®ç° `@hippo/eslint-plugin` ã€‚

æ­¤å¤–ï¼Œ`@hippo/eslint-config`Â ä¹Ÿæ”¯æŒ `all-in-one`Â ç‰¹æ€§ï¼Œå³ä½¿ç”¨æ–¹ä¸éœ€è¦å®‰è£…ä»»ä½•Â `eslint-config-*`Â æˆ–Â `eslint-plugin`Â ä¾èµ–

> ç›®å‰ç¤¾åŒºä¸Šä¸»æµçš„ eslint configÂ éƒ½éœ€è¦ä½¿ç”¨æ–¹åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­å®‰è£…é¢å¤–çš„ eslint plugin ä¾èµ–ï¼Œæ¯”å¦‚
> 
> *   eslint-config-airbnb-base[9]
>     
> *   eslint-config-standard[10]
>     
> *   eslint-config-alloy[11]
>     
> *   ...
>     
> 
> ç„¶è€ŒÂ `@hippo/eslint-config`Â å†…ç½®äº† config å¿…è¦çš„ eslint plugin
> 
> *   eslint-plugin-import[12]
>     
> *   eslint-plugin-react[13]
>     
> *   eslint-plugin-react-hooks[14]
>     
> *   eslint-plugin-react-native[15]
>     
> *   eslint-plugin-eslint-comments[16]
>     
> *   \@typescript-eslint/eslint-plugin[17]
>     
> *   @hippo/eslint-plugin
>     
> 
> ä½¿ç”¨æ–¹åªéœ€è¦å®‰è£…Â `@hippo/eslint-config`Â å³å¯ï¼Œé™ä½å¿ƒæ™ºè´Ÿæ‹…

ç›®å‰Â `@hippo/eslint-config`Â æä¾›äº†å››ç§ config setï¼Œåˆ†åˆ«ä¸º

### recommended

æä¾›ç»™ node é¡¹ç›®æˆ–è€…çº¯ JavaScript é¡¹ç›®ä½¿ç”¨

```
require('@rushstack/eslint-patch/modern-module-resolution');module.exportsÂ =Â {Â Â extends:Â [Â Â Â Â 'airbnb-base',Â Â Â Â 'eslint:recommended',Â Â Â Â 'plugin:@typescript-eslint/recommended',Â Â Â Â 'prettier',Â Â Â Â 'plugin:@hippo/recommended',Â Â Â Â 'plugin:eslint-comments/recommended',Â Â ],Â Â reportUnusedDisableDirectives:Â true,Â Â settings:Â {Â Â Â Â 'import/resolver':Â [Â Â Â Â Â Â require.resolve('eslint-import-resolver-node'),Â Â Â Â Â Â require.resolve('eslint-import-resolver-typescript'),Â Â Â Â ],Â Â Â Â //Â AppendÂ 'ts'Â extensionsÂ toÂ AirbnbÂ 'import/extensions'Â settingÂ Â Â Â 'import/extensions':Â ['.js',Â '.mjs',Â '.jsx',Â '.ts',Â '.tsx',Â '.d.ts'],Â Â },Â Â rules:Â {Â Â Â Â //Â TheÂ reasonÂ whyÂ AirbnbÂ turnedÂ onÂ thisÂ ruleÂ isÂ thatÂ theyÂ discourageÂ toÂ useÂ loopsÂ Â Â Â //Â DetailsÂ inÂ https://github.com/airbnb/javascript/issues/1103Â Â Â Â //Â ThatÂ doesn'tÂ makeÂ senseÂ toÂ usÂ sinceÂ weÂ allowÂ toÂ useÂ `while`Â andÂ early-returnÂ techniqueÂ reliesÂ onÂ `continue`Â inÂ loopsÂ Â Â Â 'no-continue':Â 'off',Â Â Â Â ...Â Â }}
```

### react-native

æä¾›ç»™ react native é¡¹ç›®ä½¿ç”¨

```
require('@rushstack/eslint-patch/modern-module-resolution');module.exportsÂ =Â {Â Â env:Â {Â Â Â Â 'react-native/react-native':Â true,Â Â },Â Â extends:Â [require.resolve('./react'),Â 'plugin:react-native/all'],Â Â settings:Â {Â Â Â Â 'import/resolver':Â [Â Â Â Â Â Â require.resolve('./utils/aliasResolver'),Â Â Â Â Â Â require.resolve('eslint-import-resolver-typescript'),Â Â Â Â Â Â {Â Â Â Â Â Â Â Â [require.resolve('eslint-import-resolver-react-native')]:Â {Â Â Â Â Â Â Â Â Â Â //Â whichÂ extensionsÂ willÂ beÂ searchedÂ Â Â Â Â Â Â Â Â Â extensions:Â ['.tsx',Â '.ts',Â '.js',Â '.jsx',Â '.mjs'],Â Â Â Â Â Â Â Â },Â Â Â Â Â Â },Â Â Â Â ],Â Â },Â Â rules:Â {Â Â Â Â //Â FIXME:Â weÂ mightÂ needÂ toÂ developÂ aÂ similarÂ butÂ specificÂ ruleÂ forÂ react-nativeÂ Â Â Â '@typescript-eslint/no-use-before-define':Â ['error',Â {Â variables:Â falseÂ }],Â Â Â Â 'react-native/no-color-literals':Â 'off',Â Â Â Â 'react-native/sort-styles':Â 'off',Â Â },};
```

æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬é…ç½®äº†ä¸€ä¸ªé¢å¤–çš„ aliasResolverï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„ RN é¡¹ç›®ä¸­ä½¿ç”¨äº†åˆ«åï¼Œæ˜¯é€šè¿‡ babel-plugin-module-resolver[18] æ­¤ babel plugin æ”¯æŒçš„ã€‚ä¸ºäº†è®©Â `eslint-plugin-import`Â ä¸­çš„éœ€è¦ resolve æ–‡ä»¶çš„è§„åˆ™èƒ½è§£æåˆ°æ­£ç¡®çš„æ–‡ä»¶è·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª resolver[19]ã€‚å…¶å†…éƒ¨åŸç†æ¯”è¾ƒç®€å•ä¸ babel-plugin-module-resolver[20] åŸºæœ¬ä¸€è‡´ã€‚

### react

æä¾›ç»™ä¿æŒè€çš„ JSX transformï¼ˆturned JSX intoÂ `React.createElement(...)`Â callsï¼‰çš„ react é¡¹ç›®ä½¿ç”¨

```
require('@rushstack/eslint-patch/modern-module-resolution');module.exportsÂ =Â {Â Â extends:Â [Â Â Â Â 'airbnb/rules/react',Â //Â don'tÂ importÂ a11yÂ rulesÂ Â Â Â 'airbnb/hooks',Â Â Â Â require.resolve('./recommended'),Â Â ],Â Â rules:Â {Â Â Â Â //Â SinceÂ weÂ alreadyÂ useÂ TypeScript,Â weÂ don'tÂ quiteÂ needÂ thisÂ ruleÂ Â Â Â 'react/require-default-props':Â 'off',Â Â Â Â //Â SinceÂ weÂ alreadyÂ useÂ TypeScript,Â turningÂ onÂ thisÂ ruleÂ willÂ conflictÂ withÂ tsÂ typeÂ detectionÂ Â Â Â 'react/static-property-placement':Â 'off',Â Â Â Â 'react/function-component-definition':Â 'off',Â Â Â Â 'react/jsx-filename-extension':Â [1,Â {Â extensions:Â ['.tsx']Â }],Â Â Â Â //Â NoÂ worriesÂ sinceÂ weÂ writeÂ inÂ TypeScriptÂ Â Â Â 'react/jsx-props-no-spreading':Â 'off',Â Â },};
```

### react-17

æä¾›ç»™ä½¿ç”¨äº†æ–°çš„Â new-jsx-transform[21]Â JSX transform çš„ react é¡¹ç›®ä½¿ç”¨

```
require('@rushstack/eslint-patch/modern-module-resolution');module.exportsÂ =Â {Â Â extends:Â [require.resolve('./react'),Â 'plugin:react/jsx-runtime'],};
```

### å¦‚ä½•æ”¯æŒ all-in-one ç‰¹æ€§ï¼Ÿ

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Â \@rushstack/eslint-patch/modern-module-resolution[22]

æˆ‘ä»¬åœ¨æ¯ä¸ª config set ä¹‹å‰ä¼šè°ƒç”¨

```
require('@rushstack/eslint-patch/modern-module-resolution');
```

å®ƒå°† resolve `eslint-plugin-*` æˆ– `eslint-config-*` çš„æ–¹å¼ä»ç”¨æˆ·é¡¹ç›®ä¸­çš„ node_modules æ”¹å˜ä¸ºæˆ‘ä»¬ config ä¸­çš„ node_modulesï¼Œä»è€Œå®Œç¾çš„æ”¯æŒ `all-in-one` ç‰¹æ€§

5.2 @hippo/eslint-plugin
------------------------

`@hippo/eslint-plugin` å®ç°äº†ä¸€äº›æˆ‘ä»¬å›¢é˜Ÿçš„ Eslint ruleï¼Œç”±äºç¯‡å¹…æœ‰é™è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚

å‚è€ƒï¼š

*   Feflow[23]
    
*   modernjs.dev/[24]
    
*   GitHub - yarnpkg/berry: ğŸ“¦ğŸˆ Active development trunk for Yarn âš’[25]
    

å…³äºæœ¬æ–‡  

ä½œè€…ï¼šlcwlucky
===========

https://juejin.cn/post/7250375753597943863

æœ€å
--

æ¬¢è¿å…³æ³¨ã€å‰ç«¯ç“¶å­å›ã€‘âœ¿âœ¿ãƒ½ (Â°â–½Â°) ãƒâœ¿

å›å¤ã€Œäº¤æµã€ï¼Œå¹å¹æ°´ã€èŠèŠæŠ€æœ¯ã€ååæ§½ï¼

å›å¤ã€Œé˜…è¯»ã€ï¼Œæ¯æ—¥åˆ·åˆ·é«˜è´¨é‡å¥½æ–‡ï¼

å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œã€Œåœ¨çœ‹ã€æ˜¯æœ€å¤§çš„æ”¯æŒï¼

```
æœ€åä¸è¦å¿˜äº†ç‚¹èµå‘¦ï¼

```