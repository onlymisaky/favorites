> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Os4U_AZGJiflkVe1WRBt0Q)

ç‚¹å‡»ä¸Šæ–¹Â é«˜çº§å‰ç«¯è¿›é˜¶ï¼Œå›å¤ â€œåŠ ç¾¤â€  

åŠ å…¥æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ï¼Œå¤©å¤©è¿›æ­¥

![](https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHoX7icOibtUaZRAZD45BVfCwGoyklFcic3PXhibI7fCiboxLL2VmEWYOfsQwMzBtJoBHvGeqvgSbHwaXKg/640?wx_fmt=png)

  

ä½ çœŸçš„äº†è§£ React å—ï¼Ÿæˆ‘ä»¬åœ¨é¢è¯•ä¸­å¾€å¾€æ¶‰åŠ React æ—¶ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ â€œè§£é‡Š React æ˜¯ä»€ä¹ˆâ€ã€‚è§£é‡Šä¸€ç§æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Œåœ¨é¢è¯•ä¸­ä¹Ÿæ˜¯éå¸¸å¸¸è§çš„å¼•èµ· è¯é¢˜çš„é¢˜ç›®ã€‚æœ¬ç¯‡æ–‡ç« æˆ‘å°±å¸¦ä½ æŒæ¡è¿™ä¸€ç±»æ¦‚å¿µé¢˜çš„è§£ç­”æŠ€å·§ã€‚

ä¸€. è¯´è¯´å¯¹ React çš„ç†è§£ï¼Œæœ‰å“ªäº›ç‰¹æ€§
----------------------

å®˜æ–¹çš„è§£é‡Š: React æ˜¯ä¸€ä¸ª UI åº“ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯`UI=F(data)`, å³ç•Œé¢çš„å‘ˆç°æ˜¯ç”±å‡½æ•°ä¼ å…¥çš„å‚æ•°å†³å®šçš„

å¼€å‘è€…ä¸å†éœ€è¦å…³å¿ƒç•Œé¢æ—¶å¦‚ä½•æ¸²æŸ“çš„ï¼Œåªè¦å…³å¿ƒæ•°æ®çš„ç”Ÿæˆå’Œä¼ é€’ï¼Œè¿™å¤§å¤§æé«˜çš„å¼€å‘è€…çš„å¼€å‘æ•ˆç‡ï¼ŒèŠ‚çœäº†å¼€å‘æ—¶é—´

å…¶æ¬¡ React è®¾è®¡çš„

*   ä½¿ç”¨ç±»ä¼¼ HTML çš„`JSX`è¯­æ³•æ¥æè¿°è§†å›¾
    
*   é€šè¿‡`è™šæ‹ŸDOM`ä¿®æ”¹`çœŸå®DOM`
    
*   é€šè¿‡`setState`ä¿®æ”¹æ•°æ®
    
*   åœ¨ä¸åŒçš„`ç”Ÿå‘½å‘¨æœŸ`é˜¶æ®µåšä¸åŒçš„äº‹
    
*   æºç åº•å±‚å¯¹çœŸå® DOM äº‹ä»¶è¿›è¡Œå°è£…ï¼Œä½¿ç”¨`äº‹ä»¶å§”æ‰˜`çš„æ–¹å¼æ¥æ•è· DOM äº‹ä»¶
    
*   ....
    

ç­‰ç‰¹æ€§è¿›ä¸€æ­¥ç®€åŒ–çš„ çœŸå® DOM æ“ä½œçš„å¤æ‚æ€§

äºŒ. è¯´è¯´çœŸå® DOM ä¸è™šæ‹Ÿ DOM çš„åŒºåˆ«ï¼Œä¼˜ç¼ºç‚¹
---------------------------

![](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHoX7icOibtUaZRAZD45BVfCwGj3SAfDSqEVQkZ7Cuv2HEDztq0PiadIXyjlCKbfQJnda2dGu83erjSjA/640?wx_fmt=other)è™šæ‹Ÿ DOM

### 2.1 è™šæ‹Ÿ DOM æ˜¯ä»€ä¹ˆ

*   `çœŸå®DOM`å°±æ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­çœ‹åˆ°çš„`DOM`ç»“æ„
    
*   `è™šæ‹ŸDOM`ç®€å•æ¥è¯´å°±æ˜¯ JS å¯¹è±¡ï¼Œæ­¤å¯¹è±¡ä¸­çš„å­—æ®µåŒ…å«äº†å¯¹`çœŸå®DOM`çš„æè¿°:
    

*   `type`: æ˜¯ä»€ä¹ˆæ ‡ç­¾ / å…ƒç´ 
    
*   `props`: æ ‡ç­¾ / å…ƒç´ æœ‰å“ªäº›å±æ€§
    
*   `children`: æ˜¯å¦æœ‰å­å…ƒç´ 
    

![](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHoX7icOibtUaZRAZD45BVfCwGX0vh2ibluibpZguOJqhssWaxPe2zgtiaNQhEXJPh8NyL2jJCUw82dDdHQ/640?wx_fmt=other) a

### 2.2 è™šæ‹Ÿ DOM å¤§æ¦‚æ˜¯å¦‚ä½•å·¥ä½œçš„

å½“ `DOM` æ“ä½œï¼ˆæ¸²æŸ“æ›´æ–°ï¼‰æ¯”è¾ƒé¢‘ç¹æ—¶ï¼Œ

React åº•å±‚ä¼šå…ˆå°†å‰åä¸¤æ¬¡çš„`è™šæ‹ŸDOM` æ ‘è¿›è¡Œå¯¹æ¯”ï¼Œ

å®šä½å‡ºå…·ä½“éœ€è¦æ›´æ–°çš„éƒ¨åˆ†ï¼Œç”Ÿæˆä¸€ä¸ª`è¡¥ä¸é›†`ï¼Œ

æœ€ååªæŠŠ â€œè¡¥ä¸â€ æ‰“åœ¨éœ€è¦æ›´æ–°çš„é‚£éƒ¨åˆ†`çœŸå®DOM` ä¸Šï¼Œå®ç°ç²¾å‡†çš„ â€œå·®é‡æ›´æ–°â€ã€‚

### 2.3 è™šæ‹Ÿ DOM çš„ä¼˜ç‚¹

1.  è§£å†³äº†é¢‘ç¹æ“ä½œçœŸå® DOM çš„ä½æ•ˆç‡å·¥ä½œ - ä¸ç›´æ¥æ“ä½œ DOMï¼Œæ•°æ®é©±åŠ¨è§†å›¾, ä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šæå‡äº†æ€§èƒ½
    
2.  è§£å†³äº†æ‰©å¹³å°å¼€å‘çš„é—®é¢˜ï¼Œå› ä¸ºè™šæ‹Ÿ DOM æè¿°çš„ä¸œè¥¿å¯ä»¥æ˜¯çœŸå® DOM, ä¹Ÿå¯ä»¥æ˜¯å®‰å“ç•Œé¢ã€‚IOS ç•Œé¢ç­‰ç­‰, è¿™å°±å¯ä»¥å¯¹æ¥ä¸åŒå¹³å°çš„æ¸²æŸ“é€»è¾‘ã€‚ä»è€Œå®ç° "ä¸€æ¬¡ç¼–ç ï¼Œå¤šç«¯è¿è¡Œ"(å¦‚ React,React Native)
    

### 2.4 è™šæ‹Ÿ DOM çš„ç¼ºç‚¹

å¦‚æœå½“è™šæ‹Ÿ DOM çš„æ„å»ºå’Œ`diff`çš„è¿‡ç¨‹ç›¸å¯¹å¤æ‚ (æ¯”å¦‚å¾ˆå¤šé€’å½’éå†ç­‰æ“ä½œ), é‚£ä¹ˆè™šæ‹Ÿ DOM çš„ JS è®¡ç®—æ˜¯æ¯”è¾ƒè€—æ—¶çš„

ä¸‰. è¯´è¯´ Diff ç®—æ³•
-------------

![](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHoX7icOibtUaZRAZD45BVfCwGgW8NMUCVRoTSIHd2byFicib7rgduD2ZafVuLWcTmFj021txY6VRz9gjQ/640?wx_fmt=other)Diff ç®—æ³•

ä¸€èˆ¬çš„åŸå§‹ diff æ€è·¯ç®—æ³•å¤æ‚åº¦æ˜¯`O(n^3)`, å³å¾ªç¯é€’å½’è¿›è¡Œæ ‘èŠ‚ç‚¹çš„ä¸€ä¸€å¯¹æ¯”

ä½† React çš„ `diff ç®—æ³•`æ˜¯ `O (n)` å¤æ‚åº¦çš„æ€è·¯

> å½“å¯¹æ¯”ä¸¤æ£µè™šæ‹Ÿ DOM æ ‘æ—¶ï¼ŒReact é¦–å…ˆæ¯”è¾ƒä¸¤æ£µæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚ä¸åŒç±»å‹çš„æ ¹èŠ‚ç‚¹å…ƒç´ ä¼šæœ‰ä¸åŒçš„å½¢æ€
> 
> å½“å¯¹æ¯”ä¸¤ä¸ªç›¸åŒç±»å‹çš„ React å…ƒç´ æ—¶ï¼ŒReact ä¼šä¿ç•™ DOM èŠ‚ç‚¹ï¼Œä»…æ¯”å¯¹åŠæ›´æ–°æœ‰æ”¹å˜çš„å±æ€§ã€‚

1.  å½“æ ¹èŠ‚ç‚¹ä¸ºä¸åŒç±»å‹çš„å…ƒç´ æ—¶ï¼ŒReact ä¼šæ‹†å¸åŸæœ‰çš„æ ‘å¹¶ä¸”å»ºç«‹èµ·æ–°çš„æ ‘ï¼Œè¿™å¤§å¤§å‡å°‘äº† `Diff` è¿‡ç¨‹ä¸­å†—ä½™çš„é€’å½’æ“ä½œ
    
2.  å½“å¯¹æ¯”ä¸¤ä¸ªç›¸åŒç±»å‹çš„ React å…ƒç´ æ—¶ï¼ŒReact ä¼šä¿ç•™ DOM èŠ‚ç‚¹ï¼Œä»…æ¯”å¯¹åŠæ›´æ–°æœ‰æ”¹å˜çš„å±æ€§
    
3.  åˆ—è¡¨å½¢å¼çš„å­å…ƒç´ æ¯”è¾ƒ: React å¼•å…¥äº† `key å±æ€§`ã€‚å½“å­å…ƒç´ æ‹¥æœ‰ `key` æ—¶ï¼ŒReact ä½¿ç”¨ `key` æ¥åŒ¹é…åŸæœ‰æ ‘ä¸Šçš„å­å…ƒç´ ä»¥åŠæœ€æ–°æ ‘ä¸Šçš„å­å…ƒç´ , å¦‚æœ `key`ä¸åŒ ä¸åŒåˆ™ä¼šæ‹†å¸åŸæœ‰çš„ `key` èŠ‚ç‚¹å¹¶ä¸”å»ºç«‹èµ·æ–°çš„ `key` èŠ‚ç‚¹
    

è¯¦ç»†å†…å®¹è¯·å‚è€ƒ React å®˜æ–¹æ–‡æ¡£ - Diffing ç®—æ³• [2]

å››. è¯´è¯´ React å£°æ˜å‘¨æœŸæœ‰å“ªäº›ä¸åŒé˜¶æ®µ, æ¯ä¸ªé˜¶æ®µå¯¹åº”çš„æ–¹æ³•æ˜¯ä»€ä¹ˆ
-------------------------------------

![](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHoX7icOibtUaZRAZD45BVfCwGERw1l359B4UI2Rm6jFLiaqtehyD6hclcibxPnYQavsGpcBMSr0Vl0Wvg/640?wx_fmt=other)image.png

### 4.1 åˆ›å»ºé˜¶æ®µ

1.  `constructor()`: ç»„ä»¶çš„æ„é€ å‡½æ•°ï¼Œç»„ä»¶æ›´æ–°åˆ°ç•Œé¢ä¸Šä¹‹å‰ä¼šå…ˆè°ƒç”¨
    

*   ç”¨äºåˆå§‹åŒ–å†…éƒ¨çŠ¶æ€, å¾ˆå°‘ä½¿ç”¨
    
*   å”¯ä¸€å¯ä»¥ç›´æ¥ä¿®æ”¹ `state` çš„åœ°æ–¹
    

3.  `static getDerivedStateFromProps(nextProps, prevState)`: ç”¨äºä»å¤–éƒ¨çš„å±æ€§å»åˆå§‹åŒ–ä¸€äº›å†…éƒ¨çš„çŠ¶æ€
    

*   å½“ `state` éœ€è¦ä» `props` åˆå§‹åŒ–æ—¶ä½¿ç”¨
    
*   å°½é‡ä¸è¦ä½¿ç”¨, ç»´æŠ¤ `state/props` çŠ¶æ€ä¸€è‡´æ€§ä¼šå¢åŠ å¤æ‚åº¦
    
*   æ¯æ¬¡ `render` éƒ½ä¼šè°ƒç”¨
    
*   å…¸å‹åœºæ™¯: è¡¨å•æ§ä»¶è·å–é»˜è®¤å€¼
    

5.  `render()`:: ç»„ä»¶å¿…é¡»å®šä¹‰çš„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œç”¨æ¥æè¿° è™šæ‹Ÿ DOM ç»“æ„
    
6.  `componentDidMount()`: ç”¨äºæ•°æ®è¯·æ±‚ï¼Œå®šä¹‰ä¸€äº›å¤–éƒ¨èµ„æºç­‰ç­‰å‰¯ä½œç”¨
    

*   UI æ¸²æŸ“å®Œæˆåè°ƒç”¨
    
*   åªæ‰§è¡Œä¸€æ¬¡
    
*   å…¸å‹åœºæ™¯: è·å–å¤–éƒ¨èµ„æº
    

### 4.2 æ›´æ–°é˜¶æ®µ

1.  `static getDerivedStateFromProps(nextProps, prevState)`
    
2.  `shouldComponentUpdate(nextProps, nextState)`: å‘Šè¯‰ç»„ä»¶æ˜¯å¦éœ€è¦é‡æ–°æ¸²æŸ“ï¼Œç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼Œæ¯”å¦‚åˆ¤å®šæŒ‡å®š props å‘ç”Ÿæ”¹å˜ï¼Œç»„ä»¶æ‰è¿›è¡Œé‡æ–°æ¸²æŸ“
    

*   å†³å®šè™šæ‹Ÿ DOM æ˜¯å¦éœ€è¦é‡ç»˜
    
*   ä¸€èˆ¬å¯ä»¥ç”± `PureComponent` è‡ªåŠ¨å®ç°
    
*   å…¸å‹åœºæ™¯: æ€§èƒ½ä¼˜åŒ–
    

4.  `render()`
    
5.  `getSnapshotBeforeUpdate(prevProps, prevState)`
    

*   åœ¨æœ€è¿‘ä¸€æ¬¡æ¸²æŸ“è¾“å‡ºï¼ˆæäº¤åˆ° DOM èŠ‚ç‚¹ï¼‰ä¹‹å‰è°ƒç”¨, state å·²æ›´æ–°
    
*   ä¸ `componentDidUpdate` æ­é…ä½¿ç”¨
    
*   å…¸å‹åœºæ™¯: æ•è· `render` ä¹‹å‰çš„ DOM çŠ¶æ€
    

7.  `componentDidUpdate(prevProps, prevState)`
    

*   æ¯æ¬¡ UI æ›´æ–°æ—¶è¢«è°ƒç”¨
    
*   å…¸å‹åœºæ™¯: é¡µé¢éœ€è¦æ ¹æ® `props` å˜åŒ–é‡æ–°è·å–æ•°æ®
    

### 4.3 å¸è½½é˜¶æ®µ

1.  `componentWillUnmount()`: åšäº›èµ„æºé‡Šæ”¾ï¼Œå¸è½½å‰¯ä½œç”¨çš„äº‹æƒ…
    

*   æ­¤æ–¹æ³•ä¸­å¯ä»¥æ‰§è¡Œå¿…è¦çš„æ¸…ç†æ“ä½œï¼Œä¾‹å¦‚ï¼Œæ¸…é™¤ timerï¼Œå–æ¶ˆç½‘ç»œè¯·æ±‚æˆ–æ¸…é™¤åœ¨
    

è¯¦ç»†å†…å®¹è¯·å‚è€ƒ React çŸ¥è¯†ä½“ç³»ä¹‹ç”Ÿå‘½å‘¨æœŸåŠä½¿ç”¨åœºæ™¯ [3]

äº”. è¯´è¯´å¯¹ State å’Œ Props çš„ç†è§£ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«
------------------------------

*   `state`ç”¨äºç»„ä»¶å†…éƒ¨æ•°æ®ä¼ é€’,`state` æ•°æ®å¯ä»¥é€šè¿‡`this.setSate`æˆ–è€…`useState`è¿›è¡Œä¿®æ”¹
    
*   `props`ç”¨äºç»„ä»¶å¤–éƒ¨ç»„ä»¶æ•°æ®ä¼ é€’ï¼Œ`props`ä¸èƒ½ç›´æ¥ä¿®æ”¹. ä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯:
    

*   å…„å¼Ÿç»„ä»¶é€šä¿¡
    
*   çˆ¶å­ç»„ä»¶é€šä¿¡
    
*   `"çˆ·å­™ç»„ä»¶"`ç»„ä»¶é€šä¿¡
    

*   `props`çš„ä½¿ç”¨èŒƒå›´è™½ç„¶æ›´åŠ å¹¿æ³›ï¼Œä½†ä¹Ÿæœ‰å…¶å±€é™æ€§: å¯¹äºåµŒå¥—å±‚æ¬¡è¾ƒæ·±çš„ç»„ä»¶ï¼Œå¦‚æœä½¿ç”¨`props`ä¼ é€’æ•°æ®, ä¼šå¯¼è‡´ä»£ç å†—ä½™, å¢åŠ æ•°æ®ä¼ é€’çš„å¤æ‚åº¦
    

å…­. super å’Œ super(props) æœ‰ä»€ä¹ˆåŒºåˆ«
-----------------------------

> åœ¨ JavaScript ä¸­ï¼Œsuper æŒ‡çš„æ˜¯çˆ¶ç±»æ„é€ å‡½æ•°ã€‚ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒæŒ‡å‘ React.Component å®ç°ã€‚ï¼‰

åœ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ä¹‹å‰ï¼Œä½ æ˜¯ä¸èƒ½åœ¨ `constructor` ä¸­ä½¿ç”¨ `this` å…³é”®å­—çš„ã€‚JavaScript ä¸å…è®¸è¿™ä¸ªè¡Œä¸º

```
classÂ CheckboxÂ extendsÂ React.ComponentÂ {Â Â constructor(props)Â {Â Â Â Â //Â ğŸ”´Â Â è¿˜ä¸èƒ½ä½¿ç”¨Â `this`Â Â Â Â super(props);Â Â Â Â //Â âœ…Â Â ç°åœ¨å¯ä»¥äº†Â Â Â Â this.stateÂ =Â {Â isOn:Â trueÂ };Â Â }Â Â //Â ...}å¤åˆ¶ä»£ç 
```

ä¸ºä»€ä¹ˆä¸€å®šè¦ä¼ é€’ `props` å‘¢ï¼Ÿä¸ºäº†è®© `React.Component` æ„é€ å‡½æ•°èƒ½å¤Ÿåˆå§‹åŒ– `this.props`

React å†…éƒ¨ä»£ç :

```
//Â ReactÂ å…§éƒ¨classÂ ComponentÂ {Â Â constructor(props)Â {Â Â Â Â this.propsÂ =Â props;Â Â Â Â //Â ...Â Â }}å¤åˆ¶ä»£ç 
```

å®ä¾‹ä»£ç :

```
classÂ ButtonÂ extendsÂ React.ComponentÂ {Â Â constructor(props)Â {Â Â Â Â super();Â //Â ?Â WeÂ forgotÂ toÂ passÂ propsÂ Â Â Â console.log(props);Â //Â âœ…Â {}Â Â Â Â console.log(this.props);Â //Â ?Â undefinedÂ Â }Â Â //Â ...}å¤åˆ¶ä»£ç 
```

```
classÂ ButtonÂ extendsÂ React.ComponentÂ {Â Â constructor(props)Â {Â Â Â Â super(props);Â //Â âœ…Â WeÂ passedÂ propsÂ Â Â Â console.log(props);Â //Â âœ…Â {}Â Â Â Â console.log(this.props);Â //Â âœ…Â {}Â Â }Â Â //Â ...}å¤åˆ¶ä»£ç 
```

æœ‰äº† Hooks ä»¥åï¼Œæˆ‘ä»¬å‡ ä¹å°±ä¸éœ€è¦ `super` å’Œ `this` äº†

è¯¦ç»†å†…å®¹è¯·å‚è€ƒä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å†™ super(props) ï¼Ÿ[4]

ä¸ƒ. è¯´è¯´ React ä¸­çš„ setState æœºåˆ¶
--------------------------

![](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHoX7icOibtUaZRAZD45BVfCwGhBnzRpicU9hgRyHhibvfictnHcUyOiawqGEz4aiarW3lyEDP85byzAmsgag/640?wx_fmt=other)setState

### 7.1 åˆæˆäº‹ä»¶ã€é’©å­å‡½æ•°ä¸­çš„ setState

*   åœ¨é’©å­å‡½æ•°ä¸­ `setSate` æ‹¿ä¸åˆ°æœ€æ–°å€¼
    
*   åœ¨åˆæˆäº‹ä»¶ä¸­æ‰§è¡Œå¤šä¸ªåŒæ ·çš„ `setSate`ï¼Œæœ€ç»ˆåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”ä¹Ÿæ‹¿ä¸åˆ°æœ€æ–°å€¼
    

åŸå› :

1.  ä¸€æ¬¡ `setState` å°±ä¼šè§¦å‘ä¸€æ¬¡ `re-render`(é‡æ¸²æŸ“)
    
2.  ä¸ºäº†é¿å…é¢‘ç¹çš„ `re-ernder`,`setState` è¢«è®¾è®¡æˆå¼‚æ­¥çš„å½¢å¼
    
3.  æ¯æ¥ä¸€ä¸ª `setState`ï¼Œå°±æŠŠå®ƒå¡è¿›ä¸€ä¸ªé˜Ÿåˆ—é‡Œ â€œæ”’èµ·æ¥â€ã€‚ç­‰æ—¶æœºæˆç†Ÿï¼Œå†æŠŠâ€œæ”’èµ·æ¥â€ çš„ `state` ç»“æœåšåˆå¹¶ (å¯¹äºç›¸åŒå±æ€§çš„è®¾ç½®ï¼ŒReact åªä¼šä¸ºå…¶ä¿ç•™æœ€åä¸€æ¬¡çš„æ›´æ–°)ï¼Œæœ€ååªé’ˆå¯¹æœ€æ–°çš„ `state` å€¼èµ°ä¸€æ¬¡æ›´æ–°æµç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œå«ä½œ **`æ‰¹é‡æ›´æ–°`**
    

### 7.2 `setTimeout/setInterval`ã€`åŸç”Ÿ DOM`ä¸­çš„ setState

*   åœ¨ `setTimeout/setInterval` ä¸­è®¾ç½® `setState`, å¯ä»¥æ‹¿åˆ°æœ€æ–°çš„å€¼
    
*   åœ¨`åŸç”Ÿ DOM` äº‹ä»¶ä¸­è®¾ç½® `setState`, å¯ä»¥æ‹¿åˆ°æœ€æ–°çš„å€¼
    

åŸå› :

`setState` çš„ â€œå¼‚æ­¥â€ å¹¶ä¸æ˜¯è¯´å†…éƒ¨ç”±å¼‚æ­¥ä»£ç å®ç°ï¼Œå…¶å®æºç æœ¬èº«æ‰§è¡Œçš„è¿‡ç¨‹å’Œä»£ç éƒ½æ˜¯åŒæ­¥çš„ï¼Œ

åªæ˜¯åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°çš„è°ƒç”¨é¡ºåºåœ¨æ›´æ–°ä¹‹å‰ï¼Œå¯¼è‡´åœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­æ²¡æ³•ç«‹é©¬æ‹¿åˆ°æ›´æ–°åçš„å€¼ï¼Œå½¢å¼äº†æ‰€è°“çš„ â€œå¼‚æ­¥â€

**`setState` çš„æ‰¹é‡æ›´æ–°ä¼˜åŒ–ä¹Ÿæ˜¯å»ºç«‹åœ¨ â€œå¼‚æ­¥â€ï¼ˆåˆæˆäº‹ä»¶ã€é’©å­å‡½æ•°ï¼‰ä¹‹ä¸Šçš„**ï¼Œåœ¨åŸç”Ÿäº‹ä»¶å’Œ `setTimeout` ä¸­ä¸ä¼šæ‰¹é‡æ›´æ–°

è¯¦ç»†å†…å®¹è¯·å‚è€ƒ setState åˆ°åº•æ˜¯åŒæ­¥çš„ï¼Œè¿˜æ˜¯å¼‚æ­¥çš„ï¼Ÿ[5]

å…«. è¯´è¯´å¯¹ React äº‹ä»¶æœºåˆ¶çš„ç†è§£
--------------------

![](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHoX7icOibtUaZRAZD45BVfCwGEXSLEPibmqwSvGKiaLjwRoibSicd0A04kiaTfekmLZLVic52KapEMXyWqB3Q/640?wx_fmt=other)React äº‹ä»¶æœºåˆ¶

### 8.1 React ä¸­çš„äº‹ä»¶æ˜¯ä»€ä¹ˆ

React ä¸­çš„äº‹ä»¶å«`åˆæˆäº‹ä»¶`:React åº•å±‚ä½¿ç”¨`äº‹ä»¶å§”æ‰˜`çš„æ–¹å¼å¯¹çœŸå® DOM äº‹ä»¶è¿›è¡Œäº†å°è£…, ä½¿åˆæˆäº‹ä»¶å…·æœ‰æ›´å¥½çš„æµè§ˆå™¨å…¼å®¹æ€§å’Œæ€§èƒ½

### 8.2 åˆæˆäº‹ä»¶çš„å¤§è‡´åŸç†

å½“äº‹ä»¶åœ¨å…·ä½“çš„ DOM èŠ‚ç‚¹ä¸Šè¢«è§¦å‘åï¼Œæœ€ç»ˆéƒ½ä¼šå†’æ³¡åˆ° document ä¸Šï¼Œdocument ä¸Šæ‰€ç»‘å®šçš„ç»Ÿä¸€äº‹ä»¶å¤„ç†ç¨‹åºä¼šå°†äº‹ä»¶åˆ†å‘åˆ°å…·ä½“çš„ç»„ä»¶å®ä¾‹

### 8.3 React ä¸ºä»€ä¹ˆè¦é‡æ–°è®¾è®¡å‡ºä¸€ä¸ªåˆæˆäº‹ä»¶

åˆæˆäº‹ä»¶æ˜¯ React è‡ªå®šä¹‰çš„äº‹ä»¶å¯¹è±¡ï¼Œå®ƒç¬¦åˆ W3C è§„èŒƒï¼Œåœ¨åº•å±‚æŠ¹å¹³äº†ä¸åŒæµè§ˆå™¨çš„å·®å¼‚ï¼Œåœ¨ä¸Šå±‚é¢å‘å¼€å‘è€…æš´éœ²ç»Ÿä¸€çš„ã€ç¨³å®šçš„ã€ä¸ DOM åŸç”Ÿäº‹ä»¶ç›¸åŒçš„äº‹ä»¶æ¥å£ã€‚

å¼€å‘è€…ä»¬ç”±æ­¤ä¾¿ä¸å¿…å†å…³æ³¨çƒ¦ççš„å…¼å®¹æ€§é—®é¢˜ï¼Œå¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å¼€å‘ã€‚

*   è™½ç„¶åˆæˆäº‹ä»¶å¹¶ä¸æ˜¯åŸç”Ÿ DOM äº‹ä»¶ï¼Œä½†å®ƒä¿å­˜äº†åŸç”Ÿ DOM äº‹ä»¶çš„å¼•ç”¨ã€‚å½“ä½ éœ€è¦è®¿é—®åŸç”Ÿ DOM äº‹ä»¶å¯¹è±¡æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆæˆäº‹ä»¶å¯¹è±¡çš„ `e.nativeEvent` å±æ€§è·å–åˆ°å®ƒ
    
*   åˆæˆäº‹ä»¶æ— æ³•è·å–åˆ°çœŸå® DOM, ä½†å¯ä»¥é€šè¿‡ React æä¾›`ref`API è¿›è¡Œè·å–
    

è¯¦ç»†å†…å®¹è¯·å‚è€ƒ React äº‹ä»¶ä¸ DOM äº‹ä»¶æœ‰ä½•ä¸åŒï¼Ÿ[6]

ä¹. React äº‹ä»¶ç»‘å®šçš„æ–¹å¼æœ‰å“ªäº›
-------------------

### 9.1 ç±»ç»„ä»¶

#### 9.1.1 render æ–¹æ³•ä¸­ä½¿ç”¨ bind

è¿™ç§æ–¹å¼åœ¨ç»„ä»¶æ¯æ¬¡ render æ¸²æŸ“çš„æ—¶å€™ï¼Œéƒ½ä¼šé‡æ–°è¿›è¡Œ bind çš„æ“ä½œï¼Œå½±å“æ€§èƒ½

```
classÂ AppÂ extendsÂ React.ComponentÂ {Â Â handleClick()Â {Â Â Â Â console.log("thisÂ >Â ",Â this);Â Â }Â Â render()Â {Â Â Â Â returnÂ <divÂ onClick={this.handleClick.bind(this)}>test</div>;Â Â }}å¤åˆ¶ä»£ç 
```

#### 9.1.2 render æ–¹æ³•ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°

é€šè¿‡ ES6 çš„ä¸Šä¸‹æ–‡æ¥å°† this çš„æŒ‡å‘ç»‘å®šç»™å½“å‰ç»„ä»¶ï¼ŒåŒæ ·åœ¨æ¯ä¸€æ¬¡ render çš„æ—¶å€™éƒ½ä¼šç”Ÿæˆæ–°çš„æ–¹æ³•ï¼Œå½±å“æ€§èƒ½

```
classÂ AppÂ extendsÂ React.ComponentÂ {Â Â handleClick()Â {Â Â Â Â console.log("thisÂ >Â ",Â this);Â Â }Â Â render()Â {Â Â Â Â returnÂ <divÂ onClick={(e)Â =>Â this.handleClick(e)}>test</div>;Â Â }}å¤åˆ¶ä»£ç 
```

### 9.1.3 constructor ä¸­ bind

åœ¨ constructor ä¸­é¢„å…ˆ bind å½“å‰ç»„ä»¶ï¼Œå¯ä»¥é¿å…åœ¨ render æ“ä½œä¸­é‡å¤ç»‘å®š

```
classÂ AppÂ extendsÂ React.ComponentÂ {Â Â constructor(props)Â {Â Â Â Â super(props);Â Â Â Â this.handleClickÂ =Â this.handleClick.bind(this);Â Â }Â Â handleClick()Â {Â Â Â Â console.log("thisÂ >Â ",Â this);Â Â }Â Â render()Â {Â Â Â Â returnÂ <divÂ onClick={this.handleClick}>test</div>;Â Â }}å¤åˆ¶ä»£ç 
```

#### 9.1.4 å®šä¹‰é˜¶æ®µä½¿ç”¨ç®­å¤´å‡½æ•°ç»‘å®š

èƒ½å¤Ÿé¿å…åœ¨ render æ“ä½œä¸­é‡å¤ç»‘å®š

```
classÂ AppÂ extendsÂ React.ComponentÂ {Â Â constructor(props)Â {Â Â Â Â super(props);Â Â }Â Â handleClickÂ =Â ()Â =>Â {Â Â Â Â console.log("thisÂ >Â ",Â this);Â Â };Â Â render()Â {Â Â Â Â returnÂ <divÂ onClick={this.handleClick}>test</div>;Â Â }}å¤åˆ¶ä»£ç 
```

### 9.2 å‡½æ•°å¼ç»„ä»¶

*   ç®­å¤´å‡½æ•°
    

å‡½æ•°ç»„ä»¶æ²¡æœ‰å®ä¾‹ï¼Œå› æ­¤æ²¡æœ‰`this`

```
constÂ AppÂ =Â ()Â =>Â {Â Â handleClickÂ =Â (e)Â =>Â {Â Â Â Â console.log(e);Â Â };Â Â returnÂ <divÂ onClick={this.handleClick}>test</div>;};å¤åˆ¶ä»£ç 
```

è¯¦ç»†å†…å®¹è¯·å‚è€ƒ React æ„å»ºç»„ä»¶çš„æ–¹å¼æœ‰å“ªäº› [7]

å. React æ„å»ºç»„ä»¶çš„æ–¹å¼æœ‰å“ªäº›
-------------------

1.  ç±»ç»„ä»¶
    
2.  é«˜é˜¶ç»„ä»¶
    
3.  `render props`
    
4.  çº¯å‡½æ•°ç»„ä»¶
    
5.  `Hooks`ç»„ä»¶
    
6.  è‡ªå®šä¹‰`Hooks`
    

è¯¦ç»†å†…å®¹è¯·å‚è€ƒ React æ„å»ºç»„ä»¶çš„æ–¹å¼æœ‰å“ªäº› [8]

åä¸€. React ä¸­ç»„ä»¶é€šä¿¡çš„æ–¹å¼æœ‰å“ªäº›
---------------------

*   å•ä¸ªç»„ä»¶å†…éƒ¨æ•°æ®ä¼ é€’
    

*   `state`
    

*   çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’
    

*   `props`
    

*   å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ é€’
    

*   `props`
    

*   å…„å¼Ÿç»„ä»¶ä¹‹é—´çš„é€šä¿¡
    

*   `props`
    

*   çˆ¶ç»„ä»¶å‘åä»£ç»„ä»¶ä¼ é€’
    

*   `props`
    
*   `Context API`
    
*   `Redux`
    
*   `å‘å¸ƒ-è®¢é˜…æ¨¡å¼`
    
*   `EventBus`
    

*   éå…³ç³»ç»„ä»¶ä¼ é€’
    

*   `Context API`
    
*   `Redux`
    
*   `å‘å¸ƒ-è®¢é˜…æ¨¡å¼`
    
*   `EventBus`
    

åäºŒ. React çš„ key æœ‰ä»€ä¹ˆä½œç”¨
---------------------

è¯´åˆ° React çš„ keyï¼Œå°±è¦è¯´åˆ° React çš„ Diff ç®—æ³•

è¯¦ç»†å†…å®¹è¯·å‚è€ƒ React åˆ—è¡¨å¾ªç¯ä¸ºä»€ä¹ˆéœ€è¦ key[9]

* * *

### å‚è€ƒèµ„æ–™

[1]

https://juejin.cn/post/6978685539985653767: _https://juejin.cn/post/6978685539985653767_

[2]

https://zh-hans.reactjs.org/docs/reconciliation.html#the-diffing-algorithm: _https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fdocs%2Freconciliation.html%23the-diffing-algorithm_

[3]

https://juejin.cn/post/6981739846461030408: _https://juejin.cn/post/6981739846461030408_

[4]

https://overreacted.io/zh-hans/why-do-we-write-super-props/: _https://link.juejin.cn?target=https%3A%2F%2Foverreacted.io%2Fzh-hans%2Fwhy-do-we-write-super-props%2F_

[5]

https://www.yuque.com/u221766/xgl0mb/oxl3ik: _https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Fu221766%2Fxgl0mb%2Foxl3ik_

[6]

https://www.yuque.com/u221766/xgl0mb/iu68y0: _https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Fu221766%2Fxgl0mb%2Fiu68y0_

[7]

https://juejin.cn/post/6952907248393781284#heading-2: _https://juejin.cn/post/6952907248393781284#heading-2_

[8]

https://juejin.cn/post/6952907248393781284: _https://juejin.cn/post/6952907248393781284_

[9]

https://juejin.cn/post/6940974776441634823: _https://juejin.cn/post/6940974776441634823_

æ¥æºï¼šæœ›é“åŒå­¦

https://juejin.cn/post/6981831831112908831

The End  

å¦‚æœä½ è§‰å¾—è¿™ç¯‡å†…å®¹å¯¹ä½ æŒºæœ‰å¯å‘ï¼Œæˆ‘æƒ³è¯·ä½ å¸®æˆ‘ä¸‰ä¸ªå°å¿™ï¼š

1ã€ç‚¹ä¸ªÂ **ã€Œåœ¨çœ‹ã€**ï¼Œè®©æ›´å¤šçš„äººä¹Ÿèƒ½çœ‹åˆ°è¿™ç¯‡å†…å®¹

2ã€å…³æ³¨å®˜ç½‘Â **https://muyiy.cn**ï¼Œè®©æˆ‘ä»¬æˆä¸ºé•¿æœŸå…³ç³»

3ã€å…³æ³¨å…¬ä¼—å·ã€Œé«˜çº§å‰ç«¯è¿›é˜¶ã€ï¼Œå…¬ä¼—å·åå°å›å¤Â **ã€ŒåŠ ç¾¤ã€**Â ï¼ŒåŠ å…¥æˆ‘ä»¬ä¸€èµ·å­¦ä¹ å¹¶é€ä½ ç²¾å¿ƒæ•´ç†çš„é«˜çº§å‰ç«¯é¢è¯•é¢˜ã€‚

ã€‹ã€‹é¢è¯•å®˜éƒ½åœ¨ç”¨çš„é¢˜åº“ï¼Œå¿«æ¥çœ‹çœ‹ã€Šã€Š  

```
â€œåœ¨çœ‹â€å—ï¼Ÿåœ¨çœ‹å°±ç‚¹ä¸€ä¸‹å§

```