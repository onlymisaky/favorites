> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/s1k0gL9rsrVCpfQCAziV7A)

å‰è¨€ï¼šç”±äºç§æœ‰åŒ–çš„æ—¶å€™éœ€è¦ç”¨åˆ° idassï¼ˆç»Ÿä¸€ç™»å½•ï¼‰ï¼Œæœ¬åœ° ip ä¸ºï¼š127.0.0.1:8080ï¼Œç»Ÿä¸€ç™»å½•åœ°å€ä¸ºï¼š11.123.456.10ï¼Œç»Ÿä¸€ç™»å½•åï¼Œidass æœåŠ¡æ— æ³•è·¨ ip ç§æ¤ cookieï¼Œäºæ˜¯ä¹ï¼Œæƒ³è‡ªå·±å†™ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶è‡ªåŠ¨ç§æ¤æ‰€éœ€é¡µé¢çš„ cookie å’Œ token ç­‰å‡­è¯ï¼ˆæ¯æ¬¡è°ƒè¯•æ‰‹åŠ¨ç§æ¤ cookie å¤ªè´¹åŠ²äº†ğŸ˜­ï¼‰

ä»€ä¹ˆæ˜¯æµè§ˆå™¨æ’ä»¶
--------

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„æµè§ˆå™¨æ˜¯ä¸ªè€å®å·´äº¤çš„æ‰“å·¥ä»”ï¼Œæ¯å¤©åªä¼šæŒ‰éƒ¨å°±ç­åœ°å¹²æ´»ã€‚æ’ä»¶å°±æ˜¯ç»™å®ƒè£…å¤‡çš„ "å¤–æŒ‚"

æ¯”å¦‚ï¼š

*   å±è”½é¸¡æ±¤æ–‡å¼¹çª—ï¼Œè£…ä¸ªå¹¿å‘Šæ‹¦æˆª
    
*   æƒ³åœ¨ç”µå•†ç½‘ç«™è‡ªåŠ¨æ¯”ä»·ï¼Œå†™ä¸ªæ¯”ä»·æ’ä»¶
    
*   æ›¿æ¢ç½‘é¡µæ‰€æœ‰çš„å›¾ç‰‡
    

ä»é›¶å¼€å§‹é€ è½®å­
-------

### æ ¸å¿ƒæ–‡ä»¶ç»“æ„

```
my-extension/â”œâ”€â”€ manifest.json Â  Â  Â Â # æ’ä»¶é…ç½®æ–‡ä»¶â”œâ”€â”€ icons/ Â  Â  Â  Â  Â  Â  Â # å›¾æ ‡ï¼ˆ16x16, 48x48, 128x128ï¼‰ç”¨äºå·¥å…·æ å°å›¾æ ‡ï¼Œæ‰©å±•ç®¡ç†é¡µå›¾æ ‡ï¼Œå•†åº—å±•ç¤ºå¤§å›¾æ ‡â”œâ”€â”€ popup/ Â  Â  Â  Â  Â  Â Â # å¼¹å‡ºçª—å£â”œâ”€â”€ content-scripts/ Â Â # æ³¨å…¥é¡µé¢çš„è„šæœ¬â””â”€â”€ background/ Â  Â  Â  Â  Â Â # åå°è„šæœ¬
```

#### 1. manifest.json

```
{Â Â // å¿…é¡»å­—æ®µï¼šæ¸…å•ç‰ˆæœ¬ï¼ˆChrome æ¨èä½¿ç”¨ V3ï¼‰"manifest_version":Â 3,// æ’ä»¶åç§°ï¼ˆå±•ç¤ºåœ¨å•†åº—å’Œæµè§ˆå™¨å·¥å…·æ ï¼‰"name":Â "My Extension",// æ’ä»¶ç‰ˆæœ¬ï¼ˆæ ¼å¼ä¸º x.x.xï¼‰"version":Â "1.0",// æ’ä»¶æè¿°ï¼ˆç®€æ´è¯´æ˜åŠŸèƒ½ï¼‰"description":Â "A demo extension",// å›¾æ ‡é…ç½®ï¼ˆä¸åŒå°ºå¯¸ç”¨äºä¸åŒåœºæ™¯ï¼‰"icons": {Â  Â Â "16":Â "icons/icon16.png", Â Â // å·¥å…·æ å°å›¾æ ‡Â  Â Â "48":Â "icons/icon48.png", Â Â // æ‰©å±•ç®¡ç†é¡µå›¾æ ‡Â  Â Â "128":Â "icons/icon128.png"// å•†åº—å±•ç¤ºå¤§å›¾æ ‡Â  },// æƒé™ç”³è¯·ï¼ˆè®¿é—®æµè§ˆå™¨APIçš„æƒé™åˆ—è¡¨ï¼‰"permissions": [Â  Â Â "activeTab", Â  Â // è®¿é—®å½“å‰æ¿€æ´»æ ‡ç­¾é¡µÂ  Â Â "storage", Â  Â  Â // ä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼ˆchrome.storageï¼‰Â  Â Â "scripting"Â  Â  Â // åŠ¨æ€æ‰§è¡Œè„šæœ¬ï¼ˆManifest V3 æ–°å¢ï¼‰Â  ],// æµè§ˆå™¨å·¥å…·æ æŒ‰é’®é…ç½®"action": {Â  Â Â "default_icon":Â "icons/icon16.png", Â // é»˜è®¤å›¾æ ‡Â  Â Â "default_popup":Â "popup/popup.html",Â // ç‚¹å‡»å¼¹å‡ºçš„é¡µé¢Â  Â Â "default_title":Â "ç‚¹å‡»æˆ‘"Â  Â  Â  Â  Â  Â Â // é¼ æ ‡æ‚¬åœæç¤ºÂ  },// åå°è„šæœ¬ï¼ˆManifest V3 ä½¿ç”¨ Service Workerï¼‰"background": {Â  Â Â "service_worker":Â "background/sw.js",Â  Â Â "type":Â "module"// å¯é€‰ï¼šæ”¯æŒESæ¨¡å—Â  },// å†…å®¹è„šæœ¬ï¼ˆæ³¨å…¥åˆ°åŒ¹é…çš„ç½‘é¡µä¸­ï¼‰"content_scripts": [Â  Â  {Â  Â  Â Â "matches": ["https://*.example.com/*"],Â // åŒ¹é…çš„URLæ¨¡å¼Â  Â  Â Â "js": ["content-scripts/main.js"], Â  Â  Â // æ³¨å…¥çš„JSæ–‡ä»¶Â  Â  Â Â "css": ["content-scripts/style.css"], Â // æ³¨å…¥çš„CSSæ–‡ä»¶Â  Â  Â Â "run_at":Â "document_end"Â  Â  Â  Â  Â  Â  Â  Â // æ³¨å…¥æ—¶æœºï¼ˆdocument_idle/document_startï¼‰Â  Â  }Â  ],// é€‰é¡¹é¡µï¼ˆç”¨æˆ·é…ç½®é¡µé¢ï¼‰"options_page":Â "options/options.html"}
```

#### 2. Content Script

*   å†…å®¹è„šæœ¬ç”¨äºæ“ä½œå½“å‰ç½‘é¡µçš„ domï¼Œæ¯”å¦‚è‡ªåŠ¨é«˜äº®é¡µé¢çš„å…³é”®è¯
    

```
// content-scripts/main.jsdocument.querySelectorAll('p').forEach(p => {Â  p.innerHTML = p.innerHTML.replace(/é‡è¦/g,Â '<span style="background:yellow">é‡è¦</span>');});
```

#### 3. Popup

*   ç‚¹å‡»æµè§ˆå™¨å·¥å…·æ å›¾æ ‡å±•ç¤ºçš„ä¸€ä¸ªå¼¹çª—
    

```
<!DOCTYPEÂ html><html>Â Â <head>Â  Â Â <title>Webpage Demo</title>Â Â </head>Â Â <body>Â  Â Â <h3>hello world</h3>Â Â </body></html>
```

è¿™æ ·å†™çš„è¯ç‚¹å‡»æµè§ˆå™¨æ’ä»¶å°±ä¼šå‡ºç° hello world![](https://mmbiz.qpic.cn/sz_mmbiz_png/cAd6ObKOzEBd3WcQ9iaE4YqJpfoa59Gb6a2Na6rrl23wKyyxKNEZ3hZGu8hMxaISK9hYrHjO0NFSu0C8X9seceg/640?wx_fmt=png&from=appmsg#imgIndex=0)

#### 4. Background Script

*   åœ¨æµè§ˆå™¨çš„åå°è¿è¡Œ
    
*   ç”¨äºç›‘å¬æµè§ˆå™¨äº‹ä»¶ï¼Œè·¨æ ‡ç­¾é€šä¿¡ç­‰å…¨å±€äº‹ä»¶
    

æ¯”å¦‚å†™ä¸€ä¸ªæœ€ç®€å•çš„é€šè¿‡æœ¬åœ°å­˜å‚¨å»å­˜å‚¨ comment åˆ—è¡¨

```
chrome.runtime.onMessage.addListener((message, sender, sendResponse) =>Â {ifÂ (message.action ===Â 'getComments') {Â  Â  chrome.storage.local.get(['comments'], (result) => {Â  Â  Â Â constÂ comments = result.comments || []Â  Â  Â  sendResponse(comments);Â  Â  });Â  }ifÂ (message.action ===Â 'saveComment') {Â  Â  chrome.storage.local.get(['comments'], (result) => {Â  Â  Â Â constÂ comments = result.comments || []Â  Â  Â  comments.push(message.comment);Â  Â  Â  chrome.storage.local.set({ ['comments']: comments }, () => {Â  Â  Â  Â  sendResponse({Â status:Â 'saved'Â });Â  Â  Â  });Â  Â  });Â  }});
```

##### 1. chrome.runtime.onMessage.addListener(...)

*   ç»™æ•´ä¸ªæ’ä»¶æ³¨å†Œä¸€ä¸ª â€œæ¶ˆæ¯ç›‘å¬å™¨â€ã€‚
    
*   ä»»ä½•ä» popup.jsã€content-script æˆ–å…¶ä»–åœ°æ–¹ç”¨ chrome.runtime.sendMessage å‘é€åˆ°åå°ï¼ˆbackground.jsï¼‰çš„æ¶ˆæ¯ï¼Œéƒ½ä¼šè¿›å…¥è¿™é‡Œ
    

##### 2. if (message.action === 'getComments')

*   **è§¦å‘æ¡ä»¶**ï¼šæ”¶åˆ°ä¸€ä¸ª action å­—æ®µæ˜¯'getComments' çš„æ¶ˆæ¯ã€‚
    
*   åŠŸèƒ½ï¼š
    

*   ä» chrome.storage.local é‡Œè¯»å–é”®åæ˜¯'comments' çš„æ•°æ®ã€‚
    
*   è¯»å–æˆåŠŸåï¼Œé€šè¿‡ sendResponse æŠŠç»“æœè¿”å›ç»™å‘é€æ¶ˆæ¯çš„ä¸€æ–¹
    

##### 3. if (message.action === 'saveComment')

*   **è§¦å‘æ¡ä»¶**ï¼šæ”¶åˆ°ä¸€ä¸ª action å­—æ®µæ˜¯'saveComment' çš„æ¶ˆæ¯ã€‚
    
*   åŠŸèƒ½ï¼š
    

*   å…ˆè¯»å–ç°æœ‰çš„'comments'ã€‚
    
*   æŠŠæ–°çš„è¯„è®º message.comment åŠ åˆ° comments é‡Œé¢ã€‚
    
*   ç„¶åé‡æ–°ç”¨ chrome.storage.local.set æŠŠæ›´æ–°åçš„ comments ä¿å­˜å›å»ã€‚
    
*   ä¿å­˜æˆåŠŸåï¼Œè°ƒç”¨ sendResponse({status: 'saved'}) å‘ŠçŸ¥ä¿å­˜æˆåŠŸã€‚
    

å®æˆ˜ demo
-------

æ¥å‰è¨€æ¥å¼€å‘ï¼Œå…ˆåˆ—ä¸‹éœ€æ±‚ï¼š

1.  é¦–å…ˆéœ€è¦ä¸‰ä¸ªè¾“å…¥æ¡†ï¼Œè¾“å…¥ç›®æ ‡ ip åœ°å€ï¼Œå…è®¸çš„ cookie keysï¼Œä»¥åŠ localStorage keys
    
2.  æ’ä»¶è¿˜éœ€è¦æ”¯æŒä¿å­˜é…ç½®çš„åŠŸèƒ½
    
3.  æ”¯æŒä¸€é”®è·³è½¬åˆ°ç›®æ ‡ ip é¡µé¢ï¼Œå¹¶ä¸”ä¼šæºå¸¦å½“å‰é¡µé¢å…è®¸çš„ cookie keys ä»¥åŠ localStorage keys ç§æ¤åˆ°ç›®æ ‡é¡µé¢å»
    

é¦–å…ˆéœ€è¦ä¸€ä¸ªå¯è§†åŒ–çš„æ“ä½œå¼¹çª—ï¼š

### 1. popup.html

```
<body><h3>æ·»åŠ æ–°é…ç½®</h3><inputÂ type="text"Â id="target-ip"Â placeholder="ç›®æ ‡ IP åœ°å€ (ä¾‹å¦‚: 192.168.1.2)"Â /><textareaÂ id="cookie-keys"Â placeholder="å…è®¸çš„ Cookie keysï¼ˆç”¨è‹±æ–‡é€—å· , åˆ†éš”ï¼‰"></textarea><textareaÂ id="storage-keys"Â placeholder="å…è®¸çš„ LocalStorage keysï¼ˆç”¨è‹±æ–‡é€—å· , åˆ†éš”ï¼‰"></textarea><buttonÂ id="save-config">ä¿å­˜é…ç½®</button><h3>é…ç½®åˆ—è¡¨</h3><divÂ id="config-list"></div><scriptÂ src="popup.js"></script></body>
```

æ¥ä¸‹æ¥æ˜¯å¤„ç†å¼¹çª—é€»è¾‘çš„ js æ–‡ä»¶

### 2. popup.js

```
// è·å–å…ƒç´ constÂ targetIpInput =Â document.getElementById('target-ip');constÂ cookieKeysInput =Â document.getElementById('cookie-keys');constÂ storageKeysInput =Â document.getElementById('storage-keys');constÂ configListDiv =Â document.getElementById('config-list');constÂ saveButton =Â document.getElementById('save-config');// ä¿å­˜æ–°é…ç½®saveButton.addEventListener('click', () => {constÂ targetIp = targetIpInput.value.trim();constÂ cookieKeys = cookieKeysInput.value.split(',').map(kÂ =>Â k.trim()).filter(kÂ =>Â k);constÂ storageKeys = storageKeysInput.value.split(',').map(kÂ =>Â k.trim()).filter(kÂ =>Â k);ifÂ (!targetIp) {Â  Â  alert('è¯·è¾“å…¥ç›®æ ‡ IP åœ°å€');Â  Â Â return;Â  }constÂ newConfig = { targetIp, cookieKeys, storageKeys };Â  chrome.storage.local.get(['configs'], (result) => {Â  Â Â constÂ configs = result.configs || [];Â  Â  configs.push(newConfig);Â  Â  chrome.storage.local.set({ configs }, () => {Â  Â  Â  renderConfigs();Â  Â  Â  targetIpInput.value =Â '';Â  Â  Â  cookieKeysInput.value =Â '';Â  Â  Â  storageKeysInput.value =Â '';Â  Â  });Â  });});// æ¸²æŸ“å·²æœ‰é…ç½®functionÂ renderConfigs()Â {Â  configListDiv.innerHTML =Â '';Â  chrome.storage.local.get(['configs'], (result) => {Â  Â Â constÂ configs = result.configs || [];Â  Â  configs.forEach((config, index) =>Â {Â  Â  Â Â constÂ div =Â document.createElement('div');Â  Â  Â  div.className =Â 'config-item';Â  Â  Â  div.innerHTML =Â `Â  Â  Â  Â  <div><strong>IP:</strong>Â ${config.targetIp}</div>Â  Â  Â  Â  <div><strong>Cookies:</strong>Â ${config.cookieKeys.join(', ')}</div>Â  Â  Â  Â  <div><strong>LocalStorage:</strong>Â ${config.storageKeys.join(', ')}</div>Â  Â  Â  Â  <button data-index="${index}" class="run-btn">ä¸€é”®è·³è½¬</button>Â  Â  Â  Â  <button data-index="${index}" class="delete-btn">åˆ é™¤</button>Â  Â  Â  `;Â  Â  Â  configListDiv.appendChild(div);Â  Â  });Â  Â Â // ç»‘å®šæŒ‰é’®Â  Â Â document.querySelectorAll('.run-btn').forEach(btnÂ =>Â {Â  Â  Â  btn.addEventListener('click', (e) => {Â  Â  Â  Â Â constÂ idx = e.target.dataset.index;Â  Â  Â  Â  startCopy(configs[idx]);Â  Â  Â  });Â  Â  });Â  Â Â document.querySelectorAll('.delete-btn').forEach(btnÂ =>Â {Â  Â  Â  btn.addEventListener('click', (e) => {Â  Â  Â  Â Â constÂ idx = e.target.dataset.index;Â  Â  Â  Â  configs.splice(idx,Â 1);Â  Â  Â  Â  chrome.storage.local.set({ configs }, renderConfigs);Â  Â  Â  });Â  Â  });Â  });}// å¼€å§‹åŒæ­¥å¹¶è·³è½¬functionÂ startCopy(config)Â {Â  chrome.tabs.query({Â active:Â true,Â currentWindow:Â trueÂ }, ([tab]) => {Â  Â  chrome.runtime.sendMessage({Â  Â  Â Â action:Â 'copyData',Â  Â  Â  config,Â  Â  Â Â sourceUrl: tab.urlÂ  Â  Â Â tabId: tab.idÂ  Â  }, (response) => {Â  Â  Â Â ifÂ (!response.success) {Â  Â  Â  Â  alert('åŒæ­¥å¤±è´¥ï¼');Â  Â  Â  }Â  Â  });Â  });}// åˆå§‹åŒ–renderConfigs();
```

ç»™æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶ä»¥åŠæ¸²æŸ“é…ç½®éƒ½æ˜¯å¾ˆåŸºç¡€çš„ï¼Œé‡ç‚¹è¯´ä¸€ä¸‹ startCopy è¿™ä¸ªæ–¹æ³•

#### chrome.tabs.query({active: true, currentWindow: true}, ([tab]) => {...})

*   é€šè¿‡ chrome.tabs.query æ–¹æ³•ï¼ŒæŸ¥è¯¢å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µï¼ˆactive tabï¼‰
    
*   å‚æ•° {active: true, currentWindow: true}ï¼š
    

*   active: true â€”â€” åªæ‰¾å½“å‰çª—å£ä¸­æ­£åœ¨æ¿€æ´»ä¸­çš„ tabï¼ˆæ¯”å¦‚ä½ æ‰“å¼€çš„é¡µé¢ï¼‰ã€‚
    
*   currentWindow: true â€”â€” é™åˆ¶åªåœ¨å½“å‰æµè§ˆå™¨çª—å£é‡Œæ‰¾ï¼Œä¸è·¨çª—å£
    

*   è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé€šå¸¸æ•°ç»„é‡Œåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œç›®çš„æ˜¯æ‹¿åˆ°å½“å‰é¡µé¢çš„ url
    

#### chrome.runtime.sendMessage({action: 'copyData', config, sourceUrl: tab.url}, (response) => {...})

*   æ‹¿åˆ°å½“å‰é¡µé¢åï¼Œå°±ç”¨ chrome.runtime.sendMessage å‘é€ä¸€ä¸ªæ¶ˆæ¯åˆ°åå°è„šæœ¬ background.js
    
*   å‚æ•°ä¼šæºå¸¦é…ç½®çš„ urlï¼Œä»¥åŠå…è®¸çš„ keys
    
*   ç„¶åå°±æ˜¯ä¼šå¤„ç† background å›åº”çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿™é‡Œä¸»è¦æ˜¯å‘æ¶ˆæ¯ï¼Œä¸»è¦é€»è¾‘éƒ½åœ¨ background.js å†…éƒ¨
    

### 3. background.js

```
chrome.runtime.onMessage.addListener((message, sender, sendResponse) =>Â {ifÂ (message.action ===Â 'copyData') {Â  Â Â constÂ { config, sourceUrl, tabId } = message;Â  Â Â constÂ urlObj =Â newÂ URL(sourceUrl);Â  Â Â constÂ domain = urlObj.hostname;Â  Â Â // è¯»å– cookieÂ  Â  chrome.cookies.getAll({ domain }, (cookies) => {Â  Â  Â Â constÂ allowedCookies = cookies.filter(cÂ =>Â config.cookieKeys.includes(c.name));Â  Â  Â Â Â  Â  Â Â // è®¾ç½®åˆ°ç›®æ ‡ IPÂ  Â  Â  allowedCookies.forEach(cookieÂ =>Â {Â  Â  Â  Â  chrome.cookies.set({Â  Â  Â  Â  Â Â url:Â `http://${config.targetIp}`,Â  Â  Â  Â  Â Â name: cookie.name,Â  Â  Â  Â  Â Â value: cookie.value,Â  Â  Â  Â  Â Â path: cookie.path,Â  Â  Â  Â  Â Â secure: cookie.secure,Â  Â  Â  Â  Â Â httpOnly: cookie.httpOnly,Â  Â  Â  Â  Â Â sameSite: cookie.sameSiteÂ  Â  Â  Â  });Â  Â  Â  });Â  Â  Â Â // å­˜å‚¨ localStorageÂ  Â  Â  chrome.tabs.sendMessage(tabId, {Â  Â  Â  Â Â action:Â 'storeData',Â  Â  Â  Â  configÂ  Â  Â  });Â  Â  Â Â // å‘é€æ¶ˆæ¯ç»™ content script å¤„ç† localStorageÂ  Â  Â  chrome.tabs.create({Â url:Â `http://${config.targetIp}`Â }, (tab) => {Â  Â  Â  Â Â // æ³¨æ„ï¼šè¦ç­‰æ–°é¡µé¢åŠ è½½å®Œæˆåæ‰èƒ½æ³¨å…¥ localStorage æ“ä½œÂ  Â  Â  Â  chrome.tabs.onUpdated.addListener(functionÂ listener(tab_id, info)Â {Â  Â  Â  Â  Â Â ifÂ (tab_id === tab.id && info.status ===Â 'complete') {Â  Â  Â  Â  Â  Â  chrome.tabs.onUpdated.removeListener(listener);Â // ç§»é™¤ç›‘å¬ï¼Œé¿å…å¤šæ¬¡è§¦å‘Â  Â  Â  Â  Â  Â Â // ç»™ç›®æ ‡tabIdå‘é€æ¶ˆæ¯Â  Â  Â  Â  Â  Â  chrome.tabs.sendMessage(tab_id, {Â  Â  Â  Â  Â  Â  Â Â action:Â 'copyLocalStorage',Â  Â  Â  Â  Â  Â  Â  configÂ  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  }Â  Â  Â  Â  });Â  Â  Â  });Â  Â  Â  sendResponse({Â success:Â trueÂ });Â  Â  });Â  Â Â returntrue;Â // å¼‚æ­¥Â  }});
```

#### æ•´ä½“åŠŸèƒ½

*   âœ… ä»å½“å‰é¡µé¢è¯»å– cookieï¼ˆæŒ‡å®š keysï¼‰
    
*   âœ… æŠŠè¿™äº› cookie å†™åˆ°ç›®æ ‡ IP
    
*   âœ… æ–°å¼€ä¸€ä¸ª tab è·³è½¬åˆ°ç›®æ ‡ IP
    
*   âœ… åœ¨ç›®æ ‡ IP é¡µé¢æ³¨å…¥ localStorage æ•°æ®
    

#### 1. ç›‘å¬æ¶ˆæ¯

```
chrome.runtime.onMessage.addListener((message, sender, sendResponse) =>Â {
```

*   chrome.runtime.onMessage.addListenerï¼šç›‘å¬æ’ä»¶å†…éƒ¨å‘é€çš„æ¶ˆæ¯
    
*   messageï¼šæ”¶åˆ°çš„æ¶ˆæ¯å†…å®¹ï¼ˆaction, config, sourceUrlï¼‰
    
*   senderï¼šå‘é€æ¶ˆæ¯çš„ tab ä¿¡æ¯ï¼ˆsender.tabï¼‰
    
*   sendResponseï¼šå›è°ƒå‡½æ•°ï¼Œå¼‚æ­¥è¿”å›ä¸€ä¸ªå“åº”
    

#### 2. å–å‡ºé…ç½®å’Œæºåœ°å€ï¼Œå¹¶ä¸”è¯»å– cookie

```
constÂ { config, sourceUrl } = message;constÂ urlObj =Â newÂ URL(sourceUrl);constÂ domain = urlObj.hostname;chrome.cookies.getAll({ domain }, (cookies) => {})
```

#### 3. æŠŠ cookie å†™åˆ°ç›®æ ‡ IP

```
allowedCookies.forEach(cookieÂ =>Â {Â  chrome.cookies.set({Â  Â Â url:Â `http://${config.targetIp}`,Â  Â Â name: cookie.name,Â  Â Â value: cookie.value,Â  Â Â path: cookie.path,Â  Â Â secure: cookie.secure,Â  Â Â httpOnly: cookie.httpOnly,Â  Â Â sameSite: cookie.sameSiteÂ  });});
```

#### 4. æ‰“å¼€æ–°æ ‡ç­¾é¡µè·³è½¬åˆ°ç›®æ ‡ IP

```
chrome.tabs.create({Â url:Â `http://${config.targetIp}`Â }, (tab) => {})
```

#### 5. ç­‰æ–°é¡µé¢åŠ è½½å®Œæˆï¼Œå†æ³¨å…¥ localStorage

```
chrome.tabs.onUpdated.addListener(functionÂ listener(tabId, info)Â {Â Â ifÂ (tabId === tab.id && info.status ===Â 'complete') {Â  Â  chrome.tabs.onUpdated.removeListener(listener);Â  Â  chrome.tabs.sendMessage(tabId, {Â  Â  Â Â action:Â 'copyLocalStorage',Â  Â  Â  configÂ  Â  });Â  }});
```

#### 6. return true;

æœ€åè¿”å› ture æ˜¯å› ä¸ºï¼š

*   Chrome è§„å®šï¼šå¦‚æœ sendResponse æ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œå¿…é¡» return trueï¼Œå¦åˆ™é¡µé¢æ”¶ä¸åˆ°å›è°ƒ
    

#### æ³¨æ„ç‚¹

ä¸‹é¢å°±æ˜¯å¤„ç†æ³¨å…¥ localStorage çš„é€»è¾‘äº†ï¼Œä¸ºä»€ä¹ˆä¸èƒ½åœ¨ backgroud é‡Œç›´æ¥ç§æ¤å‘¢ï¼Ÿ

*   å› ä¸º backgroud.js ç›¸å½“äºä¸€ä¸ªå¤§è„‘ï¼Œä»–èƒ½è°ƒç”¨æ’ä»¶çš„æ‰€æœ‰ apiï¼Œä½†æ˜¯ä»–ä¸èƒ½æ“ä½œé¡µé¢çš„å†…å®¹
    
*   å®ƒæ— æ³•ç›´æ¥è¯»å–ç½‘é¡µé‡Œçš„ DOMã€localStorageã€æ‰§è¡Œé¡µé¢é‡Œçš„ JS
    
*   ä¸‹é¢å°±æ˜¯ content-script.js äº†
    

### 4. content-script.js

```
chrome.runtime.onMessage.addListener((message, sender, sendResponse) =>Â {ifÂ (message.action ===Â 'copyLocalStorage') {Â  Â Â // å½“é¡µé¢è·³è½¬åˆ°ç›®æ ‡ IP åï¼Œæ¢å¤ localStorageÂ  Â Â ifÂ (window.location.hostname.match(/^(\d{1,3}\.){3}\d{1,3}$/)) {Â  Â  Â Â console.log('é¡µé¢è·³è½¬åˆ°ç›®æ ‡ IP');Â  Â  Â  chrome.storage.local.get(['tempStorageData'], (result) => {Â  Â  Â  Â Â console.log(result,Â 'result');Â  Â  Â  Â Â constÂ data = result.tempStorageData || {};Â  Â  Â  Â Â Object.keys(data).forEach(keyÂ =>Â {Â  Â  Â  Â  Â  localStorage.setItem(key, data[key]);Â  Â  Â  Â  });Â  Â  Â  Â  chrome.storage.local.remove('tempStorageData');Â  Â  Â  });Â  Â  }Â  }ifÂ (message.action ===Â 'storeData') {Â  Â Â constÂ { storageKeys } = message.config;Â  Â Â constÂ storageData = {};Â  Â  storageKeys.forEach(keyÂ =>Â {Â  Â  Â Â console.log(localStorage.getItem(key));Â  Â  Â Â constÂ value = localStorage.getItem(key);Â  Â  Â Â ifÂ (value !==Â null) {Â  Â  Â  Â  storageData[key] = value;Â  Â  Â  }Â  Â  });Â  Â Â console.log(storageData,'storageData');Â  Â  chrome.storage.local.set({Â tempStorageData: storageData });Â  }});
```

è¿™é‡Œé¢çš„é€»è¾‘å¾ˆç®€å•äº†ï¼Œåˆ©ç”¨äº†ä¸€ä¸ªä¸´æ—¶ç¼“å­˜ tempStorageData å»ç§æ¤ localStorage

### 5. é™„ä¸Šé…ç½®æ–‡ä»¶

```
{Â Â "manifest_version":Â 3,Â // æŒ‡å®šä½¿ç”¨ Manifest V3ï¼Œè¿™æ˜¯ Chrome æ’ä»¶ç›®å‰æ¨èçš„æ–°ç‰ˆæœ¬"name":Â "unlogin-plug-in",Â // æ’ä»¶çš„åç§°"version":Â "1.0.0",Â // æ’ä»¶ç‰ˆæœ¬å·"description":Â "unlogin-plug-in",Â // æ’ä»¶æè¿°"permissions": [Â  Â Â "storage",Â // å…è®¸ä½¿ç”¨ chrome.storage APIï¼Œæœ¬åœ°å­˜å‚¨æ•°æ®Â  Â Â "cookies",Â // å…è®¸è¯»å–å’Œè®¾ç½® cookieÂ  Â Â "tabs",Â // å…è®¸è®¿é—®å’Œæ“ä½œæµè§ˆå™¨æ ‡ç­¾é¡µä¿¡æ¯Â  Â Â "scripting"// å…è®¸ä½¿ç”¨ chrome.scripting æ³¨å…¥è„šæœ¬Â  ],"host_permissions": [Â  Â Â "<all_urls>"// å…è®¸è®¿é—®æ‰€æœ‰ç½‘ç«™çš„é¡µé¢ï¼Œæ¯”å¦‚è¯»å– cookieã€æ³¨å…¥è„šæœ¬ç­‰Â  ],"action": {Â  Â Â "default_popup":Â "popup.html"// ç‚¹å‡»æ’ä»¶å›¾æ ‡æ—¶ï¼Œå¼¹å‡ºçš„ç•Œé¢ HTML æ–‡ä»¶Â  },"background": {Â  Â Â "service_worker":Â "background.js"// åå°è„šæœ¬ï¼Œä½¿ç”¨ service worker æ–¹å¼è¿è¡ŒÂ  },"content_scripts": [Â  Â  {Â  Â  Â Â "matches": ["<all_urls>"],Â // æŒ‡å®šåœ¨å“ªäº›é¡µé¢æ³¨å…¥ content-scriptï¼Œè¿™é‡Œæ˜¯æ‰€æœ‰é¡µé¢Â  Â  Â Â "js": ["content-script.js"]Â // è¢«æ³¨å…¥çš„è„šæœ¬æ–‡ä»¶ï¼Œå¤„ç†å½“å‰é¡µé¢çš„ localStorageã€DOM æ“ä½œç­‰Â  Â  }Â  ]}
```

å°å°æµ‹è¯•äº†ä¸€ä¸‹ï¼ŒåŠŸèƒ½å¤§ä½“æ˜¯ OK çš„ğŸ˜„

![](https://mmbiz.qpic.cn/sz_mmbiz_png/cAd6ObKOzEBd3WcQ9iaE4YqJpfoa59Gb6yqyQPXpzQoTzwGMokbuO7Pl2ib5tN6IibjoPWZUCkBWicClPPDibm51ReA/640?wx_fmt=png&from=appmsg#imgIndex=1)åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°

-END -

**å¦‚æœæ‚¨å…³æ³¨å‰ç«¯ + AI ç›¸å…³é¢†åŸŸå¯ä»¥æ‰«ç è¿›ç¾¤äº¤æµ**

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/cAd6ObKOzEArGqlLlZmLVB61keywZ2APgWHNwTdK8OicE1utUcAJj1m5ZMFTL8iac51bGglnIeCR5KHicCBh5lh3A/640?wx_fmt=jpeg#imgIndex=2)

æ·»åŠ å°ç¼–å¾®ä¿¡è¿›ç¾¤ğŸ˜Š  

å…³äºå¥‡èˆå›¢
-----

å¥‡èˆå›¢æ˜¯ 360 é›†å›¢æœ€å¤§çš„å¤§å‰ç«¯å›¢é˜Ÿï¼Œéå¸¸é‡è§†äººæ‰åŸ¹å…»ï¼Œæœ‰å·¥ç¨‹å¸ˆã€è®²å¸ˆã€ç¿»è¯‘å®˜ã€ä¸šåŠ¡æ¥å£äººã€å›¢é˜Ÿ Leader ç­‰å¤šç§å‘å±•æ–¹å‘ä¾›å‘˜å·¥é€‰æ‹©ï¼Œå¹¶è¾…ä»¥æä¾›ç›¸åº”çš„æŠ€æœ¯åŠ›ã€ä¸“ä¸šåŠ›ã€é€šç”¨åŠ›ã€é¢†å¯¼åŠ›ç­‰åŸ¹è®­è¯¾ç¨‹ã€‚å¥‡èˆå›¢ä»¥å¼€æ”¾å’Œæ±‚è´¤çš„å¿ƒæ€æ¬¢è¿å„ç§ä¼˜ç§€äººæ‰å…³æ³¨å’ŒåŠ å…¥å¥‡èˆå›¢ã€‚  

![](https://mmbiz.qpic.cn/mmbiz_png/cAd6ObKOzEBLicibtcprJISN18FgTtg2N1ichPnMqRhicrP20VfwnC4vday7gtEoiaSynIH1bas4N5kgicliakrLdtT2Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1#imgIndex=3)