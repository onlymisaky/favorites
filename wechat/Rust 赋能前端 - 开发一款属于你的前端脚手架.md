> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/zDbMoldMFKj5WoLgnHG4Pw)

> â
> 
> åŒè„šæ˜¯å¤§åœ°ä¸Šé£ç¿”çš„ç¿…è†€
> 
> â

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯**ã€ŒæŸ’å…«ä¹ã€**ã€‚ä¸€ä¸ª**ã€Œä¸“æ³¨äºå‰ç«¯å¼€å‘æŠ€æœ¯ /`Rust`åŠ`AI`åº”ç”¨çŸ¥è¯†åˆ†äº«ã€**çš„`Coder`ã€‚

å‰è¨€
==

åœ¨ä¹‹å‰çš„æ–‡ç« æˆ‘ä»¬è®²äº†å¾ˆå¤šå…³äº`Rust`çš„æ–‡ç« ã€‚

1.  [è‡´æ‰€æœ‰æ¸´æœ›å­¦ä¹  Rust çš„äººçš„ä¿¡](https://mp.weixin.qq.com/s?__biz=Mzg3NjU2OTE1Mw==&mid=2247489662&idx=1&sn=e4eba6d631e7aee9838aa974861f10ec&scene=21#wechat_redirect)
    
2.  [Rust å¼€å‘å‘½ä»¤è¡Œå·¥å…·](https://mp.weixin.qq.com/s?__biz=Mzg3NjU2OTE1Mw==&mid=2247489733&idx=1&sn=e90f57ad50bd7f90392d190333152127&scene=21#wechat_redirect)
    
3.  [ç”¨ Rust æ­å»º React Server Components çš„ Web æœåŠ¡å™¨](https://mp.weixin.qq.com/s?__biz=Mzg3NjU2OTE1Mw==&mid=2247489899&idx=1&sn=6fc040b1e3e66e5a2ae8083c0dc32a70&scene=21#wechat_redirect)
    
4.  [Rust ç¼–è¯‘ä¸º WebAssembly åœ¨å‰ç«¯é¡¹ç›®ä¸­ä½¿ç”¨](https://mp.weixin.qq.com/s?__biz=Mzg3NjU2OTE1Mw==&mid=2247490124&idx=1&sn=fc2197871abfee65d8b7d4915d4a2791&scene=21#wechat_redirect)
    
5.  [Game = Rust + WebAssembly + æµè§ˆå™¨](https://mp.weixin.qq.com/s?__biz=Mzg3NjU2OTE1Mw==&mid=2247490949&idx=1&sn=0543ebdd97004bd76e1fcf223a47f751&scene=21#wechat_redirect)
    

ä»`å‘½ä»¤è¡Œå·¥å…·`åˆ°`WebæœåŠ¡å™¨`ï¼Œå†åˆ°`WebAssembly`ã€‚å›Šæ‹¬äº†å¾ˆå¤šä¸œè¥¿ï¼Œç„¶åå‘¢ï¼Œä»Šå¤©æˆ‘ä»¬æ¥èŠèŠ**ã€Œç”¨`Rust`å†™ä¸€ä¸ªè„šæ‰‹æ¶ã€**ã€‚

ä¸çŸ¥é“ï¼Œå¤§å®¶å¹³æ—¶åœ¨å¼€å‘ä¸­æ–°å¯åŠ¨ä¸€ä¸ªé¡¹ç›®æ˜¯å¦‚ä½•æ“ä½œçš„ã€‚

*   `create-react-app`æ„å»ºä¸€ä¸ª`react`åº”ç”¨
    
*   `vue-cli`æ„å»ºä¸€ä¸ª`vue`åº”ç”¨
    
*   `vite create` æ„å»ºä¸€ä¸ª`react/vue`åº”ç”¨
    

ä¸Šé¢çš„æµç¨‹æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¤§å®¶æ˜¯å¦æ³¨æ„åˆ°ä¸€ç‚¹ï¼Œå°±æ˜¯æ— è®ºå“ªç§å¤„ç†æ–¹å¼ï¼Œå®ƒä»…ä»…æä¾›äº†ä¸€ä¸ª`base`ï¼Œç„¶åä½ éœ€è¦æ ¹æ®`è‡ªèº«`ä¸šåŠ¡åœºæ™¯è¿›è¡Œé…ç½®å¤„ç†ã€‚

é‚£é…ç½®ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„å‰ç«¯å°±æ¶‰åŠå¾ˆå¤šä¸œè¥¿äº†

*   ç»„ä»¶åº“
    
*   CSS é¢„å¤„ç†å™¨ï¼ˆ`scss`/`less`ï¼‰
    
*   `tailwind`/`css-in-js`
    
*   å…¨å±€çŠ¶æ€ç®¡ç†
    
*   `eslint`+ `oxlint`(æœ€è¿‘å¾ˆç«)
    
*   `prettier`
    
*   `husky`
    
*   `axios`
    
*   `TypeScript`
    
*   è‡ªå®šä¹‰æ ·å¼
    
*   è·¯ç”±
    
*   `ErrorBoundary`
    
*   `git`
    
*   å¤„ç†`Webpack/Vite`çš„æ‰“åŒ…é…ç½®
    
*   `.gitlab-ci.yml`çš„é…ç½®
    
*   ....
    

ç­‰ç­‰ä¸€ç³»åˆ—çš„ä¸œè¥¿ã€‚

æ‰€ä»¥ï¼Œæœ‰ä¸€ä¸ªä¸€é”®åˆ›å»ºé¡¹ç›®ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ‹¥æœ‰ä¸Šé¢æ‰€æœ‰ç‰¹æ€§çš„è„šæ‰‹æ¶èƒ½å¤Ÿçœå»å¤šå°‘æ—¶é—´ã€‚

è¿™ä¹Ÿæ˜¯ï¼Œæˆ‘ä»¬å†™è¿™ç¯‡æ–‡ç« çš„åˆè¡·ï¼Œé€šè¿‡å­¦ä¹ è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿæ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„å‰ç«¯é¡¹ç›®ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjDLNHCiaude7ibeMKo6W5XytCIrMHkhOkPE2XiahCogmiaibNescEOmUI7aA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjNBoNibdGa1mq2tX2FIZVebic1LjNvTIIGJYoa8IdKrdicaue5dTkaQofg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjibD5IUNpq7VNGGeWjfVWsrp7V3WZJx5nODG1RxAYYTkws1fZ1vkk0rQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzj2ZuBHWXXX6CpMsVcKsk8N28YyBWxCnyRkeD4kztc62819sV0wXlXHg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjTmkuiahE0JTHGKAb3ueftqsY7JhpjWic4pmGrHuNm0n2T9OgyJoF8GZw/640?wx_fmt=png&from=appmsg)

<<<å·¦å³æ»‘åŠ¨è§æ›´å¤š>>>

ç„¶åï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®åˆå§‹åŒ–åï¼Œé€šè¿‡`npm/yarn`æŒ‰ç…§å¥½å¯¹åº”çš„ä¾èµ–ï¼Œæ‰§è¡Œå¯¹åº”çš„å‘½ä»¤å°±å¯ä»¥å¼€å§‹æœ¬åœ°å¼€å‘äº†ã€‚

> â
> 
> è¿˜æœ‰å‡ ç‚¹éœ€è¦è¯´æ˜ï¼Œ
> 
> 1.  è¿™ç¯‡æ–‡ç« ä¸ä¼šå¯¹æ¯ä¸€ä¸ªæ–¹æ³•éƒ½è¯¦ç»†åšè§£é‡Šï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå¯¹æœ€åç”Ÿæˆçš„å‰ç«¯é¡¹ç›®åšåˆ†æã€‚(æˆ‘ä»¬ä¼šå•å†™ä¸€ç¯‡æ–‡ç« ï¼Œæ¥æè¿°ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„å‰ç«¯é¡¹ç›®è¯¥æœ‰å•¥)ã€‚
>     
> 2.  ç”±äºç²¾åŠ›æœ‰é™ï¼Œè¯¥è„šæ‰‹æ¶åªå…¼å®¹äº†`React`é¡¹ç›®çš„åˆå§‹åŒ–ï¼Œå¯¹`Vue`é¡¹ç›®æ²¡åšå¤„ç†ï¼Œå…¶å®å¤„ç†é€»è¾‘ä¹Ÿæ˜¯ç…§çŒ«ç”»è™
>     
> 3.  æœ€åï¼Œç°åœ¨è¿™ä¸ªç‰ˆæœ¬åªé™é€šè¿‡ crates.io[1] è¿›è¡Œä¸‹è½½ï¼ŒåæœŸæˆ‘ä»¬ä¼šå°†å…¶å‘å¸ƒåˆ°`npm`ã€‚å¦‚æœæœ‰ç­‰ä¸åŠçš„å°ä¼™ä¼´ï¼Œå¯ä»¥ç§èŠç´¢è¦æœ€æ–°ç‰ˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åé€šè¿‡åœ¨`.bashrc`æ·»åŠ `export PATH="/Users/xx/xx:$PATH"`è¿›è¡Œå…¨å±€å®‰è£…
>     
> 
> â

å¥½äº†ï¼Œå¤©ä¸æ—©äº†ï¼Œå¹²ç‚¹æ­£äº‹å“‡ã€‚

![](https://mmbiz.qpic.cn/mmbiz_gif/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjPlDCDxgYQ1XuMuTjWZPDs0ISyYbibkSq6yTy778Oic6Ksw53221wRPQQ/640?wx_fmt=gif&from=appmsg)

### æˆ‘ä»¬èƒ½æ‰€å­¦åˆ°çš„çŸ¥è¯†ç‚¹

> â
> 
> 1.  å‰ç½®çŸ¥è¯†ç‚¹
>     
> 2.  é¡¹ç›®ç›®å½•ç®€ä»‹
>     
> 3.  é¡¹ç›®åˆå§‹åŒ–
>     
> 4.  `main.rs`
>     
> 5.  `content/*`
>     
> 6.  æ ¸å¿ƒå‡½æ•°`create`
>     
> 7.  `utils/logger.rs`
>     
> 8.  å…¶ä»–å‡½æ•°
>     
> 9.  cargo build
>     
> 10.  cargo publish
>     
> 11.  TODO
>     
> 
> â

* * *

1. å‰ç½®çŸ¥è¯†ç‚¹
========

> â
> 
> **ã€Œå‰ç½®çŸ¥è¯†ç‚¹ã€**ï¼Œåªæ˜¯åšä¸€ä¸ªæ¦‚å¿µçš„ä»‹ç»ï¼Œä¸ä¼šåšæ·±åº¦è§£é‡Šã€‚å› ä¸ºï¼Œè¿™äº›æ¦‚å¿µåœ¨ä¸‹é¢æ–‡ç« ä¸­ä¼šæœ‰å‡ºç°ï¼Œä¸ºäº†è®©è¡Œæ–‡æ›´åŠ çš„é¡ºç•…ï¼Œæ‰€ä»¥å°†æœ¬è¯¥åœ¨æ–‡å†…çš„æ¦‚å¿µè§£é‡Šæ”¾åˆ°å‰é¢æ¥ã€‚**ã€Œå¦‚æœå¤§å®¶å¯¹è¿™äº›æ¦‚å¿µç†Ÿæ‚‰ï¼Œå¯ä»¥ç›´æ¥å¿½ç•¥ã€**  
> åŒæ—¶ï¼Œç”±äºé˜…è¯»æˆ‘æ–‡ç« çš„ç¾¤ä½“æœ‰å¾ˆå¤šï¼Œæ‰€ä»¥æœ‰äº›çŸ¥è¯†ç‚¹å¯èƒ½**ã€Œæˆ‘è§†ä¹‹è‹¥çå®ï¼Œå°”è§†åªå¦‚è‰èŠ¥ï¼Œå¼ƒä¹‹å¦‚æ•å±¥ã€**ã€‚ä»¥ä¸‹çŸ¥è¯†ç‚¹ï¼Œè¯·**ã€Œé…Œæƒ…ä½¿ç”¨ã€**ã€‚
> 
> â

ä½•ä¸ºè„šæ‰‹æ¶
-----

å…³äºè„šæ‰‹æ¶ï¼Œæˆ‘ä»¬åœ¨[å‰ç«¯å·¥ç¨‹åŒ–ä¹‹æ¦‚å¿µä»‹ç»](https://mp.weixin.qq.com/s?__biz=Mzg3NjU2OTE1Mw==&mid=2247484622&idx=1&sn=8641716e20fe854d2da33e8343ce46db&scene=21#wechat_redirect)ä¸­æœ‰è¿‡è§£é‡Šï¼Œæˆ‘ä»¬å°±æ‹¿æ¥ä¸»ä¹‰äº†ã€‚

> â
> 
> è„šæ‰‹æ¶ä½œä¸ºä¸€ç§åˆ›å»ºé¡¹ç›®**ã€Œåˆå§‹æ–‡ä»¶ã€**çš„å·¥å…·è¢«å¹¿æ³›åœ°åº”ç”¨äº**ã€Œæ–°é¡¹ç›®ã€**æˆ–è€…**ã€Œè¿­ä»£åˆå§‹é˜¶æ®µã€**
> 
> â

ä½¿ç”¨å·¥å…·æ›¿ä»£äººå·¥æ“ä½œèƒ½å¤Ÿé¿å…äººä¸ºå¤±è¯¯å¼•èµ·çš„ä½çº§é”™è¯¯ï¼ŒåŒæ—¶ç»“åˆæ•´ä½“å‰ç«¯å·¥ç¨‹åŒ–æ–¹æ¡ˆï¼Œå¿«é€Ÿç”ŸæˆåŠŸèƒ½**ã€Œæ¨¡å—é…ç½®ã€**ã€**ã€Œè‡ªåŠ¨å®‰è£…ä¾èµ–ã€**ç­‰ï¼Œé™ä½äº†æ—¶é—´æˆæœ¬ã€‚

### è„šæ‰‹æ¶æ¨¡æ¿

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºè„šæ‰‹æ¶å¯¹åº”çš„æ¨¡æ¿å¯¹é¡¹ç›®è¿›è¡Œ**ã€Œå®šåˆ¶åŒ–å¤„ç†ã€**ã€‚

å®šåˆ¶åŒ–æ¨¡æ¿å¯ä»¥**ã€Œå¼¥è¡¥ã€**å®˜æ–¹æä¾›åŸºç¡€å·¥å…·é›†ä¸æ»¡è¶³ç‰¹å®šéœ€æ±‚çš„åœºæ™¯ã€‚

å®šåˆ¶åŒ–æœ‰å¦‚ä¸‹ä¼˜ç‚¹ (ä½†æœ‰ä¸ä»…é™è¿™äº›ä¼˜ç‚¹)

*   ä¸ºé¡¹ç›®å¼•å…¥**ã€Œæ–°çš„ã€**é€šç”¨ç‰¹æ€§
    
*   é’ˆå¯¹æ„å»ºç¯èŠ‚çš„ `webpack/vite` é…ç½®ä¼˜åŒ–ï¼Œæ¥æå‡å¼€å‘ç¯å¢ƒçš„æ•ˆç‡å’Œç”Ÿäº§ç¯å¢ƒçš„æ€§èƒ½ç­‰
    
*   å®šåˆ¶ç¬¦åˆ**ã€Œå›¢é˜Ÿå†…éƒ¨è§„èŒƒã€**çš„ä»£ç æ£€æµ‹è§„åˆ™é…ç½®
    
*   å®šåˆ¶å•å…ƒæµ‹è¯•ç­‰**ã€Œè¾…åŠ©å·¥å…·æ¨¡å—ã€**çš„é…ç½®é¡¹
    
*   å®šåˆ¶ç¬¦åˆå›¢é˜Ÿå†…éƒ¨è§„èŒƒçš„**ã€Œç›®å½•ç»“æ„ä¸é€šç”¨ä¸šåŠ¡æ¨¡å—ã€**
    

*   ä¸šåŠ¡ç»„ä»¶åº“
    
*   è¾…åŠ©å·¥å…·ç±»
    
*   é¡µé¢æ¨¡æ¿
    

> â
> 
> è„šæ‰‹æ¶çš„**ã€ŒåŠŸèƒ½å’Œæœ¬è´¨ã€**
> 
> 1.  åŠŸèƒ½æ˜¯**ã€Œåˆ›å»ºé¡¹ç›®åˆå§‹æ–‡ä»¶ã€**
>     
> 2.  æœ¬è´¨æ˜¯**ã€Œæ–¹æ¡ˆçš„å°è£…ã€**
>     
> 
> â

ä¹‹å‰ï¼Œæˆ‘ä»¬åœ¨[å‰ç«¯å·¥ç¨‹åŒ–ä¹‹æ¦‚å¿µä»‹ç»](https://mp.weixin.qq.com/s?__biz=Mzg3NjU2OTE1Mw==&mid=2247484622&idx=1&sn=8641716e20fe854d2da33e8343ce46db&scene=21#wechat_redirect)ä¸­å†™è¿‡åŸºäº`create-react-app`çš„è„šæ‰‹æ¶æ–¹æ¡ˆï¼Œå¦‚æœæœ‰å°ä¼™ä¼´çš„å…¬å¸è¿˜æ˜¯ç”¨`CRA`è¿›è¡Œé¡¹ç›®åˆå§‹åŒ–ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« ã€‚

* * *

rustup å·¥å…·å‘½ä»¤
-----------

è¦æŸ¥çœ‹é€šè¿‡ `rustup` å®‰è£…çš„å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡ ä¸ªä¸åŒçš„å‘½ä»¤æ¥è·å–ä¸åŒç±»å‹çš„ä¿¡æ¯ã€‚

### 1. æŸ¥çœ‹å·²å®‰è£…çš„ Rust ç‰ˆæœ¬

```
rustupÂ show
```

è¿™ä¸ªå‘½ä»¤ä¼šæ˜¾ç¤ºå½“å‰å®‰è£…çš„ Rust ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬é»˜è®¤ç‰ˆæœ¬ã€ç¨³å®šç‰ˆï¼ˆstableï¼‰ã€å¼€å‘ç‰ˆï¼ˆnightlyï¼‰å’Œæµ‹è¯•ç‰ˆï¼ˆbetaï¼‰ï¼Œä»¥åŠä¸ºä¸åŒç›®æ ‡å¹³å°å®‰è£…çš„å·¥å…·é“¾ã€‚

### 2. åˆ—å‡ºå·²å®‰è£…çš„ç›®æ ‡å¹³å°

```
rustupÂ targetÂ listÂ --installed
```

è¿™ä¸ªå‘½ä»¤ä¼šåˆ—å‡ºå·²ç»ä¸ºä½ çš„ Rust å®‰è£…æ·»åŠ çš„æ‰€æœ‰ç›®æ ‡å¹³å°ã€‚

### 3. æŸ¥çœ‹å¯ç”¨çš„å·¥å…·é“¾

```
rustupÂ toolchainÂ list
```

æ­¤å‘½ä»¤å°†æ˜¾ç¤ºå·²å®‰è£…çš„æ‰€æœ‰ Rust å·¥å…·é“¾ã€‚

### 4. æŸ¥çœ‹å·²å®‰è£…çš„ç»„ä»¶

å¯¹äºå½“å‰æ´»åŠ¨çš„å·¥å…·é“¾ï¼Œå¯ä»¥æŸ¥çœ‹å·²å®‰è£…çš„ç»„ä»¶ï¼ˆå¦‚ rustcã€cargo ç­‰ï¼‰ï¼š

```
rustupÂ componentÂ listÂ --installed
```

### 5. æ›´æ–° Rust å’Œ rustup

ä¸ºäº†ç¡®ä¿ä½ çš„å·¥å…·æ˜¯æœ€æ–°çš„ï¼Œå¯ä»¥å®šæœŸè¿è¡Œæ›´æ–°å‘½ä»¤ï¼š

```
rustupÂ update
```

è¿™ä¸ªå‘½ä»¤ä¼šæ›´æ–°æ‰€æœ‰å·²å®‰è£…çš„å·¥å…·é“¾ã€‚

* * *

2. é¡¹ç›®ç›®å½•ç®€ä»‹
=========

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjTw6r3icqSrJibVkKhM9Xibfob0IlAOocdZdCYsBScOvSQUlqKOQEnDsTg/640?wx_fmt=png&from=appmsg)

ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸»è¦çš„é‡ç‚¹å°±æ˜¯ä»‹ç»`src`é‡Œé¢çš„å†…å®¹ï¼Œç„¶ååƒ`template-react/template-state-redux`æˆ‘ä»¬åç»­ä¼šæœ‰ä¸“é—¨çš„æ–‡ç« è§£é‡Šã€‚

ç„¶åï¼Œ`template-customize-hook`çš„è¯ï¼Œå¯ä»¥ç›´æ¥å‚è€ƒæˆ‘ä»¬ä¹‹å‰å†™çš„[ç¾ä¸½çš„å…¬ä¸»å’Œå®ƒçš„ 27 ä¸ª React è‡ªå®šä¹‰ Hook](https://mp.weixin.qq.com/s?__biz=Mzg3NjU2OTE1Mw==&mid=2247490072&idx=1&sn=e2398b4567c624fa1b0317c8cd6d222b&scene=21#wechat_redirect)ã€‚é‡Œé¢éƒ½æ˜¯ä¸€äº›æ–¹ä¾¿ç”¨äºæˆ‘ä»¬å¹³æ—¶å¼€å‘çš„`hook`ã€‚

* * *

3. é¡¹ç›®åˆå§‹åŒ–
========

ä¿—è¯è¯´ï¼Œæ“’è´¼å…ˆæ“’ç‹ï¼Œé‚£å¯¹äº`Rust`é¡¹ç›®æ¥è®²ã€‚æˆ‘ä»¬é¦–å…ˆè¦çœ‹`Cargo.toml`ã€‚

ä¸€èˆ¬æˆ‘ä»¬æ–°å»ºä¸€ä¸ª`Rust`é¡¹ç›®ï¼Œéƒ½æ˜¯é€šè¿‡`cargo init xx`æ¥åˆå§‹åŒ–é¡¹ç›®ã€‚

ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
xxx
â”œâ”€Â src
â”‚Â Â â””â”€Â main.rs
â””â”€Â Cargo.toml
```

æ­¤æ—¶çš„`Cargo.toml`åªæ˜¯åˆå§‹åŒ–ä¸€äº›æœ€åŸºç¡€çš„é…ç½®ä¿¡æ¯ã€‚

```
[package]
name = "xxx" // é¡¹ç›®åç§°
version = "0.1.0"
edition = "2021"

[dependencies]
```

æ‰€ä»¥ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ­¥çš„æ“ä½œå°±æ˜¯å¤„ç†`Cargo.toml`çš„é…ç½®ä¿¡æ¯ã€‚ä¸‹é¢æˆ‘ä»¬å°±ç›´æ¥è´´å‡ºäº†ï¼Œæˆ‘ä»¬é¡¹ç›®æœ€åçš„é…ç½®å†…å®¹ã€‚é‡Œé¢çš„`[dependencies]`æˆ‘ä»¬åœ¨ä¸‹é¢ä»£ç è®²è§£ä¸­ä»‹ç»ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjj6Pj4EjPpJz9z4t7xX8fe5gB5XDGlF9KvJQ5V3aD1RwML8GTxoCaVA/640?wx_fmt=png&from=appmsg)

*   `[package]`æˆ‘ä»¬å°±ä¸éœ€è¦å¤šä»‹ç»äº†ï¼Œå®ƒä¸»è¦æè¿°äº†è¯¥é¡¹ç›®çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ã€‚
    
*   `[dependencies]`çš„è¯ï¼Œæ ‡æ³¨äº†æˆ‘ä»¬é¡¹ç›®ä¸­éœ€è¦å¼•å…¥çš„ç¬¬ä¸‰æ–¹`crate`
    

ä¸Šé¢æœ‰ä¸¤ä¸ªä¸œè¥¿æˆ‘ä»¬å¯èƒ½æ„Ÿåˆ°é™Œç”Ÿã€‚

*   `default-run`
    

*   `[package]` éƒ¨åˆ†ä¸­çš„ `default-run` å­—æ®µå¯ç”¨äºæŒ‡å®š `cargo run` é€‰æ‹©çš„é»˜è®¤äºŒè¿›åˆ¶æ–‡ä»¶ã€‚
    

*   `[[bin]]`
    

*   `äºŒè¿›åˆ¶ç›®æ ‡`æ˜¯ç¼–è¯‘åå¯ä»¥è¿è¡Œçš„å¯æ‰§è¡Œç¨‹åºã€‚é»˜è®¤äºŒè¿›åˆ¶æ–‡ä»¶åæ˜¯ `src/main.rs`ï¼Œé»˜è®¤ä¸ºåŒ…çš„åç§°ã€‚å…¶ä»–äºŒè¿›åˆ¶æ–‡ä»¶å­˜å‚¨åœ¨ç›®å½•ä¸­`src/bin/`ã€‚
    

æƒ³æ›´è¿‡äº†è§£`Cargo.toml`çš„é…ç½®å±æ€§ï¼Œå¯ä»¥å‚è€ƒ Manifest Format[2]

* * *

4. main.rs
==========

åœ¨`vscode`ä¸­æˆ‘ä»¬ä½¿ç”¨`Ctrl+K+0`æŠ˜å æ‰€æœ‰çš„ä»£ç å—ï¼Œç„¶åä¾æ®é€»è¾‘å’ŒåŠŸèƒ½åˆ’åˆ†ã€‚å¯ä»¥å°†`main.rs`åˆ’æˆ 5 éƒ¨åˆ†ï¼Œå¦‚ä¸‹å›¾ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzj5vfwEdnOYlxq5f1NZ7O9OXGax7TTz7FUkbAFjA04IkKzPPNE0EDu2w/640?wx_fmt=png&from=appmsg)

ä¸‹é¢å°±æŒ‰ç…§ä¸Šé¢çš„åˆ’åˆ†è¿›è¡Œä»£ç çš„è§£æã€‚

4.1 å¼•å…¥å­æ¨¡å—å’Œç¬¬ä¸‰æ–¹åº“
--------------

### å¼•å…¥å­æ¨¡å—

```
modÂ content;modÂ utils;useÂ content::project;useÂ utils::logger;useÂ crate::project::CreationOptions;
```

*   **ã€Œmodã€**:
    

*   `mod`å…³é”®å­—åœ¨`Rust`ä¸­ç”¨äº**ã€Œå£°æ˜æ¨¡å—ã€**
    
*   `mod content;` å’Œ `mod utils;` æ˜¯å£°æ˜ä¸¤ä¸ªæ¨¡å—`content`å’Œ`utils`ã€‚
    

*   **ã€Œuseã€**:
    

*   `use`å…³é”®å­—ç”¨äº**ã€Œå°†æ¨¡å—æˆ–æ¨¡å—ä¸­çš„é¡¹å¼•å…¥å½“å‰ä½œç”¨åŸŸã€**ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒä»¬è€Œä¸éœ€è¦å‰ç¼€ã€‚
    
*   ä¸Šé¢ä»£ç å¼•å…¥äº†`content`æ¨¡å—ä¸­çš„`project`ï¼Œ`utils`æ¨¡å—ä¸­çš„`logger`ï¼Œä»¥åŠå½“å‰åŒ…ä¸­çš„`project::CreationOptions`ã€‚
    

### å¼•å…¥ç¬¬ä¸‰æ–¹åº“

```
useÂ anyhow::Result;useÂ clap::{Â Â Parser,Â Â Â Subcommand,Â Â Â ValueEnum,Â Â Â builder::{EnumValueParser,Â ValueHint}};useÂ std::path::PathBuf;useÂ dialoguer::{console::Term,Â theme::ColorfulTheme,Â Select};
```

1.  anyhow[3] ç”¨äº**ã€Œç®€åŒ–é”™è¯¯å¤„ç†ã€**çš„åº“ï¼Œ`Result`æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œä»£è¡¨æ“ä½œå¯èƒ½çš„æˆåŠŸï¼ˆ`Ok`ï¼‰æˆ–å¤±è´¥ï¼ˆ`Err`ï¼‰ã€‚
    
2.  clap[4] ç”¨äº**ã€Œè§£æå‘½ä»¤è¡Œå‚æ•°ã€**ã€‚`Parser`, `Subcommand`, `ValueEnum`, `EnumValueParser`, å’Œ `ValueHint` æ˜¯ç”¨æ¥å®šä¹‰å¦‚ä½•è§£æå‘½ä»¤è¡Œå‚æ•°å’Œå¦‚ä½•ä¸å®ƒä»¬äº¤äº’çš„å·¥å…·ã€‚
    
3.  `use std::path::PathBuf;`å¼•å…¥äº†æ ‡å‡†åº“`std`ä¸­çš„`path::PathBuf`ï¼Œå®ƒæ˜¯è·¯å¾„çš„æ‰€æœ‰æƒå˜ä½“ï¼Œç”¨äºè·¨å¹³å°çš„è·¯å¾„æ“ä½œã€‚
    
4.  dialoguer[5] æ˜¯ä¸€ä¸ªç”¨äº**ã€Œåˆ›å»ºå‘½ä»¤è¡Œäº¤äº’ã€**çš„åº“ã€‚è¿™é‡Œå¼•å…¥äº†`Term`ç”¨äºè¡¨ç¤ºç»ˆç«¯ï¼Œ`ColorfulTheme`ç”¨äºå®šä¹‰äº¤äº’çš„ä¸»é¢˜é£æ ¼ï¼Œä»¥åŠ`Select`ç”¨äºåˆ›å»ºé€‰æ‹©èœå•ã€‚
    

* * *

4.2 å®šä¹‰è¡Œå‘½ä»¤æšä¸¾å‚æ•°
-------------

å…¶å®è¿™éƒ¨åˆ†å¾ˆç®€å•å°±æ˜¯å®šä¹‰äº†å‡ ä¸ªå…¬å…±ç±»å‹çš„æšä¸¾ã€‚

æˆ‘å°±æ‹¿å…¶ä¸­ä¸€ä¸ªä½œä¸ºä¾‹å­æ¥è®²è§£ã€‚

```
#[derive(Clone,Â Copy,Â Debug,Â PartialEq,Â Eq,Â ValueEnum)]pubÂ enumÂ StateManagementÂ {Â Â Â Â Redux,Â Â Â Â Zustand,Â Â Â Â Recoil,Â Â Â Â Jotai,Â Â Â Â MobX,Â Â Â Â Valtio,}
```

*   `pub enum StateManagement` å£°æ˜äº†ä¸€ä¸ªå…¬å¼€çš„æšä¸¾ç±»å‹`StateManagement`ã€‚
    
*   `Redux`/`Zustand`/`Recoil`/`Jotai`/`MobX`/`Valtio`æ˜¯è¿™ä¸ªæšä¸¾çš„å˜ä½“ï¼Œåˆ†åˆ«ä»£è¡¨äº†ç°åœ¨æœ€æµè¡Œçš„`React`çŠ¶æ€ç®¡ç†æ–¹æ¡ˆã€‚
    

> â
> 
> é’ˆå¯¹çŠ¶æ€ç®¡ç†å™¨æŒ‰ç…§åŠŸèƒ½åˆ†ç±»ï¼Œå…¶å®ï¼Œåº”è¯¥æ˜¯ 3 å¤§ç±»ï¼Œ
> 
> 1.  åŸºäº`Reducer`çš„`Redux`å’Œ`Zustand`
>     
> 2.  åŸºäº`Atom`çš„`Recoil`å’Œ`Jotai`
>     
> 3.  åŸºäº`Mutable`çš„`MobX`å’Œ`Valtio`
>     
> 
> â

è¿™ä¸ªæˆ‘ä»¬åæœŸä¼šä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« æ¥è§£é‡Šçš„ã€‚

ç»†å¿ƒçš„ä½ ï¼Œä¼šå‘ç°åœ¨æ¯ä¸ªæšä¸¾ä¸Šéƒ½æœ‰`#[derive(Clone, Copy, Debug, PartialEq, Eq, ValueEnum)]`ã€‚

è®©æˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚

### #[derive]

> â
> 
> #[derive][6] åœ¨ `Rust` ä¸­æ˜¯ä¸€ä¸ªå±æ€§ï¼ˆ`attribute`ï¼‰ï¼Œç”¨äºè‡ªåŠ¨ä¸ºæŸäº›ç±»å‹ï¼ˆå¦‚`ç»“æ„ä½“`æˆ–`æšä¸¾`ï¼‰æ´¾ç”Ÿæˆ–å®ç°ä¸€äº›ç‰¹å®šçš„ `trait`ã€‚
> 
> â

è¿™ä¸ªç‰¹æ€§å…è®¸å¼€å‘è€…åœ¨ç¼–å†™ç»“æ„ä½“æˆ–æšä¸¾æ—¶é¿å…æ‰‹åŠ¨å®ç°ä¸€äº›é€šç”¨çš„ `trait`ï¼Œå¦‚ `Clone`, `Copy`, `Debug`, `PartialEq`, `Eq` ç­‰ï¼Œä»è€Œå‡å°‘é‡å¤ä»£ç ï¼Œå¹¶ä½¿å¾—ä»£ç æ›´åŠ ç®€æ´ã€‚

å½“æˆ‘ä»¬ä½¿ç”¨ `#[derive]` å±æ€§æ—¶ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæŒ‡å®šçš„ç±»å‹è‡ªåŠ¨å®ç°è¿™äº› trait çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨ `#[derive(Debug)]`ï¼Œ`Rust` ä¼šä¸ºä½ çš„ç±»å‹ç”Ÿæˆä¸€ä¸ªæ ¼å¼åŒ–è¾“å‡ºçš„å®ç°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å ä½ç¬¦ `{:?}` æ¥æ‰“å°è¯¥ç±»å‹çš„å€¼ã€‚

åƒæšä¸¾ä¸Šé¢çš„`#[derive(Clone, Copy, Debug, PartialEq, Eq, ValueEnum)]`è¯­å¥ã€‚å®ƒè‡ªåŠ¨ä¸ºæšä¸¾å®ç°äº†æ‹¬å·å†…æŒ‡å®šçš„å¤šä¸ª`trait`ã€‚

*   **ã€ŒCloneã€**: å…è®¸è¿™ä¸ªæšä¸¾çš„å®ä¾‹è¢«å¤åˆ¶ã€‚
    
*   **ã€ŒCopyã€**: å…è®¸è¿™ä¸ªæšä¸¾çš„å®ä¾‹åœ¨èµ‹å€¼æ—¶è¢«å¤åˆ¶ï¼ˆä¸ Clone ç›¸ä¼¼ï¼Œä½†é€‚ç”¨äºæ›´ç®€å•çš„å€¼ï¼‰ã€‚
    
*   **ã€ŒDebugã€**: å…è®¸å®ä¾‹å¯ä»¥è¢«æ ¼å¼åŒ–è¾“å‡ºï¼Œä¸»è¦ç”¨äºè°ƒè¯•ã€‚
    
*   **ã€ŒPartialEqã€**: å…è®¸å®ä¾‹å¯ä»¥è¢«æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ã€‚
    
*   **ã€ŒEqã€**: è¡¨ç¤ºè¿™ä¸ªæšä¸¾çš„ç›¸ç­‰æ¯”è¾ƒæ˜¯åå°„æ€§çš„ï¼Œå¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚
    
*   **ã€ŒValueEnumã€**: è¿™æ˜¯æ¥è‡ªç¬¬ä¸‰æ–¹åº“`clap`çš„ä¸€ä¸ª traitï¼Œå…è®¸è¿™ä¸ªæšä¸¾å¯ä»¥è¢«ç”¨ä½œå‘½ä»¤è¡Œå‚æ•°çš„å€¼ã€‚
    

* * *

4.3 å‘½ä»¤è¡Œç»“æ„ä½“
----------

```
#[derive(Parser)]#[command(Â Â Â Â nameÂ =Â "f_cli",Â Â Â Â author,Â Â Â Â version,Â Â Â Â about,Â Â Â Â args_conflicts_with_subcommandsÂ =Â trueÂ )]structÂ CliÂ {Â Â Â Â #[command(subcommand)]Â Â Â Â command:Â Option<Commands>,Â Â Â Â #[arg(helpÂ =Â "å¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šæ–°é¡¹ç›®çš„åç§°",Â value_hintÂ =Â ValueHint::DirPath)]Â Â Â Â name:Â Option<String>,}
```

è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ª`Cli`ç»“æ„ä½“ï¼Œä½¿ç”¨`clap`åº“æ¥è‡ªåŠ¨ç”Ÿæˆå‘½ä»¤è¡Œè§£æçš„ä»£ç ã€‚é€šè¿‡`#[derive(Parser)]`ï¼Œå®ƒè‡ªåŠ¨å®ç°äº†å‘½ä»¤è¡Œå‚æ•°çš„è§£æåŠŸèƒ½ã€‚`#[command]`å±æ€§åˆ™ç”¨æ¥å®šä¹‰å‘½ä»¤è¡Œç•Œé¢çš„åŸºæœ¬å…ƒä¿¡æ¯å’Œä¸€äº›ç‰¹å®šçš„è¡Œä¸ºè§„åˆ™ã€‚

è®©æˆ‘ä»¬æ¥é€ä¸€è§£é‡Š

*   `#[derive(Parser)]`:
    

*   è¿™æ˜¯ä¸€ä¸ªå±æ€§ï¼ŒæŒ‡ç¤ºç¼–è¯‘å™¨è‡ªåŠ¨ä¸º`Cli`ç»“æ„ä½“å®ç°`clap::Parser` traitã€‚è€Œ`Parser` trait æ˜¯`clap`åº“æä¾›çš„ï¼Œç”¨äº**ã€Œå°†ç»“æ„ä½“è½¬æ¢æˆå‘½ä»¤è¡Œè§£æå™¨ã€**ã€‚
    

*   `#[command(...)]`:
    

*   `#[command]`æ˜¯`clap`åº“çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºå®šä¹‰å‘½ä»¤è¡Œå·¥å…·çš„**ã€Œå…ƒä¿¡æ¯ã€**ä»¥åŠä¸€äº›è¡Œä¸ºã€‚
    
*   `name = "f_cli"`: è®¾ç½®å‘½ä»¤è¡Œå·¥å…·çš„åç§°ä¸º`f_cli`ã€‚
    
*   `author`: è‡ªåŠ¨ä½¿ç”¨`Cargo.toml`ä¸­å®šä¹‰çš„ä½œè€…ä¿¡æ¯ã€‚
    
*   `version`: è‡ªåŠ¨ä½¿ç”¨`Cargo.toml`ä¸­å®šä¹‰çš„ç‰ˆæœ¬å·ã€‚
    
*   `about`: è‡ªåŠ¨ä½¿ç”¨`Cargo.toml`ä¸­å®šä¹‰çš„è¯´æ˜ä¿¡æ¯ã€‚
    
*   `args_conflicts_with_subcommands = true`: è¿™æ˜¯ä¸€ä¸ªè¡Œä¸ºè®¾ç½®ï¼ŒæŒ‡å®šå½“å­˜åœ¨å­å‘½ä»¤æ—¶ï¼Œä¸»å‘½ä»¤ä¸å…è®¸ä½¿ç”¨ä¸å­å‘½ä»¤åŒåçš„å‚æ•°ã€‚
    

*   `struct Cli` å®šä¹‰äº†ä¸€ä¸ªåä¸º`Cli`çš„ç»“æ„ä½“ï¼Œç”¨äºè¡¨ç¤ºå‘½ä»¤è¡Œæ¥å£çš„é…ç½®ã€‚
    
*   ç»“æ„ä½“å­—æ®µ
    

*   `command: Option<Commands>,` å­—æ®µå¯èƒ½å­˜å‚¨ä¸€ä¸ª`Commands`æšä¸¾ï¼Œè¿™ä¸ªæšä¸¾åŒ…å«ä¸åŒçš„å­å‘½ä»¤ã€‚ä½¿ç”¨`Option`æ˜¯å› ä¸ºç”¨æˆ·å¯èƒ½ä¸æä¾›ä»»ä½•å­å‘½ä»¤ã€‚
    
*   `name: Option<String>,` å­—æ®µå¯èƒ½å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ç”¨äºæŒ‡å®šæ–°é¡¹ç›®çš„åç§°ã€‚åŒæ ·ä½¿ç”¨`Option`æ˜¯å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ã€‚
    

* * *

4.4 å‘½ä»¤ç±»å‹
--------

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzj54L2YMticiaD7wNmQqhiaOjp57W1PGVgydWLnibxvO81PlnZgunOicj5iacQ/640?wx_fmt=png&from=appmsg)

> â
> 
> è¿™æ®µä»£ç ä½¿ç”¨`clap`åº“æ¥å®šä¹‰ä¸€ä¸ª**ã€Œå‘½ä»¤è¡Œæ¥å£ã€**ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ª`Create`å­å‘½ä»¤ç”¨äºåˆ›å»ºæ–°é¡¹ç›®ã€‚
> 
> â

æ¯ä¸ªå‚æ•°å’Œæ ‡å¿—éƒ½ä½¿ç”¨`clap`çš„å±æ€§è¿›è¡Œäº†è¯¦ç»†çš„é…ç½®ï¼Œä»¥ç¡®ä¿å‘½ä»¤è¡Œæ¥å£çš„è¡Œä¸ºç¬¦åˆé¢„æœŸã€‚

ç»“æœå°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªåä¸º`Commands`çš„æšä¸¾ï¼Œç”¨äºè¡¨ç¤ºå‘½ä»¤è¡Œå·¥å…·çš„ä¸åŒå‘½ä»¤ã€‚æ­¤æšä¸¾åŒ…å«ä¸€ä¸ªå˜ä½“`Create`ï¼Œä»£è¡¨åˆ›å»ºæ–°é¡¹ç›®çš„å‘½ä»¤ã€‚

æœ€åçš„æ•ˆæœå°±æ˜¯ï¼Œæˆ‘ä»¬åœ¨è¿è¡Œ`f_cli`æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`f_cli --help`æ¥è·å–æ“ä½œç»†èŠ‚ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjicPGL4PNUhfbo8HSbuIT4GOvlC3y3UuPn4hR0dk73ibhXjeBtdiaMMs9w/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjToB32TAjficpCt9g8dp6m9NNy9ZQ0FnTGdozA7iajoOyPCica56K9hXFA/640?wx_fmt=png&from=appmsg)

<<<å·¦å³æ»‘åŠ¨è§æ›´å¤š>>>

*   `#[derive(Subcommand)]`:
    

*   è¿™ä¸ªå±æ€§æŒ‡ç¤ºç¼–è¯‘å™¨ä¸ºæšä¸¾è‡ªåŠ¨å®ç°`Subcommand` traitï¼Œè¯¥ trait æ˜¯`clap`åº“ä¸­å®šä¹‰çš„ï¼Œç”¨äºå¤„ç†å­å‘½ä»¤ã€‚
    

*   `enum Commands`:
    

*   è¿™å®šä¹‰äº†ä¸€ä¸ªåä¸º`Commands`çš„æšä¸¾ï¼Œå®ƒå°†è¢«ç”¨ä½œä¸»å‘½ä»¤çš„å­å‘½ä»¤ã€‚å½“å‰ä»£ç ä¸­åªå®šä¹‰äº†ä¸€ä¸ªå­å‘½ä»¤`Create`ã€‚
    

### Create æšä¸¾å˜ä½“è§£é‡Š

`Create`å˜ä½“ç”¨æ¥è¡¨ç¤ºåˆ›å»ºé¡¹ç›®çš„å‘½ä»¤ï¼Œå¹¶åŒ…å«å¤šä¸ªæ ‡è®°å’Œå‚æ•°ï¼š

1.  `cli_mode`:
    

*   é€šè¿‡`short`å’Œ`long`å±æ€§å®šä¹‰äº†çŸ­æ ‡è®°`-c`å’Œé•¿æ ‡è®°`--cli`ã€‚
    
*   `name`å±æ€§æè¿°äº†å‚æ•°çš„åç§°ã€‚
    
*   `help`å±æ€§æä¾›äº†å…³äºæ­¤æ ‡è®°çš„å¸®åŠ©ä¿¡æ¯ã€‚
    
*   `requires`æŒ‡æ˜äº†è¯¥æ ‡è®°éœ€è¦ä¸`xx`å‚æ•°ä¸€èµ·ä½¿ç”¨ã€‚
    
*   ç±»å‹ä¸º`bool`ï¼Œè¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¸ƒå°”æ ‡å¿—ã€‚
    

3.  **ã€Œnameã€**:
    

*   ä»£è¡¨é¡¹ç›®åç§°çš„å‚æ•°ã€‚
    
*   `help`å±æ€§æä¾›äº†å¯¹æ­¤å‚æ•°çš„ç®€è¦è¯´æ˜ã€‚
    
*   `value_hint`å±æ€§æ˜¯`clap`æä¾›çš„ç‰¹æ€§ï¼Œè¿™é‡Œç”¨`ValueHint::DirPath`è¡¨ç¤ºè¯¥å‚æ•°åº”è¯¥æ˜¯ä¸€ä¸ªç›®å½•è·¯å¾„ã€‚
    

5.  **ã€Œui_designã€**:
    

*   ç”¨äºé…ç½® UI åº“ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©é¢„å®šä¹‰çš„`UIDesign`æšä¸¾ã€‚
    
*   ä½¿ç”¨`EnumValueParser`æ¥è§£ææšä¸¾ç±»å‹çš„å‚æ•°ã€‚
    
*   `ignore_case`å±æ€§è®¾ç½®ä¸º`true`è¡¨ç¤ºå¿½ç•¥å¤§å°å†™ã€‚
    

7.  `css_pre_processors/hook/state_management`å’Œ`ui_design`æ˜¯ç±»ä¼¼çš„é…ç½®ï¼Œè¿™é‡Œä¸åœ¨è¯´æ˜
    

`cli_mode`æˆ‘ä»¬éœ€è¦é¢å¤–ä»‹ç»ä¸€ä¸‹ã€‚

æˆ‘ä»¬`cli`æä¾›ä¸¤ç§æ„å»ºé¡¹ç›®çš„æ¨¡å¼

1.  äº¤äº’å¼ - åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ä¸Š / ä¸‹é€‰æ‹©é¢„ç½®çš„ç‰¹æ€§
    
2.  é»˜è®¤ - ä½ éœ€è¦åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œå°±éœ€è¦å°†éœ€è¦çš„ç‰¹æ€§æŒ‡å®š
    

æˆ‘ä»¬å¯ä»¥é€šè¿‡`f_cli create xx -c`æ¥å¼€å¯`é»˜è®¤æ¨¡å¼`![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjM6EMneUia8nnxtoEd5Y2qXqqWZLoIPt9laFTTI6WJgxsJ4mWWn1z6pQ/640?wx_fmt=png&from=appmsg)

* * *

4.5 ä¸šåŠ¡ä¸»é€»è¾‘
---------

è¿™é‡Œæœ‰ä¸¤ä¸ªå‡½æ•°ä»£ç 

1.  `fn main() -> Result<()>`
    
2.  `fn create_project(...) -> anyhow::Result<()>`
    

### fn main() -> Result<()>

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjmicqYPKaBhJYVtoKwQsQP4ncl5j5Z6un88OBlRicXW1ouiaEx5Rub8Zbw/640?wx_fmt=png&from=appmsg)

è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªä½¿ç”¨`clap`åº“è§£æå‘½ä»¤è¡Œå‚æ•°å¹¶æ ¹æ®è¿™äº›å‚æ•°æ‰§è¡Œç›¸åº”æ“ä½œçš„ Rust ç¨‹åºå…¥å£ï¼ˆ`main`å‡½æ•°ï¼‰ã€‚

ä¸Šé¢ä»£ç ä¸­å¯¹æ ¸å¿ƒæ­¥éª¤å·²ç»æœ‰äº†æ³¨é‡Šï¼Œç„¶åæˆ‘ä»¬å†å°†æˆ‘è®¤ä¸ºæ¯”è¾ƒæ ¸å¿ƒçš„ç‚¹ï¼Œå†ç®€å•ç½—åˆ—ä¸€ä¸‹ã€‚

*   **ã€Œè§£æå‘½ä»¤è¡Œå‚æ•°ã€**:
    
    ```
    letÂ cliÂ =Â Cli::parse();
    ```
    

*   è¿™é‡Œè°ƒç”¨`clap`è‡ªåŠ¨ç”Ÿæˆçš„`parse`æ–¹æ³•ï¼Œå°†å‘½ä»¤è¡Œå‚æ•°è§£æä¸º`Cli`ç»“æ„ä½“çš„å®ä¾‹ã€‚è¿™ä¸ªç»“æ„ä½“åŒ…å«äº†ç¨‹åºè¿è¡Œæ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ã€‚
    

*   **ã€Œæ£€æŸ¥é¡¹ç›®ç‰ˆæœ¬ã€**:
    
    ```
    project::check_cli_version()?;
    ```
    

*   åœ¨æ‰§è¡Œä»»ä½•æ“ä½œä¹‹å‰ï¼Œç¨‹åºé¦–å…ˆè°ƒç”¨`check_cli_version`å‡½æ•°æ¥ç¡®ä¿ç”¨æˆ·æ­£åœ¨ä½¿ç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ CLI å·¥å…·ã€‚
    

å…¶ä¸­ï¼Œæœ€ä¸»è¦çš„å°±æ˜¯åŸºäº`match cli.command`è¿›è¡Œåˆ¤æ–­ï¼Œç„¶åè°ƒç”¨`create_project()`

### fn create_project()

è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸º`create_project`çš„å‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ã€‚å®ƒæ¥å—å…³äºé¡¹ç›®çš„å¤šä¸ªé…ç½®å‚æ•°ï¼Œå¹¶åŸºäºè¿™äº›å‚æ•°æ‰§è¡Œé¡¹ç›®çš„åˆ›å»ºé€»è¾‘ã€‚![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjhOoSmGrCTehsTXIZFTAianWXsf2wXhUW93XQ7icZ9doghHxuGZNwlFCg/640?wx_fmt=png&from=appmsg)

> â
> 
> ç”±äºç¯‡å¹…æœ‰é™ï¼Œæˆ‘ä»¬å°†`ui/hook/state`çš„å¤„ç†é€»è¾‘ç»™æŠ˜å äº†ï¼Œè¿™å—çš„å¤„ç†é€»è¾‘å’Œ`css`æ˜¯ç±»ä¼¼çš„ã€‚
> 
> â

ä»å‡½æ•°ç­¾åä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¤§å¤šæ•°å‚æ•°éƒ½æ˜¯`Option`ç±»å‹ï¼Œè¡¨ç¤ºå®ƒä»¬æ˜¯å¯é€‰çš„ã€‚å¹¶ä¸”è¿”å›å€¼æ˜¯`anyhow::Result<()>`ï¼Œè¡¨ç¤ºå‡½æ•°æ‰§è¡Œå¯èƒ½ä¼šæœ‰é”™è¯¯ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡**ã€Œåˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ã€**, å¦‚æœé¡¹ç›®åç§°å¯¹åº”çš„ç›®å½•å·²ç»å­˜åœ¨ï¼Œåˆ™é€šè¿‡`logger::error`æ‰“å°é”™è¯¯æ¶ˆæ¯å¹¶è¿”å›ã€‚

ç„¶åå°±æ˜¯é€šè¿‡`match`è¡¨è¾¾å¼æ¥é€‰æ‹©å„ç§é…ç½®ä¿¡æ¯ã€‚(`UIåº“/CSSé¢„å¤„ç†å™¨/hookè§£å†³æ–¹æ¡ˆ/çŠ¶æ€è§£å†³æ–¹æ¡ˆ`) ç­‰ã€‚

æˆ‘ä»¬éšä¾¿æŒ‘ä¸€ä¸ªæ¥ç®€å•è§£é‡Šä¸€ä¸‹ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjEQGaFxgyAeXVH9MwTCTiaicUmbcdOPUseDYF4w7NKic0yXSwNuvhpSw7Q/640?wx_fmt=png&from=appmsg)

1.  **ã€ŒMatch è¡¨è¾¾å¼ã€**:
    

*   ä»£ç ä½¿ç”¨`match`è¡¨è¾¾å¼æ¥å¤„ç†`css_pre_processors`ã€‚è¿™æ˜¯`Rust`ä¸­çš„æ¨¡å¼åŒ¹é…ï¼Œç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„`switch-case`ã€‚
    

3.  **ã€ŒSome åˆ†æ”¯ã€**:
    

*   å¦‚æœ`css_pre_processors`æ˜¯`Some(css_pre_processors)`ï¼ˆå³å·²ç»æœ‰æŒ‡å®šçš„ CSS é¢„å¤„ç†å™¨ï¼‰ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨è¯¥å€¼ã€‚
    

5.  **ã€ŒNone åˆ†æ”¯ã€**:
    

*   å¦‚æœ`css_pre_processors`æ˜¯`None`ï¼ˆå³æ²¡æœ‰æŒ‡å®šçš„ CSS é¢„å¤„ç†å™¨ï¼‰ï¼Œåˆ™è¿›ä¸€æ­¥å¤„ç†ã€‚
    

7.  **ã€Œéäº¤äº’æ¨¡å¼ä¸‹çš„å¤„ç†ã€**:
    

*   å¦‚æœå¤„äº`cli_mode`ï¼ˆéäº¤äº’æ¨¡å¼ï¼‰ï¼Œåˆ™ç¨‹åºä¸èƒ½ç»§ç»­è¿›è¡Œï¼Œå› ä¸º CSS é¢„å¤„ç†å™¨æ˜¯å¿…é¡»çš„ã€‚æ­¤æ—¶ä¼šè§¦å‘`panic`ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢ç¨‹åºã€‚
    

9.  **ã€Œäº¤äº’æ¨¡å¼ä¸‹çš„å¤„ç†ã€**:
    

*   å¦‚æœä¸æ˜¯`cli_mode`ï¼ˆå³æ˜¯äº¤äº’æ¨¡å¼ï¼‰ï¼Œç¨‹åºä¼šæ˜¾ç¤ºäº¤äº’å¼èœå•è®©ç”¨æˆ·é€‰æ‹© CSS é¢„å¤„ç†å™¨ã€‚
    
*   ä½¿ç”¨`logger::multiselect_msg`å’Œ`logger::message`æ‰“å°æç¤ºä¿¡æ¯ã€‚
    
*   å®šä¹‰äº†ä¸€ä¸ªåŒ…å«`"scss"`, `"less"`, `"stylus"`çš„å‘é‡`items`ä½œä¸ºç”¨æˆ·çš„é€‰é¡¹ã€‚
    
*   ä½¿ç”¨`Select::with_theme(&ColorfulTheme::default()).items(&items).default(0).interact_on_opt(&Term::stderr())?;`åˆ›å»ºä¸€ä¸ªåŸºäº`dialoguer`çš„äº¤äº’å¼é€‰æ‹©èœå•ã€‚
    

11.  **ã€Œç”¨æˆ·é€‰æ‹©å¤„ç†ã€**:
    

*   ç”¨æˆ·çš„é€‰æ‹©è¢«è®°å½•åœ¨`selection`å˜é‡ä¸­ã€‚
    
*   ä½¿ç”¨å¦ä¸€ä¸ª`match`è¡¨è¾¾å¼æ¥å°†ç”¨æˆ·çš„é€‰æ‹©æ˜ å°„åˆ°å…·ä½“çš„`CSSPreProcessors`æšä¸¾å€¼ã€‚
    
*   æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„ç´¢å¼•ï¼ˆ0 å¯¹åº”`"scss"`, 1 å¯¹åº”`"less"`, 2 å¯¹åº”`"stylus"`ï¼‰ï¼Œå°†å…¶è½¬æ¢ä¸ºå¯¹åº”çš„æšä¸¾å€¼ï¼ˆ`CSSPreProcessors::Sass`, `CSSPreProcessors::Less`, `CSSPreProcessors::Stylus`ï¼‰ã€‚
    
*   å¦‚æœç”¨æˆ·é€‰æ‹©äº†ä¸åœ¨åˆ—è¡¨ä¸­çš„é€‰é¡¹ï¼Œåˆ™è§¦å‘ panicï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢ç¨‹åºã€‚
    

ä¸Šé¢ä»£ç æ˜¯ä¸€ä¸ªå…¸å‹çš„äº¤äº’å¼å‘½ä»¤è¡Œé€‰é¡¹å¤„ç†é€»è¾‘ã€‚å®ƒé¦–å…ˆæ£€æŸ¥æ˜¯å¦æœ‰é¢„å…ˆæŒ‡å®šçš„é€‰é¡¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ ¹æ®æ˜¯äº¤äº’æ¨¡å¼è¿˜æ˜¯éäº¤äº’æ¨¡å¼æ¥å†³å®šå¦‚ä½•è¿›ä¸€æ­¥è·å–ç”¨æˆ·çš„è¾“å…¥ã€‚åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼Œå®ƒä½¿ç”¨äº†`dialoguer`åº“æ¥åˆ›å»ºä¸€ä¸ªç®€æ´çš„ç”¨æˆ·ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·ä»é¢„å®šä¹‰çš„é€‰é¡¹ä¸­é€‰æ‹©ã€‚è¿™ç§æ–¹æ³•ä½¿å¾—å‘½ä»¤è¡Œå·¥å…·æ—¢èƒ½ä»¥éäº¤äº’æ–¹å¼è¿è¡Œï¼Œä¹Ÿèƒ½æä¾›å‹å¥½çš„äº¤äº’æ–¹å¼ã€‚

é’ˆå¯¹å…¶ä»–ç‰¹æ€§çš„å¤„ç†ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬è¿™é‡Œå°±ä¸è¿‡å¤šè§£é‡Šäº†ã€‚

æœ€åï¼Œè°ƒç”¨`project::create()`ï¼Œå°†`project_name`å’Œ`CreationOptions`ä¼ äººå…¶ä¸­ï¼Œåœ¨é‡Œé¢åšäº†çœŸæ­£çš„é¡¹ç›®è¿ç§»å’Œæ“ä½œã€‚

é’ˆå¯¹é‡Œé¢åˆ°åº•å‘ç”Ÿäº†å•¥ï¼Œæˆ‘ä»¬åœ¨ä¸‹èŠ‚ä¸­è¯¦ç»†è¯´æ˜ã€‚

* * *

5. content/*
============

ç”¨`erd -y inverted`æ¥æŸ¥çœ‹å¯¹åº”çš„ç›®å½•ä¿¡æ¯å¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjRLficiacLrXvfS7mGKTThselyw1nWP7JTensGdtlicqZc8miarpRTqicbwQ/640?wx_fmt=png&from=appmsg)

mod.rs
------

`mod.rs`ç­‰åŒäºæˆ‘ä»¬å‰ç«¯å¼€å‘ä¸­çš„æ¯ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„`index.js`ã€‚ç”¨äºå¼•å…¥å­æ¨¡å—ä¿¡æ¯

```
pubÂ modÂ project;pubÂ modÂ update_package_json;pubÂ modÂ add_customize_hook;pubÂ modÂ update_state_management;pubÂ modÂ add_redux_template;
```

project.rs
----------

> â
> 
> å¯ä»¥è¿™ä¹ˆè¯´ï¼Œ`project.rs`ç®—æ˜¯è¿™ä¸ª`Rust`çš„æ ¸å¿ƒæ–¹æ³•ï¼Œä»–é€šè¿‡è°ƒç”¨å¾ˆå¤šå·¥å…·æ–¹æ³•å’Œç¬¬ä¸‰æ–¹åº“ï¼Œå®ç°äº†æˆ‘ä»¬æœ€åçœŸæ­£çš„å‰ç«¯é¡¹ç›®ã€‚
> 
> â

è¿˜æ˜¯ç†Ÿæ‚‰çš„å‘³é“ï¼Œä½¿ç”¨`Ctrl+K+0`æŠ˜å æ‰€æœ‰çš„ä»£ç å—ï¼Œç„¶åæŒ‰ç…§åŠŸèƒ½åˆ†ä¸ºå››éƒ¨åˆ†

1.  æœ¬åœ°æ–¹æ³•å’Œç¬¬ä¸‰æ–¹åº“çš„å¼•å…¥
    
2.  ä½¿ç”¨äº†`RustEmbed`åº“æ¥åµŒå…¥æ–‡ä»¶å¤¹ä¸­çš„é™æ€æ–‡ä»¶åˆ°äºŒè¿›åˆ¶ä¸­
    
3.  å®šä¹‰æ•°æ®ç»“æ„
    
4.  æ ¸å¿ƒå‡½æ•°`create()`
    

> â
> 
> çœ¼å°–çš„åŒå­¦ï¼Œå¯èƒ½ä¼šè¯´é‚£ä¸æ˜¯è¿˜æœ‰ä¸€ä¸ª`check_cli_version()`å—ï¼Œè¿™ä¸ªå‡½æ•°åœ¨`main.rs`ä¸­å°±è°ƒç”¨è¿‡ï¼Œä¸åœ¨`project.create()`ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä¸åšè¿‡å¤šçš„è§£é‡Šã€‚
> 
> â

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjHS1ZjEPb7OpywiaianX8mmBib01ZQSictldA3akcd1NP10p1BFHSZQZibOw/640?wx_fmt=png&from=appmsg)

### åº“çš„å¼•å…¥

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjiaHE5M8g3yic3vwD6dricPCWg4wfYlVbBNlrAbYNfiaW5xu5IZBGiaDVOoA/640?wx_fmt=png&from=appmsg)ç®€å•çš„æ‚ä¸Šä¸€ğŸ‘€ï¼Œé‡Œé¢ä¸ä»…è°ƒç”¨äº†`utils`ä¸­çš„å„ç§å·¥å…·æ–¹æ³•ï¼Œè¿˜æœ‰åœ¨`main.rs`å®šä¹‰çš„å„ç§å˜é‡`UIDesign/Hook`ç­‰ï¼Œè¿˜æœ‰å’Œ`project.rs`åŒç›®å½•çš„æ¨¡å—ç”¨äºå¯¹ç‰¹å®šçš„ä¿¡æ¯è¿›è¡Œæ›´æ–°å’Œæ’å…¥ (`update_project_basic_info`/`update_state_management_by_choose`)ã€‚

### Struct Asset

```
#[derive(RustEmbed)]#[folderÂ =Â "template-react"]structÂ Asset;
```

> â
> 
> è¿™æ®µä»£ç é€šè¿‡å£°æ˜ä¸€ä¸ª`Asset`ç»“æ„ä½“å¹¶åº”ç”¨ RustEmbed[7] å®ï¼ŒæŒ‡ç¤º Rust ç¼–è¯‘æ—¶å°†`template-react`ç›®å½•ä¸‹çš„æ–‡ä»¶åµŒå…¥åº”ç”¨ç¨‹åºå†…ï¼Œä½¿å¾—è¿™äº›æ–‡ä»¶éšåº”ç”¨ç¨‹åºä¸€èµ·ç¼–è¯‘å¹¶å¯ä»¥åœ¨è¿è¡Œæ—¶è®¿é—®ã€‚
> 
> â

è™½ç„¶ï¼Œåªæœ‰ 3 è¡Œï¼Œä½†æ˜¯è¿™å·®ä¸å¤šæ˜¯æ¯”è¾ƒæ ¸å¿ƒçš„æ­¥éª¤ã€‚

1.  **ã€Œ#[derive(RustEmbed)]ã€**:
    

*   è¿™æ˜¯ä¸€ä¸ªå±æ€§å®ï¼Œå®ƒæŒ‡ç¤ºç¼–è¯‘å™¨ä¸º`Asset`ç»“æ„ä½“è‡ªåŠ¨å®ç°`RustEmbed` traitã€‚`RustEmbed` trait ä½¿å¾—æˆ‘ä»¬å¯ä»¥è®¿é—®åœ¨ç¼–è¯‘æ—¶åµŒå…¥åˆ° Rust ç¨‹åºä¸­çš„æ–‡ä»¶ã€‚
    
*   ä½¿ç”¨`RustEmbed`é€šå¸¸æ˜¯ä¸ºäº†å°†æ–‡ä»¶ï¼ˆå¦‚ HTML, CSS, JavaScript, images ç­‰ï¼‰æ‰“åŒ…åˆ°ç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿è¿™äº›æ–‡ä»¶å¯ä»¥éšç¨‹åºä¸€èµ·åˆ†å‘ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶æ— éœ€å¤–éƒ¨ä¾èµ–ã€‚
    

3.  **ã€Œ#[folder = "template-react"]ã€**:
    

*   è¿™æ˜¯`RustEmbed`ç‰¹å®šçš„å±æ€§ï¼Œç”¨äºæŒ‡å®šè¦åµŒå…¥çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚å¦‚ä¸Šå›¾ä¸­æ‰€ç¤ºï¼Œå®ƒå‘Šè¯‰`RustEmbed`å°†`template-react`æ–‡ä»¶å¤¹ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•æˆ– Cargo.toml æ–‡ä»¶çš„ä½ç½®ï¼‰ä¸­çš„æ‰€æœ‰å†…å®¹åµŒå…¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚
    
*   è¿™æ„å‘³ç€`template-react`æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«åŒ…å«åˆ°ç¼–è¯‘åçš„ç¨‹åºä¸­ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶é€šè¿‡`Asset`ç»“æ„ä½“è®¿é—®ã€‚
    

5.  **ã€Œstruct Assetã€**:
    

*   è¿™å®šä¹‰äº†ä¸€ä¸ªåä¸º`Asset`çš„ç»“æ„ä½“ã€‚ç»“æ„ä½“æœ¬èº«æ²¡æœ‰å®šä¹‰ä»»ä½•å­—æ®µï¼Œå› ä¸º`RustEmbed` trait ä¸ºå…¶æä¾›äº†æ‰€éœ€çš„æ‰€æœ‰åŠŸèƒ½ã€‚
    

> â
> 
> é€šå¸¸ï¼Œå½“æˆ‘ä»¬æƒ³å°†æŸäº›é™æ€èµ„æºï¼ˆå¦‚é…ç½®æ–‡ä»¶ã€HTML æ¨¡æ¿ã€JS è„šæœ¬ã€CSS æ ·å¼ç­‰ï¼‰ç›´æ¥åµŒå…¥åˆ° Rust åº”ç”¨ç¨‹åºä¸­ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ä½œä¸ºå•ä¸ªç‹¬ç«‹çš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ†å‘æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨`RustEmbed`ã€‚
> 
> â

### å®šä¹‰æ•°æ®ç»“æ„

```
pubÂ enumÂ DependenciesModÂ {Â Â Â Â Dev,Â Â Â Â Prod}pubÂ structÂ CreationOptionsÂ {Â Â Â Â pubÂ state:StateManagement,Â Â Â Â pubÂ _hook:Â Hook,Â Â Â Â pubÂ css:Â CSSPreProcessors,Â Â Â Â pubÂ ui:UIDesign,Â Â Â Â pubÂ cli_mode:Â bool,}
```

å®šä¹‰äº†ä¸€ä¸ª`enum DependenciesMod`, è¯¥æšä¸¾æ˜¯ç”¨äºåœ¨å®‰è£…å‰ç«¯ä¾èµ–æ—¶å€™ï¼ŒåŒºåˆ†è¯¥åŒ…æ˜¯å±äº`dependencies`è¿˜æ˜¯`devDependencies`

è€Œç»“æ„ä½“`CreationOptions`ç”¨äºæ”¶é›†åœ¨`create`é¡¹ç›®æ—¶å€™ï¼Œé€šè¿‡`cli`æŒ‡å®šçš„å‚æ•°ã€‚

ä¹Ÿå°±æ˜¯åœ¨`main.rs`è°ƒç”¨`project.create()`ä¼ äººçš„`CreationOptions`ã€‚è¿™ä¸ªæˆ‘ä»¬åœ¨å°†`main.rs`æ—¶è§£é‡Šè¿‡ã€‚

```
project::create(
Â Â Â Â project_name.as_ref(),
Â Â Â Â CreationOptionsÂ {
Â Â Â Â Â Â Â Â state,
Â Â Â Â Â Â Â Â _hook,
Â Â Â Â Â Â Â Â css,
Â Â Â Â Â Â Â Â ui,
Â Â Â Â Â Â Â Â cli_mode,
Â Â Â Â }
)?;
```

### æ ¸å¿ƒå‡½æ•°`create()`

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjpxiaW5aaDL7pPqhBAvMvHgYkMmIah9oT13Qtxlp8gqejNE9PliawnrJg/640?wx_fmt=png&from=appmsg)

è¿™ä¸ªæ–¹æ³•æŒ‰åŠŸèƒ½åˆ’åˆ†ä¸€å…±åˆ†ä¸º 5 éƒ¨åˆ†ã€‚

1.  åˆå§‹åŒ–é¡¹ç›®ç›®å½•è·¯å¾„`project_dir`
    
2.  éå†`Asset`å†…éƒ¨æ–‡ä»¶ï¼Œå¹¶å†™å…¥åˆ°`project_dir`ä¸­
    
3.  ä¿®æ”¹ package.json çš„åŸºç¡€ä¿¡æ¯
    
4.  ä¾æ®`cli`çš„å‚æ•°ï¼Œæ›´æ–°`react`é¡¹ç›®
    
5.  åˆå§‹åŒ–`git`
    

> â
> 
> ç”±äºç¯‡å¹…æœ‰é™ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰“ç®—è¯¦ç»†ä»‹ç»ä¸€ä¸‹`create()`ä¸­çš„ç»†èŠ‚ï¼Œå¹¶ä¸”ä¼šå°†`content/utils`ä¸­çš„æ–¹æ³•ï¼Œç›´æ¥æ‹å‡ºæ¥ä»‹ç»ï¼Œä¸ä¼šæŒ‰ç…§æ–‡æ¡£ç›®å½•æ¥å¤„ç†äº†ã€‚
> 
> â

* * *

6. æ ¸å¿ƒå‡½æ•°`create`
===============

6.1 åˆå§‹åŒ–é¡¹ç›®ç›®å½•è·¯å¾„`project_dir`
--------------------------

```
letÂ project_dir:Â PathBufÂ =Â PathBuf::from(project_name);logger::command_tip("åˆ›å»ºé¡¹ç›®ç›®å½•...");matchÂ std::fs::create_dir_all(&project_dir)Â {Â Â Â Â Ok(_)Â =>Â {}Â Â Â Â Err(err)Â =>Â logger::exit_error("std::fs::create_dir_all():",Â err),}
```

1.  åˆå§‹åŒ–é¡¹ç›®ç›®å½•è·¯å¾„:
    

*   ä½¿ç”¨`PathBuf::from`æ¥å°†é¡¹ç›®åç§°è½¬æ¢ä¸ºè·¯å¾„ç¼“å†²åŒºï¼ˆ`PathBuf`ï¼‰ï¼Œè¿™å°†ä½œä¸ºé¡¹ç›®ç›®å½•çš„è·¯å¾„ã€‚
    

3.  åˆ›å»ºé¡¹ç›®ç›®å½•:
    

*   è°ƒç”¨`std::fs::create_dir_all`å°è¯•åˆ›å»ºé¡¹ç›®ç›®å½•ã€‚è¿™ä¸ªå‡½æ•°ä¼šåˆ›å»ºæ‰€æœ‰ç¼ºå¤±çš„çˆ¶ç›®å½•ï¼Œç¡®ä¿æ•´ä¸ªè·¯å¾„éƒ½è¢«æ­£ç¡®åˆ›å»ºã€‚
    
*   ä½¿ç”¨`match`è¡¨è¾¾å¼æ¥å¤„ç†å¯èƒ½çš„é”™è¯¯ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™ç»§ç»­ï¼›å¦‚æœå‡ºç°é”™è¯¯ï¼Œåˆ™æ‰“å°é”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºã€‚
    

6.2 éå†`Asset`å†…éƒ¨æ–‡ä»¶ï¼Œå¹¶å†™å…¥åˆ°`project_dir`ä¸­
------------------------------------

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjUqfVRibws3ewBD3jhichqXlrVVvibfdrEE74KEjn5sYgwehiba3RpdwW9A/640?wx_fmt=png&from=appmsg)

1.  æ–‡ä»¶å¤åˆ¶:
    

*   ä½¿ç”¨`Asset::iter()`æ¥éå†`Asset`ç»“æ„ä½“ï¼ˆç”±`RustEmbed`ç”Ÿæˆï¼‰ä¸­æ‰€æœ‰çš„æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶æ˜¯åœ¨ç¼–è¯‘æ—¶åµŒå…¥åˆ°äºŒè¿›åˆ¶ä¸­çš„ã€‚
    
*   å¯¹äºæ¯ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨`Asset::get`æ¥è·å–å…¶å†…å®¹ï¼ˆä»¥`Cow<'static, [u8]>`å½¢å¼ï¼‰ã€‚
    

3.  æ–‡ä»¶å†™å…¥:
    

*   ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è·¯å¾„`file_path`ï¼Œå®ƒæ˜¯é¡¹ç›®ç›®å½•è·¯å¾„å’Œæ–‡ä»¶åçš„ç»„åˆã€‚
    
*   åˆ›å»ºæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼ˆå¦‚æœå°šä¸å­˜åœ¨ï¼‰ã€‚è¿™æ˜¯é€šè¿‡å–æ–‡ä»¶è·¯å¾„çš„`directory_path`å¹¶è°ƒç”¨`pop`æ¥ç§»é™¤æ–‡ä»¶åéƒ¨åˆ†å®ç°çš„ã€‚
    
*   ä½¿ç”¨`std::fs::write`å°†æ–‡ä»¶å†…å®¹å†™å…¥åˆ°ç›®æ ‡è·¯å¾„ã€‚å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œå®ƒå°†è¢«è¦†ç›–ã€‚
    

6.3 ä¿®æ”¹ package.json çš„åŸºç¡€ä¿¡æ¯
-------------------------

```
update_project_basic_info(&project_dir,project_name.to_owned())?;
```

è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥åŸºäº`cli`ä¸­çš„ä¿¡æ¯æ¥æ›´æ–°`React`é¡¹ç›®ä¸­çš„`package.json`çš„ä¿¡æ¯çš„ã€‚

å®ƒä½äºå’Œ`project.rs`åŒçº§ç›®å½•çš„`update_package_json.rs`æ–‡ä»¶ä¸­ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzj66odSYtiayGTXuKmjyANdK9UbHsj3WxW4icMROf0HBc2ag26WwH1fWVQ/640?wx_fmt=png&from=appmsg)

å…¶å®`update_project_basic_info`ä¸­ä¹Ÿæ²¡å•¥é­”æ³•ï¼ŒåŸºæœ¬çš„æ€è·¯éƒ½æ˜¯æ ¹æ®è·¯å¾„åç§°æ‰¾åˆ°è·¯å¾„ï¼Œå¹¶ä¸”ç„¶åä¿®æ”¹æ–‡ä»¶ä¿¡æ¯ã€‚

ä½†æ˜¯å‘¢ï¼Œè¿™é‡Œå’Œå…¶ä»–çš„è¿˜æœ‰ä¸€ç‚¹ä¸ä¸€æ ·çš„åœ°æ–¹å°±æ˜¯ï¼Œè¿™æ˜¯è¦ä¿®æ”¹`json`æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© serde_json[8] å°†`json`æ–‡ä»¶è§£ææˆç±»ä¼¼`Object/Map`çš„æ•°æ®ç±»å‹ï¼Œç„¶åé€šè¿‡`xx.get_mut/insert`ç­‰æ–¹å¼ä¿®æ”¹æŒ‡å®šçš„å±æ€§ä¿¡æ¯ã€‚

æˆ‘ä»¬è¿™é‡Œåªä¿®æ”¹äº†ä¸¤ä¸ªåœ°æ–¹

1.  åŸºäº`cli`å‚æ•°ä¸­çš„é¡¹ç›®åç§° - æ¥ä¿®æ­£`package.json`çš„`name`ä¿¡æ¯
    
2.  ä¿®æ”¹ç‰ˆæœ¬ä¿¡æ¯ã€‚
    

æœ€åæˆ‘ä»¬è°ƒç”¨`serde_json::to_string_pretty(&parsed_json)`å°†åˆšæ‰ä¿®æ”¹åçš„`json`è½¬æ¢æˆ`String`ç±»å‹ï¼Œå¹¶è°ƒç”¨`fs::wirte()`, å†™å…¥åˆ°é¡¹ç›®ä¸­ã€‚

6.4 ä¾æ®`cli`çš„å‚æ•°ï¼Œæ›´æ–°`react`é¡¹ç›®
--------------------------

æ¥ä¸‹æ¥å°±æ˜¯å¤„ç†æˆ‘ä»¬åœ¨`cli`ä¸­é€‰ä¸­çš„å„ç§ç‰¹æ€§äº†ï¼ˆ`css/ui/hook/state`ï¼‰

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjBvSnXvdwW9gRsNRPicQUSSHmsy5wHvPol7Nh7StX7ibrxjibRicc4sfp0w/640?wx_fmt=png&from=appmsg)

çœ‹ä¸Šé¢æˆªå›¾ï¼Œå…¶å®åˆ†ä¿©ä¸ªæ“ä½œ

1.  æ ¹æ®`creation_options.xx`ç›´æ¥è°ƒç”¨`add_dependency_to_package_json()`
    
2.  å¯èƒ½æœ‰äº›æ“ä½œï¼Œè¿˜éœ€è¦é¢å¤–çš„æ¨¡ç‰ˆæ–‡ä»¶ï¼Œç„¶åå°±æ˜¯å°†èµ·å¤åˆ¶åˆ°é¡¹ç›®ä¸­ï¼ˆ`copy_hook_to_project`ï¼‰
    

æˆ‘ä»¬è¿˜æ˜¯ç®€å•æ¥çœ‹çœ‹ç›¸å…³çš„é€»è¾‘å¤„ç†ã€‚

### add_dependency_to_package_json

è¿™ä¸ªå‡½æ•°å’Œä¸Šé¢çš„`update_project_basic_info`ä½äºåŒä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ï¼ˆ`content/update_package_json.rs`ï¼‰

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjMB1VhWQc74HuuCpS7zRJOdggcmFwJVSdLlUyjbbmvhpXnB3T6JJ3ibg/640?wx_fmt=png&from=appmsg)

çœ‹å‡½æ•°ç­¾åï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶å››ä¸ªå˜é‡

1.  project_dir:&std::path::PathBuf,
    
2.  dependency_name:&str,
    
3.  dependency_version:&str,
    
4.  mode:DependenciesMod
    

å…¶å®ï¼Œå®ƒçš„å¤„ç†é€»è¾‘å’Œ`update_project_basic_info`å¾ˆç±»ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡`project_dir`æ‰¾åˆ°`package.json`, ç„¶ååˆ©ç”¨`serde_json`å¤„ç†ã€‚

å¯èƒ½å”¯ä¸€ä¸åŒçš„å°±æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®`mode`çš„ç±»å‹ï¼Œæ¥å†³å®šä¿®æ”¹`package.json`ä¸­çš„`devDependencies`è¿˜æ˜¯`dependencies`ã€‚

è¿™ä¸ªæ—¶å€™ï¼Œå°±ç”¨åˆ°æˆ‘ä»¬ä¹‹å‰è¯´è¿‡çš„`DependenciesMod`æšä¸¾äº†ã€‚

æ¯•ç«Ÿï¼Œæˆ‘ä»¬åœ¨å¼€å‘æ—¶å€™ï¼Œæœ‰äº›åº“åªéœ€è¦åœ¨å¼€å‘æ¨¡å¼ä¸Šèµ·ä½œç”¨ï¼Œç„¶ååœ¨ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œå®ƒå°±ä¸éœ€è¦äº†ã€‚

### copy_xx_to_project

å› ä¸ºï¼Œè¿™ä¸ªç‰ˆæœ¬åªåšäº†é’ˆå¯¹`hook`çš„æ–‡ä»¶å¤åˆ¶ï¼Œå…¶å®å¦‚æœåæœŸè¿˜æœ‰å…¶ä»–çš„æ“ä½œçš„è¯ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥æ–°å¢ä¸€ç±»ï¼Œé’ˆå¯¹`xx`çš„å¤åˆ¶æ“ä½œã€‚

`copy_xx_to_project()`å‡½æ•°ä½äº`add_customize_hook.rs`ä¸­ï¼Œè§åçŸ¥æ„ï¼Œå®ƒå°±æ˜¯ä¸ºäº†å°†æˆ‘ä»¬è‡ªå®šä¹‰çš„`hook`æ–‡ä»¶æ·»åŠ åˆ°é¡¹ç›®ä¸­çš„ã€‚

è€Œè¿™ä¸ª`hook`æˆ‘ä»¬ä¸ä¼šé™Œç”Ÿï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¹‹å‰ä»‹ç»è¿‡çš„[ç¾ä¸½çš„å…¬ä¸»å’Œå®ƒçš„ 27 ä¸ª React è‡ªå®šä¹‰ Hook](https://mp.weixin.qq.com/s?__biz=Mzg3NjU2OTE1Mw==&mid=2247490072&idx=1&sn=e2398b4567c624fa1b0317c8cd6d222b&scene=21#wechat_redirect)ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjCfJfg0viaoTNqPFRSdRZib6mgqAib863GiawJNGV5H0mG8ibgWcJiaUdvbfA/640?wx_fmt=png&from=appmsg)

å…¶å®å®ƒçš„å†…éƒ¨é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œåˆ©ç”¨`RustEmbed`æŒ‡å‘`template-customize-hook`, ç„¶åéå†å…¶ä¸­çš„æ–‡ä»¶ï¼Œç„¶åå¤åˆ¶åˆ°é¡¹ç›®ä¸­ã€‚

ä½†æ˜¯å‘¢ï¼Œå’Œä¹‹å‰åˆ©ç”¨`RustEmbed`å¤„ç†`template-react`è¿˜ä¸ä¸€æ ·ï¼Œæ­¤æ¬¡æ“ä½œæ˜¯ï¼Œå°†`template-customize-hook`ä¸­çš„æ–‡ä»¶ï¼Œå¤åˆ¶åˆ°æœ€ç»ˆé¡¹ç›®ä¸­çš„`src/hook`ä¸‹é¢ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°`src`, å¹¶ä¸”æ–°å»ºä¸€ä¸ª`hook`æ–‡ä»¶å¤¹ï¼Œç„¶åæ‰§è¡Œå¤åˆ¶æ“ä½œå³å¯ã€‚

```
letÂ hook_pathÂ =Â project_dir.join("src").join("hook");std::fs::create_dir_all(&hook_path)?;
```

6.5 åˆå§‹åŒ–`git`
------------

å’Œå…¶ä»–çš„`cli`ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨æ–°å»ºå®Œé¡¹ç›®åï¼Œæˆ‘ä»¬è¿˜ä¼šè°ƒç”¨`git init`å¯¹é¡¹ç›®è¿›è¡Œ`git`åˆå§‹åŒ–æ“ä½œï¼Œå¹¶ä¸”é…ç½®ç›¸å…³çš„å±æ€§ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjiaLONLa4Z6j97mdVq3190LXcic9bGiaTUwQjOE0RWNgVJtj5KNQgjTCaw/640?wx_fmt=png&from=appmsg)

çœ‹èµ·æ¥æœ‰å¾ˆå¤šå‘½ä»¤æ“ä½œï¼Œä½†æ˜¯å®ƒä»¬çš„å¤„ç†é€»è¾‘éƒ½å¤§å·®ä¸å·®ã€‚

æˆ‘ä»¬å°±æˆ‘ä»¬å°±æŒ‘å…¶ä¸­ä¸€ä¸ªåšä¸€ä¸ªç®€å•è§£é‡Šã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzj0KGg1Nk2NkAt2JQTibOalXJZvyNg3Zhy6ClPFQ2FV8eTrHODoic6udqw/640?wx_fmt=png&from=appmsg)

1.  **ã€Œæ„å»ºå‘½ä»¤ã€**:
    

*   ä½¿ç”¨`std::process::Command::new("git")`åˆ›å»ºä¸€ä¸ªæ–°çš„å‘½ä»¤ï¼ŒæŒ‡å®šæ‰§è¡Œçš„æ˜¯`git`ã€‚
    
*   `.current_dir(&project_dir)`è®¾ç½®å‘½ä»¤çš„å½“å‰å·¥ä½œç›®å½•ä¸º`project_dir`ï¼Œè¿™æ ·å‘½ä»¤å°±ä¼šåœ¨æ­£ç¡®çš„é¡¹ç›®ç›®å½•å†…æ‰§è¡Œã€‚
    
*   `.arg("add")`å’Œ`.arg("-A")`æ·»åŠ å‚æ•°åˆ°å‘½ä»¤ä¸­ï¼Œè¿™äº›å‚æ•°è®© git å°†æ‰€æœ‰å˜æ›´æ·»åŠ åˆ°æš‚å­˜åŒºã€‚
    
*   `.stdout(std::process::Stdio::null())`å°†æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ° nullï¼Œå³ä¸åœ¨æ§åˆ¶å°æ˜¾ç¤ºå‘½ä»¤çš„è¾“å‡ºã€‚
    

3.  **ã€Œæ‰§è¡Œå‘½ä»¤ã€**:
    

*   ä½¿ç”¨`.status()`æ‰§è¡Œå‘½ä»¤å¹¶è·å–å…¶é€€å‡ºçŠ¶æ€ã€‚è¿™ä¸ªå‡½æ•°ä¼šç­‰å¾…å‘½ä»¤å®Œæˆå¹¶è¿”å›ä¸€ä¸ªåŒ…å«çŠ¶æ€ä¿¡æ¯çš„`Result`ç±»å‹ã€‚
    
*   `.expect("failed to execute process")`å¤„ç†`Result`ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼ˆä¾‹å¦‚å› ä¸º`git`ä¸åœ¨ç³»ç»Ÿè·¯å¾„ä¸­ï¼‰ï¼Œç¨‹åºä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ panicã€‚
    

5.  **ã€Œæ£€æŸ¥å‘½ä»¤æ‰§è¡Œç»“æœã€**:
    

*   `if !git_add.success()`æ£€æŸ¥`git`å‘½ä»¤æ˜¯å¦æˆåŠŸæ‰§è¡Œã€‚`success()`æ–¹æ³•è¿”å›`true`å¦‚æœå‘½ä»¤çš„é€€å‡ºçŠ¶æ€æ˜¯ 0ï¼Œå¦åˆ™è¿”å›`false`ã€‚
    
*   å¦‚æœå‘½ä»¤æœªæˆåŠŸæ‰§è¡Œï¼Œåˆ™ä½¿ç”¨`logger::error("æ‰§è¡Œ`git add -A`å¤±è´¥")`æ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨`std::process::exit(1)`é€€å‡ºç¨‹åºã€‚è¿™é‡Œçš„ 1 æ˜¯é€€å‡ºç ï¼Œé€šå¸¸è¡¨ç¤ºç¨‹åºå¼‚å¸¸ç»ˆæ­¢ã€‚
    

* * *

æœ€åï¼Œå½“æˆ‘ä»¬æ‰§è¡Œåˆ°`Ok(())`æ—¶ï¼Œè¯´æ˜æˆ‘ä»¬å·²ç»é¡ºåˆ©å®Œæˆäº†ä¸Šé¢åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ„å»ºå®Œæˆäº†å‰ç«¯é¡¹ç›®ã€‚

ç„¶åå°±ä¼šå‡ºç°ä¸‹å›¾ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjTmkuiahE0JTHGKAb3ueftqsY7JhpjWic4pmGrHuNm0n2T9OgyJoF8GZw/640?wx_fmt=png&from=appmsg)

> â
> 
> è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œæœ¬æ¥å‘¢ï¼Œæˆ‘ä»¬æƒ³é€šè¿‡`Rust`é…ç½®`husky/oxlint`ç›¸å…³çš„é…ç½®ï¼Œä½†æ˜¯åœ¨æ“ä½œçš„æ—¶å€™ï¼Œä¼šæœ‰è«åçš„é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¿™æ­¥æ“ä½œæƒé™ï¼Œæ”¾åˆ°æ“ä½œè€…æ‰‹é‡Œã€‚
> 
> â

çœ‹åˆ°ä¸Šé¢å†…å®¹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡`cli`çš„æç¤ºï¼Œæ¥å‘Šè¯‰å¤§å®¶éœ€è¦æ‰§è¡Œå“ªäº›æ­¥éª¤ã€‚è€Œè¿™ä¸€æ­¥çš„æ“ä½œæ˜¯åœ¨`main.rs`ä¸­`create_project()`ä¸­æ‰§è¡Œå®Œ`project.create()`å æ‰§è¡Œ`logger::project_created_msg(project_name);`è¾“å‡ºçš„å†…å®¹ã€‚

è¿™äº›ä¿¡æ¯å…¶å®å°±æ˜¯ä¸€ä¸ª`logger`ä¿¡æ¯çš„å±•ç¤ºã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹`logger.rs`éƒ¨åˆ†ã€‚

* * *

7. utils/logger.rs
==================

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjZ4D25ssk1JvpaY62dI4jwYsHnV1YK9JNVhJv7beusuFdUibvwo1rT3Q/640?wx_fmt=png&from=appmsg)

çœ‹ä¸Šé¢æˆ‘ä»¬å®šä¹‰äº†å¾ˆå¤šå…³äº`logger`çš„æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯å¯¹ console[9] çš„å°è£…ã€‚

ç„¶åï¼Œæˆ‘ä»¬å°±æŒ‘ä¸€ä¸ªæ¥ç®€å•è®²è®²ã€‚

```
pubÂ fnÂ message(msg:Â &str)Â {Â Â Â Â println!("[{}]Â {}",Â style("f_cli").blue(),Â msg)}
```

*   **ã€Œå‡½æ•°å®šä¹‰ã€**:
    
    ```
    pubÂ fnÂ message(msg:Â &str)Â {Â Â Â Â println!("[{}]Â {}",Â style("f_cli").blue(),Â msg)}
    ```
    

*   `message`å‡½æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡`msg`ä½œä¸ºå‚æ•°ï¼Œä»£è¡¨è¦æ‰“å°çš„æ¶ˆæ¯ã€‚
    
*   å‡½æ•°ä½“å†…ï¼Œå®ƒä½¿ç”¨`println!`å®æ¥è¾“å‡ºæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ã€‚æ¶ˆæ¯çš„æ ¼å¼ä¸º`[f_cli] msg`ï¼Œå…¶ä¸­`f_cli`æ˜¯è“è‰²çš„ï¼Œç”±`style("f_cli").blue()`è®¾ç½®ã€‚
    

ä¹‹å‰ï¼Œæˆ‘ä»¬åœ¨æœ€åè¾“å‡ºä¸€å †æ–‡æ¡ˆä¿¡æ¯å°±æ˜¯ä¸‹é¢æ–¹æ³•æ‰§è¡Œçš„ã€‚é‡Œé¢ä¹Ÿæ²¡å•¥é­”æ³•å°±æ˜¯è°ƒç”¨äº†`message`è¾“å‡ºæˆ‘ä»¬æƒ³è¦å±•ç¤ºçš„ä¿¡æ¯ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjhBOE9e16ElWJFgG1o2VUbe4q4K6k5KWCKtwc6S1Aa2uQDe6YfDqZJw/640?wx_fmt=png&from=appmsg)

* * *

8. å…¶ä»–å‡½æ•°
=======

ä¸Šé¢è®²äº†ä¸€å †æ–¹æ³•ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯æ–‡ä»¶çš„å¤åˆ¶ (`project.rs`å¤åˆ¶`template-react`) æˆ–è€…å¯¹ç‰¹æ®Šæ–‡ä»¶è¿›è¡Œä¿®æ”¹ (ä¿®æ”¹`package.json`çš„ä¿¡æ¯)ã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åšåˆ°ï¼Œåœ¨å·²ç»å­˜åœ¨çš„æ–‡ä»¶ä¸­ï¼Œè¿½åŠ æˆ–è€…ä¿®æ”¹å†…å®¹ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥è®²ä¸€ä¸‹åœ¨æˆ‘ä»¬é€‰æ‹©`state`çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©äº†ç‰¹å®šçš„åº“ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯ä¸ä»…éœ€è¦é…ç½®`package.json`, æˆ‘ä»¬è¿˜éœ€è¦åœ¨ç»„ä»¶çš„æ ¹æ–‡ä»¶ä¸­é…ç½®ç›¸å…³çš„ä¿¡æ¯ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjFpJNfRyehYymWz4TzDbGcK4qV27HqFz5ibP2wycl7khP4m85Ia0Bz5w/640?wx_fmt=png&from=appmsg)

ä¸Šé¢çš„æ–‡ä»¶ç›®å½•æ˜¯æˆ‘ä»¬é€šè¿‡`vite create`æ„å»ºçš„ä¸€ä¸ªæœ€åŸºæœ¬çš„é¡¹ç›®ã€‚ç„¶åï¼Œåœ¨`src/main.tsx`ä¸­å°±æ˜¯æˆ‘ä»¬çš„é¡¹ç›®ä¸»å…¥å£æ–‡ä»¶ã€‚

> â
> 
> å¿½ç•¥åˆ°è­¦å‘Šå’ŒæŠ¥é”™ï¼Œå› ä¸ºæˆ‘`vscode`é…ç½®äº†å…¨å±€çš„`ts`ï¼Œæ‰€ä»¥ä¼šæç¤ºé”™è¯¯ã€‚ï¼ˆç›¸ä¿¡æˆ‘ï¼Œè¿™ä¸æ˜¯é”™è¯¯ï¼‰
> 
> â

åœ¨é€šè¿‡`cli`åˆ›å»ºé¡¹ç›®æ—¶ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹© 3 å¤§ç±» (6 ç§) çŠ¶æ€ç®¡ç†åº“ã€‚å¦‚ä¸‹å›¾ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjlYiceu1pR5AodhjsfBSR0SEoJhJNbPRaEW40HVKfUFotibibWoxdPKRpw/640?wx_fmt=png&from=appmsg)

ç”¨è¿‡`Redux/Recoil`çš„åŒå­¦éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦åœ¨`package.json`ä¸­é…ç½®ä¾èµ–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†`xxProvider`é…ç½®åˆ°é¡µé¢ä¸­ã€‚

é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±éœ€è¦æ–¹æ³•æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚

ä¸‹é¢ä¸­çš„`update_state_management_by_choose`çš„æ–¹æ³•å°±æ˜¯å¤„ç†è¿™ç§æƒ…å†µçš„ã€‚è¯¥æ–¹æ³•ä½äº`content/update_state_management.rs`ä¸­ã€‚![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjpyprFndUic1J0e1Wr7JeMpialJJU9LnWGu9Us7iaT0LUjRVaNRHegDlag/640?wx_fmt=png&from=appmsg)

å…¶å®ä¸Šé¢çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•å°±æ˜¯ï¼ŒåŸºäº`state`çš„å€¼åšå¤„ç†ï¼Œä»ä¸Šé¢çœ‹åˆ°æˆ‘ä»¬åªå¤„ç†äº†`redux/recoil`ã€‚ ç„¶åå”¤èµ·å¯¹åº”çš„`insert_xx_root()`å°†æŒ‡å®šçš„ä¿¡æ¯æ’å…¥åˆ°å·²æœ‰çš„æ–‡ä»¶ä¸­ã€‚

é€šè¿‡ä¸Šè¿°æ“ä½œï¼Œä¹‹å‰å…‰ç§ƒç§ƒçš„`src/main.tsx`å°±æœ‰äº†æ–°çš„å†…å®¹ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzjSXkAeKsfOvH51PE782ckZRHrajmBDsttv5ibZkibxLdyFFdtLeFD8C0Q/640?wx_fmt=png&from=appmsg)

çœ‹ä¸Šé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªæ‹¥æœ‰`redux`çš„åŠŸèƒ½äº†ã€‚

* * *

9. cargo build
==============

å¦‚æœæ‰§è¡Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡`cargo build`å°†å…¶ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`cargo build --release`è¿›è¡Œå¤„ç†ã€‚ç„¶åï¼Œåœ¨é¡¹ç›®ä¸­çš„`target/release`æ‰¾åˆ°`f_cli`ã€‚è¿™æ ·ï¼Œå°±åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œåˆšæ‰æˆ‘ä»¬çš„å‘½ä»¤ï¼Œæ‰§è¡Œé¡¹ç›®çš„æ„å»ºã€‚

å¦‚æœæ˜¯æœ‰äºŒè¿›åˆ¶æºæ–‡ä»¶çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†`f_cli`æ”¾åˆ°å®‰å…¨çš„æ–‡ä»¶å¤¹ä¸­ã€‚é€šè¿‡åœ¨`.bashrc`ä¸­é…ç½®`PATH`ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å…¨å±€èŒƒå›´å†…è®¿é—®äº†ã€‚

å› ä¸ºäºŒè¿›åˆ¶çš„å—æ“ä½œç³»ç»Ÿçš„ç¼˜æ•…ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å…¶ç¼–è¯‘æˆæ»¡è¶³å„ç§å†…æ ¸çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä¾‹å¦‚

1.  `Mac Arm`æ¶æ„
    
2.  `Window`ç¯å¢ƒã€‚
    
3.  `Linux`
    
4.  .....
    

æˆ‘ä»¬å¯ä»¥é€šè¿‡`rustup target list`æŸ¥çœ‹å¯ä»¥ç¼–è¯‘æˆçš„`target`ã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ platform-support[10] æ¥æŸ¥çœ‹æ›´è¯¦ç»†çš„æè¿°ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡`rustup target add xxx`æ¥æ–°å¢æˆ‘ä»¬éœ€è¦çš„`target`ã€‚

10. cargo publish
=================

å¯¹äºå¦‚ä½•å‘å¸ƒä¸€ä¸ª`rust`åº”ç”¨åˆ°`crates.io`ã€‚æˆ‘ä»¬ä¹‹å‰åœ¨ [Rust å¼€å‘å‘½ä»¤è¡Œå·¥å…·](https://mp.weixin.qq.com/s?__biz=Mzg3NjU2OTE1Mw==&mid=2247489804&idx=1&sn=1fe78ee8bcc9ccb2191d3b73c6a83e02&scene=21#wechat_redirect)ä¸­æœ‰è¿‡è¯¦ç»†ä»‹ç»ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzj6rgIlRvteo9xW52gZY3HTYfCABw4MywoCvLbrQpsbsQduft9xZ8fSg/640?wx_fmt=png&from=appmsg)

* * *

11. TODO
========

å…¶å®æˆ‘ä»¬è¿™ä¸ªç‰ˆæœ¬çš„`f_cli`è¿˜æœ‰å¾ˆå¤šäº‹æƒ…éœ€è¦åšã€‚å¦‚æœå¤§å®¶è°æœ‰å…´è¶£ï¼Œå¯ä»¥ç§èŠï¼Œç„¶åæˆ‘ä»¬ä¸€èµ·æ¥åšä¸€äº›æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚

1.  æ‰“åŒ…å·¥å…·çš„é€‰æ‹© (`Webpack/Vite/RsPack`)
    
2.  å‰ç«¯æ¡†æ¶çš„é€‰æ‹© (`Vue/React`)
    
3.  åŸºäºæœ¬åœ°æ–‡ä»¶è¿›è¡Œè‡ªå®šä¹‰é…ç½®
    
4.  é’ˆå¯¹ç°æœ‰é¡¹ç›®çš„é…ç½®æ›´æ–°
    
5.  ....
    

* * *

åè®°
==

**ã€Œåˆ†äº«æ˜¯ä¸€ç§æ€åº¦ã€**ã€‚

**ã€Œå…¨æ–‡å®Œï¼Œæ—¢ç„¶çœ‹åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œéšæ‰‹ç‚¹ä¸ªèµå’Œ â€œåœ¨çœ‹â€ å§ã€‚ã€**

![](https://mmbiz.qpic.cn/mmbiz_gif/rv5jxwmzMCVhXm5K52f69q8BuYuiaKHzj7iarWibnK16yBKwjj0HI4JToWy8gFnEumoGfLQQia9EIeH8CgNPuao89Q/640?wx_fmt=gif&from=appmsg)

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`rustup target list --installed`æ¥æŸ¥çœ‹å·²ç»å®‰è£…è¿‡çš„`target`ã€‚

### Reference

[1]

crates.io: https://crates.io/crates/f_cli

[2]

Manifest Format: https://doc.rust-lang.org/cargo/reference/manifest.html

[3]

anyhow: https://crates.io/crates/anyhow

[4]

clap: https://crates.io/crates/clap

[5]

dialoguer: https://crates.io/crates/dialoguer

[6]

#[derive]: https://doc.rust-lang.org/reference/attributes/derive.html

[7]

RustEmbed: https://crates.io/crates/rust-embed

[8]

serde_json: https://crates.io/crates/serde_json

[9]

console: https://crates.io/crates/console

[10]

platform-support: https://doc.rust-lang.org/rustc/platform-support.html