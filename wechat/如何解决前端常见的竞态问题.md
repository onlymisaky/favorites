> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/d3ztpCF1yUv52Y8JCD4F_g)

ä¸€èµ·è¿›æ­¥ğŸš€)" data-from="0" data-is_biz_ban="0" data-origin_num="20" data-isban="0" data-biz_account_status="0" data-index="0" class="mp_common_widget">

ä»Šå¤©æˆ‘ä»¬èŠèŠå‰ç«¯å¸¸è§çš„ç«æ€é—®é¢˜ã€‚

é˜…è¯»å®Œæœ¬æ–‡ï¼Œä½ å°†ä¼šçŸ¥é“ï¼š

*   ä»€ä¹ˆæ˜¯ç«æ€é—®é¢˜
    
*   é€šå¸¸å‡ºç°åœ¨å“ªäº›åœºæ™¯
    
*   è§£å†³ç«æ€é—®é¢˜æœ‰å“ªäº›æ–¹æ³•
    

ä»€ä¹ˆæ˜¯ç«æ€é—®é¢˜
-------

> **ç«æ€é—®é¢˜**ï¼Œåˆå«**ç«æ€æ¡ä»¶**ï¼ˆrace conditionï¼‰ï¼Œå®ƒæ—¨åœ¨æè¿°ä¸€ä¸ªç³»ç»Ÿæˆ–è€…è¿›ç¨‹çš„è¾“å‡ºä¾èµ–äºä¸å—æ§åˆ¶çš„äº‹ä»¶å‡ºç°é¡ºåºæˆ–è€…å‡ºç°æ—¶æœºã€‚
> 
> æ­¤è¯æºè‡ªäºä¸¤ä¸ªä¿¡å·è¯•ç€å½¼æ­¤ç«äº‰ï¼Œæ¥å½±å“è°å…ˆè¾“å‡ºã€‚

ç®€å•æ¥è¯´ï¼Œå®ƒå‡ºç°çš„åŸå› æ˜¯æ— æ³•ä¿è¯å¼‚æ­¥æ“ä½œçš„å®Œæˆä¼šæŒ‰ç…§ä»–ä»¬å¼€å§‹æ—¶åŒæ ·çš„é¡ºåºã€‚

ä¸¾ä¸ªğŸŒ°ï¼Œæœ‰ä¸€ä¸ªåˆ†é¡µåˆ—è¡¨ï¼Œæˆ‘ä»¬å¿«é€Ÿåœ°åˆ‡æ¢ç¬¬äºŒé¡µï¼Œç¬¬ä¸‰é¡µã€‚

ä¼šå…ˆåè¯·æ±‚ data2 ä¸ data3ï¼Œåˆ†é¡µå™¨æ˜¾ç¤ºå½“å‰åœ¨ç¬¬ä¸‰é¡µï¼Œå¹¶ä¸”è¿›å…¥ loadingã€‚

ä½†ç”±äºç½‘ç»œçš„ä¸ç¡®å®šæ€§ï¼Œå…ˆå‘å‡ºçš„è¯·æ±‚ä¸ä¸€å®šå…ˆå“åº”ï¼Œæœ‰å¯èƒ½ data3 æ¯” data2 å…ˆè¿”å›ã€‚

æœ€ç»ˆï¼Œè¯·æ±‚è¿”å› data2 åï¼Œåˆ†é¡µå™¨æŒ‡ç¤ºå½“å‰åœ¨ç¬¬ä¸‰é¡µï¼Œä½†å±•ç¤ºçš„æ˜¯ç¬¬äºŒé¡µçš„æ•°æ®ã€‚

è¿™å°±æ˜¯ç«æ€æ¡ä»¶ï¼Œåœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œå¸¸è§äºæœç´¢ï¼Œåˆ†é¡µï¼Œé€‰é¡¹å¡ç­‰åˆ‡æ¢çš„åœºæ™¯ã€‚

é‚£ä¹ˆå¦‚ä½•è§£å†³ç«æ€é—®é¢˜å‘¢ï¼Ÿåœ¨ä»¥ä¸Šè¿™äº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ï¼š

**å½“å‘å‡ºæ–°çš„è¯·æ±‚æ—¶ï¼Œå–æ¶ˆæ‰ä¸Šæ¬¡è¯·æ±‚å³å¯ã€‚**

å–æ¶ˆè¿‡æœŸè¯·æ±‚
------

æœ‰å“ªäº›æ–¹æ³•å¯ä»¥å–æ¶ˆè¯·æ±‚å‘¢ï¼Ÿ

### XMLHttpRequest å–æ¶ˆè¯·æ±‚

XMLHttpRequestï¼ˆXHRï¼‰æ˜¯ä¸€ä¸ªå†…å»ºçš„æµè§ˆå™¨å¯¹è±¡ï¼Œå®ƒå…è®¸ä½¿ç”¨ JavaScript å‘é€ HTTP è¯·æ±‚ã€‚

å¦‚æœè¯·æ±‚å·²è¢«å‘å‡ºï¼Œå¯ä»¥ä½¿ç”¨ abort() æ–¹æ³•ç«‹åˆ»ä¸­æ­¢è¯·æ±‚ã€‚

```
constÂ xhr=Â newÂ XMLHttpRequest();xhr.open('GET',Â 'https://xxx');xhr.send();Â Â Â Â xhr.abort();Â //Â å–æ¶ˆè¯·æ±‚
```

### fetch API å–æ¶ˆè¯·æ±‚

fetch å·ç§°æ˜¯ AJAX çš„æ›¿ä»£å“ï¼Œå‡ºç°äº ES6ï¼Œå®ƒä¹Ÿå¯ä»¥å‘å‡ºç±»ä¼¼ XMLHttpRequest çš„ç½‘ç»œè¯·æ±‚ã€‚

ä¸»è¦çš„åŒºåˆ«åœ¨äº fetch ä½¿ç”¨äº† promiseï¼Œè¦ä¸­æ­¢ fetch å‘å‡ºçš„è¯·æ±‚ï¼Œéœ€è¦ä½¿ç”¨ `AbortController`ã€‚

```
constÂ controllerÂ =Â newÂ AbortController();constÂ signalÂ =Â controller.signal;fetch('/xxx',Â {Â Â signal,}).then(function(response)Â {Â Â //...});controller.abort();Â //Â å–æ¶ˆè¯·æ±‚
```

### axios å–æ¶ˆè¯·æ±‚

axios æ˜¯ä¸€ä¸ª HTTP è¯·æ±‚åº“ï¼Œæœ¬è´¨æ˜¯å¯¹åŸç”Ÿ XMLHttpRequest çš„å°è£… ååŸºäº promise çš„å®ç°ç‰ˆæœ¬ï¼Œå› æ­¤ axios è¯·æ±‚ä¹Ÿå¯ä»¥è¢«å–æ¶ˆã€‚

å¯ä»¥åˆ©ç”¨ axios çš„ CancelToken API å–æ¶ˆè¯·æ±‚ã€‚

```
constÂ sourceÂ =Â axios.CancelToken.source();axios.get('/xxx',Â {Â Â cancelToken:Â source.token}).then(functionÂ (response)Â {Â Â //Â ...});source.cancel()Â //Â å–æ¶ˆè¯·æ±‚
```

åœ¨ cancel æ—¶ï¼Œaxios ä¼šåœ¨å†…éƒ¨è°ƒç”¨ promise.reject() ä¸ xhr.abort()ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/K0dLoicpO1icfSVEyia1iaX6Rl1I5m7ZwskKClSMCIabldpO2XicbIkFhrIg3JjHxM88eZbnAtdjjo0GrMShHjZvqwg/640?wx_fmt=png)æ‰€ä»¥æˆ‘ä»¬åœ¨å¤„ç†è¯·æ±‚é”™è¯¯æ—¶ï¼Œéœ€è¦åˆ¤æ–­ error æ˜¯å¦æ˜¯ cancel å¯¼è‡´çš„ï¼Œä¸å¸¸è§„é”™è¯¯åŒºåˆ†å¤„ç†ã€‚

```
axios.get('/xxx',Â {Â Â cancelToken:Â source.token}).catch(function(err)Â {Â Â Â ifÂ (axios.isCancel(err))Â {Â Â Â Â console.log('RequestÂ canceled',Â err.message);Â Â }Â elseÂ {Â Â Â Â //Â å¤„ç†é”™è¯¯Â Â }});
```

ä½† cancelToken ä» v0.22.0 å¼€å§‹å·²è¢« axios å¼ƒç”¨ã€‚åŸå› æ˜¯åŸºäºå®ç°è¯¥ API çš„ææ¡ˆ cancelable promises proposal[1] å·²è¢«æ’¤é”€ã€‚

ä» v0.22.0 å¼€å§‹ï¼Œaxios æ”¯æŒä»¥ fetch API æ–¹å¼çš„ AbortController å–æ¶ˆè¯·æ±‚ã€‚

```
constÂ controllerÂ =Â newÂ AbortController();axios.get('/xxx',Â {Â Â signal:Â controller.signal}).then(function(response)Â {Â Â Â //...});controller.abort()Â //Â å–æ¶ˆè¯·æ±‚
```

åŒæ ·ï¼Œåœ¨å¤„ç†è¯·æ±‚é”™è¯¯æ—¶ï¼Œä¹Ÿéœ€è¦åˆ¤æ–­ error æ˜¯å¦æ¥è‡ª cancelã€‚

### å¯å–æ¶ˆçš„ promise

åŸç”Ÿ promise å¹¶ä¸æ”¯æŒ cancelï¼Œä½† cancel å¯¹äºå¼‚æ­¥æ“ä½œæ¥è¯´åˆæ˜¯ä¸ªå¾ˆå¸¸è§çš„éœ€æ±‚ã€‚æ‰€ä»¥ç¤¾åŒºå¾ˆå¤šä»“åº“éƒ½è‡ªå·±å®ç°äº† promise çš„ cancel èƒ½åŠ›ã€‚

æˆ‘ä»¬ä»¥ awesome-imperative-promise[2] ä¸ºä¾‹ï¼Œæ¥çœ‹çœ‹ cancel çš„å®ç°ï¼Œå®ƒçš„ cancel å®ç°åŸºäº**æŒ‡ä»¤å¼ promise**ï¼Œæºç ä¸€å…±åªæœ‰ 40 è¡Œã€‚

ä»€ä¹ˆæ˜¯æŒ‡ä»¤å¼ promiseï¼Ÿ

æˆ‘ä»¬æ™®éä½¿ç”¨çš„ promiseï¼Œå®ƒçš„ resolve/reject åªèƒ½åœ¨ new Promise å†…éƒ¨è°ƒç”¨ï¼Œè€ŒæŒ‡ä»¤å¼ promise æ”¯æŒåœ¨ promise å¤–éƒ¨æ‰‹åŠ¨è°ƒç”¨ resolve/reject ç­‰æŒ‡ä»¤ã€‚

é€šè¿‡å®ƒçš„ç”¨æ³•èƒ½æ›´å¥½åœ°ç†è§£ä½•ä¸ºæŒ‡ä»¤å¼ promiseï¼š

```
importÂ {Â createImperativePromiseÂ }Â fromÂ 'awesome-imperative-promise';constÂ {Â resolve,Â reject,Â cancelÂ }Â =Â createImperativePromise(promise);resolve("someÂ value");//Â orreject(newÂ Error());//Â orcancel();
```

å†…éƒ¨çš„ cancel æ–¹æ³•å…¶å®å°±æ˜¯å°† resolveï¼Œreject è®¾ä¸º nullï¼Œè®© promise æ°¸è¿œä¸ä¼š resolve/rejectã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/K0dLoicpO1icfSVEyia1iaX6Rl1I5m7ZwskKwso01CFYoV4zEBGRuWOlibky27QIKWhxCqZY5hICicdiagUr5QgLwMDmQ/640?wx_fmt=png)

> ä¸€ç›´æ²¡æœ‰ resolve ä¹Ÿæ²¡æœ‰ reject çš„ promise ä¼šé€ æˆå†…å­˜æ³„éœ²å—ï¼Ÿ
> 
> æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥äº†è§£ä¸‹è¿™ç¯‡çŸ¥ä¹æé—® [3]ï¼Œå›ç­”ä¼—è¯´çº·çº­ã€‚
> 
> æˆ‘ä¸ªäººè®¤ä¸ºï¼Œå¦‚æœæ²¡æœ‰ä¿ç•™å¯¹ promise çš„å¼•ç”¨ï¼Œå°±ä¸ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚

å›åˆ° promise cancelï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶ API å‘½åä¸º cancelï¼Œä½†å®é™…ä¸Šæ²¡æœ‰ä»»ä½• cancel çš„åŠ¨ä½œï¼Œpromise çš„çŠ¶æ€è¿˜æ˜¯ä¼šæ­£å¸¸æµè½¬ï¼Œåªæ˜¯å›è°ƒä¸å†æ‰§è¡Œï¼Œè¢« â€œå¿½ç•¥â€ äº†ï¼Œæ‰€ä»¥çœ‹èµ·æ¥åƒè¢« cancel äº†ã€‚

å› æ­¤è§£å†³ç«æ€é—®é¢˜çš„æ–¹æ³•ï¼Œé™¤äº†ã€Œå–æ¶ˆè¯·æ±‚ã€ï¼Œè¿˜å¯ä»¥ã€Œå¿½ç•¥è¯·æ±‚ã€ã€‚

**å½“è¯·æ±‚å“åº”æ—¶ï¼Œåªè¦åˆ¤æ–­è¿”å›çš„æ•°æ®æ˜¯å¦éœ€è¦ï¼Œå¦‚æœä¸æ˜¯åˆ™å¿½ç•¥å³å¯ã€‚**

å¿½ç•¥è¿‡æœŸè¯·æ±‚
------

æˆ‘ä»¬åˆæœ‰å“ªäº›æ–¹å¼æ¥å¿½ç•¥è¿‡æœŸçš„è¯·æ±‚å‘¢ï¼Ÿ

### å°è£…æŒ‡ä»¤å¼ promise

åˆ©ç”¨æŒ‡ä»¤å¼ promiseï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è°ƒç”¨ cancel API æ¥å¿½ç•¥ä¸Šæ¬¡è¯·æ±‚ã€‚

ä½†æ˜¯å¦‚æœæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´é¡¹ç›®ä¸­ç›¸åŒçš„æ¨¡æ¿ä»£ç è¿‡å¤šï¼Œå¶å°”ä¹Ÿå¯èƒ½å¿˜è®° cancelã€‚

æˆ‘ä»¬å¯ä»¥åŸºäºæŒ‡ä»¤å¼ promise å°è£…ä¸€ä¸ªè‡ªåŠ¨å¿½ç•¥è¿‡æœŸè¯·æ±‚çš„é«˜é˜¶å‡½æ•° `onlyResolvesLast`ã€‚

**åœ¨æ¯æ¬¡å‘é€æ–°è¯·æ±‚å‰ï¼Œcancel æ‰ä¸Šä¸€æ¬¡çš„è¯·æ±‚ï¼Œå¿½ç•¥å®ƒçš„å›è°ƒã€‚**

```
functionÂ onlyResolvesLast(fn)Â {Â Â //Â ä¿å­˜ä¸Šä¸€ä¸ªè¯·æ±‚çš„Â cancelÂ æ–¹æ³•Â Â letÂ cancelPreviousÂ =Â null;Â Â Â constÂ wrappedFnÂ =Â (...args)Â =>Â {Â Â Â Â //Â å½“å‰è¯·æ±‚æ‰§è¡Œå‰ï¼Œå…ˆÂ cancelÂ ä¸Šä¸€ä¸ªè¯·æ±‚Â Â Â Â cancelPreviousÂ &&Â cancelPrevious();Â Â Â Â //Â æ‰§è¡Œå½“å‰è¯·æ±‚Â Â Â Â constÂ resultÂ =Â fn.apply(this,Â args);Â Â Â Â Â Â Â Â Â //Â åˆ›å»ºæŒ‡ä»¤å¼çš„Â promiseï¼Œæš´éœ²Â cancelÂ æ–¹æ³•å¹¶ä¿å­˜Â Â Â Â constÂ {Â promise,Â cancelÂ }Â =Â createImperativePromise(result);Â Â Â Â cancelPreviousÂ =Â cancel;Â Â Â Â Â Â Â Â returnÂ promise;Â Â };Â Â returnÂ wrappedFn;}
```

ä»¥ä¸Šå°±æ˜¯ awesome-only-resolves-last-promise[4] çš„å®ç°ã€‚

åªéœ€è¦å°† `onlyResolvesLast` åŒ…è£…ä¸€ä¸‹è¯·æ±‚æ–¹æ³•ï¼Œå°±èƒ½å®ç°è‡ªåŠ¨å¿½ç•¥ï¼Œå‡å°‘å¾ˆå¤šæ¨¡æ¿ä»£ç ã€‚

```
constÂ fnÂ =Â (duration)Â =>Â Â Â newÂ Promise(rÂ =>Â {Â Â Â Â Â Â Â Â setTimeout(r,Â duration);Â Â Â Â });constÂ wrappedFnÂ =Â onlyResolvesLast(fn);wrappedFn(500).then(()Â =>Â console.log(1));wrappedFn(1000).then(()Â =>Â console.log(2));wrappedFn(100).then(()Â =>Â console.log(3));//Â è¾“å‡ºÂ 3
```

### ä½¿ç”¨å”¯ä¸€ id æ ‡è¯†æ¯æ¬¡è¯·æ±‚

é™¤äº†æŒ‡ä»¤å¼ promiseï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»™ã€Œè¯·æ±‚æ ‡è®° idã€çš„æ–¹å¼æ¥å¿½ç•¥ä¸Šæ¬¡è¯·æ±‚ã€‚

å…·ä½“æ€è·¯æ˜¯ï¼š

*   åˆ©ç”¨å…¨å±€å˜é‡è®°å½•æœ€æ–°ä¸€æ¬¡çš„è¯·æ±‚ id
    
*   åœ¨å‘è¯·æ±‚å‰ï¼Œç”Ÿæˆå”¯ä¸€ id æ ‡è¯†è¯¥æ¬¡è¯·æ±‚
    
*   åœ¨è¯·æ±‚å›è°ƒä¸­ï¼Œåˆ¤æ–­ id æ˜¯å¦æ˜¯æœ€æ–°çš„ idï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™å¿½ç•¥è¯¥è¯·æ±‚çš„å›è°ƒ
    

ä¼ªä»£ç å¦‚ä¸‹ï¼š

```
letÂ fetchIdÂ =Â 0;Â //Â ä¿å­˜æœ€æ–°çš„è¯·æ±‚Â idconstÂ getUsersÂ =Â ()Â =>Â {Â Â //Â å‘èµ·è¯·æ±‚å‰ï¼Œç”Ÿæˆæ–°çš„Â idÂ å¹¶ä¿å­˜Â Â constÂ idÂ =Â fetchIdÂ +Â 1;Â Â fetchIdÂ =Â id;Â Â Â Â awaitÂ è¯·æ±‚Â Â Â Â //Â åˆ¤æ–­æ˜¯æœ€æ–°çš„è¯·æ±‚Â idÂ å†å¤„ç†å›è°ƒÂ Â ifÂ (idÂ ===Â fetchId)Â {Â Â Â Â //Â è¯·æ±‚å¤„ç†Â Â }}
```

ä¸Šé¢çš„ä½¿ç”¨æ–¹æ³•ä¹Ÿä¼šåœ¨é¡¹ç›®ä¸­äº§ç”Ÿå¾ˆå¤šæ¨¡æ¿ä»£ç ï¼Œç»è¿‡å°è£…åï¼Œä¹Ÿèƒ½å®ç°ä¸€å¥—åŒæ ·ç”¨æ³•çš„ `onlyResolvesLast`ï¼š

```
functionÂ onlyResolvesLast(fn)Â {Â Â //Â åˆ©ç”¨é—­åŒ…ä¿å­˜æœ€æ–°çš„è¯·æ±‚Â idÂ Â letÂ idÂ =Â 0;Â Â Â Â constÂ wrappedFnÂ =Â (...args)Â =>Â {Â Â Â Â //Â å‘èµ·è¯·æ±‚å‰ï¼Œç”Ÿæˆæ–°çš„Â idÂ å¹¶ä¿å­˜Â Â Â Â constÂ fetchIdÂ =Â idÂ +Â 1;Â Â Â Â idÂ =Â fetchId;Â Â Â Â Â Â Â Â //Â æ‰§è¡Œè¯·æ±‚Â Â Â Â constÂ resultÂ =Â fn.apply(this,Â args);Â Â Â Â Â Â Â Â returnÂ newÂ Promise((resolve,Â reject)Â =>Â {Â Â Â Â Â Â //Â resultÂ å¯èƒ½ä¸æ˜¯Â promiseï¼Œéœ€è¦åŒ…è£…æˆÂ promiseÂ Â Â Â Â Â Promise.resolve(result).then((value)Â =>Â {Â Â Â Â Â Â Â Â //Â åªå¤„ç†æœ€æ–°ä¸€æ¬¡è¯·æ±‚Â Â Â Â Â Â Â Â ifÂ (fetchIdÂ ===Â id)Â {Â Â Â Â Â Â Â Â Â Â Â resolve(value);Â Â Â Â Â Â Â Â }Â Â Â Â Â Â },Â (error)Â =>Â {Â Â Â Â Â Â Â Â //Â åªå¤„ç†æœ€æ–°ä¸€æ¬¡è¯·æ±‚Â Â Â Â Â Â Â Â ifÂ (fetchIdÂ ===Â id)Â {Â Â Â Â Â Â Â Â Â Â reject(error);Â Â Â Â Â Â Â Â }Â Â Â Â Â Â });Â Â Â Â })Â Â };Â Â Â Â returnÂ wrappedFn;}
```

ç”¨æ³•ä¹Ÿä¸€æ ·ï¼Œä½¿ç”¨ `onlyResolvesLast` åŒ…è£…ä¸€ä¸‹è¯·æ±‚æ–¹æ³•ï¼Œå®ç°è¿‡æœŸè¯·æ±‚è‡ªåŠ¨å¿½ç•¥ã€‚

è€Œä¸”ï¼Œè¿™æ ·çš„å®ç°ä¸ä¾èµ–æŒ‡ä»¤å¼ promiseï¼Œä¹Ÿæ›´è½»é‡ã€‚

```
constÂ fnÂ =Â (duration)Â =>Â Â Â newÂ Promise(rÂ =>Â {Â Â Â Â Â Â Â Â setTimeout(r,Â duration);Â Â Â Â });constÂ wrappedFnÂ =Â onlyResolvesLast(fn);wrappedFn(500).then(()Â =>Â console.log(1));wrappedFn(1000).then(()Â =>Â console.log(2));wrappedFn(100).then(()Â =>Â console.log(3));//Â è¾“å‡ºÂ 3
```

ã€Œå–æ¶ˆã€å’Œã€Œå¿½ç•¥ã€çš„æ¯”è¾ƒ
------------

### ã€Œå–æ¶ˆã€æ›´å®é™…

å¦‚æœè¯·æ±‚è¢«ã€Œå–æ¶ˆã€äº†æ²¡æœ‰åˆ°è¾¾æœåŠ¡ç«¯ï¼Œé‚£ä¹ˆå¯ä»¥ä¸€å®šç¨‹åº¦å‡è½»æœåŠ¡çš„å‹åŠ›ã€‚

ä½†æ˜¯å–æ¶ˆè¯·æ±‚ä¹Ÿä¾èµ–åº•å±‚çš„è¯·æ±‚ APIï¼Œæ¯”å¦‚ XMLHttpRequest éœ€è¦ç”¨ abortï¼Œè€Œ fetch API å’Œ axios éœ€è¦ç”¨ AbortControllerã€‚

### ã€Œå¿½ç•¥ã€æ›´é€šç”¨

è€Œã€Œå¿½ç•¥ã€çš„æ–¹å¼ï¼Œä¸ä¾èµ–è¯·æ±‚çš„ APIï¼Œæ›´åŠ é€šç”¨ï¼Œæ›´å®¹æ˜“æŠ½è±¡å’Œå°è£…ã€‚æœ¬è´¨ä¸Šæ‰€æœ‰çš„å¼‚æ­¥æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨ onlyResolvesLast æ¥å¿½ç•¥è¿‡æœŸçš„è°ƒç”¨ã€‚

ä¸€ä¸ªæ›´å®é™…ï¼Œä¸€ä¸ªæ›´é€šç”¨ï¼Œä¸¤è€…çš„ä½¿ç”¨éœ€è¦æ ¹æ®å…·ä½“åœºæ™¯æ¥æƒè¡¡ã€‚

æ€»ç»“
--

åœ¨å‰ç«¯å¸¸è§çš„æœç´¢ï¼Œåˆ†é¡µï¼Œé€‰é¡¹å¡ç­‰åˆ‡æ¢çš„åœºæ™¯ä¸­ã€‚ç”±äºç½‘ç»œçš„ä¸ç¡®å®šæ€§ï¼Œå…ˆå‘å‡ºçš„è¯·æ±‚ä¸ä¸€å®šå…ˆå“åº”ï¼Œè¿™ä¼šé€ æˆç«æ€é—®é¢˜ã€‚

è§£å†³ç«æ€é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ã€Œå–æ¶ˆã€æˆ–ã€Œå¿½ç•¥ã€è¿‡æœŸè¯·æ±‚ã€‚

*   ã€Œå–æ¶ˆè¯·æ±‚ã€ï¼ŒXMLHttpRequest å¯ä»¥ä½¿ç”¨ abort æ–¹æ³•ï¼Œfetch API ä»¥åŠ axios å¯ä»¥ä½¿ç”¨ AbortController
    
*   ã€Œå¿½ç•¥è¯·æ±‚ã€ï¼Œå¯ä»¥åŸºäºæŒ‡ä»¤å¼ promise æˆ–è¯·æ±‚ id çš„æ–¹å¼å°è£…é«˜é˜¶å‡½æ•°æ¥å‡å°‘æ¨¡æ¿ä»£ç 
    

ä¸¤ç§æ–¹å¼å„æœ‰å„çš„å¥½ï¼Œéœ€è¦æ ¹æ®å®é™…åœºæ™¯æƒè¡¡åˆ©å¼Šã€‚

å…¶å®è§£å†³æ–¹å¼ä¸æ­¢è¿™äº›ï¼Œåƒ React Queryï¼ŒGraphQLï¼ŒRxJS ç­‰å†…éƒ¨éƒ½æœ‰ç«æ€å¤„ç†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å†æ·±å…¥äº†è§£ã€‚

ä¸€èµ·è¿›æ­¥ğŸš€)" data-from="0" data-is_biz_ban="0" data-origin_num="20" data-isban="0" data-biz_account_status="0" data-index="1" class="mp_common_widget">

### å‚è€ƒèµ„æ–™

[1]

cancelable promises proposal: _https://github.com/tc39/proposal-cancelable-promises_

[2]

awesome-imperative-promise: _https://github.com/slorber/awesome-imperative-promise_

[3]

è¿™ç¯‡çŸ¥ä¹æé—®: _https://www.zhihu.com/question/386595851_

[4]

awesome-only-resolves-last-promise: _https://github.com/slorber/awesome-only-resolves-last-promise/_