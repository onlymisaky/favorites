> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/P3T2b_ZPbDgaQRhUd8pp_g)

```
ç‚¹å‡»ä¸Šæ–¹Â ç¨‹åºå‘˜æˆé•¿æŒ‡åŒ—ï¼Œå…³æ³¨å…¬ä¼—å·

å›å¤1ï¼ŒåŠ å…¥é«˜çº§Nodeäº¤æµç¾¤

```

### ä¸€ã€å¼•è¨€ï¼šä¸ºä½•é€‰æ‹©å¾®å‰ç«¯ï¼Ÿ

åœ¨ä¼ ç»Ÿå•ä½“å‰ç«¯æ¶æ„ä¸­ï¼Œéšç€ä¸šåŠ¡å¤æ‚åº¦å¢åŠ ï¼Œä»£ç è‡ƒè‚¿ã€åä½œå›°éš¾ã€éƒ¨ç½²æ•ˆç‡ä½ç­‰é—®é¢˜æ„ˆå‘çªå‡ºã€‚**å¾®å‰ç«¯**é€šè¿‡å°†é¡¹ç›®æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹è‡ªæ²»çš„å¾®åº”ç”¨ï¼Œè§£å†³äº†è¿™äº›é—®é¢˜ï¼š

*   **æŠ€æœ¯æ ˆæ— å…³**ï¼šæ”¯æŒ Vueã€Reactã€Angular ç­‰æ¡†æ¶æ··åˆå¼€å‘
    
*   **ç‹¬ç«‹éƒ¨ç½²**ï¼šå„å›¢é˜Ÿå¯ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€å‘å¸ƒ
    
*   **æ¸è¿›å‡çº§**ï¼šå…è®¸é€æ­¥é‡æ„æ—§ç³»ç»Ÿ
    
*   **åŠ¨æ€åŠ è½½**ï¼šæŒ‰éœ€åŠ è½½å‡å°‘é¦–å±è€—æ—¶
    

æœ¬æ–‡å°†ä»¥**ç”µå•†åå°ç®¡ç†ç³»ç»Ÿ**ä¸ºåº”ç”¨åœºæ™¯ï¼Œå¯¹æ¯”åˆ†ææ— ç•Œï¼ˆMomentumï¼‰ä¸ä¹¾å¤ï¼ˆQiankunï¼‰ä¸¤å¤§æ¡†æ¶çš„å®ç°æ–¹å¼ï¼Œé€šè¿‡å®Œæ•´ç¤ºä¾‹ä»£ç æ­ç¤ºå…¶æ ¸å¿ƒå·®å¼‚ã€‚

* * *

### äºŒã€åŸºç¡€æ¦‚å¿µå¯¹æ¯”

<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>æ— ç•Œï¼ˆMomentumï¼‰</strong></th><th><strong>ä¹¾å¤ï¼ˆQiankunï¼‰</strong></th></tr></thead><tbody><tr><td><strong>æŠ€æœ¯å®ç°</strong></td><td><section>WebComponents + iframe</section></td><td><section>single-spa + proxy + function-based sandbox</section></td></tr><tr><td><strong>æ ·å¼éš”ç¦»</strong></td><td><section>ä¾èµ– WebComponent åŸç”Ÿå½±å­ DOM</section></td><td><section>JS æ²™ç®± + å®éªŒæ€§æ ·å¼éš”ç¦»</section></td></tr><tr><td><strong>æµè§ˆå™¨å…¼å®¹æ€§</strong></td><td><section>IE11+ï¼ˆéœ€å¤„ç† iframe å¼¹çª—ï¼‰</section></td><td><section>æ”¯æŒ IE11ï¼ˆé€šè¿‡ polyfillï¼‰</section></td></tr><tr><td><strong>å­¦ä¹ æˆæœ¬</strong></td><td><section>æä½ï¼ˆæ¥è¿‘åŸç”Ÿå¼€å‘ï¼‰</section></td><td><section>ä¸­ç­‰ï¼ˆéœ€ç†è§£ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼‰</section></td></tr><tr><td><strong>æœ€ä½³é€‚ç”¨åœºæ™¯</strong></td><td><section>ä¸­å°å‹é¡¹ç›®ã€å¿«é€Ÿé›†æˆ</section></td><td><section>å¤§å‹å¤æ‚é¡¹ç›®ã€å¤šå›¢é˜Ÿåä½œ</section></td></tr></tbody></table>

* * *

### ä¸‰ã€å®æˆ˜ç¤ºä¾‹ï¼šç”µå•†åå°ç®¡ç†ç³»ç»Ÿ

#### åœºæ™¯æè¿°

å‡è®¾æŸç”µå•†åå°åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š

1.  **å•†å“ç®¡ç†**ï¼ˆReact æŠ€æœ¯æ ˆï¼‰
    
2.  **è®¢å•å¤„ç†**ï¼ˆVue æŠ€æœ¯æ ˆï¼‰
    
3.  **ç”¨æˆ·ä¸­å¿ƒ**ï¼ˆAngular æŠ€æœ¯æ ˆï¼‰
    

ä¸»åº”ç”¨æä¾›ç»Ÿä¸€å¯¼èˆªå’Œç™»å½•æ€ï¼Œå„å­åº”ç”¨ç‹¬ç«‹å¼€å‘éƒ¨ç½²ã€‚

* * *

#### å››ã€ä¸»åº”ç”¨é…ç½®ï¼ˆé€šç”¨éƒ¨åˆ†ï¼‰

##### 1. åˆ›å»ºä¸»åº”ç”¨ï¼ˆVue 3ï¼‰

```
vue create main-app
cdÂ main-app
npm install momentum-uiÂ # æ— ç•Œæ¡†æ¶
npm install qiankun Â  Â  Â # ä¹¾å¤æ¡†æ¶


```

##### 2. ç›®å½•ç»“æ„

```
main-app/
â”œâ”€â”€ public/
â”‚ Â  â””â”€â”€ index.html
â”œâ”€â”€ src/
â”‚ Â  â”œâ”€â”€ components/
â”‚ Â  â”‚ Â  â””â”€â”€ NavBar.vue
â”‚ Â  â”œâ”€â”€ App.vue
â”‚ Â  â”œâ”€â”€ main.js
â”‚ Â  â””â”€â”€ ...
â”œâ”€â”€ package.json


```

* * *

#### äº”ã€æ— ç•Œæ¡†æ¶å®ç°

##### 1. ä¸»åº”ç”¨é…ç½®ï¼ˆ`src/main.js`ï¼‰

```
importÂ { createApp }Â from'vue'
importÂ AppÂ from'./App.vue'
importÂ NavBarÂ from'./components/NavBar.vue'
importÂ { registerMicroApps }Â from'momentum-ui'

constÂ app = createApp(App)
app.component('NavBar', NavBar)
app.mount('#app')

// æ³¨å†Œå­åº”ç”¨
registerMicroApps([
Â  {
Â  Â Â name:Â 'product-react',
Â  Â Â entry:Â '//localhost:7100',
Â  Â Â activeRule:Â '/product',
Â  Â Â container:Â '#subapp-container'
Â  },
Â  {
Â  Â Â name:Â 'order-vue',
Â  Â Â entry:Â '//localhost:7101',
Â  Â Â activeRule:Â '/order',
Â  Â Â container:Â '#subapp-container'
Â  }
])


```

##### 2. å¯¼èˆªç»„ä»¶ï¼ˆ`src/components/NavBar.vue`ï¼‰

```
<template>
Â Â <nav>
Â  Â Â <router-linkÂ to="/product">å•†å“ç®¡ç†</router-link>
Â  Â Â <router-linkÂ to="/order">è®¢å•å¤„ç†</router-link>
Â Â </nav>
</template>


```

##### 3. ä¸»åº”ç”¨æ¨¡æ¿ï¼ˆ`public/index.html`ï¼‰

```
<body>
Â Â <divÂ id="app">
Â  Â Â <NavBarÂ />
Â  Â Â <divÂ id="subapp-container"></div>
Â Â </div>
</body>


```

* * *

#### å…­ã€ä¹¾å¤æ¡†æ¶å®ç°

##### 1. ä¸»åº”ç”¨é…ç½®ï¼ˆ`src/main.js`ï¼‰

```
importÂ { createApp }Â from'vue'
importÂ AppÂ from'./App.vue'
importÂ NavBarÂ from'./components/NavBar.vue'
importÂ { registerMicroApps, start }Â from'qiankun'

constÂ app = createApp(App)
app.component('NavBar', NavBar)
app.mount('#app')

// æ³¨å†Œå­åº”ç”¨
registerMicroApps([
Â  {
Â  Â Â name:Â 'product-react',
Â  Â Â entry:Â '//localhost:7100',
Â  Â Â activeRule:Â '/product',
Â  Â Â container:Â '#subapp-container',
Â  Â Â props: {Â allowRouter:Â trueÂ }
Â  },
Â  {
Â  Â Â name:Â 'order-vue',
Â  Â Â entry:Â '//localhost:7101',
Â  Â Â activeRule:Â '/order',
Â  Â Â container:Â '#subapp-container'
Â  }
])

// å¯åŠ¨ä¹¾å¤
start()


```

##### 2. å…³é”®åŒºåˆ«

*   **æ— ç•Œ**ï¼šæ— éœ€æ˜¾å¼å¯åŠ¨ï¼Œæ³¨å†Œå³è‡ªåŠ¨åŠ è½½
    
*   **ä¹¾å¤**ï¼šéœ€è°ƒç”¨Â `start()`Â æ¿€æ´»æ²™ç®±ç¯å¢ƒ
    
*   **æ ·å¼éš”ç¦»**ï¼šæ— ç•Œä¾èµ– WebComponent å½±å­ DOMï¼Œä¹¾å¤éœ€é…ç½®Â `sandbox: { strictStyleIsolation: true }`
    

* * *

#### ä¸ƒã€å­åº”ç”¨å¼€å‘ï¼ˆä»¥ React å­åº”ç”¨ä¸ºä¾‹ï¼‰

##### 1. åˆ›å»ºå­åº”ç”¨

```
npx create-react-app product-react
cdÂ product-react
npm install momentum-uiÂ # æˆ– qiankun


```

##### 2. æ— ç•Œé€‚é…é…ç½®

```
// src/index.js (æ— ç•Œ)
importÂ ReactÂ fromÂ 'react'
importÂ ReactDOMÂ fromÂ 'react-dom'
importÂ AppÂ fromÂ './App'

ifÂ (window.__POWERED_BY_MOMENTUM__) {
Â  __webpack_public_path__ =Â window.__INJECTED_PUBLIC_PATH_BY_MOMENTUM__
}

ReactDOM.render(<AppÂ />,Â document.getElementById('root'))


```

##### 3. ä¹¾å¤é€‚é…é…ç½®

```
// src/index.js (ä¹¾å¤)
importÂ ReactÂ from'react'
importÂ ReactDOMÂ from'react-dom'
importÂ AppÂ from'./App'

letÂ instance =Â null

functionÂ render(props)Â {
Â  ReactDOM.render(<AppÂ {...props} />,Â document.getElementById('root'))
}

ifÂ (!window.__POWERED_BY_QIANKUN__) {
Â  render()
}

exportasyncfunctionÂ bootstrap()Â {
console.log('React å­åº”ç”¨å¯åŠ¨')
}
exportasyncfunctionÂ mount(props)Â {
console.log('React å­åº”ç”¨æŒ‚è½½')
Â  render(props)
}
exportasyncfunctionÂ unmount()Â {
Â  ReactDOM.unmountComponentAtNode(instance.container.querySelector('#root'))
console.log('React å­åº”ç”¨å¸è½½')
}


```

* * *

### å…«ã€æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”

#### 1. æ ·å¼éš”ç¦»

*   **æ— ç•Œ**ï¼šåˆ©ç”¨ WebComponent çš„å½±å­ DOM è‡ªåŠ¨éš”ç¦»æ ·å¼
    
*   **ä¹¾å¤**ï¼šéœ€å¼€å¯ä¸¥æ ¼æ ·å¼éš”ç¦»ï¼ˆ`sandbox: { strictStyleIsolation: true }`ï¼‰ï¼Œå¦åˆ™å¯èƒ½æ±¡æŸ“å…¨å±€æ ·å¼
    

#### 2. JS æ²™ç®±

*   **æ— ç•Œ**ï¼šé€šè¿‡ iframe å¤©ç„¶éš”ç¦»ï¼Œä½†è·¨å¸§é€šä¿¡æˆæœ¬è¾ƒé«˜
    
*   **ä¹¾å¤**ï¼šé‡‡ç”¨å‡½æ•°ä»£ç†æ²™ç®±ï¼Œæ€§èƒ½æ›´ä¼˜ä½†éœ€æ³¨æ„å˜é‡æ³„æ¼
    

#### 3. åŠ¨æ€è·¯ç”±

*   **æ— ç•Œ**ï¼šæ”¯æŒåŠ¨æ€æ³¨å†Œè·¯ç”±ï¼Œé€‚åˆé¢‘ç¹å˜åŒ–çš„å¯¼è´­ç³»ç»Ÿ
    
*   **ä¹¾å¤**ï¼šä¾èµ–ä¸»åº”ç”¨è·¯ç”±é…ç½®ï¼Œæ›´é€‚åˆå›ºå®šå…¥å£çš„åœºæ™¯
    

* * *

### ä¹ã€ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è¦ç‚¹

1.  **æ„å»ºé¡ºåº**ï¼š
    

*   å…ˆæ„å»ºä¸»åº”ç”¨ï¼Œå†ä¾æ¬¡æ„å»ºå­åº”ç”¨
    
*   ä½¿ç”¨å¸¦å“ˆå¸Œçš„æŒ‡çº¹ç‰ˆæœ¬é¿å…ç¼“å­˜é—®é¢˜
    

3.  **Nginx é…ç½®ç¤ºä¾‹**ï¼š
    

```
server {
Â  listen 80;
Â  location / {
Â  Â  root /path/to/main-app/dist;
Â  Â  try_filesÂ $uriÂ $uri/ /index.html;
Â  }
Â  location /product/ {
Â  Â  proxy_pass http://localhost:7100;
Â  }
Â  location /order/ {
Â  Â  proxy_pass http://localhost:7101;
Â  }
}


```

3.  **è·¨åŸŸå¤„ç†**ï¼š
    

*   å­åº”ç”¨éœ€è®¾ç½®Â `Access-Control-Allow-Origin`
    
*   æ¨èä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æºåŠ è½½
    

* * *

### åã€æ€»ç»“ä¸é€‰æ‹©å»ºè®®

<table><thead><tr><th><strong>éœ€æ±‚åœºæ™¯</strong></th><th><strong>æ¨èæ¡†æ¶</strong></th><th><strong>ç†ç”±</strong></th></tr></thead><tbody><tr><td><section>å¿«é€ŸåŸå‹éªŒè¯ã€ä¸­å°å‹é¡¹ç›®</section></td><td><section>æ— ç•Œ</section></td><td><section>é›¶é…ç½®æ¥å…¥ã€å¤©ç„¶æ ·å¼éš”ç¦»ã€æ”¯æŒç°ä»£æµè§ˆå™¨</section></td></tr><tr><td><section>ä¼ä¸šçº§å¤æ‚ç³»ç»Ÿã€å¤šå›¢é˜Ÿåä½œ</section></td><td><section>ä¹¾å¤</section></td><td><section>å®Œå–„çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€æ›´å¼ºçš„å…¼å®¹æ€§ã€é€‚åˆé•¿æœŸç»´æŠ¤</section></td></tr><tr><td><section>æ··åˆæŠ€æœ¯æ ˆé¡¹ç›®</section></td><td><section>ä¹¾å¤</section></td><td><section>å®˜æ–¹æ”¯æŒå¤šç§æ¡†æ¶æ··åˆï¼Œç¤¾åŒºç”Ÿæ€æ›´æˆç†Ÿ</section></td></tr></tbody></table>

é€šè¿‡æœ¬æ–‡çš„å¯¹æ¯”ä¸å®æˆ˜æ¼”ç¤ºï¼Œå¼€å‘è€…å¯æ ¹æ®é¡¹ç›®è§„æ¨¡ã€æŠ€æœ¯å¤æ‚åº¦ã€å›¢é˜Ÿåä½œéœ€æ±‚é€‰æ‹©åˆé€‚çš„å¾®å‰ç«¯æ¡†æ¶ã€‚å»ºè®®ä»æ— ç•Œå…¥æ‰‹ä½“éªŒå¾®å‰ç«¯ä¼˜åŠ¿ï¼Œå¾…ä¸šåŠ¡æ‰©å±•åå†é€æ­¥è¿ç§»è‡³ä¹¾å¤ã€‚

> æœ¬æ–‡è½¬è½½äºç¨€åœŸæ˜é‡‘æŠ€æœ¯ç¤¾åŒºï¼Œä½œè€…ï¼š
> 
> æ¶æ„ä¸ªé©¾é©¾
> 
> https://juejin.cn/post/7514956702345773065

  

Node ç¤¾ç¾¤

```
æˆ‘ç»„å»ºäº†ä¸€ä¸ªæ°›å›´ç‰¹åˆ«å¥½çš„ Node.js ç¤¾ç¾¤ï¼Œé‡Œé¢æœ‰å¾ˆå¤š Node.jså°ä¼™ä¼´ï¼Œå¦‚æœä½ å¯¹Node.jså­¦ä¹ æ„Ÿå…´è¶£çš„è¯ï¼ˆåç»­æœ‰è®¡åˆ’ä¹Ÿå¯ä»¥ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·è¿›è¡ŒNode.jsç›¸å…³çš„äº¤æµã€å­¦ä¹ ã€å…±å»ºã€‚ä¸‹æ–¹åŠ  è€ƒæ‹‰ å¥½å‹å›å¤ã€ŒNodeã€å³å¯ã€‚

Â Â Â â€œåˆ†äº«ã€ç‚¹èµã€åœ¨çœ‹â€ æ”¯æŒä¸€æ³¢ğŸ‘

```