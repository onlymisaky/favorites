> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/2-DIsGx9rKNxdRyYBFTv9w)

![](https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCUmheBYjQLWsib9vV342ZeRNd9qVFGFlYYzkhyat3RrP1eGEjFCF8RAQ/640?wx_fmt=png)

> â
> 
> èŠåˆ°è¿ç»´ï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´æˆ‘è§‰å¾—è·Ÿå‰ç«¯å°±æ˜¯æ¯«æ— å…³è”çš„ç©æ„ï¼Œåº”è¯¥è¯´åŠæ¯›é’±å…³ç³»éƒ½æœ¨ã€‚ä½†éšç€å‰ç«¯å·¥ç¨‹åŒ–çš„å‘å±•ï¼Œå‰ç«¯åŸºæœ¬è¿ç»´éƒ¨ç½²ç›¸å…³çŸ¥è¯†ç”šè‡³ä¹Ÿé€æ­¥è¢«é‡è§†ï¼Œå¦‚æœä½ å…¬å¸çš„è¿ç»´éƒ¨é—¨å¾ˆå¼ºå¤§ï¼Œé‚£ä¹ˆä½ ä¹Ÿå¯ä»¥å®Œå…¨å¿½ç•¥è¿ç»´ç›¸å…³çš„ã€‚åªæ˜¯æ ‘é…±è§‰å¾—ï¼Œå¦‚æœä½ æƒ³æ›´å¤šäº†è§£å‰ç«¯æ¶æ„ï¼Œè¿˜æ˜¯éœ€è¦å…·å¤‡ä¸€å®šçš„è¿ç»´ç›¸å…³çŸ¥è¯†å‚¨å¤‡ã€‚å½“ç„¶ï¼Œç°åœ¨äº‘å‚å•†éƒ½æƒ³åº”æ¨å‡ºè‡ªå·±çš„ Serverless æœåŠ¡ (ä¸‹ä¸€ç¯‡ä¼šè®²ï½)ï¼Œå·ç§°è®©å‰ç«¯æ›´ä¸“æ³¨ä¸šåŠ¡çš„å¼€å‘ï¼Œè€Œä¸ç”¨æ‹…å¿ƒåº•å±‚åº”ç”¨çš„éƒ¨ç½²å’Œç»´æŠ¤ï¼Œå¯¹å¼€å‘è€…è€Œè¨€å¯ä»¥æ›´å¤šèšç„¦åˆ°ä¸šåŠ¡é¢†åŸŸçš„å¼€å‘ï¼Œæœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥å»ç©ç©
> 
> â

![](https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCKYibfFPCh90jh87WLWneqJHOXKeacibagaOvNmzcZUYC7ubnlq30G2Qw/640?wx_fmt=png)

### 1.npm

> â
> 
> npm æ˜¯ Node.js å®˜æ–¹æä¾›çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¸»è¦ç”¨æ¥ç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œå‘å¸ƒç­‰ç­‰ï¼Œä¸‹é¢ä»‹ç»å‡ ä¸ªæ¯”è¾ƒå¸¸è§çš„éƒ¨ç½²åº”ç”¨åœºæ™¯ï¼Œå¸¸ç”¨çš„ npm å‘½ä»¤è¿™é‡Œä¸ä½œä»‹ç»äº†
> 
> â

#### 1.1 nrm

> â
> 
> nrm(npm registry manager) æ˜¯ npm çš„é•œåƒæºç®¡ç†å·¥å…·ï¼Œå› ä¸º npm é»˜è®¤å»ºç«‹çš„é“¾æ¥è®¿é—®çš„æ˜¯å›½å¤–çš„èµ„æºï¼Œè®¿é—®é€Ÿåº¦è¾ƒæ…¢ï¼Œä½¿ç”¨è¿™ä¸ªå°±å¯ä»¥å¿«é€Ÿåœ°åœ¨ npm æºé—´åˆ‡
> 
> â

*   å¦‚ä½•å®‰è£…
    

```
npm install -g nrm
```

*   æŸ¥çœ‹å¯é€‰çš„èµ„æº
    

```
nrm ls   *npm ---- https://registry.npmjs.org/cnpm --- http://r.cnpmjs.org/taobao - http://registry.npm.taobao.org/eu ----- http://registry.npmjs.eu/...
```

*   æ·»åŠ ç§æœ‰ä»“åº“é“¾æ¥
    

```
nrm add name http://registry.npm.tree.com/  # ç§æœ‰ä»“åº“é“¾æ¥nrm use name # ä½¿ç”¨æœ¬å€çš„é•œåƒåœ°å€
```

nrm æ›´å¤šç”¨äºå¦‚æœå…¬å¸å†…ç½‘éƒ¨ç½²äº†ç§æœ‰ä»“åº“ï¼Œä¹Ÿå°±æ˜¯æ–¹ä¾¿ç”¨ nrm ä½œæ¥æºåˆ‡æ¢ï¼Œä¹Ÿæœ‰ç›Šäºä¾èµ–çš„ç‰ˆæœ¬ç®¡ç†ï¼Œå¦‚æœä½ æƒ³æ­å»ºè‡ªå·±çš„ç§æœ‰ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ verdaccioï¼Œå¯ä»¥çœ‹è¿™ä¸ªå…·ä½“çš„æ•™ç¨‹ ç‚¹æˆ‘ğŸ‘‡

#### 1.2 å‘å¸ƒ npm åŒ…

> â
> 
> å½“æˆ‘ä»¬æƒ³å‘å¸ƒä¸€ä¸ª npm åŒ…ï¼Œéœ€è¦å®Œæˆä»€ä¹ˆæ ·çš„æµç¨‹å‘¢ï¼Ÿ
> 
> â

*   å…ˆæ³¨å†Œ npm è´¦å· ğŸ”—
    
*   é…ç½® package.json
    

```
{  "name": "kutil",  "version": "1.0.0", #ç‰ˆæœ¬åç§°  "scripts":[], # å¯æ‰§è¡Œçš„è„šæœ¬å‘½ä»¤  "repository": "https://github.com/xxx/xxx.git", #githubä»“åº“åœ°å€  "author": "tree <shuxin_liu@kingdee.com>", #ä½œè€…  "description": "å·¥å…·åŒ…â€œ, #åŒ…çš„è¯´æ˜  "keywords": [    "utils",  ]}
```

*   é…ç½®æ‰“åŒ…æœºåˆ¶
    

> â
> 
> å¦‚æœæ˜¯å·¥å…·ç±»æ‰“åŒ…ï¼Œæ¨èä½¿ç”¨ rollupï¼Œwebpack æ¯”è¾ƒé€‚åˆæ‰“åŒ…ä¸€äº›åº”ç”¨ï¼Œä¾‹å¦‚ SPA æˆ–è€…åŒæ„é¡¹ç›®
> 
> â

*   æ·»åŠ å•å…ƒæµ‹è¯•
    

> â
> 
> ä¼˜è´¨çš„å¼€æºåŒ…ï¼Œéƒ½æœ‰å•å…ƒæµ‹è¯•æ¨¡å—ï¼Œæ¥ä¿è¯åŒ…çš„ç¨³å®šæ€§å’Œä»£ç è´¨é‡ï¼Œå¸¸è§ä¼šæœ‰ build-passing çš„æ ‡è®°ï¼Œæœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥é˜…è¯»æ ‘é…±ä¹‹å‰å†™çš„å‰ç«¯å•å…ƒæµ‹è¯•é‚£äº›äº‹
> 
> â

*   å¼€å‘æ–‡æ¡£ readme.me
    

> â
> 
> readme æ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿç†Ÿæ‚‰ï¼ŒåŒ…æ‹¬å…·ä½“çš„ Api ä»‹ç»ã€ä½¿ç”¨ä¾‹å­ã€é¡¹ç›®ä»‹ç»ç­‰ç­‰ï¼Œè¿˜å¯ä»¥åŠ å…¥åŒ…æ‹¬å•å…ƒæµ‹è¯•è¦†ç›–ç‡ã€ä¸‹è½½é‡ã€è¯ä¹¦ç­‰ç­‰
> 
> â

æœ€åå®Œæˆä¸Šé¢ä¸€ç³»åˆ—æ“ä½œä¹‹åï¼Œåˆ°äº†æœ€ç»ˆçš„å‘å¸ƒç¯èŠ‚

```
npm login # ç™»å½•ä½ ä¸Šé¢æ³¨å†Œçš„npmè´¦å·npm publish # ç™»å½•æˆåŠŸåï¼Œæ‰§è¡Œå‘å¸ƒå‘½ä»¤+ kutil@1.0.0 # å‘å¸ƒæˆåŠŸæ˜¾ç¤ºnpmæŠ¥ååŠåŒ…çš„ç‰ˆæœ¬å·
```

### 2. jenkins

> â
> 
> jenkins ä½œä¸ºä¸€ä¸ªå¯æ‰©å±•çš„è‡ªåŠ¨åŒ–æœåŠ¡å™¨ï¼Œå¯ä»¥ç”¨ä½œç®€å•çš„ CI æœåŠ¡å™¨ï¼Œå…·æœ‰è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ç­‰åŠŸèƒ½ï¼Œç®€è€Œè¨€ä¹‹ï¼Œjenkins å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬æ—¥å¸¸çš„å‰ç«¯é¡¹ç›®ç‰ˆæœ¬æ›´æ–°è¿­ä»£ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ƒè‡ªåŠ¨åŒ–å®Œæˆä¸€ç³»åˆ—çš„æ“ä½œåŒ…æ‹¬ï¼šç¼–è¯‘æ‰“åŒ…å…ƒæµ‹è¯•ã€ä»£ç æ‰«æç­‰ï¼Œå®˜æ–¹æ–‡æ¡£
> 
> â

#### 2.1 å¦‚ä½•å®‰è£…

*   ä¸‹è½½ Jenkins.
    
*   æ‰“å¼€ç»ˆç«¯è¿›å…¥åˆ°ä¸‹è½½ç›®å½•.
    
*   è¿è¡Œå‘½ä»¤ `java -jar jenkins.war --httpPort=8080.`
    
*   æ‰“å¼€æµè§ˆå™¨è¿›å…¥é“¾æ¥ http://localhost:8080.
    
*   æŒ‰ç…§è¯´æ˜å®Œæˆå®‰è£….
    

è¯¦ç»†æµç¨‹å›¾å¯å‚è€ƒ Jenkins+github å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²

#### 2.2 é…åˆå‰ç«¯é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²

> â
> 
> è¿™é‡Œä¸»è¦ä»‹ç» jenkins æµæ°´çº¿é…ç½®çš„ä½¿ç”¨ï¼Œæµæ°´çº¿çš„ä»£ç å®šä¹‰äº†æ•´ä¸ªçš„æ„å»ºè¿‡ç¨‹, ä»–é€šå¸¸åŒ…æ‹¬æ„å»º, æµ‹è¯•å’Œäº¤ä»˜åº”ç”¨ç¨‹åºçš„é˜¶æ®µï¼Œä¸‹é¢æ˜¯è·¯å¾„å’Œä»“åº“çš„é…ç½®
> 
> â

![](https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PC1cQc9Ml1KicnVEcshLSTCJJVM4kBRzWuv5ySP2EKksERxulCEib3TtFg/640?wx_fmt=png)

å›¾ç‰‡ç›¸å…³é…ç½®å¦‚ä¸‹ï¼š

*   SCM: é€‰æ‹© git æˆ–è€… svn ä½œä¸ºä»£ç è§¦å‘å™¨
    
*   è„šæœ¬è·¯å¾„ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º jenkinsfile æ¥ç¼–å†™æµæ°´çº¿
    

ä¸‹é¢ä»‹ç»ä¸€ä¸ªç®€å•ç‰ˆçš„ jenkinsfile çš„æµæ°´çº¿ä»»åŠ¡å†™æ³•ï¼Œå®Œæˆæ•´ä¸ªå‰ç«¯å·¥ç¨‹åŒ–éƒ¨ç½²æ¶‰åŠçš„ç¼–è¯‘æ‰“åŒ…ã€é™æ€æ‰«æã€å•å…ƒæµ‹è¯•ç­‰ç¯èŠ‚

```
def gitUrl = "http://gitlab.****.com/shc/****.git"//GITå…¥å£ï¼ˆéšä¸åŒå·¥ç¨‹æ”¹å˜ï¼‰def gitCred = "***-***-4f00-a926-1848b670d97b"    //GIT èº«ä»½å‡­æ®if ("DEV" == buildType) {    buildScript = "build_development"    try {        node('k8s') {            stage('ä¸‹æ‹‰æºç ') {                   checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: "${gitCred}", url: "${gitUrl}"]]])                 #å¯ç”±ç‰‡æ®µç”Ÿæˆå™¨ç”Ÿæˆï¼Œé€‰æ‹©ç¤ºä¾‹æ­¥éª¤ â€œcheckout:Check out from version controlâ€ï¼Œç”Ÿæˆæµæ°´çº¿è„šæœ¬è·å–            }            checkStatus('ä¸‹æ‹‰æºç ')            stage('ä»£ç æ„å»ºç¼–è¯‘') {                sh "yarn run ${buildScript}"            }            checkStatus('ä»£ç æ„å»ºç¼–è¯‘')            stage('ä»£ç é™æ€æ‰«æ') {                sh 'yarn run lint'            }            checkStatus('ä»£ç é™æ€æ‰«æ')            stage('å•å…ƒæµ‹è¯•') {                 sh 'yarn run unit'            }            checkStatus('å•å…ƒæµ‹è¯•')        }    } catch(Exception e) {           }}
```

å®Œæˆåï¼Œå³å¯æ„å»ºé¡¹ç›®ï¼Œåˆ†é˜¶æ®µå®Œæˆï¼Œé¦–å…ˆæ˜¯ä¸‹æ‹‰æºç ã€ä»£ç æ„å»ºç¼–è¯‘ã€ä»£ç æ‰«æç­‰ç­‰ï¼Œæ‰€æœ‰ç¯èŠ‚æˆåŠŸæ‰ç®—è‡ªåŠ¨åŒ–éƒ¨ç½²æˆåŠŸï¼Œå¦‚ä¸‹æ‰€ç¤º

![](https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCdwCJZHvjHspD1pk9QoetxhuYMHK5L4WKefwVWEILibc6lelnPUtUD3A/640?wx_fmt=png)

### 3.Docker

> â
> 
> Docker æ˜¯ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒå®¹å™¨, å¯ä»¥å°†å¼€å‘ç¯å¢ƒã€ä»£ç ã€é…ç½®æ–‡ä»¶ç­‰ä¸€å¹¶æ‰“åŒ…åˆ°è¿™ä¸ªå®¹å™¨ä¸­, æœ€åå‘å¸ƒåº”ç”¨
> 
> â

#### 3.1 å¦‚ä½•ä½¿ç”¨

> â
> 
> é€šè¿‡å°†éƒ¨ç½²çš„æ“ä½œé›†ä¸­æˆä¸€ä¸ªéƒ¨ç½²è„šæœ¬å®Œæˆä¼ ç»Ÿçš„éƒ¨ç½²æµç¨‹ï¼Œé€šè¿‡åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ docker å®¹å™¨æ¥è¿è¡Œå‰ç«¯åº”ç”¨
> 
> â

å¦‚ä½•å®‰è£…

```
yum install docker-ce
```

é¡¹ç›®ç›®å½•ï¼Œéƒ¨ç½²é¡¹ç›®éœ€è¦å‡†å¤‡ Dockerfile å’Œ nginx.conf(å¦‚æœ nginx ä¸ä½œå®šåˆ¶åŒ–ï¼Œå¯ä»¥ç›´æ¥ç”¨å®˜æ–¹é•œåƒ)

![](https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PChmIuNhcpbOTv0mibmPa9e3lwcNlE1lkEzia3g5Qj5qTPY2kHcpTia643g/640?wx_fmt=png)

#### 3.2 Dockerfile é…ç½®

> â
> 
> dockerfile æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶, ç”¨æ¥è®© docker build å‘½ä»¤æ¸…æ¥šè¿è¡Œé‚£äº›æ“ä½œï¼Œåˆ›å»º dockerfile å¹¶ç¼–å†™ç›¸å…³é…ç½®
> 
> â

```
FROM node:latest as builder WORKDIR /appCOPY package.json RUN npm install   COPY . .RUN npm run buildFROM nginx:latestCOPY nginx.conf /etc/nginxCOPY --from=builder /app/dist  /usr/share/nginx/html//ps: æ¯ä¸€ä¸ªæŒ‡ä»¤çš„å‰ç¼€éƒ½å¿…é¡»æ˜¯å¤§å†™çš„ã€‚
```

*   ADD å’Œ COPYï¼šÂ  å°†æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ° Dockerfile æ„å»ºçš„é•œåƒä¸­
    
*   EXPOSEï¼šÂ æŒ‡å®šè¿è¡Œè¯¥é•œåƒçš„å®¹å™¨ä½¿ç”¨çš„ç«¯å£ï¼Œå¯ä»¥æ˜¯å¤šä¸ªã€‚
    
*   RUN ï¼šæŒ‡ä»¤å‘Šè¯‰ docker åœ¨é•œåƒå†…æ‰§è¡Œå‘½ä»¤
    
*   FROM ï¼šé€šè¿‡ FROM æŒ‡å®šçš„é•œåƒåç§°ï¼Œè¿™ä¸ªé•œåƒç§°ä¹‹ä¸ºåŸºç¡€é•œåƒï¼Œå¿…é¡»ä½äºç¬¬ä¸€æ¡éæ³¨é‡ŠæŒ‡ä»¤
    
*   WORKDIRï¼šÂ åœ¨å®¹å™¨å†…éƒ¨è®¾ç½®å·¥ä½œç›®å½•
    

Nginx.conf é…ç½®å¦‚ä¸‹

```
events {    worker_connections  1024;}http{    server {        listen       80;        server_name  localhost;        location / {            root   /usr/share/nginx/html;            index  index.html index.htm;        }       }}
```

åˆ›å»ºæ–‡ä»¶å¹¶ç¼–å†™åï¼Œç”¨ docker åˆ›å»ºé•œåƒ

#### 3.3 å¦‚ä½•åˆ›å»ºé•œåƒ

> â
> 
> ä½¿ç”¨å½“å‰ç›®å½•çš„ Dockerfile åˆ›å»ºé•œåƒï¼Œæ ‡ç­¾ä¸º frontend
> 
> â

```
docker build -t frontend .
```

*   -t ï¼šæŒ‡å®šè¦åˆ›å»ºçš„ç›®æ ‡é•œåƒ
    
*   . ï¼šDockerfile æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œå¯ä»¥æŒ‡å®š Dockerfile çš„ç»å¯¹è·¯å¾„
    

![](https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCKkCibqcxfpCrQ0Qr18xAvic9dRm8JtU7Wv6pcIXiahV8ZaMzTGZpZicuTw/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCTQup8kuVPUj3gYBM2oibJmQV9v3LXC2YibaBmWGzUMK0pjoOFtFRZI2w/640?wx_fmt=png)

é•œåƒæˆåŠŸç”Ÿæˆ

#### 3.4 æŸ¥çœ‹é•œåƒ

```
docker image ls | grep frontend
```

![](https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCL3Rd1GLk7g0C8dSbvaySlgyn7n7sVYMZib4RdMeNcWszMCxn6TxbLYA/640?wx_fmt=png)

å‡ºç°ç»“æœåˆ™åº”ç”¨é•œåƒ frontend æˆåŠŸåˆ›å»º, ç„¶åæˆ‘ä»¬åŸºäºè¯¥é•œåƒå¯åŠ¨ä¸€ä¸ª Docker å®¹å™¨

#### 4.5 å¦‚ä½•å¯åŠ¨

> â
> 
> ä½¿ç”¨ docker é•œåƒ frontend:latest ä»¥æŒ‡å®š 80 ç«¯å£æ˜ å°„æ¨¡å¼å¯åŠ¨å®¹å™¨, å¹¶å°†å®¹å™¨å‘½åä¸º frontend
> 
> â

```
docker run --name frontend -p 80:80 frontend:latest
```

*   -p: æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼šä¸»æœº (å®¿ä¸») ç«¯å£: å®¹å™¨ç«¯å£ å°†å®¿ä¸»çš„ 80 ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ 80 ç«¯å£
    
*   -name: ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼›
    

å®Œæˆ docker éƒ¨ç½²

docker ä¹Ÿå¯ä»¥é›†æˆåˆ°ä¸Šä¸€èŠ‚è®²çš„ jenkins è‡ªåŠ¨åŒ–éƒ¨ç½²æµæ°´çº¿ä¸­å»

```
stage('éƒ¨ç½²åˆ°å¼€å‘è”è°ƒç¯å¢ƒ') {                echo "auto deploy to test environment"                sh "docker build -t frontend ."                sh "docker run --name frontend -p 80:80 frontend:latest"  }
```

### 4.PM2

> â
> 
> PM2 æ˜¯ node è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥ç®€åŒ–å¾ˆå¤š node åº”ç”¨ç®¡ä¸­ç¹çä»»åŠ¡ï¼Œæ˜¯ Nodejs åº”ç”¨ç¨‹åºå®ˆæŠ¤è¿›ç¨‹å¿…ä¸å¯å°‘çš„é€‰æ‹©ï¼Œæ–¹ä¾¿ç®¡ç†åŸºäº nodejs å¹³å°ä¸‹èƒ½å¤Ÿæœ‰ç‹¬ç«‹è¿è¡Œè®¿é—®çš„ web æœåŠ¡ï¼Œå¦‚ nextjsã€expressã€koa ç­‰å‰ç«¯åº”ç”¨
> 
> â

#### 4.1 å¸¸è§çš„åº”ç”¨åœºæ™¯

*   éƒ¨ç½² node koa2 æˆ– express é¡¹ç›®åº”ç”¨
    
*   éƒ¨ç½² å‰ç«¯ SSRï¼ˆåç«¯æ¸²æŸ“ï¼‰åº”ç”¨ï¼Œå¦‚ nuxt.jsï¼ˆVueï¼‰å’Œ next.js(React) ç­‰æ„å»ºæœåŠ¡ç«¯æ¸²æŸ“åº”ç”¨æ¡†æ¶
    

#### 4.2 å¦‚ä½•ä½¿ç”¨

*   å®‰è£… ï¼š`npm install -g pm2`
    
*   å¯åŠ¨ node é¡¹ç›® : `pm2 start app.js æˆ–è€… pm2 start bin/www`
    
*   åœæ­¢ pm2 æœåŠ¡ï¼š`pm2 stop bin/www`
    
*   åœæ­¢æ‰€æœ‰ pm2 æœåŠ¡: `stop all`
    
*   é‡å¯ pm2 æœåŠ¡: `pm2 restart bin/www`
    
*   pm2 æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼š`pm2 list`
    

å¯åŠ¨åå¦‚ä¸‹æ‰€ç¤º![](https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PC9j1G4h6u3HU8Xt3p8tX5N65ImGxibxdtwPrPibGibBvibpD9Xtm9wbqLRg/640?wx_fmt=png)

#### 4.3 é«˜é˜¶åº”ç”¨

> â
> 
> åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ·»åŠ ä¸€ä¸ª processes.json
> 
> â

```
{ #appsæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸€ä¸ªæ•°ç»„æˆå‘˜å°±æ˜¯å¯¹åº”ä¸€ä¸ªpm2ä¸­è¿è¡Œçš„åº”ç”¨  "apps": [{    "name": "app",  #åç§°    "script": "./", #ç¨‹åºå…¥å£    "cwd": "./",           #åº”ç”¨ç¨‹åºæ‰€åœ¨çš„ç›®å½•    "error_file": "./logs/err.log",#é”™è¯¯è¾“å‡ºæ—¥å¿—    "log_date_format": "YYYY-MM-DD HH:mm Z" #æ—¥æœŸæ ¼å¼  }]}
```

ç»“åˆ packjson è„šæœ¬å‘½ä»¤ï¼Œå¯ä»¥ç”¨ processes æ¥ç®¡ç†å¤šåº”ç”¨

```
"script":{    "pm2":"pm2 start processes.json"}
```

æ›´å¤šå‘½ä»¤å’Œé…ç½®ä¿¡æ¯æŸ¥çœ‹ pm2 æ–‡æ¡£

### 5.Nginx

> â
> 
> Nginx å®ƒæ—¢å¯ä»¥ä½œä¸º Web æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œå…·å¤‡é«˜æ€§èƒ½ã€é«˜å¹¶å‘è¿æ¥ç­‰
> 
> â

#### 5.1 å‰ç«¯ Nginx é‚£äº›äº‹

![](https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib309JpyfsgbGdM4Ergib06PCL6EL0wsMTWxqfsCLsAw2iahQYpo9U0Mcgk0BwUSvbUepver8RFW7K1w/640?wx_fmt=png)

è¯¦ç»†ä¿¡æ¯è¯·çœ‹ä¹‹å‰æ¢³ç†çš„[å‰ç«¯ Nginx é‚£äº›äº‹](http://mp.weixin.qq.com/s?__biz=MjM5OTExNzQ3NQ==&mid=2450958611&idx=1&sn=a4cfe928fd06e93b0da1ce2b602d6e64&chksm=b1225edf8655d7c9fc708c70445b7613f4919dac0d429f5f85d0b05c4d0c98656affd7b6d246&scene=21#wechat_redirect)

#### 5.2 è¡¥å……

*   ç°åº¦å‘å¸ƒ
    

> â
> 
> ç°åº¦å‘å¸ƒå³æ˜¯è®©ä¸€éƒ¨åˆ†äººç»§ç»­ç”¨æ—§ç‰ˆæœ¬çš„äº§å“ Aï¼Œç„¶åä¸€éƒ¨åˆ†ç”¨æˆ·å¼€å§‹ç”¨æ–°ç‰ˆæœ¬ç‰¹å¾çš„äº§å“ Bï¼Œå¦‚æœç”¨æˆ·å¯¹ B æ²¡æœ‰ä»€ä¹ˆé—®é¢˜åé¦ˆï¼Œåˆ™é€æ­¥æ‰©å¤§èŒƒå›´ã€‚ä¸€æ–¹é¢å¯ä»¥ä¿è¯æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šï¼Œè€Œä¸”åœ¨åˆå§‹ç°åº¦çš„æ—¶å€™å°±å¯ä»¥å‘ç°ã€è°ƒæ•´é—®é¢˜ï¼Œä»¥ä¿è¯å…¶å½±å“åº¦
> 
> â

ä¼ ç»Ÿçš„ç°åº¦æ˜¯é€šè¿‡ Nginx åˆ†å‘æµé‡åˆ°æœåŠ¡å™¨ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸‹ç®€å•çš„ç°åº¦è§„åˆ™é…ç½®ï¼Œé€šè¿‡åœ¨ nginx é‡Œé¢é…ç½®è·¯ç”±è§„åˆ™å°±å¥½ï¼Œå¦‚æœæ˜¯è§„åˆ™å¤æ‚çš„è¯, å¯ä»¥ç»“åˆ nginx+lua åšä¸€äº›äº›ç°åº¦çš„ä¸šåŠ¡é€»è¾‘

1. æ ¹æ® Cookie å®ç°ç°åº¦å‘å¸ƒ

> â
> 
> é€šè¿‡è·å– cookie è®¾ç½®çš„ç‰ˆæœ¬å·æ¥åŒºåˆ†
> 
> â

```
upstream test1 {    server 192.168.0.1:8080 max_fails=1 fail_timeout=60;}upstream default {    server 192.168.0.0:8080 max_fails=1 fail_timeout=60;}server {  listen 80;  server_name  www.****.com;  set $group "default";    if ($http_cookie ~* "version=V1"){        set $group test1;    }  location / {                           proxy_pass http://$group;    proxy_set_header   Host             $host;    proxy_set_header   X-Real-IP        $remote_addr;    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;    index  index.html index.htm;  } }
```

2.  æ ¹æ® IP å®ç°ç°åº¦å‘å¸ƒ
    

> â
> 
> é€šè¿‡å†…å¤–ç½‘ IP æ¥åŒºåˆ†
> 
> â

```
upstream test1 {    server 192.168.0.1:8080 max_fails=1 fail_timeout=60;}upstream default {    server 192.168.0.0:8080 max_fails=1 fail_timeout=60;}server {  listen 80;  server_name  www.xxx.com;  set $group default;  if ($remote_addr ~ "10.0.0.110") {      set $group test1;  }location / {                           proxy_pass http://$group;    proxy_set_header   Host             $host;    proxy_set_header   X-Real-IP        $remote_addr;    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;    index  index.html index.htm;  }}
```

#### è¯·ä½ å–æ¯ğŸµ è®°å¾—ä¸‰è¿å“¦ï½  

1. é˜…è¯»å®Œè®°å¾—ç»™ğŸŒ² é…±ç‚¹ä¸ªèµå“¦ï¼Œæœ‰ğŸ‘ æœ‰åŠ¨åŠ›

2. å…³æ³¨å…¬ä¼—å·å‰ç«¯é‚£äº›è¶£äº‹ï¼Œé™ªä½ èŠèŠå‰ç«¯çš„è¶£äº‹

3. æ–‡ç« æ”¶å½•åœ¨ GithubÂ frontendThingsÂ æ„Ÿè°¢ Starâœ¨

![](https://mmbiz.qpic.cn/mmbiz_png/lXoAxSVgJib0hSuGQdexXfrDLwAbZaXG0cegU7IsxgmAlJJpKdJU5iax4ZGlZRa5pMRCRP4Enrkga1axvzoOvrPA/640?wx_fmt=png)