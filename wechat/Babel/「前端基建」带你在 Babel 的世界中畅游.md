> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/nnaELt1ivLvx-Jq2I2Clwg)

`Babel`åœ¨ç›®å‰å‰ç«¯é¢†åŸŸç±»ä¼¼ä¸€åº§å±±ä¸€æ ·çš„å­˜åœ¨ï¼Œä»»ä½•é¡¹ç›®æˆ–å¤šæˆ–å°‘éƒ½æœ‰å®ƒçš„èº«å½±åœ¨æµ®ç°ã€‚

ä¹Ÿè®¸å¯¹äº`Babel`ç»å¤§å¤šæ•°å‰ç«¯å¼€å‘è€…éƒ½æ˜¯å¤„äºä¸€çŸ¥åŠè§£çš„çŠ¶æ€ï¼Œä½†æ˜¯æ— è®ºæ˜¯åœ¨å®é™…ä¸šåŠ¡å¼€å‘ä¸­è¿˜æ˜¯å¯¹äºæˆ‘ä»¬ä¸ªäººæå‡æ¥è¯´ç†Ÿç»ƒæŒæ¡`Babel`ä¸€å®šæ˜¯æ™‹å‡é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆçš„å¿…å¤‡ä¹‹è·¯ã€‚

æ–‡ç« ä¸­æˆ‘ä»¬åªè®² â€œå¹²è´§â€ï¼Œä»åŸç†å‡ºå‘ç»“åˆæ·±å±‚æ¬¡å®è·µå¸¦ä½ é¢†ç•¥`Babel`ä¹‹ç¾ã€‚

æˆ‘ä»¬ä¼šä»`Babel`åŸºç¡€å†…å®¹ä»è€Œæ¸è¿›åˆ°`Babel`æ’ä»¶å¼€å‘è€…çš„ä¸–ç•Œï¼Œä»æ­¤è®©ä½ å¯¹äº`Babel`å¾—å¿ƒåº”æ‰‹ã€‚

æ–‡ä¸­å¤§è‡´ç›®å½•å¦‚ä¸‹:

*   `Babel`æ—¥å¸¸ç”¨æ³•æŒ‡å—
    

*   ä»åŸºç¡€å†…å®¹å‡ºå‘ï¼Œå¸¦ä½ æŒæ¡å¸¸è§çš„`Plugin`å’Œ`Preset`ã€‚
    
*   å‰ç«¯åŸºå»ºé¡¹ç›®ä¸­çš„`Babel`é…ç½®è®²è§£ã€‚
    
*   `Babel`ç›¸å…³`polyfill`å†…å®¹ã€‚
    

*   `Babel`æ’ä»¶å¼€å‘æŒ‡å—
    

*   å¸¦ä½ èµ°è¿›`Babel`çš„ç¼–è¯‘ä¸–ç•Œï¼Œé¢†ç•¥`Babel`èƒŒåçš„åŸç†çŸ¥è¯†ã€‚
    
*   æ‰‹æŠŠæ‰‹å¸¦ä½ å¼€å‘ä¸€æ¬¾å±äºè‡ªå·±çš„`Babel`æ’ä»¶ã€‚
    

ğŸš€ åºŸè¯ä¸å¤šè®²ï¼Œè®©æˆ‘ä»¬å¼€å§‹çœŸæ­£è¿›å…¥`Babel`çš„ä¸–ç•Œã€‚

`Babel`æ—¥å¸¸ç”¨æ³•
===========

é¦–å…ˆæˆ‘ä»¬ä¼šä»åŸºç¡€çš„é…ç½®`Babel`åŠç›¸å…³å†…å®¹å¼€å§‹è®²è§£ã€‚

å¸¸è§`plugin`å’Œ`Preset`
-------------------

é¦–å…ˆæˆ‘ä»¬æ¥è¯´è¯´`Plugin`å’Œ`Preset`çš„åŒºåˆ«å’Œè”ç³»ã€‚

**æ‰€è°“`Preset`å°±æ˜¯ä¸€äº›`Plugin`ç»„æˆçš„åˆé›†**, ä½ å¯ä»¥å°†`Preset`ç†è§£ç§°ä¸ºå°±æ˜¯ä¸€äº›çš„`Plugin`æ•´åˆç§°ä¸ºçš„ä¸€ä¸ªåŒ…ã€‚

### å¸¸è§`Preset`

æ–‡ç« ä¸­åˆ—ä¸¾äº†ä¸‰ä¸ªæœ€å¸¸ç”¨çš„`Preset`ï¼Œæ›´å¤šçš„`Prest`ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥é˜… [1]ã€‚

#### `babel-preset-env`

`@babel/preset-env`æ˜¯ä¸€ä¸ªæ™ºèƒ½é¢„è®¾ï¼Œå®ƒå¯ä»¥å°†æˆ‘ä»¬çš„é«˜ç‰ˆæœ¬`JavaScript`ä»£ç è¿›è¡Œè½¬è¯‘æ ¹æ®å†…ç½®çš„è§„åˆ™è½¬è¯‘æˆä¸ºä½ç‰ˆæœ¬çš„`javascript`ä»£ç ã€‚

`preset-env`å†…éƒ¨é›†æˆäº†ç»å¤§å¤šæ•°`plugin`ï¼ˆ`State > 3`ï¼‰çš„è½¬è¯‘æ’ä»¶ï¼Œå®ƒä¼šæ ¹æ®å¯¹åº”çš„å‚æ•°è¿›è¡Œä»£ç è½¬è¯‘ã€‚

å…·ä½“çš„å‚æ•°é…ç½®ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ° [2]ã€‚

> `@babel/preset-env`ä¸ä¼šåŒ…å«ä»»ä½•ä½äº Stage 3 çš„ JavaScript è¯­æ³•ææ¡ˆã€‚å¦‚æœéœ€è¦å…¼å®¹ä½äº`Stage 3`é˜¶æ®µçš„è¯­æ³•åˆ™éœ€è¦é¢å¤–å¼•å…¥å¯¹åº”çš„`Plugin`è¿›è¡Œå…¼å®¹ã€‚

> éœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯`babel-preset-env`ä»…ä»…é’ˆå¯¹è¯­æ³•é˜¶æ®µçš„è½¬è¯‘ï¼Œæ¯”å¦‚è½¬è¯‘ç®­å¤´å‡½æ•°ï¼Œ`const/let`è¯­æ³•ã€‚é’ˆå¯¹ä¸€äº›`Api`æˆ–è€…`Es 6`å†…ç½®æ¨¡å—çš„`polyfill`ï¼Œ`preset-env`æ˜¯æ— æ³•è¿›è¡Œè½¬è¯‘çš„ã€‚è¿™å—å†…å®¹æˆ‘ä»¬ä¼šåœ¨ä¹‹åçš„`polyfill`ä¸­ä¸ºå¤§å®¶è¿›è¡Œè¯¦ç»†è®²è§£ã€‚

#### `babel-preset-react`

é€šå¸¸æˆ‘ä»¬åœ¨ä½¿ç”¨`React`ä¸­çš„`jsx`æ—¶ï¼Œç›¸ä¿¡å¤§å®¶éƒ½æ˜ç™½å®è´¨ä¸Š`jsx`æœ€ç»ˆä¼šè¢«ç¼–è¯‘ç§°ä¸º`React.createElement()`æ–¹æ³•ã€‚

`babel-preset-react`è¿™ä¸ªé¢„è®¾èµ·åˆ°çš„å°±æ˜¯å°†`jsx`è¿›è¡Œè½¬è¯‘çš„ä½œç”¨ã€‚

#### `babel-preset-typescript`

å¯¹äº`TypeScript`ä»£ç ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å»ç¼–è¯‘`TypeScript`ä»£ç æˆä¸º`JavaScript`ä»£ç ã€‚

1.  ä½¿ç”¨`tsc`å‘½ä»¤ï¼Œç»“åˆ`cli`å‘½ä»¤è¡Œå‚æ•°æ–¹å¼æˆ–è€…`tsconfig`é…ç½®æ–‡ä»¶è¿›è¡Œç¼–è¯‘`ts`ä»£ç ã€‚
    
2.  ä½¿ç”¨`babel`ï¼Œé€šè¿‡`babel-preset-typescript`ä»£ç è¿›è¡Œç¼–è¯‘`ts`ä»£ç ã€‚
    

### å¸¸è§ Plugin

`Babel`å®˜ç½‘åˆ—ä¸¾å‡ºäº†ä¸€ä»½éå¸¸è¯¦å°½çš„ Plugin List[3]ã€‚

å…³äºå¸¸è§çš„`Plugin`å…¶å®å¤§å¤šæ•°éƒ½é›†æˆåœ¨äº†`babel-preset-env`ä¸­ï¼Œå½“ä½ å‘ç°ä½ çš„é¡¹ç›®ä¸­å¹¶ä¸èƒ½æ”¯æŒæœ€æ–°çš„`js`è¯­æ³•æ—¶ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥æŸ¥é˜…å¯¹åº”çš„`Babel Plugin List`æ‰¾åˆ°å¯¹åº”çš„è¯­æ³•æ’ä»¶æ·»åŠ è¿›å…¥`babel`é…ç½®ã€‚

> åŒæ—¶è¿˜æœ‰ä¸€äº›ä¸å¸¸ç”¨çš„`packages`ï¼Œæ¯”å¦‚`@babel/register`ï¼šå®ƒä¼šæ”¹å†™`require`å‘½ä»¤ï¼Œä¸ºå®ƒåŠ ä¸Šä¸€ä¸ªé’©å­ã€‚æ­¤åï¼Œæ¯å½“ä½¿ç”¨`require`åŠ è½½`.js`ã€`.jsx`ã€`.es`å’Œ`.es6`åç¼€åçš„æ–‡ä»¶ï¼Œå°±ä¼šå…ˆç”¨ Babel è¿›è¡Œè½¬ç ã€‚

> è¿™äº›åŒ…æ—¥å¸¸ä¸­ä¸æ˜¯ç‰¹åˆ«å¸¸ç”¨ï¼Œå¦‚æœæœ‰åŒå­¦æœ‰ç›¸å…³ç¼–è¯‘ç›¸å…³éœ€æ±‚å®Œå…¨å¯ä»¥å»`babel`å®˜ç½‘æŸ¥é˜…ã€‚å¦‚æœå®˜ç½‘ä¸å­˜åœ¨ç°æˆçš„`plugin/package`ï¼Œåˆ«æ‹…å¿ƒï¼æˆ‘ä»¬åŒæ—¶ä¹Ÿä¼šåœ¨ä¹‹åæ‰‹æŠŠæ‰‹æ•™å¤§å®¶`babel`æ’ä»¶çš„å¼€å‘ã€‚

å…¶ä¸­æœ€å¸¸è§çš„`@babel/plugin-transform-runtime`æˆ‘ä»¬ä¼šåœ¨ä¸‹é¢çš„`Polyfill`è¿›è¡Œè¯¦ç»†çš„è®²è§£ã€‚

å‰ç«¯åŸºå»ºä¸­çš„`Babel`é…ç½®è¯¦è§£
-----------------

æ¥ä¸‹é‡Œæˆ‘ä»¬èŠèŠå‰ç«¯é¡¹ç›®æ„å»ºä¸­ç›¸å…³çš„`babel`ç›¸å…³é…ç½®ã€‚

å…³äºå‰ç«¯æ„å»ºå·¥å…·ï¼Œæ— è·¯ä½ ä½¿ç”¨çš„æ˜¯`webapack`è¿˜æ˜¯`rollup`åˆæˆ–æ˜¯ä»»ä½•æ„å»ºæ‰“åŒ…å·¥å…·ï¼Œå†…éƒ¨éƒ½ç¦»ä¸å¼€`Babel`ç›¸å…³é…ç½®ã€‚

> è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸šåŠ¡ä¸­æœ€å¸¸ç”¨çš„`webpack`ä¸¾ä¾‹ï¼Œå…¶ä»–æ„å»ºå·¥å…·åœ¨ä½¿ç”¨æ–¹é¢åªæ˜¯å¼•å…¥çš„åŒ…ä¸åŒï¼Œ`Babel`é…ç½®åŸç†æ˜¯ç›¸é€šçš„ã€‚

å…³äº`WebPack`ä¸­æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„`babel`ç›¸å…³é…ç½®ä¸»è¦æ¶‰åŠä»¥ä¸‹ä¸‰ä¸ªç›¸å…³æ’ä»¶:

*   `babel-loader`
    
*   `babel-core`
    
*   `babel-preset-env`
    

ä¹Ÿè®¸ä½ ç»å¸¸åœ¨é¡¹ç›®æ­å»ºè¿‡ç¨‹ä¸­è§åˆ°ä»–ä»¬ï¼Œè¿™é‡Œæˆ‘ä»¬å°†é€æ­¥ä½¿ç”¨ä¸€æ®µä¼ªä»£ç æ¥è®²è§£ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«å’Œè”ç³»ã€‚

é¦–å…ˆæˆ‘ä»¬éœ€è¦æ¸…æ¥šåœ¨ **`webpack`ä¸­`loader`çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—æˆ‘ä»¬çš„æºä»£ç ä½œä¸ºå…¥å‚åŒæ—¶è¿”å›æ–°çš„å†…å®¹ã€‚**

### `babel-loader`

æ‰€ä»¥`babel-loader`çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬åŒ¹é…åˆ°å¯¹åº”çš„`jsx?/tsx?`çš„æ–‡ä»¶äº¤ç»™`babel-loader`:

```
/**Â *Â Â *Â @paramÂ sourceCodeÂ æºä»£ç å†…å®¹Â *Â @paramÂ optionsÂ babel-loaderç›¸å…³å‚æ•°Â *Â @returnsÂ å¤„ç†åçš„ä»£ç Â */functionÂ babelLoaderÂ (sourceCode,options)Â {Â Â //Â ..Â Â returnÂ targetCode}
```

> å…³äº`options`ï¼Œ`babel-loader`æ”¯æŒç›´æ¥é€šè¿‡`loader`çš„å‚æ•°å½¢å¼æ³¨å…¥ï¼ŒåŒæ—¶ä¹Ÿåœ¨`loader`å‡½æ•°å†…éƒ¨é€šè¿‡è¯»å–`.babelrc/babel.config.js/`babel.config.json`` ç­‰æ–‡ä»¶æ³¨å…¥é…ç½®ã€‚

> å…³äº`babel`åœ¨å„ç§åŸºå»ºé¡¹ç›®çš„åˆå§‹åŒ–æ–¹å¼ä½ åœ¨å¯ä»¥åœ¨è¿™é‡ŒæŸ¥é˜… [4]ã€‚

### `babel-core`

æˆ‘ä»¬è®²åˆ°äº†`babel-loader`ä»…ä»…æ˜¯è¯†åˆ«åŒ¹é…æ–‡ä»¶å’Œæ¥å—å¯¹åº”å‚æ•°çš„å‡½æ•°ï¼Œé‚£ä¹ˆ`babel`åœ¨ç¼–è¯‘ä»£ç è¿‡ç¨‹ä¸­æ ¸å¿ƒçš„åº“å°±æ˜¯`@babel/core`è¿™ä¸ªåº“ã€‚

`babel-core`æ˜¯`babel`æœ€æ ¸å¿ƒçš„ä¸€ä¸ªç¼–è¯‘åº“ï¼Œä»–å¯ä»¥å°†æˆ‘ä»¬çš„ä»£ç è¿›è¡Œ**è¯æ³•åˆ†æ -- è¯­æ³•åˆ†æ -- è¯­ä¹‰åˆ†æ**è¿‡ç¨‹ä»è€Œç”Ÿæˆ`AST`æŠ½è±¡è¯­æ³•æ ‘ï¼Œä»è€Œå¯¹äº â€œè¿™æ£µæ ‘â€ çš„æ“ä½œä¹‹åå†é€šè¿‡ç¼–è¯‘ç§°ä¸ºæ–°çš„ä»£ç ã€‚

> `babel-core`å…¶å®ç›¸å½“äº`@babel/parse`å’Œ`@babel/generator`è¿™ä¸¤ä¸ªåŒ…çš„åˆä½“ï¼Œæ¥è§¦è¿‡`js`ç¼–è¯‘çš„åŒå­¦å¯èƒ½æœ‰äº†è§£`esprima`å’Œ`escodegen`è¿™ä¸¤ä¸ªåº“ï¼Œä½ å¯ä»¥å°†`babel-core`çš„ä½œç”¨ç†è§£ç§°ä¸ºè¿™ä¸¤ä¸ªåº“çš„åˆä½“ã€‚

`babel-core`é€šè¿‡`transform`æ–¹æ³•å°†æˆ‘ä»¬çš„ä»£ç è¿›è¡Œç¼–è¯‘ã€‚

å…³äº`babel-core`ä¸­çš„ç¼–è¯‘æ–¹æ³•å…¶å®æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ç›´æ¥æ¥å—å­—ç¬¦ä¸²å½¢å¼çš„`transform`æ–¹æ³•æˆ–è€…æ¥å—`js`æ–‡ä»¶è·¯å¾„çš„`transformFile`æ–¹æ³•è¿›è¡Œæ–‡ä»¶æ•´ä½“ç¼–è¯‘ã€‚

åŒæ—¶å®ƒè¿˜æ”¯æŒåŒæ­¥ä»¥åŠå¼‚æ­¥çš„æ–¹æ³•, å…·ä½“æ–¹æ³•ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ° [5]ã€‚

å…³äº`babel-core`å†…éƒ¨çš„ç¼–è¯‘ä½¿ç”¨è§„åˆ™ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¹‹åçš„æ’ä»¶ç« èŠ‚ä¸­è¯¦ç»†è®²åˆ°ã€‚

æ¥ä¸‹æ¥è®©æˆ‘ä»¬å®Œå–„å¯¹åº”çš„`babel-loader`å‡½æ•°:

```
constÂ coreÂ =Â require('@babel/core')/**Â *Â Â *Â @paramÂ sourceCodeÂ æºä»£ç å†…å®¹Â *Â @paramÂ optionsÂ babel-loaderç›¸å…³å‚æ•°Â *Â @returnsÂ å¤„ç†åçš„ä»£ç Â */functionÂ babelLoaderÂ (sourceCode,options)Â {Â Â //Â é€šè¿‡transformæ–¹æ³•ç¼–è¯‘ä¼ å…¥çš„æºä»£ç Â Â core.transform(sourceCode)Â Â returnÂ targetCode}
```

è¿™é‡Œæˆ‘ä»¬åœ¨`babel-loader`ä¸­è°ƒç”¨äº†`babel-core`è¿™ä¸ªåº“è¿›è¡Œäº†ä»£ç çš„ç¼–è¯‘ä½œç”¨ã€‚

### `babel-preset-env`

ä¸Šè¾¹æˆ‘ä»¬è¯´åˆ°`babel-loader`æœ¬è´¨æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒåœ¨å†…éƒ¨é€šè¿‡`babel/core`è¿™ä¸ªæ ¸å¿ƒåŒ…è¿›è¡Œ`JavaScript`ä»£ç çš„è½¬è¯‘ã€‚

ä½†æ˜¯é’ˆå¯¹ä»£ç çš„è½¬è¯‘**æˆ‘ä»¬éœ€è¦å‘Šè¯‰`babel`ä»¥ä»€ä¹ˆæ ·çš„è§„åˆ™è¿›è¡Œè½¬åŒ–**ï¼Œæ¯”å¦‚æˆ‘éœ€è¦å‘Šè¯‰`babel`ï¼šâ€œå˜¿ï¼Œbabelã€‚å°†æˆ‘çš„è¿™æ®µä»£ç è½¬åŒ–ç§°ä¸º EcmaScript 5 ç‰ˆæœ¬çš„å†…å®¹ï¼â€ã€‚

æ­¤æ—¶`babel-preset-env`åœ¨è¿™é‡Œå……å½“çš„å°±æ˜¯è¿™ä¸ªä½œç”¨ï¼š**å‘Šè¯‰`babel`æˆ‘éœ€è¦ä»¥ä¸ºä»€ä¹ˆæ ·çš„è§„åˆ™è¿›è¡Œä»£ç è½¬ç§»**ã€‚

```
constÂ coreÂ =Â require('@babel/core');/**Â *Â *Â @paramÂ sourceCodeÂ æºä»£ç å†…å®¹Â *Â @paramÂ optionsÂ babel-loaderç›¸å…³å‚æ•°Â *Â @returnsÂ å¤„ç†åçš„ä»£ç Â */functionÂ babelLoader(sourceCode,Â options)Â {Â Â //Â é€šè¿‡transformæ–¹æ³•ç¼–è¯‘ä¼ å…¥çš„æºä»£ç Â Â core.transform(sourceCode,Â {Â Â Â Â presets:Â ['babel-preset-env'],Â Â Â Â plugins:Â [...]Â Â });Â Â returnÂ targetCode;}
```

> è¿™é‡Œ`plugin`å’Œ`prest`å…¶å®æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘å°†`plugin`ç›´æ¥æ”¾åœ¨ä»£ç ä¸­äº†ã€‚åŒç†ä¸€äº›å…¶ä»–çš„`preset`æˆ–è€…`plugin`ä¹Ÿæ˜¯å‘æŒ¥è¿™æ ·çš„ä½œç”¨ã€‚

å…³äº`babel`çš„åŸºç¡€åŸºå»ºé…ç½®æˆ‘ç›¸ä¿¡è®²åˆ°è¿™é‡Œå¤§å®¶å·²ç»æ˜ç™½äº†ä»–ä»¬å¯¹åº”çš„èŒè´£å’ŒåŸºç¡€åŸç†ï¼Œå¦‚æœè¿˜æœ‰å…¶ä»–é…ç½®æ–¹é¢çš„é—®é¢˜å¯ä»¥æŸ¥é˜…`babel`æ–‡æ¡£æˆ–è€…æŸ¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç«  React-Webpack5-TypeScript æ‰“é€ å·¥ç¨‹åŒ–å¤šé¡µé¢åº”ç”¨ [6]ã€‚

### `Babel`ç›¸å…³`polyfill`å†…å®¹

#### ä½•è°“`polyfill`

å…³äº`polyfill`ï¼Œæˆ‘ä»¬å…ˆæ¥è§£é‡Šä¸‹ä½•è°“`polyfill`ã€‚

é¦–å…ˆæˆ‘ä»¬æ¥ç†æ¸…æ¥šè¿™ä¸‰ä¸ªæ¦‚å¿µ:

*   æœ€æ–°`ES`è¯­æ³•ï¼Œæ¯”å¦‚ï¼šç®­å¤´å‡½æ•°ï¼Œ`let/const`ã€‚
    
*   æœ€æ–°`ES Api`ï¼Œæ¯”å¦‚`Promise`
    
*   æœ€æ–°`ES`å®ä¾‹ / é™æ€æ–¹æ³•ï¼Œæ¯”å¦‚`String.prototype.include`
    

`babel-prest-env`ä»…ä»…åªä¼šè½¬åŒ–æœ€æ–°çš„`es`è¯­æ³•ï¼Œå¹¶ä¸ä¼šè½¬åŒ–å¯¹åº”çš„`Api`å’Œå®ä¾‹æ–¹æ³•, æ¯”å¦‚è¯´`ES 6`ä¸­çš„`Array.from`é™æ€æ–¹æ³•ã€‚`babel`æ˜¯ä¸ä¼šè½¬è¯‘è¿™ä¸ªæ–¹æ³•çš„ï¼Œå¦‚æœæƒ³åœ¨ä½ç‰ˆæœ¬æµè§ˆå™¨ä¸­è¯†åˆ«å¹¶ä¸”è¿è¡Œ`Array.from`æ–¹æ³•è¾¾åˆ°æˆ‘ä»¬çš„é¢„æœŸå°±éœ€è¦é¢å¤–å¼•å…¥`polyfill`è¿›è¡Œåœ¨`Array`ä¸Šæ·»åŠ å®ç°è¿™ä¸ªæ–¹æ³•ã€‚

å…¶å®å¯ä»¥ç¨å¾®ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œ**è¯­æ³•å±‚é¢çš„è½¬åŒ–`preset-env`å®Œå…¨å¯ä»¥èƒœä»»ã€‚ä½†æ˜¯ä¸€äº›å†…ç½®æ–¹æ³•æ¨¡å—ï¼Œä»…ä»…é€šè¿‡`preset-env`çš„è¯­æ³•è½¬åŒ–æ˜¯æ— æ³•è¿›è¡Œè¯†åˆ«è½¬åŒ–çš„ï¼Œæ‰€ä»¥å°±éœ€è¦ä¸€ç³»åˆ—ç±»ä¼¼â€ å«ç‰‡ â€œçš„å·¥å…·è¿›è¡Œè¡¥å……å®ç°è¿™éƒ¨åˆ†å†…å®¹çš„ä½ç‰ˆæœ¬ä»£ç å®ç°ã€‚è¿™å°±æ˜¯æ‰€è°“çš„`polyfill`çš„ä½œç”¨ï¼Œ**

é’ˆå¯¹äº`polyfill`æ–¹æ³•çš„å†…å®¹ï¼Œ`babel`ä¸­æ¶‰åŠä¸¤ä¸ªæ–¹é¢æ¥è§£å†³ï¼š

*   `@babel/polyfill`
    
*   `@babel/runtime`
    
*   `@babel/plugin-transform-runtime`
    

æˆ‘ä»¬ç†æ¸…äº†ä½•è°“`polyfill`ä»¥åŠ`polyfill`çš„ä½œç”¨å’Œå«ä¹‰åï¼Œè®©æˆ‘ä»¬æ¥é€ä¸ªå‡»ç ´è¿™ä¸¤ä¸ª`babel`åŒ…å¯¹åº”çš„ä½¿ç”¨æ–¹å¼å’ŒåŒºåˆ«å§ã€‚

#### `@babel/polyfill`

é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬ä¸€ç§å®ç°`polyfill`çš„æ–¹å¼ï¼š

##### `@babel/polyfill`ä»‹ç»

é€šè¿‡ babelPolyfill[7] é€šè¿‡å¾€å…¨å±€å¯¹è±¡ä¸Šæ·»åŠ å±æ€§ä»¥åŠç›´æ¥ä¿®æ”¹å†…ç½®å¯¹è±¡çš„`Prototype`ä¸Šæ·»åŠ æ–¹æ³•å®ç°`polyfill`ã€‚

æ¯”å¦‚è¯´æˆ‘ä»¬éœ€è¦æ”¯æŒ`String.prototype.include`ï¼Œåœ¨å¼•å…¥`babelPolyfill`è¿™ä¸ªåŒ…ä¹‹åï¼Œå®ƒä¼šåœ¨å…¨å±€`String`çš„åŸå‹å¯¹è±¡ä¸Šæ·»åŠ `include`æ–¹æ³•ä»è€Œæ”¯æŒæˆ‘ä»¬çš„`Js Api`ã€‚

æˆ‘ä»¬è¯´åˆ°è¿™ç§æ–¹å¼æœ¬è´¨ä¸Šæ˜¯å¾€å…¨å±€å¯¹è±¡ / å†…ç½®å¯¹è±¡ä¸ŠæŒ‚è½½å±æ€§ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼éš¾å…ä¼šé€ æˆå…¨å±€æ±¡æŸ“ã€‚

##### åº”ç”¨`@babel/polyfill`

åœ¨`babel-preset-env`ä¸­å­˜åœ¨ä¸€ä¸ª`useBuiltIns`å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å†³å®šäº†å¦‚ä½•åœ¨`preset-env`ä¸­ä½¿ç”¨`@babel/polyfill`ã€‚

```
{Â Â Â Â "presets":Â [Â Â Â Â Â Â Â Â ["@babel/preset-env",Â {Â Â Â Â Â Â Â Â Â Â Â Â "useBuiltIns":Â falseÂ Â Â Â Â Â Â Â }]Â Â Â Â ]}
```

*   `useBuiltIns`--`"usage"`|Â `"entry"`|Â `false`
    

###### `false`

å½“æˆ‘ä»¬ä½¿ç”¨`preset-env`ä¼ å…¥`useBuiltIns`å‚æ•°æ—¶å€™ï¼Œé»˜è®¤ä¸º`false`ã€‚å®ƒè¡¨ç¤ºä»…ä»…ä¼šè½¬åŒ–æœ€æ–°çš„`ES`è¯­æ³•ï¼Œå¹¶ä¸ä¼šè½¬åŒ–ä»»ä½•`Api`å’Œæ–¹æ³•ã€‚

###### `entry`

å½“ä¼ å…¥`entry`æ—¶ï¼Œéœ€è¦æˆ‘ä»¬åœ¨é¡¹ç›®å…¥å£æ–‡ä»¶ä¸­æ‰‹åŠ¨å¼•å…¥ä¸€æ¬¡`core-js`ï¼Œå®ƒä¼šæ ¹æ®æˆ‘ä»¬é…ç½®çš„æµè§ˆå™¨å…¼å®¹æ€§åˆ—è¡¨ (`browserList`) ç„¶å**å…¨é‡**å¼•å…¥ä¸å…¼å®¹çš„`polyfill`ã€‚

> Tips: åœ¨`Babel7.4ã€‚0`ä¹‹åï¼Œ`@babel/polyfill`è¢«åºŸå¼ƒå®ƒå˜æˆå¦å¤–ä¸¤ä¸ªåŒ…çš„é›†æˆã€‚`"core-js/stable"; "regenerator-runtime/runtime";`ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å˜åŒ– [8]ï¼Œä½†æ˜¯ä»–ä»¬çš„ä½¿ç”¨æ–¹å¼æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯åœ¨å…¥å£æ–‡ä»¶ä¸­å¼•å…¥çš„åŒ…ä¸åŒäº†ã€‚

> æµè§ˆå™¨å…¼å®¹æ€§åˆ—è¡¨é…ç½®æ–¹å¼ç®€ä»‹ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ° [9]ã€‚

```
//Â é¡¹ç›®å…¥å£æ–‡ä»¶ä¸­éœ€è¦é¢å¤–å¼•å…¥polyfill//Â core-jsÂ 2.0ä¸­æ˜¯ä½¿ç”¨"@babel/polyfill"Â core-js3.0ç‰ˆæœ¬ä¸­å˜åŒ–æˆä¸ºäº†ä¸Šè¾¹ä¸¤ä¸ªåŒ…importÂ "@babel/polyfill"//Â babel{Â Â Â Â "presets":Â [Â Â Â Â Â Â Â Â ["@babel/preset-env",Â {Â Â Â Â Â Â Â Â Â Â Â Â "useBuiltIns":Â "entry"Â Â Â Â Â Â Â Â }]Â Â Â Â ]}
```

> åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨`useBuiltIns:entry/usage`æ—¶ï¼Œéœ€è¦é¢å¤–æŒ‡å®š`core-js`è¿™ä¸ªå‚æ•°ã€‚é»˜è®¤ä¸ºä½¿ç”¨`core-js 2.0`ï¼Œæ‰€è°“çš„`core-js`å°±æ˜¯æˆ‘ä»¬ä¸Šæ–‡è®²åˆ°çš„ â€œå«ç‰‡â€ çš„å®ç°ã€‚å®ƒä¼šå®ç°ä¸€ç³»åˆ—å†…ç½®æ–¹æ³•æˆ–è€…`Promise`ç­‰`Api`ã€‚

> `core-js 2.0`ç‰ˆæœ¬æ˜¯è·Ÿéš`preset-env`ä¸€èµ·å®‰è£…çš„ï¼Œä¸éœ€è¦å•ç‹¬å®‰è£…å“¦ï½

###### `usage`

ä¸Šè¾¹æˆ‘ä»¬è¯´åˆ°é…ç½®ä¸º`entry`æ—¶ï¼Œ`perset-env`ä¼šåŸºäºæˆ‘ä»¬çš„æµè§ˆå™¨å…¼å®¹åˆ—è¡¨è¿›è¡Œå…¨é‡å¼•å…¥`polyfill`ã€‚æ‰€è°“çš„å…¨é‡å¼•å…¥æ¯”å¦‚è¯´æˆ‘ä»¬ä»£ç ä¸­ä»…ä»…ä½¿ç”¨äº†`Array.from`è¿™ä¸ªæ–¹æ³•ã€‚ä½†æ˜¯`polyfill`å¹¶ä¸ä»…ä»…ä¼šå¼•å…¥`Array.from`ï¼ŒåŒæ—¶ä¹Ÿä¼šå¼•å…¥`Promise`ã€`Array.prototype.include`ç­‰å…¶ä»–å¹¶æœªä½¿ç”¨åˆ°çš„æ–¹æ³•ã€‚è¿™å°±ä¼šé€ æˆåŒ…ä¸­å¼•å…¥çš„ä½“ç§¯å¤ªå¤§äº†ã€‚

æ­¤æ—¶å°±å¼•å…¥å‡ºäº†æˆ‘ä»¬çš„`useBuintIns:usage`é…ç½®ã€‚

å½“æˆ‘ä»¬é…ç½®`useBuintIns:usage`æ—¶ï¼Œä¼šæ ¹æ®é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œä»¥åŠä»£ç ä¸­ **ä½¿ç”¨åˆ°çš„`Api` è¿›è¡Œå¼•å…¥`polyfill`æŒ‰éœ€æ·»åŠ ã€‚**

å½“ä½¿ç”¨`usage`æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦é¢å¤–åœ¨é¡¹ç›®å…¥å£ä¸­å¼•å…¥`polyfill`äº†ï¼Œå®ƒä¼šæ ¹æ®æˆ‘ä»¬é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„è¿›è¡ŒæŒ‰éœ€å¼•å…¥ã€‚

```
{Â Â Â Â "presets":Â [Â Â Â Â Â Â Â Â ["@babel/preset-env",Â {Â Â Â Â Â Â Â Â Â Â Â Â "useBuiltIns":Â "usage",Â Â Â Â Â Â Â Â Â Â Â Â "core-js":Â 3Â Â Â Â Â Â Â Â }]Â Â Â Â ]}
```

###### å…³äº`usage`å’Œ`entry`å­˜åœ¨ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æœ¬è´¨ä¸Šçš„åŒºåˆ«ã€‚

æˆ‘ä»¬ä»¥é¡¹ç›®ä¸­å¼•å…¥`Promise`ä¸ºä¾‹ã€‚

å½“æˆ‘ä»¬é…ç½®`useBuintInts:entry`æ—¶ï¼Œä»…ä»…ä¼šåœ¨å…¥å£æ–‡ä»¶å…¨é‡å¼•å…¥ä¸€æ¬¡`polyfill`ã€‚ä½ å¯ä»¥è¿™æ ·ç†è§£:

```
//Â å½“ä½¿ç”¨entryé…ç½®æ—¶...//Â ä¸€ç³»åˆ—å®ç°polyfillçš„æ–¹æ³•global.PromiseÂ =Â promise//Â å…¶ä»–æ–‡ä»¶ä½¿ç”¨æ—¶constÂ aÂ =Â newÂ Promise()
```

è€Œå½“æˆ‘ä»¬ä½¿ç”¨`useBuintIns:usage`æ—¶ï¼Œ`preset-env`åªèƒ½åŸºäºå„ä¸ªæ¨¡å—å»åˆ†æå®ƒä»¬ä½¿ç”¨åˆ°çš„`polyfill`ä»è€Œè¿›å…¥å¼•å…¥ã€‚

`preset-env`ä¼šå¸®åŠ©æˆ‘ä»¬æ™ºèƒ½åŒ–çš„åœ¨éœ€è¦çš„åœ°æ–¹å¼•å…¥ï¼Œæ¯”å¦‚:

```
//Â a.Â jsÂ ä¸­importÂ "core-js/modules/es.promise";...
```

```
//Â b.jsä¸­importÂ "core-js/modules/es.promise";...
```

*   åœ¨`usage`æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬å­˜åœ¨å¾ˆå¤šä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆæ— ç–‘ä¼šå¤šå‡ºå¾ˆå¤šå†—ä½™ä»£ç  (`import`è¯­æ³•)ã€‚
    
*   åŒæ ·åœ¨ä½¿ç”¨`usage`æ—¶å› ä¸ºæ˜¯æ¨¡å—å†…éƒ¨å±€éƒ¨å¼•å…¥`polyfill`æ‰€ä»¥å¹¶ä¸ä¼šæ±¡æŸ“å…¨å±€å˜é‡ï¼Œè€Œ`entry`æ˜¯æŒ‚è½½åœ¨å…¨å±€ä¸­æ‰€ä»¥ä¼šæ±¡æŸ“å…¨å±€å˜é‡ã€‚
    

`usageBuintIns`ä¸åŒå‚æ•°åˆ†åˆ«æœ‰ä¸åŒåœºæ™¯çš„é€‚åº”åº¦ï¼Œå…·ä½“å‚æ•°ä½¿ç”¨åœºæ™¯è¿˜éœ€è¦å¤§å®¶ç»“åˆè‡ªå·±çš„é¡¹ç›®å®é™…æƒ…å†µæ‰¾åˆ°æœ€ä½³æ–¹å¼ã€‚

#### `@babel/runtime`

ä¸Šè¾¹æˆ‘ä»¬è®²åˆ°`@babel/polyfill`æ˜¯å­˜åœ¨æ±¡æŸ“å…¨å±€å˜é‡çš„å‰¯ä½œç”¨ï¼Œåœ¨å®ç°`polyfill`æ—¶`Babel`è¿˜æä¾›äº†å¦å¤–ä¸€ç§æ–¹å¼å»è®©æˆ‘ä»¬å®ç°è¿™åŠŸèƒ½ï¼Œé‚£å°±æ˜¯`@babel/runtime`ã€‚

ç®€å•æ¥è®²ï¼Œ`@babel/runtime`æ›´åƒæ˜¯ä¸€ç§**æŒ‰éœ€åŠ è½½çš„è§£å†³æ–¹æ¡ˆ**ï¼Œæ¯”å¦‚å“ªé‡Œéœ€è¦ä½¿ç”¨åˆ°`Promise`ï¼Œ`@babel/runtime`å°±ä¼šåœ¨ä»–çš„æ–‡ä»¶é¡¶éƒ¨æ·»åŠ 

`import promise from 'babel-runtime/core-js/promise'`ã€‚

åŒæ—¶ä¸Šè¾¹æˆ‘ä»¬è®²åˆ°å¯¹äº`preset-env`çš„`useBuintIns`é…ç½®é¡¹ï¼Œæˆ‘ä»¬çš„`polyfill`æ˜¯`preset-env`å¸®æˆ‘ä»¬æ™ºèƒ½å¼•å…¥ã€‚

è€Œ`babel-runtime`åˆ™ä¼šå°†å¼•å…¥æ–¹å¼ç”±æ™ºèƒ½å®Œå…¨äº¤ç”±æˆ‘ä»¬è‡ªå·±ï¼Œæˆ‘ä»¬éœ€è¦ä»€ä¹ˆè‡ªå·±å¼•å…¥ä»€ä¹ˆã€‚

å®ƒçš„ç”¨æ³•å¾ˆç®€å•ï¼Œåªè¦æˆ‘ä»¬å»å®‰è£…`npm install \--save @babel/runtime`åï¼Œåœ¨éœ€è¦ä½¿ç”¨å¯¹åº”çš„`polyfill`çš„åœ°æ–¹å»å•ç‹¬å¼•å…¥å°±å¯ä»¥äº†ã€‚æ¯”å¦‚ï¼š

```
//Â a.jsÂ ä¸­éœ€è¦ä½¿ç”¨PromiseÂ æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å¼•å…¥å¯¹åº”çš„è¿è¡Œæ—¶polyfillimportÂ PromiseÂ fromÂ 'babel-runtime/core-js/promise'constÂ promsiesÂ =Â newÂ Promise()
```

æ€»è€Œè¨€ä¹‹ï¼Œ`babel/runtime`ä½ å¯ä»¥ç†è§£ç§°ä¸ºå°±æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ â€œå“ªé‡Œéœ€è¦å¼•å“ªé‡Œâ€ çš„å·¥å…·åº“ã€‚

> é’ˆå¯¹`babel/runtime`ç»å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¼šé…åˆ`@babel/plugin-transfrom-runtime`è¿›è¡Œä½¿ç”¨è¾¾åˆ°æ™ºèƒ½åŒ–`runtime`çš„`polyfill`å¼•å…¥ã€‚

#### `@babel/plugin-transform-runtime`

##### `babel-runtime`å­˜åœ¨çš„é—®é¢˜

`babel-runtime`åœ¨æˆ‘ä»¬æ‰‹åŠ¨å¼•å…¥ä¸€äº›`polyfill`çš„æ—¶å€™ï¼Œå®ƒä¼šç»™æˆ‘ä»¬çš„ä»£ç ä¸­æ³¨å…¥ä¸€äº›ç±»ä¼¼`_extend()ï¼Œ classCallCheck()`ä¹‹ç±»çš„å·¥å…·å‡½æ•°ï¼Œè¿™äº›å·¥å…·å‡½æ•°çš„ä»£ç ä¼šåŒ…å«åœ¨ç¼–è¯‘åçš„æ¯ä¸ªæ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚ï¼š

```
classÂ CircleÂ {}//Â babel-runtimeÂ ç¼–è¯‘Classéœ€è¦å€ŸåŠ©_classCallCheckè¿™ä¸ªå·¥å…·å‡½æ•°functionÂ _classCallCheck(instance,Â Constructor)Â {Â //...Â }Â varÂ CircleÂ =Â functionÂ Circle()Â {Â _classCallCheck(this,Â Circle);Â };
```

å¦‚æœæˆ‘ä»¬é¡¹ç›®ä¸­å­˜åœ¨å¤šä¸ªæ–‡ä»¶ä½¿ç”¨äº†`class`ï¼Œé‚£ä¹ˆæ— ç–‘åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­æ³¨å…¥è¿™æ ·ä¸€æ®µå†—ä½™é‡å¤çš„å·¥å…·å‡½æ•°å°†æ˜¯ä¸€ç§ç¾éš¾ã€‚

æ‰€ä»¥é’ˆå¯¹ä¸Šè¿°æåˆ°çš„ä¸¤ä¸ªé—®é¢˜:

*   `babel-runtime`æ— æ³•åšåˆ°æ™ºèƒ½åŒ–åˆ†æï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¼•å…¥ã€‚
    
*   `babel-runtime`ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šé‡å¤ç”Ÿæˆå†—ä½™ä»£ç ã€‚
    

æˆ‘ä»¬å°±è¦å¼•å…¥æˆ‘ä»¬çš„ä¸»è§’`@babel/plugin-transform-runtime`ã€‚

##### `@babel/plugin-transform-runtime`ä½œç”¨

`@babel/plugin-transform-runtime`æ’ä»¶çš„ä½œç”¨æ°æ°å°±æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°æˆ‘ä»¬æåˆ°çš„`run-time`å­˜åœ¨çš„é—®é¢˜è€Œæå‡ºçš„æ’ä»¶ã€‚

*   `babel-runtime`æ— æ³•åšåˆ°æ™ºèƒ½åŒ–åˆ†æï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¼•å…¥ã€‚
    

`@babel/plugin-transform-runtime`æ’ä»¶ä¼šæ™ºèƒ½åŒ–çš„åˆ†ææˆ‘ä»¬çš„é¡¹ç›®ä¸­æ‰€ä½¿ç”¨åˆ°éœ€è¦è½¬è¯‘çš„`js`ä»£ç ï¼Œä»è€Œå®ç°æ¨¡å—åŒ–ä»`babel-runtime`ä¸­å¼•å…¥æ‰€éœ€çš„`polyfill`å®ç°ã€‚

*   `babel-runtime`ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šé‡å¤ç”Ÿæˆå†—ä½™ä»£ç ã€‚
    

`@babel/plugin-transform-runtime`æ’ä»¶æä¾›äº†ä¸€ä¸ª`helpers`å‚æ•°ã€‚å…·ä½“ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥é˜…å®ƒçš„æ‰€æœ‰é…ç½®å‚æ•° [10]ã€‚

è¿™ä¸ª`helpers`å‚æ•°å¼€å¯åå¯ä»¥å°†ä¸Šè¾¹æåˆ°ç¼–è¯‘é˜¶æ®µé‡å¤çš„å·¥å…·å‡½æ•°ï¼Œæ¯”å¦‚`classCallCheck,Â extends`ç­‰ä»£ç è½¬åŒ–ç§°ä¸º`require`è¯­å¥ã€‚æ­¤æ—¶ï¼Œè¿™äº›å·¥å…·å‡½æ•°å°±ä¸ä¼šé‡å¤çš„å‡ºç°åœ¨ä½¿ç”¨ä¸­çš„æ¨¡å—ä¸­äº†ã€‚æ¯”å¦‚è¿™æ ·ï¼š

```
//Â @babel/plugin-transform-runtimeä¼šå°†å·¥å…·å‡½æ•°è½¬åŒ–ä¸ºrequireè¯­å¥è¿›è¡Œå¼•å…¥//Â è€Œéruntimeé‚£æ ·ç›´æ¥å°†å·¥å…·æ¨¡å—ä»£ç æ³¨å…¥åˆ°æ¨¡å—ä¸­varÂ _classCallCheckÂ =Â require("@babel/runtime/helpers/classCallCheck");Â varÂ CircleÂ =Â functionÂ Circle()Â {Â _classCallCheck(this,Â Circle);Â };
```

##### é…ç½®`@babel/plugin-transform-runtime`

å…¶å®ç”¨æ³•åŸç†éƒ¨åˆ†å·²ç»åœ¨ä¸Šè¾¹åˆ†æçš„æ¯”è¾ƒé€å½»äº†ï¼Œé…ç½®è¿™é‡Œè¿˜æœ‰ç–‘é—®çš„åŒå­¦å¯ä»¥è¯„è®ºåŒºç»™æˆ‘ç•™è¨€æˆ–è€…ç§»æ­¥`babel`å®˜ç½‘æŸ¥çœ‹ [11]ã€‚

è¿™é‡Œä¸ºåˆ—ä¸€ä»½ç›®å‰å®ƒçš„é»˜è®¤é…ç½®:

```
{Â Â "plugins":Â [Â Â Â Â [Â Â Â Â Â Â "@babel/plugin-transform-runtime",Â Â Â Â Â Â {Â Â Â Â Â Â Â Â "absoluteRuntime":Â false,Â Â Â Â Â Â Â Â "corejs":Â false,Â Â Â Â Â Â Â Â "helpers":Â true,Â Â Â Â Â Â Â Â "regenerator":Â true,Â Â Â Â Â Â Â Â "version":Â "7.0.0-beta.0"Â Â Â Â Â Â }Â Â Â Â ]Â Â ]}
```

#### æ€»ç»“`polyfill`

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é’ˆå¯¹`polyfill`å…¶å®æˆ‘è€—è´¹äº†ä¸å°‘å»å°†å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å’Œè”ç³»ï¼Œè®©æˆ‘ä»¬æ¥ç¨å¾®æ€»ç»“ä¸€ä¸‹å§ã€‚

åœ¨`babel`ä¸­å®ç°`polyfill`ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š

*   ä¸€ç§æ˜¯é€šè¿‡`@babel/polyfill`é…åˆ`preset-env`å»ä½¿ç”¨ï¼Œè¿™ç§æ–¹å¼å¯èƒ½ä¼šå­˜åœ¨æ±¡æŸ“å…¨å±€ä½œç”¨åŸŸã€‚
    
*   ä¸€ç§æ˜¯é€šè¿‡`@babel/runtime`é…åˆ`@babel/plugin-transform-runtime`å»ä½¿ç”¨ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸ä¼šæ±¡æŸ“ä½œç”¨åŸŸã€‚
    
*   å…¨å±€å¼•å…¥ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸï¼Œä½†æ˜¯ç›¸å¯¹äºå±€éƒ¨å¼•å…¥æ¥è¯´ã€‚å®ƒä¼šå¢åŠ å¾ˆå¤šé¢å¤–çš„å¼•å…¥è¯­å¥ï¼Œå¢åŠ åŒ…ä½“ç§¯ã€‚
    

åœ¨`useBuintIns:usage`æƒ…å†µä¸‹å…¶å®å’Œ`@babel/plugin-transform-runtime`æƒ…å†µä¸‹æ˜¯ç±»ä¼¼çš„ä½œç”¨ï¼Œ

é€šå¸¸æˆ‘ä¸ªäººé€‰æ‹©æ˜¯ä¼šåœ¨å¼€å‘ç±»åº“æ—¶éµå®ˆä¸æ±¡æŸ“å…¨å±€ä¸ºé¦–å…ˆä½¿ç”¨`@babel/plugin-transform-runtime`è€Œåœ¨ä¸šåŠ¡å¼€å‘ä¸­ä½¿ç”¨`@babel/polyfill`ã€‚

```
babel-runtime æ˜¯ä¸ºäº†å‡å°‘é‡å¤ä»£ç è€Œç”Ÿçš„ã€‚babelç”Ÿæˆçš„ä»£ç ï¼Œå¯èƒ½ä¼šç”¨åˆ°ä¸€äº›_extend()ï¼Œ classCallCheck()Â ä¹‹ç±»çš„å·¥å…·å‡½æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›å·¥å…·å‡½æ•°çš„ä»£ç ä¼šåŒ…å«åœ¨ç¼–è¯‘åçš„æ–‡ä»¶ä¸­ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªæ–‡ä»¶ï¼Œé‚£æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰å¯èƒ½å«æœ‰ä¸€ä»½é‡å¤çš„ä»£ç ã€‚babel-runtimeæ’ä»¶èƒ½å¤Ÿå°†è¿™äº›å·¥å…·å‡½æ•°çš„ä»£ç è½¬æ¢æˆrequireè¯­å¥ï¼ŒæŒ‡å‘ä¸ºå¯¹babel-runtimeçš„å¼•ç”¨ï¼Œå¦‚Â require('babel-runtime/helpers/classCallCheck'). è¿™æ ·ï¼Œ classCallCheckçš„ä»£ç å°±ä¸éœ€è¦åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­éƒ½å­˜åœ¨äº†ã€‚
```

`Babel`æ’ä»¶å¼€å‘
===========

ä¸Šè¾¹æˆ‘ä»¬è®²åˆ°äº†æ—¥å¸¸ä¸šåŠ¡ä¸­`babel`çš„ä½¿ç”¨æ–¹å¼åŸç†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥è®²è®²`babel`æ’ä»¶ç›¸å…³å¼€å‘çš„å†…å®¹ã€‚

ä¹Ÿè®¸ä½ ä¼šç–‘æƒ‘`Babel`æ’ä»¶èƒ½æœ‰ä»€ä¹ˆæ ·çš„ä½œç”¨ï¼Ÿç®€å•æ¥è¯´ï¼Œé€šè¿‡`babel`æ’ä»¶å¯ä»¥å¸¦ä½ åœ¨åŸç†å±‚é¢æ›´åŠ æ·±å…¥å‰ç«¯ç¼–è¯‘åŸç†çš„çŸ¥è¯†å†…å®¹ã€‚

å½“ç„¶å¦‚æœä¸ä»…ä»…æ˜¯å¯¹äºä¸ªäººèƒ½åŠ›çš„æå‡ï¼Œå‡ä½¿ä½ åœ¨å¼€å‘ä¸€æ¬¾å±äºè‡ªå·±çš„ç»„ä»¶åº“ï¼Œä½ æƒ³å®ç°ç±»ä¼¼`element-plus`ä¸­çš„æŒ‰éœ€å¼•å…¥æ–¹å¼ï¼Œåˆæˆ–è®¸å¯¹äº`lint`ä½ å­˜åœ¨è‡ªå·±çš„ç‰¹æ®Šçš„è§„åˆ™ã€‚å†ä¸ç„¶å¯¹äºä¸€äº›`js`ä¸­ç‰¹æ®Šçš„å†™æ³•çš„æ”¯æŒã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ‡‚ç¼–è¯‘åŸç†çœŸçš„æ˜¯å¯ä»¥æ— æ‰€æ¬²ä¸ºï¼

å¸¦ä½ èµ°è¿›`babel`çš„ç¼–è¯‘ä¸–ç•Œ
----------------

é’ˆå¯¹äºç¼–è¯‘æ–¹é¢çš„çŸ¥è¯†ï¼Œæ–‡ç« ä¸­çš„é‡ç‚¹å¹¶ä¸æ˜¯è¿™ä¸ªã€‚ä½†æ˜¯å¤§å®¶è¯·æ”¾å¿ƒï¼Œæˆ‘ä¼šç”¨æœ€é€šä¿—çš„æ–¹å¼å¸¦å¤§å®¶å…¥é—¨`babel`æ’ä»¶çš„å¼€å‘ã€‚

`webpack`ã€`lint`ã€`babel`ç­‰ç­‰å¾ˆå¤šå·¥å…·å’Œåº“çš„æ ¸å¿ƒéƒ½æ˜¯é€šè¿‡**æŠ½è±¡è¯­æ³•æ ‘**ï¼ˆAbstract Syntax Treeï¼ŒASTï¼‰è¿™ä¸ªæ¦‚å¿µæ¥å®ç°å¯¹ä»£ç çš„å¤„ç†ã€‚

### `AST`

æ‰€è°“æŠ½è±¡è¯­æ³•æ ‘å°±æ˜¯é€šè¿‡`JavaScript Parser`å°†ä»£ç è½¬åŒ–æˆä¸ºä¸€é¢—æŠ½è±¡è¯­æ³•æ ‘ï¼Œè¿™æ£µæ ‘å®šä¹‰äº†ä»£ç çš„ç»“æ„ã€‚ç„¶åé€šè¿‡æ“çºµè¿™æ£µæ ‘çš„å¢åˆ æ”¹æŸ¥å®ç°å¯¹ä»£ç çš„åˆ†æï¼Œå˜æ›´ï¼Œä¼˜åŒ–ã€‚

é’ˆå¯¹å°†ä»£ç è½¬åŒ–ä¸ºä¸åŒçš„`AST`ä½ å¯ä»¥åœ¨è¿™é‡Œ `astexplorer`[12] ç›®å‰ä¸»æµä»»ä½•è§£æå™¨çš„`AST`è½¬åŒ–ã€‚

è¿™é‡Œæˆ‘ä»¬é¦–å…ˆåˆ—ä¸¾ä¸€äº›æ¶‰åŠçš„å‚è€ƒç½‘ç«™ç»™å¤§å®¶ï¼š

*   astexplorer[13]ï¼šè¿™æ˜¯ä¸€ä¸ªåœ¨çº¿çš„ä»£ç è½¬è¯‘å™¨ï¼Œä»–å¯ä»¥æŒ‰ç…§ç›®å‰ä¸šç•Œä¸»æµçš„æ–¹å¼å°†ä»»ä½•ä»£ç è½¬ä¸º`AST`ã€‚
    
*   babel-handbookï¼š`babel`æ’ä»¶å¼€å‘ä¸­æ–‡æ‰‹å†Œæ–‡æ¡£ã€‚
    
*   the-super-tiny-compiler-cn[14]ï¼šä¸€ä¸ª`github`ä¸Šçš„å¼€æºå°å‹`listp`é£æ ¼è½¬åŒ–`js`ç¼–è¯‘å™¨ï¼Œå¼ºçƒˆæ¨èå¯¹ç¼–è¯‘åŸç†æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»çœ‹ä¸€çœ‹å®ƒçš„ä»£ç ã€‚
    

### `babel`æ’ä»¶å¼€å‘åŸºç¡€æŒ‡å—

å½“æˆ‘ä»¬éœ€è¦å¼€å‘ä¸€æ¬¾å±äºè‡ªå·±çš„`babel`æ’ä»¶æ—¶ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šå€ŸåŠ©`babel`çš„ä¸€äº›åº“å»è¿›è¡Œä»£ç çš„`parser`ä»¥åŠ`transform ast`ï¼Œ`generator code`ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬å»æ‰‹åŠ¨å¯¹ä»£ç è¿›è¡Œè¯æ³• / è¯­æ³•åˆ†æè¿‡ç¨‹ã€‚

æ’ä»¶å¼€å‘é€šå¸¸ä¼šæ¶‰åŠè¿™äº›åº“:

*   `@babel/core`: ä¸Šè¾¹æˆ‘ä»¬è¯´è¿‡`babel/core`æ˜¯`babel`çš„æ ¸å¿ƒåº“ï¼Œæ ¸å¿ƒçš„`api`éƒ½åœ¨è¿™é‡Œã€‚æ¯”å¦‚ä¸Šè¾¹æˆ‘ä»¬è®²åˆ°çš„`transform`ï¼Œ`parse`æ–¹æ³•ã€‚
    
*   `@babel/parser`:`babel`è§£æå™¨ã€‚
    
*   `@babel/types`: è¿™ä¸ªæ¨¡å—åŒ…å«æ‰‹åŠ¨æ„å»º AST å’Œæ£€æŸ¥ AST èŠ‚ç‚¹ç±»å‹çš„æ–¹æ³• (æ¯”å¦‚é€šè¿‡å¯¹åº”çš„`api`ç”Ÿæˆå¯¹åº”çš„èŠ‚ç‚¹)ã€‚
    
*   `@babel/traverse`: è¿™ä¸ªæ¨¡å—ç”¨äºå¯¹`Ast`çš„éå†ï¼Œå®ƒç»´æŠ¤äº†æ•´æ£µæ ‘çš„çŠ¶æ€ (éœ€è¦æ³¨æ„çš„æ˜¯`traverse`å¯¹äº`ast`æ˜¯ä¸€ç§æ·±åº¦éå†)ã€‚
    
*   `@babel/generator`: è¿™ä¸ªæ¨¡å—ç”¨äºä»£ç çš„ç”Ÿæˆï¼Œé€šè¿‡`AST`ç”Ÿæˆæ–°çš„ä»£ç è¿”å›ã€‚
    

### `babel`çš„å·¥ä½œæµç¨‹

åœ¨æ—¥å¸¸å‰ç«¯é¡¹ç›®ä¸­ï¼Œç»å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬ä½¿ç”¨`babel`è¿›è¡Œ`js`ä»£ç çš„è½¬åŒ–ã€‚

å®ƒçš„å·¥ä½œæµç¨‹å¤§æ¦‚å¯ä»¥æ¦‚æ‹¬ç§°ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢:

*   `Parse`ï¼ˆè§£æï¼‰é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µå°†æˆ‘ä»¬çš„`js`ä»£ç  (å­—ç¬¦ä¸²) è¿›è¡Œè¯æ³•åˆ†æç”Ÿæˆä¸€ç³»åˆ—`tokens`ï¼Œä¹‹åå†è¿›è¡Œè¯­æ³•åˆ†æå°†`tokens`ç»„åˆç§°ä¸ºä¸€é¢—`AST`æŠ½è±¡è¯­æ³•æ ‘ã€‚(æ¯”å¦‚`babel-parser`å®ƒçš„ä½œç”¨å°±æ˜¯è¿™ä¸€æ­¥)
    
*   `Transform`ï¼ˆè½¬åŒ–ï¼‰é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µ`babel`é€šè¿‡å¯¹äºè¿™æ£µæ ‘çš„éå†ï¼Œä»è€Œå¯¹äºæ—§çš„`AST`è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œå°†æ–°çš„`js`è¯­æ³•èŠ‚ç‚¹è½¬åŒ–ç§°ä¸ºæµè§ˆå™¨å…¼å®¹çš„è¯­æ³•èŠ‚ç‚¹ã€‚(`babel/traverse`å°±æ˜¯åœ¨è¿™ä¸€æ­¥è¿›è¡Œéå†è¿™æ£µæ ‘)
    
*   `Generator`ï¼ˆç”Ÿæˆï¼‰é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µ`babel`ä¼šå°†æ–°çš„`AST`è½¬åŒ–åŒæ ·è¿›è¡Œæ·±åº¦éå†ä»è€Œç”Ÿæˆæ–°çš„ä»£ç ã€‚(`@babel/generator`)
    

æˆ‘ä»¬ç”¨ä¸€å¼ å›¾æ¥æè¿°ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHpqibzaPCcJ4KA6EVrOFbnTQhnTwrAmeOU6ibeKwzIxtlM61OV6LoEGC0f2vTN1qq4wia1c2kVYnbxmA/640?wx_fmt=other)image.png

### `babel`ä¸­`AST`çš„éå†è¿‡ç¨‹

*   `AST`æ˜¯æ‰€è°“çš„æ·±åº¦ä¼˜å…ˆéå†ï¼Œå…³äºä½•è°“æ·±åº¦ä¼˜å…ˆä¸äº†è§£çš„åŒå­¦å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ç›¸å…³èµ„æ–™ï½
    
*   `babel`ä¸­`AST`èŠ‚ç‚¹çš„éå†æ˜¯åŸºäºä¸€ç§è®¿é—®è€…æ¨¡å¼ (`Visitor`)ï¼Œä¸åŒçš„è®¿é—®è€…ä¼šæ‰§è¡Œä¸åŒçš„æ“ä½œä»è€Œå¾—åˆ°ä¸åŒçš„ç»“æœã€‚
    
*   `visitor`ä¸ŠæŒ‚è½½äº†ä»¥æ¯ä¸ªèŠ‚ç‚¹å‘½åçš„æ–¹æ³•ï¼Œå½“è¿›è¡Œ`AST`éå†æ—¶å°±ä¼šè§¦å‘åŒ¹é…çš„æ–¹æ³•åä»è€Œæ‰§è¡Œå¯¹åº”æ–¹æ³•è¿›è¡Œæ“ä½œã€‚
    

æ‰‹æŠŠæ‰‹å¸¦ä½ å¼€å‘`babel`æ’ä»¶
----------------

è¿™é‡Œæˆ‘ä»¬ä»¥ä¸€ä¸ªç®€å•çš„`ES6`ä¸­çš„ç®­å¤´å‡½æ•°è½¬åŒ–ä¸º`ES5`æ–¹å¼å…¥æ‰‹ï¼Œæ¥å¸¦å¤§å®¶å…¥é—¨çœŸæ­£çš„`babel`æ’ä»¶å¼€å‘ã€‚

æˆ‘ç›¸ä¿¡æœ‰çš„åŒå­¦å¯èƒ½æœ‰ç–‘æƒ‘ï¼Œ`babel`ä¸­å·²ç»å­˜åœ¨å¯¹åº”çš„`@babel/plugin-transform-arrow-functions`è¿›è¡Œç®­å¤´å‡½æ•°çš„è½¬åŒ–ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦å»å®ç°å®ƒå‘¢ã€‚

æ²¡é”™ï¼Œ`babel`ä¸­çš„ç¡®å·²ç»å­˜åœ¨è¿™ä¸ªæ’ä»¶è€Œä¸”å·²ç»éå¸¸å®Œç¾äº†ã€‚è¿™é‡Œæˆ‘æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œä¹‹æ‰€ä»¥é€‰æ‹©è¿™ä¸ªä¾‹å­æ˜¯æƒ³å¸¦å¤§å®¶çœŸæ­£å…¥é—¨`babel`æ’ä»¶çš„å¼€å‘æµç¨‹ï¼Œä¸€ä¸ªç®€å•çš„ä¾‹å­å…¶å®å¯ä»¥æ›´å¥½çš„å¸¦ç»™å¤§å®¶æ’ä»¶å¼€å‘èƒŒåçš„æ€æƒ³ä½“ä¼šï¼Œä»è€Œå¯ä»¥è®©å¤§å®¶ä¸¾ä¸€åä¸‰ã€‚

è®©æˆ‘ä»¬å¼€å§‹å§ï½

é¦–å…ˆè®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬éœ€è¦å®ç°çš„ç»“æœ:

### ç›®æ ‡

```
//Â inputconstÂ arrowFuncÂ =Â ()Â =>Â {Â console.log(this)}//Â outputvarÂ _thisÂ =Â thisfuncitonÂ arrowFunc()Â {Â Â Â Â console.log(_this)}
```

### `babel`åŸç‰ˆè½¬åŒ–æ–¹å¼

```
/**Â *Â babelæ’ä»¶Â *Â ä¸»è¦è¿˜æ˜¯@babel/coreä¸­çš„transformã€parseÂ å¯¹äºastçš„å¤„ç†Â *Â ä»¥åŠbabel/typesÂ ä¸­å„ç§è½¬åŒ–è§„åˆ™Â *Â *Â Astæ˜¯ä¸€ç§æ·±åº¦ä¼˜å…ˆéå†Â *Â å†…éƒ¨ä½¿ç”¨è®¿é—®è€…(visitor)æ¨¡å¼Â *Â *Â babelä¸»è¦ä¹Ÿæ˜¯åšçš„ASTçš„è½¬åŒ–Â *Â *Â 1.Â è¯æ³•åˆ†æÂ tokensÂ :Â varÂ aÂ Â =Â 1Â ["var","a","=","1"]Â *Â 2.Â è¯­æ³•åˆ†æÂ å°†tokensæŒ‰ç…§å›ºå®šè§„åˆ™ç”ŸæˆASTè¯­æ³•æ ‘Â *Â 3.Â è¯­æ³•æ ‘è½¬åŒ–Â åœ¨æ—§çš„è¯­æ³•æ ‘åŸºç¡€ä¸Šè¿›è¡Œå¢åˆ æ”¹æŸ¥Â ç”Ÿæˆæ–°çš„è¯­æ³•ä¹¦Â *Â 4.Â ç”Ÿæˆä»£ç Â æ ¹æ®æ–°çš„Treeç”Ÿæˆæ–°çš„ä»£ç Â *///Â babelæ ¸å¿ƒè½¬åŒ–åº“Â åŒ…å«coreÂ -ã€‹Â ASTÂ -ã€‹Â codeçš„è½¬åŒ–å®ç°/*Â Â Â babel/coreÂ å…¶å®å°±å¯ä»¥ç›¸å½“äºÂ esprima+Estraverse+EscodegenÂ Â å®ƒä¼šå°†åŸæœ¬çš„sourceCodeè½¬åŒ–ä¸ºASTè¯­æ³•æ ‘Â Â éå†è€çš„è¯­æ³•æ ‘Â Â éå†è€çš„è¯­æ³•æ ‘æ—¶å€™Â ä¼šæ£€æŸ¥ä¼ å…¥çš„æ’ä»¶/æˆ–è€…ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­ä¼ å…¥çš„`visitor`Â Â ä¿®æ”¹å¯¹åº”åŒ¹é…çš„èŠ‚ç‚¹Â Â Â ç”Ÿæˆæ–°çš„è¯­æ³•æ ‘Â Â ä¹‹åç”Ÿæˆæ–°çš„ä»£ç åœ°å€*/constÂ babelÂ =Â require('@babel/core');// babel/types å·¥å…·åº“Â è¯¥æ¨¡å—åŒ…å«æ‰‹åŠ¨æ„å»ºTSçš„æ–¹æ³•ï¼Œå¹¶æ£€æŸ¥ASTèŠ‚ç‚¹çš„ç±»å‹ã€‚(æ ¹æ®ä¸åŒèŠ‚ç‚¹ç±»å‹è¿›è¡Œè½¬åŒ–å®ç°)constÂ babelTypesÂ =Â require('@babel/types');//Â è½¬åŒ–ç®­å¤´å‡½æ•°çš„æ’ä»¶constÂ arrowFunctionÂ =Â require('@babel/plugin-transform-arrow-functions');constÂ sourceCodeÂ =Â `constÂ arrowFuncÂ =Â ()Â =>Â {Â console.log(this)}`;constÂ targetCodeÂ =Â babel.transform(sourceCode,Â {Â Â plugins:Â [arrowFunction],});console.log(targetCode.code)
```

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†`babel/core`ï¼Œå®ƒçš„`transform`æ–¹æ³•ä¼šå°†æˆ‘ä»¬çš„ä»£ç è½¬åŒ–ç§°ä¸º`AST`åŒæ—¶è¿›å…¥`plugins`çš„å¤„ç†æˆä¸ºæ–°çš„`AST`ï¼Œæœ€ç»ˆç”Ÿæˆå¯¹åº”çš„ä»£ç ã€‚

> ä¸å¤ªæ¸…æ¥šæ’ä»¶å·¥ä½œåŸç†çš„åŒå­¦å¯ä»¥æ ¹æ®ä»£ç æ³¨é‡Šè‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸‹ï¼Œè¿™é‡Œä»…ä»…æ˜¯çŸ­çŸ­åå‡ è¡Œä»£ç ã€‚

### è‡ªå·±å®ç°`@babel/plugin-transform-arrow-functions`æ’ä»¶

è¿™é‡Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹è‡ªå·±æ¥å®ç°ä¸€ä¸ªè¿™æ ·çš„åŠŸèƒ½ã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å…ˆæ¥å†™å¥½åŸºç¡€çš„ç»“æ„:

```
constÂ babelÂ =Â require('@babel/core');// babel/types å·¥å…·åº“Â è¯¥æ¨¡å—åŒ…å«æ‰‹åŠ¨æ„å»ºTSçš„æ–¹æ³•ï¼Œå¹¶æ£€æŸ¥ASTèŠ‚ç‚¹çš„ç±»å‹ã€‚(æ ¹æ®ä¸åŒèŠ‚ç‚¹ç±»å‹è¿›è¡Œè½¬åŒ–å®ç°)constÂ babelTypesÂ =Â require('@babel/types');//Â æˆ‘ä»¬è‡ªå·±å®ç°çš„è½¬åŒ–æ’ä»¶constÂ {Â arrowFunctionPluginÂ }Â =Â require('./plugin-transform-arrow-functions');constÂ sourceCodeÂ =Â `constÂ arrowFuncÂ =Â ()Â =>Â {Â console.log(this)}`;constÂ targetCodeÂ =Â babel.transform(sourceCode,Â {Â Â plugins:Â [arrowFunctionPlugin],});//Â æ‰“å°ç¼–è¯‘åä»£ç console.log(targetCode.code)
```

```
//Â plugin-transform-arrow-functions.jsconstÂ arrowFunctionPluginÂ =Â ()Â =>Â {Â Â Â Â //Â ...}module.exportsÂ =Â {Â Â Â Â arrowFunctionPlugin}
```

è¿™é‡Œï¼Œæˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ª`plugin-transform-arrow-functions`æ–‡ä»¶æ¥å®ç°æˆ‘ä»¬è‡ªå·±çš„æ’ä»¶ï¼š

ä¸Šè¾¹æˆ‘ä»¬è®²è¿‡`babel`æ’ä»¶å®è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œè¾¹ä¼šæœ‰ä¸€ä¸ªå±æ€§`visitor`ã€‚è¿™ä¸ª`visitor`å¯¹è±¡ä¸Šä¼šæœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½æ˜¯åŸºäºèŠ‚ç‚¹çš„åç§°å»å‘½åçš„ã€‚

å½“`babel/core`ä¸­çš„`transform`æ–¹æ³•è¿›è¡Œ`AST`çš„éå†æ—¶ä¼šè¿›å…¥`visitor`å¯¹è±¡ä¸­åŒ¹é…ï¼Œå¦‚æœå¯¹åº”èŠ‚ç‚¹çš„ç±»å‹åŒ¹é…åˆ°äº†`visitor`ä¸Šçš„å±æ€§é‚£ä¹ˆå°±ä¼šä»è€Œæ‰§è¡Œç›¸åº”çš„æ–¹æ³•ã€‚

æ¯”å¦‚è¿™æ ·ä¸€æ®µä»£ç :

```
constÂ arrowFunctionPluginÂ =Â {Â Â Â Â visitor:Â {Â Â Â Â Â Â ArrowFunctionExpression(nodePath)Â {Â Â Â Â Â Â Â Â Â Â //Â doÂ somethingÂ Â Â Â Â Â }Â Â Â Â },}
```

å½“è¿›è¡Œ`AST`éå†æ—¶ï¼Œå¦‚æœç¢°åˆ°èŠ‚ç‚¹ç±»å‹ä¸º`ArrowFunctionExpression`æ—¶å°±ä¼šè¿›å…¥`visitor`å¯¹è±¡ä¸­çš„`ArrowFunctionExpression`æ–¹æ³•ä»è€Œæ‰§è¡Œå¯¹åº”é€»è¾‘ä»è€Œè¿›è¡Œæ“ä½œå½“å‰æ ‘ã€‚

è¿™é‡Œæœ‰ä¸¤ä¸ª`tip`éœ€è¦å’Œå¤§å®¶ç¨å¾®è§£é‡Šä¸€ä¸‹ã€‚

*   æˆ‘å¦‚ä½•çŸ¥é“æ¯ä¸ªèŠ‚ç‚¹çš„ç±»å‹å‘¢ï¼Ÿæ¯”å¦‚`ArrowFunctionExpression`å°±æ˜¯ç®­å¤´å‡½æ•°çš„ç±»å‹ã€‚
    

é¦–å…ˆï¼Œbabel/types[15] ä¸­æ¶µç›–äº†æ‰€æœ‰çš„èŠ‚ç‚¹ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥é˜…`babel/types`æŸ¥é˜…å¯¹åº”çš„èŠ‚ç‚¹ç±»å‹ã€‚

å½“ç„¶è¿˜å­˜åœ¨å¦ä¸€ä¸ªæ›´åŠ æ–¹ä¾¿çš„æ–¹å¼ï¼Œä¸Šè¾¹æˆ‘ä»¬æåˆ°çš„ astexplorer[16]ï¼Œä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥é˜…å¯¹åº”ä»£ç ç”Ÿæˆçš„`AST`ä»è€Œè·å¾—å¯¹åº”çš„èŠ‚ç‚¹ã€‚

*   ä»€ä¹ˆæ˜¯`nodePath`å‚æ•°ï¼Œå®ƒæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ
    

è¿™é‡Œæ¯ä¸€ä¸ªæ–¹æ³•éƒ½å­˜åœ¨ä¸€ä¸ª`nodePath`å‚æ•°ï¼Œæ‰€è°“çš„`nodePath`å‚æ•°ä½ å¯ä»¥å°†å®ƒç†è§£æˆä¸ºä¸€ä¸ªèŠ‚ç‚¹è·¯å¾„ã€‚å®ƒåŒ…å«äº†è¿™ä¸ªæ ‘ä¸Šè¿™ä¸ªèŠ‚ç‚¹åˆ†å‰çš„æ‰€æœ‰ä¿¡æ¯å’Œå¯¹åº”çš„`api`ã€‚**æ³¨æ„è¿™é‡Œå¯ä»¥å¼ºè°ƒæ˜¯è·¯å¾„**ï¼Œä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥é˜… [17] å®ƒçš„å«ä¹‰ä»¥åŠå¯¹åº”çš„æ‰€æœ‰`API`ã€‚

åœ¨æˆ‘ä»¬å†™å¥½åŸºç¡€çš„ç»“æ„ä¹‹åï¼Œè®©æˆ‘ä»¬æ¥å¼€å§‹åŠ¨æ‰‹å®ç°æ’ä»¶çš„å†…éƒ¨é€»è¾‘å§ã€‚

æˆ‘ä»¬æ¸…æ¥šæƒ³è¦è®²ä»£ç è¿›è¡Œç¼–è¯‘ï¼Œéš¾å…è¦è¿›è¡Œ`AST`èŠ‚ç‚¹çš„ä¿®æ”¹ã€‚æœ¬è´¨ä¸Šæˆ‘ä»¬è¿˜æ˜¯é€šè¿‡å¯¹äº`AST`èŠ‚ç‚¹çš„æ“ä½œä¿®æ”¹`AST`ä»è€Œç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„ä»£ç ç»“æœã€‚

*   **é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡** astexplorer[18] åˆ†åˆ«è¾“å…¥æˆ‘ä»¬çš„æºä»£ç å’ŒæœŸæœ›çš„ç¼–è¯‘åä»£ç å¾—åˆ°å¯¹åº”çš„`AST`ç»“æ„ã€‚
    
*   ä¹‹åï¼Œæˆ‘ä»¬åœ¨å¯¹æ¯”è¿™ä¸¤æ£µæ ‘çš„ç»“æ„ä»è€Œåœ¨åŸæœ‰çš„`AST`åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹å¾—åˆ°æˆ‘ä»¬æœ€ç»ˆçš„`AST`ã€‚
    
*   å‰©ä¸‹ï¼Œåº”è¯¥å°±æ²¡æœ‰ä»€ä¹ˆå‰©ä¸‹çš„æ­¥éª¤äº†ã€‚`babel transform`æ–¹æ³•ä¼šæ ¹æ®æˆ‘ä»¬ä¿®æ”¹åçš„`AST`ç”Ÿæˆå¯¹åº”çš„æºä»£ç ã€‚
    

> å¼ºçƒˆå»ºè®®åŒå­¦ä»¬è‡ªå·±è¿›å…¥ astexplorer[19] è¾“å…¥éœ€è¦è½¬è¯‘çš„ä»£ç å’Œè½¬è¯‘åçš„ä»£ç è¿›è¡Œå¯¹æ¯”ä¸€ä¸‹ã€‚

éœ€è¦ç¼–è¯‘çš„ç®­å¤´å‡½æ•°éƒ¨åˆ†èŠ‚ç‚¹æˆªå›¾ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHpqibzaPCcJ4KA6EVrOFbnTQDS2ZMLlJd5bPYghHl3yIwDj69tvUDRXMpgMcQGdyTpcGF6yrj2P3ibw/640?wx_fmt=other)image.png

ç¼–è¯‘åä»£ç çš„éƒ¨åˆ†èŠ‚ç‚¹æˆªå›¾ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHpqibzaPCcJ4KA6EVrOFbnTQxU5QutM8GrxNxfns6KY9ngia5AKOXDNOKb8JxOWzcFPx2FicOHibDwGeQ/640?wx_fmt=other)image.png

è¿™é‡Œï¼Œæˆ‘ä»¬å‘ç°å¯¹æ¯”`input`å’Œ`output`:

*   `output`ä¸­å°†ç®­å¤´å‡½æ•°çš„èŠ‚ç‚¹`ArrowFunctionExpression`æ›¿æ¢æˆä¸ºäº†`FunctionDeclaration`ã€‚
    
*   `output`ä¸­é’ˆå¯¹ç®­å¤´å‡½æ•°çš„`body`ï¼Œè°ƒç”¨è¡¨è¾¾å¼å£°æ˜`ExpressionStatement`æ—¶ï¼Œä¼ å…¥çš„`arguments`ä»`ThisExpression`æ›´æ¢æˆäº†`Identifier`ã€‚
    
*   åŒæ—¶`output`åœ¨ç®­å¤´å‡½æ•°åŒä½œç”¨åŸŸå†…é¢å¤–æ·»åŠ äº†ä¸€ä¸ªå˜é‡å£°æ˜ï¼Œ`const _this = this`ã€‚
    

å¾ˆç®€å•å§ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æˆ‘ä»¬çš„`arrowFunctionPlugin`ä¸­å®ç°è¿™ä¸‰ä¸ªåŠŸèƒ½å°±å¯ä»¥æ»¡è¶³è¦æ±‚äº†ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥åŠ¨æ‰‹è¯•ä¸€è¯•å§ã€‚

```
constÂ babelTypesÂ =Â require('@babel/types');functionÂ ArrowFunctionExpression(path)Â {Â Â constÂ nodeÂ =Â path.node;Â Â hoistFunctionEnvironment(path);Â Â node.typeÂ =Â 'FunctionDeclaration';}/**Â *Â *Â *Â @paramÂ {*}Â nodePathÂ å½“å‰èŠ‚ç‚¹è·¯å¾„Â */functionÂ hoistFunctionEnvironment(nodePath)Â {Â Â //Â å¾€ä¸ŠæŸ¥æ‰¾Â ç›´åˆ°æ‰¾åˆ°æœ€è¿‘é¡¶éƒ¨éç®­å¤´å‡½æ•°çš„thisÂ p.isFunction()Â &&Â !p.isArrowFunctionExpression()Â Â //Â æˆ–è€…æ‰¾åˆ°è·ŸèŠ‚ç‚¹Â p.isProgram()Â Â constÂ thisEnvFnÂ =Â nodePath.findParent((p)Â =>Â {Â Â Â Â returnÂ (p.isFunction()Â &&Â !p.isArrowFunctionExpression())Â ||Â p.isProgram();Â Â });Â Â //Â æ¥ä¸‹æ¥æŸ¥æ‰¾å½“å‰ä½œç”¨åŸŸä¸­é‚£äº›åœ°æ–¹ç”¨åˆ°äº†thisçš„èŠ‚ç‚¹è·¯å¾„Â Â constÂ thisPathsÂ =Â getScopeInfoInformation(thisEnvFn);Â Â constÂ thisBindingsNameÂ =Â generateBindName(thisEnvFn);Â Â //Â thisEnvFnä¸­æ·»åŠ ä¸€ä¸ªå˜é‡Â å˜é‡åä¸ºÂ thisBindingsNameÂ å˜é‡å€¼ä¸ºÂ thisÂ Â //Â ç›¸å½“äºÂ constÂ _thisÂ =Â thisÂ Â thisEnvFn.scope.push({Â Â Â Â //Â è°ƒç”¨babelTypesä¸­ç”Ÿæˆå¯¹åº”èŠ‚ç‚¹Â Â Â Â //Â è¯¦ç»†ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥é˜…åˆ°Â https://babeljs.io/docs/en/babel-typesÂ Â Â Â id:Â babelTypes.Identifier(thisBindingsName),Â Â Â Â init:Â babelTypes.thisExpression(),Â Â });Â Â thisPaths.forEach((thisPath)Â =>Â {Â Â Â Â //Â å°†thisæ›¿æ¢ç§°ä¸º_thisÂ Â Â Â constÂ replaceNodeÂ =Â babelTypes.Identifier(thisBindingsName);Â Â Â Â thisPath.replaceWith(replaceNode);Â Â });}/**Â *Â *Â æŸ¥æ‰¾å½“å‰ä½œç”¨åŸŸå†…thisä½¿ç”¨çš„åœ°æ–¹Â *Â @paramÂ {*}Â nodePathÂ èŠ‚ç‚¹è·¯å¾„Â */functionÂ getScopeInfoInformation(nodePath)Â {Â Â constÂ thisPathsÂ =Â [];Â Â //Â è°ƒç”¨nodePathä¸­çš„traverseæ–¹æ³•è¿›è¡Œä¾¿åˆ©Â Â //Â ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥é˜…åˆ°Â Â https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.mdÂ Â nodePath.traverse({Â Â Â Â //Â æ·±åº¦éå†èŠ‚ç‚¹è·¯å¾„Â æ‰¾åˆ°å†…éƒ¨thisè¯­å¥Â Â Â Â ThisExpression(thisPath)Â {Â Â Â Â Â Â thisPaths.push(thisPath);Â Â Â Â },Â Â });Â Â returnÂ thisPaths;}/**Â *Â åˆ¤æ–­ä¹‹å‰æ˜¯å¦å­˜åœ¨Â _thisÂ è¿™é‡Œç®€å•å¤„ç†ä¸‹Â *Â ç›´æ¥è¿”å›å›ºå®šçš„å€¼Â *Â @paramÂ {*}Â pathÂ èŠ‚ç‚¹è·¯å¾„Â *Â @returnsÂ */functionÂ generateBindName(path,Â nameÂ =Â '_this',Â nÂ =Â '')Â {Â Â ifÂ (path.scope.hasBinding(name))Â {Â Â Â Â generateBindName(path,Â '_this'Â +Â n,Â parseInt(n)Â +Â 1);Â Â }Â Â returnÂ name;}module.exportsÂ =Â {Â Â hoistFunctionEnvironment,Â Â arrowFunctionPlugin:Â {Â Â Â Â visitor:Â {Â Â Â Â Â Â ArrowFunctionExpression,Â Â Â Â },Â Â },};
```

æ¥ä¸‹æ¥è®©æˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨æˆ‘ä»¬å†™å¥½çš„æ’ä»¶æ¥`run`ä¸€ä¸‹å§ã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHpqibzaPCcJ4KA6EVrOFbnTQByzkcicBg4LysnRgDaFAhNjQeD9q2oeribcGOlTxyFPfPh3rgmwufN2w/640?wx_fmt=other)image.png

æ€»ç»“æ’ä»¶å¼€å‘æµç¨‹
--------

ä¸Šè¾¹è™½ç„¶æ˜¯ä¸€ä¸ªç®€å•çš„æ’ä»¶`Demo`ä¾‹å­ï¼Œä½†æ˜¯éº»é›€è™½å°äº”è„ä¿±å…¨ã€‚ä¸€ä¸ªå®Œæ•´çš„`babel`æ’ä»¶æµç¨‹å¤§æ¦‚å°±æ˜¯å¦‚æ­¤ï¼Œè¿™é‡Œè®©æˆ‘ä»¬ç¨å¾®æ€»ç»“ä¸€ä¸‹å…³äº`babel`æ’ä»¶çš„å¼€å‘è¿‡ç¨‹ã€‚

*   é€šè¿‡æºä»£ç å’Œè½¬è¯‘åä»£ç è¿›è¡Œ`AST`èŠ‚ç‚¹å¯¹æ¯”ï¼Œæ‰¾å‡ºå¯¹åº”çš„åŒºåˆ«èŠ‚ç‚¹ï¼Œå°½é‡å¤ç”¨ä¹‹å‰çš„èŠ‚ç‚¹ã€‚
    
*   å­˜åœ¨ä¿®æ”¹ / å¢åŠ  / åˆ é™¤çš„èŠ‚ç‚¹ï¼Œé€šè¿‡`nodePath`ä¸­çš„`Api`è°ƒç”¨å¯¹åº”çš„æ–¹æ³•è¿›è¡Œ`AST`çš„å¤„ç†ã€‚
    

å®è§‚ä¸Šæ¥è®²æ’ä»¶çš„å¼€å‘æµç¨‹ä¸»è¦å°±åˆ†ä¸ºè¿™ä¸¤ä¸ªæ­¥éª¤ï¼Œå‰©ä¸‹çš„å°±æ˜¯å„ä½å¯¹äº`ast`ä¸­è½¬åŒ–éƒ¨åˆ†çš„ â€œä¸šåŠ¡é€»è¾‘â€ å•¦ã€‚

> `babel`æ’ä»¶å¼€å‘éƒ¨åˆ†å¯èƒ½ä¼šæ¶‰åŠä¸€äº›å¤§å®¶ä¹‹å‰å¹¶æ²¡æœ‰æ¥è§¦è¿‡çš„`API`ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ç›´æ¥ç”¨ä»£ç çš„æ–¹å¼å»è®²è§£æ’ä»¶çš„å¼€å‘å¹¶æ²¡æœ‰å»æ·±å…¥è®²è§£è¿™äº›`API`ã€‚å¦‚æœå¯¹æŸäº›éƒ¨åˆ†ä¸å¤ªç†è§£çš„è¯å¯ä»¥åœ¨è¯„è®ºåŒºç•™è¨€ç»™æˆ‘ï¼Œå¯¹åº”çš„`API`æˆ‘ä¸ªäººå»ºè®®å¤§å®¶å¤šåŠ¨æ‰‹å» babel-handbook æ’ä»¶å¼€å‘æ‰‹å†Œ [20] æŸ¥è¯¢ï¼Œè¿™é‡Œç†è§£èµ·æ¥ä¼šæ›´åŠ æ·±åˆ»ã€‚

> æ–‡ä¸­æ’ä»¶ä»…ä»…æ˜¯ä¸€ä¸ªå°`Demo`çº§åˆ«çš„ï¼Œç›®çš„æ˜¯ä¸ºäº†å°†å¤§å®¶å¸¦å…¥`babel`æ’ä»¶çš„å¼€å‘çš„å¤§é—¨ã€‚æ–‡ç« ä¸­çš„ä»£ç ä½ å¯ä»¥åœ¨è¿™é‡Œ [21] æŸ¥çœ‹ã€‚è¿™ä¸ª`repo`ä¸­ä¸ä»…ä»…åŒ…å«æ–‡ç« ä¸­çš„`demo`, è¿˜æ¶‰åŠäº†ä¸€äº›éš¾åº¦æ›´é«˜çš„æ’ä»¶å­¦ä¹ æ¨¡ä»¿ï¼Œä»¥åŠæ–‡ç« å¼€å§‹æåˆ°çš„å®ç°ç»„ä»¶åº“çš„æŒ‰éœ€åŠ è½½æ’ä»¶ (æŒ‰éœ€åŠ è½½æ’ä»¶æˆ‘è¿˜åœ¨å†™, åŸè°…æˆ‘çš„æ‡’æƒ°...)ã€‚

11.6 æ›´æ–°
=======

è¿™é‡Œæˆ‘ä»¬è¡¥å……ä¸€ä¸ªå…³äº`babel-register`çš„ç®€å•çŸ¥è¯†ç‚¹ã€‚

æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®˜ç½‘ä¸Šå¯¹äº`babel-register`çš„æè¿°ï¼š

> One of the ways you can use Babel is through the require hook. The require hook will bind itself to node'sÂ `require`Â and automatically compile files on the fly. This is equivalent to CoffeeScript'sÂ coffee-script/register[22].

ç®€ç­”æ¥è¯´ä¹Ÿå°±æ˜¯å¼•å…¥`babel/register`å`babel`ä¼šå¯¹äºç‰¹å®šåç¼€çš„æ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚

> All subsequent files required by node with the extensions `.es6, .es, .jsx, .mjs,` and `.js` will be transformed by Babel.

èµ·åˆå…¶å®æˆ‘ä¸å¤ªç†è§£å®ƒçš„ä½œç”¨ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œå¯¹äºä¸Šè¿°åç¼€çš„æ–‡ä»¶äº¤ç»™`Babel`è¿›è¡Œè½¬åŒ–ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨å„ç§å‰ç«¯ç¼–è¯‘å·¥å…·ä¸­æ¯”å¦‚`webpack`ä¸­çš„`babel-loader`å’Œ`rollup`ä¸­çš„`@rollup/plugin-babel`å¸®æˆ‘ä»¬åšçš„äº‹æƒ…å—ï¼Ÿ

è¿™é‡Œçš„`@babel/regiser`çš„åŠŸèƒ½æ˜¯ä¸æ˜¯æœ‰ç‚¹å¤šæ¬¡ä¸€ä¸¾äº†ã€‚

ç›´åˆ°æˆ‘åœ¨`stackoverflow`ä¸­çœ‹åˆ°è¿™æ ·ä¸€æ®µå›ç­” [23]ã€‚

**ç¨å¾®ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œä¹Ÿå°±æ˜¯è¯´é€šå¸¸åœ¨æˆ‘ä»¬å‰ç«¯é¢†åŸŸä¸­æˆ‘ä»¬ç»“åˆäº†å„ç§æ„å»ºå·¥å…·å’Œ`babel`çš„é…åˆä½¿ç”¨å¯ä»¥æ›´å¥½çš„å°†éœ€è¦å¤„ç†çš„æ–‡ä»¶äº¤ç»™`babel`è¿›è¡Œå¤„ç¼–è¯‘ã€‚**

**è€Œåœ¨`nodejs`ä¸­`babel`å¹¶ä¸æ˜¯å…¶æ ¸å¿ƒ`API`çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨`nodejs`ä¸­ä½¿ç”¨`babel`è¿›è¡Œè½¬è¯‘æˆ‘ä»¬çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥é€šè¿‡`babel/regiseter`é’ˆå¯¹äº`require`è¯­å¥å¼•å…¥çš„æ–‡ä»¶äº¤ç»™`babel`å»`transform`ã€‚ä»è€Œè¾¾åˆ°åœ¨`nodejs`è¿›è¡Œè½¬è¯‘`js`æ–‡ä»¶ã€‚**

> éœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯`babel/register`æ˜¯å³æ—¶ç¼–è¯‘ã€‚

```
//Â index.jsrequire('@babel/register')constÂ dataÂ =Â require('./register');console.log(`${data}`,Â 'data');//Â register.jsconstÂ arrowFunctionÂ =Â ()Â =>Â {Â Â console.log('Hello,MyÂ nameÂ isÂ wang.haoyu');};module.exportsÂ =Â arrowFunction//Â babelrc{Â Â "presets":Â ["@babel/preset-env"]}
```

å½“æˆ‘ä»¬ä½¿ç”¨`node`è¿è¡Œ`index.js`æ—¶:

![](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHpqibzaPCcJ4KA6EVrOFbnTQfq4V9g09qhAxN1pIRxze6yD045r5qh4xbRo8ILK27UibSia6UlXiaQelQ/640?wx_fmt=other)image.png

ä½ ä¼šå‘ç°æˆ‘ä»¬çš„æ‰“å°ç»“æœå·²ç»å˜æˆäº†æ™®é€šå‡½æ•°äº†ã€‚

æ­¤æ—¶ï¼Œè®©æˆ‘ä»¬æ¥æ³¨é‡Šæ‰å¯¹åº”çš„`@babel/register`

```
//Â require('@babel/register')constÂ dataÂ =Â require('./register');console.log(`${data}`,Â 'data');
```

![](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHpqibzaPCcJ4KA6EVrOFbnTQ1XvBBkQ0dYTelVPrJWLLxhQS60kloqfJ0KFU24oicmmNJibdmskrtEWQ/640?wx_fmt=other)image.png

æˆ‘ä»¬å‘ç°æ­¤æ—¶æˆ‘ä»¬çš„ç®­å¤´å‡½æ•°å¹¶æ²¡æœ‰è¢«`preset-env`ç”Ÿæ•ˆã€‚

å†™åœ¨ç»“å°¾
----

è‡³æ­¤ï¼Œæ„Ÿè°¢æ¯ä¸€ä½çœ‹åˆ°è¿™é‡Œçš„å°ä¼™ä¼´ã€‚

æ–‡ç« ä¸­çš„`babel`è®²è§£ä¹Ÿä¸è¿‡æ˜¯å†°å±±ä¸€è§’ï¼Œå¸Œæœ›æˆä¸ºè¿™ç¯‡æ–‡ç« ä¼šæˆä¸ºå¤§å®¶æ¢ç´¢`Babel`çš„èµ·ç‚¹ã€‚

### å‚è€ƒèµ„æ–™

[1]

https://babeljs.io/docs/en/babel-preset-env: _https://link.juejin.cn?target=https%3A%2F%2Fbabeljs.io%2Fdocs%2Fen%2Fbabel-preset-env_

[2]

https://babeljs.io/docs/en/babel-preset-env#options: _https://link.juejin.cn?target=https%3A%2F%2Fbabeljs.io%2Fdocs%2Fen%2Fbabel-preset-env%23options_

[3]

https://babeljs.io/docs/en/plugins-list: _https://link.juejin.cn?target=https%3A%2F%2Fbabeljs.io%2Fdocs%2Fen%2Fplugins-list_

[4]

https://babeljs.io/setup: _https://link.juejin.cn?target=https%3A%2F%2Fbabeljs.io%2Fsetup_

[5]

https://babeljs.io/docs/en/babel-core: _https://link.juejin.cn?target=https%3A%2F%2Fbabeljs.io%2Fdocs%2Fen%2Fbabel-core_

[6]

https://juejin.cn/post/7011128931533193230: _https://juejin.cn/post/7011128931533193230_

[7]

https://babeljs.io/docs/en/babel-polyfill: _https://link.juejin.cn?target=https%3A%2F%2Fbabeljs.io%2Fdocs%2Fen%2Fbabel-polyfill_

[8]

https://babeljs.io/docs/en/babel-polyfill: _https://link.juejin.cn?target=https%3A%2F%2Fbabeljs.io%2Fdocs%2Fen%2Fbabel-polyfill_

[9]

https://github.com/browserslist/browserslist: _https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbrowserslist%2Fbrowserslist_

[10]

https://babeljs.io/docs/en/babel-plugin-transform-runtime#helpers: _https://link.juejin.cn?target=https%3A%2F%2Fbabeljs.io%2Fdocs%2Fen%2Fbabel-plugin-transform-runtime%23helpers_

[11]

https://babeljs.io/docs/en/babel-plugin-transform-runtime: _https://link.juejin.cn?target=https%3A%2F%2Fbabeljs.io%2Fdocs%2Fen%2Fbabel-plugin-transform-runtime_

[12]

https://astexplorer.net/: _https://link.juejin.cn?target=https%3A%2F%2Fastexplorer.net%2F_

[13]

https://astexplorer.net/: _https://link.juejin.cn?target=https%3A%2F%2Fastexplorer.net%2F_

[14]

https://github.com/starkwang/the-super-tiny-compiler-cn: _https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fstarkwang%2Fthe-super-tiny-compiler-cn_

[15]

https://babeljs.io/docs/en/babel-types: _https://link.juejin.cn?target=https%3A%2F%2Fbabeljs.io%2Fdocs%2Fen%2Fbabel-types_

[16]

https://astexplorer.net/: _https://link.juejin.cn?target=https%3A%2F%2Fastexplorer.net%2F_

[17]

https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md: _https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjamiebuilds%2Fbabel-handbook%2Fblob%2Fmaster%2Ftranslations%2Fzh-Hans%2Fplugin-handbook.md_

[18]

https://astexplorer.net/: _https://link.juejin.cn?target=https%3A%2F%2Fastexplorer.net%2F_

[19]

https://astexplorer.net/: _https://link.juejin.cn?target=https%3A%2F%2Fastexplorer.net%2F_

[20]

https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md: _https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjamiebuilds%2Fbabel-handbook%2Fblob%2Fmaster%2Ftranslations%2Fzh-Hans%2Fplugin-handbook.md_

[21]

https://github.com/19Qingfeng/QPACK: _https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F19Qingfeng%2FQPACK_

[22]

http://coffeescript.org/v2/annotated-source/register.html: _https://link.juejin.cn?target=http%3A%2F%2Fcoffeescript.org%2Fv2%2Fannotated-source%2Fregister.html_

[23]

https://stackoverflow.com/questions/35349936/what-does-register-mean-in-babel-register: _https://link.juejin.cn?target=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F35349936%2Fwhat-does-register-mean-in-babel-register_