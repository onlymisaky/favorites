> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/mbDjUmV6E30FDkkp_gA1iA)

![](https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naLVe9jbwCGjoILoSXWmpjBz1UsNgcRofN0XiaAibiatmpp5ia0GxCK6WTEiacwiaV0meqw2Ml4qiclRuhFqw/640?wx_fmt=jpeg&from=appmsg)  

å¯¼è¯»

ä½ çš„ useMemo çœŸæ­£ä¸ºä½ çš„é¡¹ç›®å¸¦æ¥äº†å¤šå°‘æ€§èƒ½ä¸Šçš„ä¼˜åŒ–ï¼Ÿç”±äº useMemo å’Œ useCallback ç±»ä¼¼ï¼Œæ‰€ä»¥æœ¬æ–‡å…¨æ–‡ä¼šåœ¨å¤§éƒ¨åˆ†åœ°æ–¹ä»¥ useMemo ä¸ºä¾‹ï¼Œéƒ¨åˆ†ä¾‹å­ä½¿ç”¨ useCallback å¸®åŠ©å¤§å®¶æ›´å¥½çš„ç†è§£ä¸¤ä¸ª hooksã€‚

ä¸çŸ¥é“å¤§å®¶åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè€ƒè™‘ä½¿ç”¨ useMemoï¼Œä½ æ˜¯ä¸æ˜¯è¿™ä¹ˆæƒ³çš„ï¼Ÿ  

ã€Œä¸çŸ¥é“è¡Œä¸è¡Œï¼Œä½†æ˜¯æ„Ÿè§‰è¿™é‡Œéœ€è¦ memo ä¸€ä¸‹ï¼Œç”¨äº†æŒ‡å®šèƒ½ä¼˜åŒ–ï¼Œå°±ç®—ä¸è¡Œä¹Ÿæ²¡å•¥å½±å“ã€

ã€Œéœ€è¦å¯¹æ•°æ®å¤„ç†ï¼Œé‡å¥½åƒè¿˜æŒºå¤šï¼Œä¸”ä¸æ€ä¹ˆéœ€è¦å˜åŒ–ï¼Œç¬¦åˆ memo çš„èƒ½åŠ›ã€

ã€Œæ•°æ®å¤„ç†èµ·æ¥å¾ˆéº»çƒ¦ï¼Œå†™æ–¹æ³•ä¸ä¹æ„ï¼Œmemo å¥½åƒå¯ä»¥å¸®æˆ‘å¥—ä¸€å±‚ç”¨æ–¹æ³•çš„å†™æ³•è¿”å›æ•°æ®ï¼ŒçœŸä¸æˆ³ã€

useMemo èƒ½å¸¦æ¥æ€§èƒ½ä¼˜åŒ–ï¼Œä½†æ˜¯ä½ çš„ useMemo çœŸçš„ä¸ºä½ çš„é¡¹ç›®å¸¦æ¥äº†å¤šå°‘æ€§èƒ½ä¸Šçš„ä¼˜åŒ–ï¼Ÿä½ ç¡®å®šä½ å†™çš„çœŸçš„æœ‰å¸¦æ¥ä¼˜åŒ–ï¼Œè¿˜æ˜¯ä½ çš„è‡ªæˆ‘å®‰æ…°ï¼Ÿ

ä½ ä¸ºä»€ä¹ˆè¦ç”¨ useMemoï¼Ÿ

æˆ‘ç”¨äº† useMemoï¼Œå‡å°‘äº†ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼Œåº”è¯¥æ˜¯æˆ‘èƒ½æƒ³åˆ°éå¸¸å¥½çš„**ä¼˜åŒ–**æ‰‹æ®µäº†ã€‚

æˆ‘åŠ äº† useMemo ä¹‹åï¼Œå°±èƒ½å¤Ÿè®©æˆ‘å†™çš„ä»£ç é‡æ¸²æŸ“**ä»£ä»·**æ›´å°ï¼Œå¤ªå¥½äº†ã€‚

å¥½å¥½å¥½ï¼Œéƒ½è¿™æ ·æƒ³æ˜¯å§ï¼Ÿå¸Œæœ›è¯»å®Œä»Šå¤©è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿè®©ä½ çš„å……æ»¡**ã€Œè‡ªä¿¡ã€**åœ°åˆ é™¤ä½ ç°åœ¨ä»£ç ä¸­ 95% çš„ useMemoï¼Œç„¶åä½ è¿˜ä¼šå‘ç°ï¼Œé¡¹ç›®å¯èƒ½åè€Œè¿è¡Œçš„**æ›´å¿«**äº†ï¼Œç»´æŠ¤çš„æˆæœ¬**æ›´å°**äº†ã€‚

![](https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naLVe9jbwCGjoILoSXWmpjBzNlsqHgT63iaI19LPkaaib9fDicChyOU8y2UOll7ALRSmFC7VhicETQQJ4A/640?wx_fmt=jpeg&from=appmsg)

ç†è§£æ„Ÿæ‚Ÿé˜¶æ®µå›¾

å•¥æ˜¯ useMemoï¼Ÿ

ä»å®˜æ–¹çš„æ–‡æ¡£ä¸­å¯ä»¥çœ‹åˆ° useMemo è¿™ä¸ª hooks çš„å®šä¹‰ï¼šå®ƒåœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“çš„æ—¶å€™èƒ½å¤Ÿç¼“å­˜è®¡ç®—çš„ç»“æœã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naLVe9jbwCGjoILoSXWmpjBzXfvXu3bZZ5Oq7pTHlZIicXlndNvvia7M7j0lRmw6SNCYFNUQC3JSeToA/640?wx_fmt=png&from=appmsg)ï»¿ï»¿

å®˜æ–¹æ–‡æ¡£å®šä¹‰

å¾ˆå¤šäººäº†è§£ useMemoï¼Œå¯èƒ½ä¹Ÿå°±æ˜¯è¿™ä¸€å¥è¯ï¼Œåˆ©ç”¨äº† useMemo èƒ½å¤Ÿç¼“å­˜è®¡ç®—ç»“æœçš„ç‰¹æ€§ã€‚

å¯¹ useMemo å†äº†è§£å¤šä¸€äº›ä¼šçŸ¥é“ useMemo å¹¶ä¸èƒ½å¸®åŠ©ä½ æé«˜ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„é€Ÿåº¦ï¼Œåªå¯èƒ½ä¼šåœ¨ä½ é‡æ–°æ¸²æŸ“ä¹‹åæé«˜é‡æ¸²æŸ“çš„é€Ÿåº¦ï¼ˆå‰ææ˜¯ä½ ä¼šæ­£ç¡®ä½¿ç”¨ useMemoï¼‰ã€‚

å¯¹äº useMemo èƒ½å¤Ÿäº†è§£ä»¥ä¸Šçš„ä¿¡æ¯ï¼Œæˆ‘è§‰å¾—æ˜¯å¤„äº**ã€Œç†Ÿæ‚‰å¹¶ä½¿ç”¨äº†å¾ˆä¹…ã€**é˜¶æ®µçš„åŒå­¦ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å†ç»§ç»­çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ä¸­ useMemo çš„ç”¨æ³•æœ‰å“ªäº›ï¼š

1. è·³è¿‡ä»£ä»·æ˜‚è´µçš„é‡æ–°è®¡ç®—

2. è·³è¿‡ç»„ä»¶çš„é‡æ¸²æŸ“

3. è®°å¿†å¦ä¸€ä¸ª Hook çš„ä¾èµ–

4. è®°å¿†ä¸€ä¸ªå‡½æ•°

æ ¸å¿ƒæºç 

> åªæŒ‘é‡ç‚¹ï¼Œè½¬æ¢ä¸ºç™½è¯ï¼Œå‡å°‘æºç å¸¦æ¥çš„ææƒ§æ„Ÿï¼Œè¯·å„ä½å®¢å®˜æ”¾å¿ƒé£Ÿç”¨ï½

è¿™é‡Œåªçœ‹æºç çš„é‡ç‚¹éƒ¨åˆ†ï¼Œåœ¨é‡æ¸²æŸ“æ—¶ï¼ŒuseMemo ä¼šæ¯”è¾ƒæ¯ä¸€ä¸ªä¾èµ–é¡¹ï¼Œå…·ä½“çš„æ¯”è¾ƒå‚è€ƒ Object.is()ï¼Œè™½ç„¶è¿™ä¸ªæ¯”è¾ƒéå¸¸çš„å¿«ï¼Œä½†æ˜¯è¿™é‡Œæƒ³è¦ç»™å¤§å®¶ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯ä½¿ç”¨ useMemo å¹¶ä¸æ˜¯ç™¾åˆ©è€Œæ— ä¸€å®³ï¼Œå®ƒä¹Ÿéœ€è¦å¤„ç†å’Œæ¯”è¾ƒã€‚å…·ä½“çš„åé¢æˆ‘ä»¬ä¼šç”¨ä¾‹å­æ¥è¯´æ˜ã€‚

```
function areHookInputsEqual(
  nextDeps: Array<mixed>,
  prevDeps: Array<mixed> | null,
): boolean {
  // çœç•¥éƒ¨åˆ†
  ...
  // $FlowFixMe[incompatible-use] found when upgrading Flow
  for (let i = 0; i < prevDeps.length && i < nextDeps.length; i++) {
    // $FlowFixMe[incompatible-use] found when upgrading Flow
    if (is(nextDeps[i], prevDeps[i])) {
      continue;
    }
    return false;
  }
  return true;
}
```

```
function is(x: any, y: any) {
  return (
    (x === y && (x !== 0 || 1 / x === 1 / y)) || (x !== x && y !== y) // eslint-disable-line no-self-compare
  );
}
```

ä¸ºä»€ä¹ˆä¸€ä¸ªç»„ä»¶ä¼šé‡æ¸²æŸ“å®ƒè‡ªå·±ï¼Ÿ

ä¼—æ‰€å‘¨çŸ¥ï¼šstate æˆ–è€… props å˜åŒ–æ—¶ï¼Œç»„ä»¶å°±ä¼šé‡æ¸²æŸ“å®ƒè‡ªå·±

![](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naLVe9jbwCGjoILoSXWmpjBzhOd4MUbPPEYhLoVVNC0mMLL5WjSXdicQ4EicF3oxIn9sHQsmJjYYmviag/640?wx_fmt=png&from=appmsg)ï»¿ï»¿

**A æ˜¯ B çš„å……åˆ†æ¡ä»¶ï¼Œå¹¶ä¸æ„å‘³ç€ !A æ˜¯ !B çš„å……åˆ†æ¡ä»¶**

å¯¼è‡´ç»„ä»¶é‡æ¸²æŸ“çš„è¿˜æœ‰ä¸€ä¸ªå¯èƒ½æ€§ï¼Œé‚£å°±æ˜¯**çˆ¶ç»„ä»¶é‡æ¸²æŸ“**

ä¸‹é¢æ¥çœ‹ä¸€æ®µä»£ç ï¼š

```
const Page = () => <Item />;

const App = () => {
  const [state, setState] = useState(1);
  return (
    <div>

      <button onClick={() => setState(state + 1)}>
        click to re-render {state}
      </button>

      // Pageæ˜¯å­ç»„ä»¶ï¼Œä¸”æ²¡æœ‰propsï¼Œé‡Œé¢ä¹Ÿæ²¡æœ‰state
      <Page />

    </div>
  );
};
```

Page æ˜¯ä¸€ä¸ªæ²¡æœ‰ props ä¹Ÿæ²¡æœ‰ state çš„ç»„ä»¶ï¼Œä½†æ˜¯å½“æˆ‘ç‚¹å‡»æŒ‰é’®æ—¶ï¼ŒApp é‡æ¸²æŸ“äº†ï¼ˆå› ä¸º state å˜åŒ–ï¼‰ï¼ŒPage ä¾æ—§é‡æ¸²æŸ“ï¼Œå¹¶ä¸” Page é‡Œé¢çš„ Item ä¹Ÿä¼šé‡æ¸²æŸ“ï¼Œæ•´ä¸ªé“¾è·¯éƒ½ä¼šé‡æ¸²æŸ“ã€‚å¦‚ä½•æ‰“æ–­è¿™ä¸ªé‡æ¸²æŸ“ï¼Ÿ**- React.memo**

```
const Page = () => <Item />;
const PageMemoized = React.memo(Page);

const App = () => {
  const [state, setState] = useState(1);
  return (
   // ... same code as before
    <PageMemoized />
  );
};
```

å½“è¿™äº›å·¥ä½œéƒ½åšå¥½äº†ï¼Œæ­¤æ—¶ï¼Œå†å»è€ƒè™‘ä½ çš„ Page çš„ propsï¼Œæ‰æ˜¯æœ‰æ„ä¹‰çš„ã€‚

æ€è€ƒä¸€ä¸‹ä¸Šé¢ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œåªæœ‰åœ¨å”¯ä¸€çš„ä¸€ç§åœºæ™¯ä¸‹ï¼Œç¼“å­˜ props æ‰æ˜¯æœ‰æ„ä¹‰çš„ï¼šå½“ç»„ä»¶çš„æ¯ä¸€ä¸ª propï¼Œä»¥åŠç»„ä»¶æœ¬èº«è¢«ç¼“å­˜çš„æ—¶å€™ã€‚

å¦‚æœç»„ä»¶ä»£ç é‡Œæœ‰ä»¥ä¸‹æƒ…å½¢ï¼Œæˆ‘ä»¬å¯ä»¥æ¯«æ— å¿ƒç†è´Ÿæ‹…åœ°åˆ æ‰ useMemo å’Œ useCallbackï¼š

*   å®ƒä»¬è¢«ä½œä¸ºÂ attributesÂ ï¼Œç›´æ¥åœ°æˆ–ä½œä¸ºä¾èµ–æ ‘çš„ä¸Šå±‚ï¼Œè¢«ä¼ é€’åˆ°æŸä¸ª DOM ä¸Šï¼›
    
*   å®ƒä»¬è¢«ä½œä¸ºÂ propsï¼Œç›´æ¥åœ°æˆ–ä½œä¸ºä¾èµ–æ ‘çš„ä¸Šå±‚ï¼Œè¢«ä¼ é€’åˆ°æŸä¸ªæœªè¢«ç¼“å­˜çš„ç»„ä»¶ä¸Šï¼›
    
*   å®ƒä»¬è¢«ä½œä¸ºÂ propsï¼Œç›´æ¥åœ°æˆ–ä½œä¸ºä¾èµ–æ ‘çš„ä¸Šå±‚ï¼Œè¢«ä¼ é€’åˆ°æŸä¸ªç»„ä»¶ä¸Šï¼Œè€Œé‚£ä¸ªç»„ä»¶è‡³å°‘æœ‰ä¸€ä¸ªÂ propÂ æœªè¢«ç¼“å­˜ï¼›
    

![](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naLVe9jbwCGjoILoSXWmpjBzL5p15cc9EdKsKHTWKJaTph7Jz2V5RlDZctMCQYP9E5wM3zDyg8GFAQ/640?wx_fmt=png&from=appmsg)

é¿å…æ¯æ¬¡æ¸²æŸ“æ—¶è¿›è¡Œæ˜‚è´µçš„è®¡ç®—

> è¿™é‡Œæš‚æ—¶ä½¿ç”¨è¿™ç¯‡æ–‡ç« è®¡ç®—çš„æ•°æ®ï¼šhttps://www.developerway.com/posts/how-to-use-memo-use-callbackï»¿

> è®¡ç®—ä»£ç ï¼šhttps://codesandbox.io/s/measure-without-memo-tnhggk?file=/src/page.tsxï»¿

è¯»åˆ°è¿™è¾¹ï¼Œæƒ³å¿…è¯»è€…ä¹Ÿåº”è¯¥çŸ¥é“ useMemo åˆ°åº•æ˜¯åšå•¥çš„ï¼Œæ­£å¦‚è¿™ä¸€ä¸ªå°æ ‡é¢˜æ‰€è¯´çš„â€”â€”useMemo çš„ä¸»è¦ç›®æ ‡æ˜¯é¿å…æ¯æ¬¡æ¸²æŸ“æ—¶è¿›è¡Œæ˜‚è´µçš„è®¡ç®—ã€‚é‚£ä»€ä¹ˆæ˜¯**æ˜‚è´µçš„è®¡ç®—**ï¼Ÿ

ä¸çŸ¥é“ï¼Œå®˜ç½‘å¥½åƒæ²¡å†™ï¼Œæˆ–è€…è¯´ä½ æ²¡æ‰¾åˆ°ã€‚æ‰€ä»¥ä½ å°±ä¸ç®¡ä»–ä¸‰ä¸ƒäºŒåä¸€ï¼Œç”¨å°±å®Œäº‹äº†ã€‚åˆ›å»ºæ–°æ—¥æœŸï¼Ÿè¿‡æ»¤ã€æ˜ å°„æˆ–æ’åºæ•°ç»„ï¼Ÿåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Ÿå…¨éƒ¨ useMemo ä¸€æŠŠæ¢­ï¼ŒuseMemo ç»ˆå°†å é¢†æ‰€æœ‰çš„ React é¡¹ç›®ï¼

å¥½å§ï¼Œé‚£æˆ‘ä»¬æ‹¿æ•°æ®æ¥çœ‹çœ‹ï¼Œæ¯”å¦‚è¯´æˆ‘è¿™æœ‰ä¸€ç³»åˆ—çš„å›½å®¶å’Œåœ°åŒºï¼ˆ250 ä¸ªï¼‰ï¼Œä½ å¸Œæœ›å¯¹å®ƒè¿›è¡Œæ’åºï¼Œç„¶åå±•ç¤ºå‡ºæ¥ã€‚

```
const Item = ({ country }: { country: Country }) => {
  return <button>{country.name}</button>;
};


const List = ({ countries }) => {
  // sorting list of countries here
  const sortedCountries = orderBy(countries, 'name', sort);

  return (
    <>
      {sortedCountries.map((country) => (
        <Item country={country} key={country.id} />
      ))}
    </>
  );
};
```

![](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naLVe9jbwCGjoILoSXWmpjBzs157u9rM5btmTq5UWfv5FwJvKX5Uic3ykiajhJXTzgkiaibQWiaCKJenQWA/640?wx_fmt=png&from=appmsg)

æ¸²ç„¶åçš„æŒ‰é’®åˆ—è¡¨

åœ¨æ²¡æœ‰ memo çš„æƒ…å†µä¸‹ï¼Œå°†æ•´ä¸ª CPU é€Ÿåº¦é™ä½ 6 å€ï¼Œå¯¹åŒ…å« 250 ä¸ªæ•°æ®è¿›è¡Œæ’åºåªéœ€è¦ä¸åˆ° 2 æ¯«ç§’ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œæ¸²æŸ“æ•´ä¸ªåˆ—è¡¨ï¼ˆåªæ˜¯ button å¸¦æ–‡å­—ï¼‰ï¼Œéœ€è¦è¶…è¿‡ **20 æ¯«ç§’**ã€‚

æ—¥å¸¸å¼€å‘æ¥è¯´ï¼Œæˆ‘ä»¬å¾ˆå°‘æœ‰è¿™ä¹ˆå¤šæ•°æ®çš„å¤„ç†ã€‚å†è€…æˆ‘ä»¬åªæ¸²æŸ“äº†æ™®é€šçš„ Button

æ‰€ä»¥ï¼Œä½ çœŸæ­£è¦åšçš„æ˜¯ memo è¿™ä¸ªæ•°ç»„çš„æ“ä½œï¼Œè¿˜æ˜¯è¯´ memo ç»„ä»¶çš„æ¸²æŸ“å’Œæ›´æ–°å‘¢ï¼Ÿ

```
const List = ({ countries }) => {
  const content = useMemo(() => {
    const sortedCountries = orderBy(countries, 'name', sort);

    return sortedCountries.map((country) => <Item country={country} key={country.id} />);
  }, [countries, sort]);

  return content;
};
```

å½“æˆ‘ä»¬ memo äº†ç»„ä»¶ä¹‹åæˆ‘ä»¬å‘ç°æ•´ä½“çš„çš„æ¸²æŸ“åˆ—è¡¨æ—¶é—´ä»åŸå…ˆçš„ **20 æ¯«ç§’**ï¼Œå‡å°‘äº†ä¸åˆ° 2 æ¯«ç§’ï¼ˆ18 æ¯«ç§’å·¦å³ï¼‰

åœ¨å®é™…åœºæ™¯ä¸­ï¼Œæ•°ç»„å¾€å¾€æ¯”ç¤ºä¾‹ä¸­çš„æ›´å°ï¼ŒåŒæ—¶æ¸²æŸ“çš„å†…å®¹æ¯”ç¤ºä¾‹ä¸­çš„æ›´å¤æ‚ï¼Œå› æ­¤æ›´æ…¢ã€‚æ‰€ä»¥æ€»çš„æ¥è¯´ã€Œè®¡ç®—ã€ä¸ã€Œæ¸²æŸ“ã€ä¹‹é—´çš„è€—æ—¶å¾€å¾€**è¶…è¿‡ 10 å€**ã€‚

é—®é¢˜åˆæ¥äº†ï¼Œé‚£ä¸ºå•¥ä¸€å®šè¦åˆ æ‰å®ƒä»¬å‘¢ï¼ŸæŠŠæ‰€æœ‰ä¸œè¥¿ç¼“å­˜èµ·æ¥ä¸æ˜¯æ›´å¥½å—ï¼Ÿå“ªæ€•åªè®©é‡æ¸²æŸ“é€Ÿåº¦æå‡äº† 2msï¼Œè¿™é‡Œæå‡ 2msï¼Œé‚£é‡Œæå‡ 2msï¼Œç´¯åŠ èµ·æ¥å°±å¾ˆå¯è§‚äº†å‘€ã€‚æ¢ä¸ªè§’åº¦çœ‹ï¼Œå¦‚æœå®Œå…¨ä¸å†™ useMemoï¼Œé‚£ä¹ˆåº”ç”¨å°±ä¼šåœ¨è¿™é‡Œæ…¢ 2msï¼Œåœ¨é‚£é‡Œåˆæ…¢ 2msï¼Œå¾ˆå¿«æˆ‘ä»¬çš„åº”ç”¨å°±ä¼šæ¯”å®ƒä»¬åŸæœ¬èƒ½è¾¾åˆ°çš„ç¨‹åº¦æ…¢çš„å¤šäº†ã€‚

å¬èµ·æ¥å¾ˆæœ‰é“ç† ï¼Œå¹¶ä¸”ï¼Œå¦‚æœä¸æ˜¯è€ƒè™‘åˆ°å¦ä¸€ç‚¹çš„è¯ï¼Œä»¥ä¸Šæ¨è®ºç¡®å® 100% è¯´å¾—é€šã€‚è¿™ä¸€ç‚¹ä¾¿æ˜¯ï¼šç¼“å­˜å¹¶ä¸æ˜¯æ¯«æ— å¼€é”€çš„ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ useMemoï¼Œåœ¨åˆå§‹æ¸²æŸ“è¿‡ç¨‹ä¸­ React å°±éœ€è¦ç¼“å­˜å…¶å€¼äº†â€”â€”è¿™å½“ç„¶ä¹Ÿäº§ç”Ÿè€—æ—¶ã€‚æ²¡é”™ï¼Œè¿™è€—æ—¶å¾ˆå¾®å°ï¼Œåœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œç¼“å­˜ä¸Šè¿°æåˆ°è¿‡çš„æ’åºå›½å®¶åˆ—è¡¨è€—æ—¶ä¸è¶…è¿‡ 1msã€‚ä½†æ˜¯ï¼**è¿™æ‰ä¼šäº§ç”Ÿè´§çœŸä»·å®çš„å åŠ æ•ˆåº”ï¼**åœ¨åˆå§‹æ¸²æŸ“è®©ä½ çš„åº”ç”¨ç¬¬ä¸€æ¬¡å‘ˆç°åœ¨å±å¹•å‰çš„è¿‡ç¨‹ä¸­ï¼Œå½“å‰é¡µé¢çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä¼šç»å†è¿™ä¸€è¿‡ç¨‹ï¼Œè¿™å°†å¯¼è‡´ 10~20 msï¼Œæˆ–æ›´ç³Ÿç³•çš„ï¼Œ**æ¥è¿‘ 100ms çš„ä¸å¿…è¦çš„å»¶æ—¶ã€‚**

ä¸åˆå§‹æ¸²æŸ“ç›¸æ¯”ï¼Œé‡æ¸²æŸ“ä»…ä»…åœ¨é¡µé¢æŸäº›éƒ¨åˆ†æ”¹å˜æ—¶å‘ç”Ÿã€‚åœ¨ä¸€ä¸ªæ¶æ„åˆç†çš„åº”ç”¨ä¸­ï¼Œåªæœ‰è¿™äº›ç‰¹å®šåŒºåŸŸçš„ç»„ä»¶æ‰ä¼šé‡æ¸²æŸ“ï¼Œè€Œéæ•´ä¸ªåº”ç”¨ï¼ˆé¡µé¢ï¼‰ã€‚é‚£ä¹ˆåœ¨ä¸€æ¬¡å¯»å¸¸çš„é‡æ¸²æŸ“ä¸­ï¼Œæ€»çš„ â€œè®¡ç®—â€ çš„æ¶ˆè€—å’Œæˆ‘ä»¬ä¸Šé¢æåˆ°çš„ä¾‹å­ï¼ˆæ³¨ï¼šæŒ‡ 250 ä¸ªå…ƒç´ çš„æ’åºåˆ—è¡¨ï¼‰ç›¸æ¯”ï¼Œä¼šé«˜å‡ºå¤šå°‘å‘¢ï¼Ÿ2~3 å€ï¼Ÿï¼Œå°±å‡è®¾æœ‰ 5 å€å¥½äº†ï¼Œé‚£ä¹Ÿä»…ä»…æ˜¯èŠ‚çœäº† 10ms çš„æ¸²æŸ“æ—¶é—´ï¼Œè¿™ä¹ˆçŸ­çš„æ—¶é—´é—´éš”æˆ‘ä»¬çš„è‚‰çœ¼æ˜¯æ— æ³•å¯Ÿè§‰çš„ï¼Œå¹¶ä¸”åœ¨åå€çš„æ¸²æŸ“æ—¶é—´ä¸‹ï¼Œè¿™ 10 ms ä¹Ÿç¡®å®å¾ˆä¸èµ·çœ¼ã€‚å¯ä½œä¸ºä»£ä»·çš„æ˜¯ï¼Œå®ƒç¡®å®**æ‹–æ…¢äº†æ¯æ¬¡éƒ½ä¼šå‘ç”Ÿçš„åˆå§‹æ¸²æŸ“è¿‡ç¨‹ğŸ˜”ã€‚**

å¸¸è§çš„é”™è¯¯ç”¨æ³•ï¼ˆé‡ç‚¹ï¼‰

**åˆçº§**

è¿™é‡Œçš„ useCallback æ¯«æ— ç”¨å¤„ï¼Œå½“ Component é‡æ¸²æŸ“ï¼Œæ‰€æœ‰ç›¸å…³çš„å­ç»„ä»¶å…¨éƒ¨éƒ½ä¼šé‡æ¸²æŸ“ï¼ˆæ— è§† propsï¼‰ï¼Œåœ¨è¿™ä¸ªæƒ…å½¢ä¸‹ï¼Œå¯¹äº click çš„ memo å°†æ¯«æ— æ„ä¹‰ã€‚

```
const Component = () => {
  const onClick = useCallback(() => {
    /* do something */
  }, []);
  return <button onClick={onClick}>Click me</button>
};
```

æ­¤æ—¶ä½ çš„å­ç»„ä»¶è¢« memo åŒ…è£¹ï¼ŒonClick ä¹Ÿè¢« useCallback åŒ…è£¹ï¼Œä½†æ˜¯ value å¹¶æ²¡æœ‰è¢«åŒ…è£¹ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½ çš„ Component é‡æ¸²æŸ“ï¼Œä½ çš„ MemoItem ä¾æ—§ä¼šé‡æ¸²æŸ“ï¼Œæ­¤æ—¶ useCallback è¿˜æ˜¯ä»€ä¹ˆéƒ½æ²¡åšã€‚

```
const Item = () => <div> ... </div>
const MemoItem = React.memo(Item)
const Component = () => {
  const onClick = useCallback(() => {
    /* do something */
  }, []);
  return <MemoItem onClick={onClick} value={[1,2,3]}/>
};
```

**ä¸­çº§**

è¿™ä¸ªçœ‹èµ·æ¥åº”è¯¥æ²¡å•¥é—®é¢˜äº†å§ï¼ŸonClick è¢« useCallback åŒ…è£¹äº†ï¼Œç„¶å MemoItem ä¹Ÿè¢« memo äº†ï¼Œè¿™å›å¤©ç‹è€å­æ¥äº†éƒ½ä¸èƒ½é‡æ¸²æŸ“å§ï¼Œä¸ç„¶æˆ‘å­¦çš„çŸ¥è¯†éƒ½ç™½å­¦äº†ï¼Ÿ

```
const Item = () => <div> ... </div>
const MemoItem = React.memo(Item)
const Component = () => {
  const onClick = useCallback(() => {
    /* do something */
  }, []);
  return 
  <MemoItem onClick={onClick}>
    <div>something</div>
  </MemoItem>
};
```

æ²¡é”™ï¼Œè¿™ä¸ªä¼šé‡æ¸²æŸ“å“¦ã€‚ä¸Šé¢è¿™æ®µä»£ç ç›¸å½“äºï¼š

```
// ä»¥ä¸‹å†™æ³•å‡ç­‰ä»·ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨propsä¸­ä¼ é€’childrenï¼Œå’Œç›´æ¥childrenåµŒå¥—æ˜¯ä¸€è‡´çš„
React.createElement('div',{
  children:'Hello World'
})

React.createElement('div',null,'Hello World')

<div>Hello World</div>
```

```
const Item = () => <div> ... </div>
const MemoItem = React.memo(Item) // useless
const Component = () => {
  const onClick = useCallback(() => { //useless
    /* do something */
  }, []);
  return 
  <MemoItem 
    onClick={onClick} 
    children={<div>something</div>}
  />
};
```

æœ‰äº›åŒå­¦çœ‹åˆ°è¿™é‡Œè¿˜ä¸ç†è§£ï¼šâ€œå°±ç®—ä½ è¯´å­ç»„ä»¶ç›¸å½“äº childrenï¼Œä½†æ˜¯æˆ‘ div è¿˜æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œä½ å‡­å•¥è¯´æˆ‘ props å˜åŒ–äº†â€ã€‚æœ‰è¿™ç§æƒ³æ³•çš„åŒå­¦å…ˆæ”¾ä¸€æ”¾ï¼Œæˆ‘ä»¬çœ‹æœ€åä¸€ä¸ªã€‚

**é«˜çº§**

å¥½å¥½å¥½ï¼Œä½ è¦è¿™æ ·è¯´æ˜¯å§ï¼Œè¡Œï¼Œé‚£æˆ‘éƒ½åŒ…è£¹èµ·æ¥ã€‚è¿™å›ç‰çš‡å¤§å¸æ¥äº†ä¹Ÿæ‹¦ä¸ä½æˆ‘ï¼Œè¿™å›å¿… memo ä½äº†ï¼

```
const Item = () => <div> ... </div>
const Child = () => <div>sth</div>

const MemoItem = React.memo(Item)
const MemoChild = React.memo(Child)

const Component = () => {
  const onClick = useCallback(() => { 
    /* do something */
  }, []);
  return (
    <MemoItem onClick={onClick}>
      <MemoChild />
    </MemoItem>
  )
};
```

ç­”æ¡ˆè¿˜æ˜¯æ²¡æœ‰ memo ä½ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ¥æˆ‘ä»¬æŠŠ MemoChild å•ç‹¬æ‹¿å‡ºæ¥è§£æä¸€ä¸‹ï¼Œå®ƒæ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼š

```
const child = <MemoChild />;
```

```
const child = React.createElement(MemoChild,props,childen);
```

```
const child = {
  type: MemoChild,
  props: {}, // same props
  ... // same interval react stuff
}
```

å‰é¢çš„é—®é¢˜ä¹Ÿè¿åˆƒè€Œè§£ï¼Œå…¶å®æ¯æ¬¡ create çš„æ—¶å€™ï¼Œåˆ›å»ºçš„ child éƒ½æ˜¯ä¸ä¸€æ ·çš„å¯¹è±¡ï¼Œæ‰€ä»¥ä¸€æ¯”è¾ƒå°±é‡æ¸²æŸ“äº†ã€‚

**ç»ˆæè§£å†³æ€è·¯**

å¦‚æœä½ çœŸçš„æƒ³è¦ memo ä½ï¼Œä½ åº”è¯¥ memo çš„ç›®æ ‡æ˜¯ Element æœ¬èº«ï¼Œè€Œä¸æ˜¯ Componentã€‚useMemo ä¼šç¼“å­˜ä¹‹å‰çš„å€¼ï¼Œå¦‚æœ memo çš„ä¾èµ–é¡¹æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¼šç”¨ç¼“å­˜çš„æ•°æ®è¿”å›ã€‚

```
const Child = () => <div>sth</div>

const MemoItem = React.memo(Item)

const Component = () => {
  const onClick = useCallback(() => { 
    /* do something */
  }, []);
  const child = useMemo(()=> <Child /> ,[])
  return (
    <MemoItem onClick={onClick}>
      {child}
    </MemoItem>
  )
};
```

ç»ˆäºï¼Œæˆ‘ä»¬çš„ç»„ä»¶ memo æˆåŠŸäº†ï¼

å¦‚æœä½ è§‰å¾—è‡ªå·±ä¹‹å‰å®Œå…¨ä¸çŸ¥é“è¿™ä¸ªç‰¹æ€§ï¼Œä¸éœ€è¦æ²®ä¸§ï¼ŒReact-Query ä½œè€… Dominik å¾ˆé•¿ä¸€æ®µæ—¶é—´ä¹Ÿä¸çŸ¥é“è¿™ä¸ªç‰¹æ€§ã€‚å¯¹äºè¿™ä¸€å—å¯ä»¥å±•å¼€è¯´å¾ˆå¤šçŸ¥è¯†ç‚¹ï¼Œæ¶µç›–äº† JSX æœ¬è´¨ï¼Œreact æœ¬èº«çš„ diffï¼Œè¿™é‡Œä¸å†å±•å¼€èµ˜è¿°ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡æ¡£ï¼š

ã€ŠOne simple trick to optimize React re-rendersã€‹https://kentcdodds.com/blog/optimize-react-re-renders

anywayï¼ŒæˆåŠŸæ¥ä¹‹ä¸æ˜“ï¼Œç°åœ¨è¿˜è§‰å¾— useMemo å¥½ç”¨å—ï¼Ÿä½ ç°åœ¨è¾›è¾›è‹¦è‹¦æ‰“ä¸‹çš„æ±Ÿå±±ï¼Œä¸‹ä¸€ä¸ªäººè¿‡æ¥åªéœ€è¦éšæ‰‹ä¼ é€’ä¸€äº›ä¸œè¥¿ä½œä¸º propsï¼Œæˆ‘ä»¬åˆå›åˆ°äº†æœ€åˆçš„èµ·ç‚¹ã€‚

ä½ åº”è¯¥åœ¨æ‰€æœ‰åœ°æ–¹åŠ ä¸Š useMemo å—ï¼Ÿ

ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæ˜¯åŸºç¡€çš„ä¸­åå°åº”ç”¨ï¼Œå¤§å¤šæ•°äº¤äº’éƒ½æ¯”è¾ƒç²—ç³™ï¼Œé€šå¸¸ä¸éœ€è¦ã€‚å¦‚æœä½ çš„åº”ç”¨ç±»ä¼¼å›¾å½¢ç¼–è¾‘å™¨ï¼Œå¤§å¤šæ•°äº¤äº’æ˜¯é¢—ç²’çŠ¶çš„ï¼ˆæ¯”å¦‚è¯´ç§»åŠ¨å½¢çŠ¶ï¼‰ï¼Œé‚£ä¹ˆæ­¤æ—¶ useMemo å¯èƒ½ä¼šèµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚

ä½¿ç”¨ useMemo è¿›è¡Œä¼˜åŒ–ä»…åœ¨å°‘æ•°æƒ…å†µä¸‹æœ‰ä»·å€¼ï¼š

*   ä½ æ˜ç¡®çŸ¥é“è¿™ä¸ªè®¡ç®—éå¸¸çš„æ˜‚è´µï¼Œè€Œä¸”å®ƒçš„ä¾èµ–å…³ç³»å¾ˆå°‘æ”¹å˜ã€‚
    
*   å¦‚æœå½“å‰çš„è®¡ç®—ç»“æœå°†ä½œä¸º memo åŒ…è£¹ç»„ä»¶çš„ props ä¼ é€’ã€‚è®¡ç®—ç»“æœæ²¡æœ‰æ”¹å˜ï¼Œå¯ä»¥åˆ©ç”¨ useMemo ç¼“å­˜ç»“æœï¼Œè·³è¿‡é‡æ¸²æŸ“ã€‚
    
*   å½“å‰è®¡ç®—çš„ç»“æœä½œä¸ºæŸäº› hook çš„ä¾èµ–é¡¹ã€‚æ¯”å¦‚å…¶ä»–çš„ useMemo/useEffect ä¾èµ–å½“å‰çš„è®¡ç®—ç»“æœã€‚
    

è¿™å‡ å¥æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œå°±æ˜¯å¼€å¤´æˆ‘è¯´çš„ useMemo çš„å®˜æ–¹æ–‡æ¡£çš„ç”¨æ³•ä¸­æåˆ°çš„è¿™å‡ é¡¹ã€‚

åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå°†è®¡ç®—è¿‡ç¨‹åŒ…è£…åœ¨ useMemo ä¸­æ²¡æœ‰ä»»ä½•å¥½å¤„ã€‚ä¸è¿‡è¿™æ ·åšä¹Ÿæ²¡æœ‰é‡å¤§å±å®³ï¼Œæ‰€ä»¥ä¸€äº›å›¢é˜Ÿé€‰æ‹©ä¸è€ƒè™‘å…·ä½“æƒ…å†µï¼Œå°½å¯èƒ½å¤šåœ°ä½¿ç”¨ useMemoï¼Œè¿™ç§åšæ³•ä¼šé™ä½ä»£ç å¯è¯»æ€§ã€‚æ­¤å¤–ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰ useMemo çš„ä½¿ç”¨éƒ½æ˜¯æœ‰æ•ˆçš„ï¼šä¸€ä¸ª â€œ**æ°¸è¿œæ˜¯æ–°çš„**â€ çš„å•ä¸€å€¼å°±è¶³ä»¥ç ´åæ•´ä¸ªç»„ä»¶çš„è®°å¿†åŒ–æ•ˆæœã€‚

æ²¡äº† useMemoï¼Œæˆ‘ä¸çŸ¥é“æ€ä¹ˆåŠäº†

**ä¾‹å­**

è¿™æ˜¯ä¸€ä¸ªå­˜åœ¨ä¸¥é‡æ¸²æŸ“æ€§èƒ½é—®é¢˜çš„ç»„ä»¶ï¼ŒExpensiveTree æ˜¯ä¸€ä¸ªæ¸²æŸ“æå…¶æ˜‚è´µçš„ç»„ä»¶ï¼š

```
import { useState } from 'react';
 
export default function App() {
  let [color, setColor] = useState('red');
  return (
    <div>
      <input value={color} onChange={(e) => setColor(e.target.value)} />
      <p style={{ color }}>Hello, world!</p>
      <ExpensiveTree />
    </div>
  );
}
 
function ExpensiveTree() {
  let now = performance.now();
  while (performance.now() - now < 100) {
    // Artificial delay -- do nothing for 100ms
  }
  return <p>I am a very slow component tree.</p>;
}
```

ï»¿try itï»¿ï¼šhttps://codesandbox.io/s/frosty-glade-m33km?file=/src/App.js:23-513

å½“ color æ”¹å˜çš„æ—¶å€™ï¼ŒExpensiveTree ä¹Ÿä¼šé‡æ¸²æŸ“ï¼Œè€Œ ExpensiveTree çš„æ¸²æŸ“éå¸¸çš„æ˜‚è´µã€‚

ç»è¿‡æˆ‘ä»¬å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œè¿™é‡Œé€‚åˆç”¨ useMemo æ¥è§£å†³ï¼Œå› ä¸ºå®ƒç¡®å®æ˜¯**æ˜‚è´µçš„è®¡ç®—**ï¼Œå¹¶ä¸”æˆ‘ç¡®å®æ„Ÿè§‰åˆ°äº†å¡é¡¿å’Œç¼“æ…¢ï¼Œå½±å“äº†æˆ‘çš„é¡¹ç›®æ­£å¸¸æ¸²æŸ“ã€‚

ä½†æ˜¯çœŸçš„ä¸€å®šè¦ç”¨ useMemo å—ï¼Ÿ

#### è§£å†³æ–¹æ¡ˆ 1ï¼šçŠ¶æ€ä¸‹ç§»

å¦‚æœä½ ä»”ç»†çš„çœ‹è¿™æ®µä»£ç ï¼Œä½ ä¼šå‘ç°ï¼Œè¿”å›çš„ç»“æœä¸­åªæœ‰éƒ¨åˆ†ä¸ color å…³è”ï¼š

```
export default function App() {
  let [color, setColor] = useState('red');
  return (
    <div>
      <input value={color} onChange={(e) => setColor(e.target.value)} />
      <p style={{ color }}>Hello, world!</p>
      <ExpensiveTree />
    </div>
  );
}
```

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†è¯¥éƒ¨åˆ†æå–å‡ºæ¥ï¼Œå¹¶å°†çŠ¶æ€ä¸‹ç§»åˆ°å…¶ä»–ç»„ä»¶ä¸­ï¼š

```
export default function App() {
  return (
    <>
      <Form />
      <ExpensiveTree />
    </>
  );
}
 
function Form() {
  let [color, setColor] = useState('red');
  return (
    <>
      <input value={color} onChange={(e) => setColor(e.target.value)} />
      <p style={{ color }}>Hello, world!</p>
    </>
  );
}
```

è‡³æ­¤ï¼Œcolor æ”¹å˜ï¼Œåªæœ‰ Form ä¼šé‡æ¸²æŸ“ï¼Œé—®é¢˜è§£å†³äº†ï¼

ï»¿try itï»¿ï¼šhttps://codesandbox.io/s/billowing-wood-1tq2u?file=/src/App.js:64-380

#### è§£å†³æ–¹æ¡ˆ 2ï¼šå†…å®¹æå‡

å¦‚æœè¯´æˆ‘ä»¬åœ¨ div çš„æœ€å¤–å±‚ä¹Ÿç”¨åˆ°äº† colorï¼Œæ­¤æ—¶è§£å†³æ–¹æ¡ˆ 1 å°±å¤±æ•ˆäº†ï¼š

```
export default function App() {
  let [color, setColor] = useState('red');
  return (
    <div style={{ color }}>
      <input value={color} onChange={(e) => setColor(e.target.value)} />
      <p>Hello, world!</p>
      <ExpensiveTree />
    </div>
  );
}
```

å®Œäº†ï¼Œè¿™å›è¿˜å’‹æå–å•Šï¼Ÿæœ€å¤–å±‚çˆ¶çº§ <div> è¿˜å¾—ç”¨ color å‘¢ï¼Œè¿™åªèƒ½ç”¨ memo äº†å§ï¼Ÿ

```
export default function App() {
  return (
    <ColorPicker>
      <p>Hello, world!</p>
      <ExpensiveTree />
    </ColorPicker>
  );
}
 
function ColorPicker({ children }) {
  let [color, setColor] = useState("red");
  return (
    <div style={{ color }}>
      <input value={color} onChange={(e) => setColor(e.target.value)} />
      {children}
    </div>
  );
}
```

ï»¿try itÂ ï»¿ï¼šhttps://codesandbox.io/s/wonderful-banach-tyfr1?file=/src/App.js:58-423

æˆ‘ä»¬å°†ç¨‹åºä¸€åˆ†ä¸ºäºŒï¼Œä¾èµ–é¢œè‰²çš„éƒ¨åˆ†ä»¥åŠå˜é‡ color æœ¬èº«å·²ç»éƒ½æ”¾åœ¨ ColorPicker ä¸­äº†ã€‚

ä¸ä¾èµ– color çš„éƒ¨åˆ†ä¿ç•™åœ¨ App ä¸­ï¼Œå¹¶ä½œä¸º ColorPicker çš„ childrenã€‚

å½“ color æ”¹å˜ï¼ŒcolorPicker é‡æ¸²æŸ“ï¼Œä½†æ˜¯ children çš„ props å¹¶æ²¡æœ‰å˜åŒ–ï¼Œå› æ­¤ React ä¼šå¤ç”¨ä¹‹å‰çš„ childrenï¼ŒExpensiveTree æ²¡æœ‰é‡æ¸²æŸ“ï¼Œé—®é¢˜è§£å†³ï¼

#### æ€»ç»“

åœ¨ç”¨ useMemo å’Œ memo ç­‰ä¼˜åŒ–æ–¹æ¡ˆä¹‹å‰ï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥å°†å˜åŒ–çš„éƒ¨åˆ†ä¸ä¸å—å½±å“çš„éƒ¨åˆ†åˆ†å¼€ï¼Œå¯èƒ½æ˜¯æ›´æœ‰æ„ä¹‰çš„ã€‚

ä½¿ç”¨æ‹†åˆ†çš„æ–¹æ³•æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šå€ŸåŠ©åˆ°ä»»ä½•çš„æ€§èƒ½å·¥å…·ï¼Œè€Œæ‹†åˆ†æœ¬è´¨ä¹Ÿä¸æ€§èƒ½æ— å…³ã€‚ä½¿ç”¨ children ä¹Ÿèƒ½éµå¾ªä»ä¸Šåˆ°ä¸‹çš„æ•°æ®æµï¼Œå¹¶å‡å°‘é€šè¿‡æ ‘å‘ä¸‹æŸ¥æ‰¾çš„å±æ€§æ•°é‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæé«˜æ€§èƒ½åªæ˜¯é”¦ä¸Šæ·»èŠ±ï¼Œè€Œä¸æ˜¯æœ€ç»ˆç›®æ ‡ï¼ŒçœŸæ­£æ„ä¹‰ä¸Šåšåˆ°ä¸€ä¸¾ä¸¤å¾—ã€‚

ä¸ºä»€ä¹ˆä¸€å®šè¦ç§»é™¤ï¼Ÿ

![](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naLVe9jbwCGjoILoSXWmpjBzG1DoDQfCMuUNNY0ia5prnb1yY3L0dNXl55u0iaZKE6CtrNRQndbkIMJg/640?wx_fmt=png&from=appmsg)

å›¾æºè‡ªï¼šDominikã€ReactJs â€¢ TypeScript â€¢ Father of twoã€‘

æœ‰äº›äººå¯èƒ½è¯´ï¼Œæˆ‘å°±æ˜¯å–œæ¬¢ useMemo å’Œ useCallbackï¼Œä¸ºå•¥è¦æˆ‘ç§»é™¤ï¼Œæˆ‘åªè¦æ‹æ¸…æ¥šå‰é¢è¯´çš„é€»è¾‘ï¼Œè®©æˆ‘çš„ useMemo çœŸæ­£æ´¾ä¸Šç”¨åœºå°±å¥½äº†ï¼

æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œæ˜¯çš„ï¼Œä½ å¯ä»¥ã€‚

ä½†æ˜¯ä½ åˆ°ç°åœ¨éƒ½æ²¡å‘ç° useMemo å’Œ useCallback ä½¿ç”¨çš„æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆè¯´æ˜ä½ ç°åœ¨æ­£åœ¨å†™çš„ç¨‹åºå¹¶æ²¡æœ‰æ€§èƒ½é—®é¢˜ã€‚

å¦‚æœä½ åšæŒä¸€å®šè¦ç”¨ï¼Œå¥½çš„ï¼Œä½ ç†è§£äº†ä½¿ç”¨è§„åˆ™ï¼Œéå¸¸å®Œç¾çš„å°†ä½ çš„ç¨‹åºç”¨ memo åŒ…è£¹èµ·æ¥ï¼Œå¯†ä¸é€é£ã€‚å¹¶ä¸”ä½ å‘Šè¯«è‡ªå·±ï¼Œä»¥åå¼€å‘ / å¢åŠ éœ€æ±‚çš„æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„ä¸è¦ç ´åæ‰æ•´ä¸ª memo çš„é“¾è·¯ï¼Œä½ å°å¿ƒç¿¼ç¿¼ã€‚é‚£è¯·é—®ä½ èƒ½å¦ä¿è¯ä¸ä½ ä¸€èµ·åˆä½œåŒå­¦åœ¨å¼€å‘æ—¶ä¹Ÿèƒ½æ³¨æ„åˆ°è¿™ä¸€ç‚¹ï¼Ÿä½ èƒ½å¦ä¿è¯é¡¹ç›®äº¤ä»˜ç»™ä¸‹ä¸€ä»»åŒå­¦æ—¶ï¼Œä»– / å¥¹èƒ½å¤ŸåšæŒä½ çš„ç»´æŠ¤ä¹‹é“ï¼Ÿ

React å›¢é˜Ÿçš„çœ‹æ³•

> åŸè§†é¢‘é“¾æ¥ï¼šhttps://www.youtube.com/watch?v=lGEMwh32soc&t=620sï»¿

React å›¢é˜Ÿä¹Ÿå‘ç°äº†ï¼Œå¦‚æœæˆ‘ä»¬ä¸ç”¨ memoï¼Œå¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†æ€§èƒ½é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¦ç”¨ memoï¼Œåˆè¦æœ‰å¾ˆå¼ºçš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œéœ€è¦è€ƒè™‘å¤šä¸ªä¾èµ–å…³ç³»èƒ½è¢«æ­£ç¡®çš„ä½¿ç”¨å’ŒåŒ…è£¹ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naLVe9jbwCGjoILoSXWmpjBzqRSOMA1ibQQXwhNzLaUVS39tyv1AhI1WMdRibdpDkdCouCMmSOXMC6pw/640?wx_fmt=png&from=appmsg)

é¢œè‰²é€‰æ‹©å™¨ä¼˜åŒ–

å¦‚æœè¯´ï¼Œæœ‰ä¸€ä¸ªä¸œè¥¿èƒ½å°†ä½ è¦åšçš„æ‰€æœ‰å…¨éƒ¨éƒ½æ­£ç¡®çš„ memo ä½ï¼Œå²‚ä¸å¦™å“‰ï¼Ÿ

![](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naLVe9jbwCGjoILoSXWmpjBzPPWEwE8alxbZ1019rIZcIvqsbU3lPPX23UmzZQt6uIemlMxxfeyXbw/640?wx_fmt=png&from=appmsg)ï»¿ï»¿

è‡ªåŠ¨è®°å¿†

ä»£å·ï¼š**React Forget** æ­£åœ¨ç ”ç©¶ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä»¥å¸®åŠ©ä½ è‡ªåŠ¨ memo çš„ç¼–è¯‘å™¨ï¼Œä½ ä»¬å¯¹äºè‡ªåŠ¨ memo çš„é—®é¢˜ï¼Œä»–ä»¬ä¹Ÿæ­£åœ¨è§£å†³å½“ä¸­ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naLVe9jbwCGjoILoSXWmpjBzGp1RueLp90xeJQVbPAib4nzak7z2qOpyu3kOCgkeeicqvZzc1qgL57Qw/640?wx_fmt=png&from=appmsg)

React Forget

æœ€å

æœ€åæˆ‘ä»¬å†ä¸€èµ·çœ‹ä¸€ä¸‹å‰é¢æåˆ°çš„å‡ ä¸ªæƒ³æ³•ï¼Œä½ ä»¬ç°åœ¨ä¼šæ€ä¹ˆè€ƒè™‘è¿™å‡ ç§ caseï¼š

*   ã€Œä¸çŸ¥é“è¡Œä¸è¡Œï¼Œä½†æ˜¯æ„Ÿè§‰è¿™é‡Œéœ€è¦ memo ä¸€ä¸‹ï¼Œç”¨äº†æŒ‡å®šèƒ½ä¼˜åŒ–ï¼Œå°±ç®—ä¸è¡Œä¹Ÿæ²¡å•¥å½±å“ã€
    
*   ã€Œéœ€è¦å¯¹æ•°æ®å¤„ç†ï¼Œé‡å¥½åƒè¿˜æŒºå¤šï¼Œä¸”ä¸æ€ä¹ˆéœ€è¦å˜åŒ–ï¼Œç¬¦åˆ memo çš„èƒ½åŠ›ã€
    
*   ã€Œæ•°æ®å¤„ç†èµ·æ¥å¾ˆéº»çƒ¦ï¼Œå†™æ–¹æ³•ä¸ä¹æ„ï¼Œmemo å¥½åƒå¯ä»¥å¸®æˆ‘å¥—ä¸€å±‚ç”¨æ–¹æ³•çš„å†™æ³•è¿”å›æ•°æ®ï¼ŒçœŸä¸æˆ³ã€
    

æˆ‘çš„çœ‹æ³•æ˜¯ï¼Œå¦‚æœä½ å‘ç°ä½ çš„é¡¹ç›®å¹¶æ²¡æœ‰æ˜æ˜¾çš„è¿Ÿé’æˆ–è€…å¡é¡¿çš„ç°è±¡ï¼Œä¸è¦ä½¿ç”¨ï¼›ä¸è¦æœŸå¾…ä½ ç°åœ¨å†™çš„ memo èƒ½ä¸ºé¡¹ç›®å¸¦æ¥é•¿è¿œçš„æ”¶ç›Šï¼Œå› ä¸ºå®ƒå¤ªå®¹æ˜“è¢«ç ´åäº†ï¼Œä¸€æ—¦æœ‰æ–°çš„é¡¹ç›®ç»´æŠ¤åŒå­¦ä¸æ‡‚ memoï¼Œå°±å®¹æ˜“å°†æ•´ä¸ª memo é“¾è·¯æ‰“ç ´ï¼›å¦‚æœç¡®å®æœ‰å¡é¡¿çš„ç°è±¡ï¼Œè¯·åˆç†ä½¿ç”¨ memo çš„è®°å¿†åŒ–åŠŸèƒ½ï¼ˆå‚è€ƒå¸¸è§çš„é”™è¯¯ç”¨æ³•ï¼‰ï¼Œå¸®åŠ©ä¼˜åŒ–å¡é¡¿æˆ–è€…è¿Ÿç¼“ç°è±¡ã€‚

**å‚è€ƒæ–‡ç« ï¼š**
---------

> è¿™äº›æ–‡ç« éƒ½éå¸¸ä¼˜ç§€ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ›´å¥½çš„äº†è§£ useMemo çš„æ­£ç¡®ä½¿ç”¨

ï»¿https://react.dev/reference/react/useMemoï»¿

ï»¿https://react.dev/reference/react/memo#memoï»¿

ï»¿https://tkdodo.eu/blog/the-uphill-battle-of-memoizationï»¿

ï»¿https://www.developerway.com/posts/how-to-use-memo-use-callbackï»¿

ï»¿https://overreacted.io/before-you-memo/ï»¿

ï»¿https://kentcdodds.com/blog/what-is-jsxï»¿

ï»¿https://kentcdodds.com/blog/optimize-react-re-rendersï»¿

ï»¿https://juejin.cn/post/7251802404877893689#heading-2