> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/1JLhyLzILjhnqTngSzSYlQ)

å‰è¨€
--

ä¸€ä¸ªåˆç†çš„åŠ¨ç”»æ˜¯è‰¯å¥½ç”¨æˆ·ä½“éªŒä¸­å¿…ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘ä»¬å¹³å¸¸æ˜¯æ€æ ·å†™åŠ¨ç”»çš„ï¼ŸCSS ä¸­çš„ `animation` å’Œ `transition`ï¼Œè¿˜æœ‰ `requestAnimationFrame`ï¼Ÿç›¸ä¿¡å¤§å®¶å†™åŠ¨ç”»çš„æ—¶å€™å¿ƒé‡Œä¹Ÿæ˜¯åœ¨ä¸‡é©¬å¥”è…¾ã€‚ä»Šå¤©æˆ‘ä»¬ä»ä¸€ä¸ªå¦è¾Ÿè¹Šå¾„çš„è§’åº¦æ¥æ¢ç´¢ä¸€ä¸ªåŠ¨ç”»å®ç°ã€‚

ç¤ºä¾‹
--

è¯·çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼š

![](https://mmbiz.qpic.cn/mmbiz_gif/3O9fy5mPFqpDuY1AiacN5ib20iciba9afClWZS6zHfBe1yiatFiaRYWom7z2sILOVKr5HLH99Olr1IwEQwXq9AVAmfhQ/640?wx_fmt=gif)

è¿™æ˜¯ä¸€ä¸ªå¯æ·»åŠ çš„æ•°å­—çš„éšæœºä¹±åºåˆ—è¡¨ã€‚é¦–å…ˆæƒ³ä¸€æƒ³ï¼Œæˆ‘ä»¬ç¬¬ä¸€ç›´è§‰å¯èƒ½ä¼šè¿™æ ·åšï¼šå°†è¿™äº›æ•°å­—çš„ DOM èŠ‚ç‚¹ç”¨ç»å¯¹å®šä½æ¥å¸ƒå±€ï¼Œæ•°å­—å˜åŒ–åè®¡ç®— `top`ã€`left` çš„å€¼ï¼Œå†é…åˆ `transition` å®ç°è¯¥åŠ¨ç”»ã€‚è¿™ç§æ–¹å¼çœ‹ä¼¼ç®€å•ï¼Œå…¶å®å†…éƒ¨è¦ç»´æŠ¤å„ç§ä½ç½®ä¿¡æ¯ï¼Œæ‰€æœ‰åæ ‡éƒ½éœ€è¦æ‰‹åŠ¨ç®¡ç†ï¼Œç›¸å½“ç¹æ‚ï¼Œéå¸¸ä¸åˆ©äºåæœŸæ‰©å±•ã€‚å¦‚æœè¿™äº›èŠ‚ç‚¹æ¢æˆé«˜åº¦ä¸å›ºå®šçš„å›¾ç‰‡ï¼Œé‚£è®¡ç®—é‡å¯æƒ³è€ŒçŸ¥ã€‚

é‚£æœ‰æ²¡æœ‰ä¸€ç§æ›´å¥½çš„æ–¹å¼å®ç°å‘¢ï¼Ÿè‚¯å®šçš„ï¼Œæ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸ªé‡‘å…‰é—ªé—ªçš„æ¦‚å¿µï¼š`FLIP`ã€‚

æå‰é¢„è§ˆï¼š

https://minjieliu.github.io/react-flip-demo[1]

FLIP
----

`FLIP` å…¶å®æ˜¯å‡ ä¸ªå•è¯çš„ç¼©å†™ï¼šå³ **F**irstã€**L**ast ã€**I**nvert ã€**P**layã€‚

è®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹ï¼š

**First**

æ¶‰åŠåŠ¨ç”»çš„å…ƒç´ çš„åˆå§‹çŠ¶æ€ï¼ˆæ¯”å¦‚ä½ç½®ã€ç¼©æ”¾ã€é€æ˜ç­‰ï¼‰ã€‚

**Last**

æ¶‰åŠåŠ¨ç”»çš„å…ƒç´ çš„æœ€ç»ˆçŠ¶æ€ã€‚

**Invert**

è¿™ä¸€æ­¥ä¸ºæ ¸å¿ƒï¼Œå³æ‰¾å‡ºè¿™ä¸ªå…ƒç´ æ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚ä¾‹å¦‚è¯¥å…ƒç´ åœ¨ **First** å’Œ **Last** ä¹‹é—´å‘å³ç§»åŠ¨äº† 50pxï¼Œä½ å°±éœ€è¦åœ¨ X æ–¹å‘ `translateX(-50px)`ï¼Œä½¿å…ƒç´ çœ‹èµ·æ¥åœ¨ **First** ä½ç½®ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹å€¼å¾—æ³¨æ„ï¼ŒDOM å…ƒç´ å±æ€§çš„æ”¹å˜ï¼ˆæ¯”å¦‚ `left`ã€`right`ã€`transform` ç­‰ï¼‰ï¼Œä¼šè¢«é›†ä¸­èµ·æ¥å»¶è¿Ÿåˆ°æµè§ˆå™¨ä¸‹ä¸€å¸§ç»Ÿä¸€æ¸²æŸ“ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªè¿™æ ·çš„ä¸­é—´æ—¶é—´ç‚¹ï¼šDOM ä½ç½®ä¿¡æ¯æ”¹å˜äº†ï¼Œè€Œæµè§ˆå™¨è¿˜æ²¡æ¸²æŸ“ [2]ã€‚ä¹Ÿå°±æ„å‘³ç€åœ¨ä¸€å®šçš„æ—¶é—´å†…ï¼Œæˆ‘ä»¬èƒ½è·å– DOM æ”¹å˜åçš„ä½ç½®ï¼Œä½†åœ¨æµè§ˆå™¨ä¸­ä½ç½®è¿˜æœªæ”¹å˜ã€‚ç»æµ‹è¯•ï¼Œè¿™ä¸ªè¿‡ç¨‹è¶…è¿‡ 10ms å°±æ˜¾å¾—ä¸ç¨³å®šäº†ã€‚å› æ­¤ `setTimeout(fn, 0)`ã€ `React useEffect` å’Œ `Vue $nextTick` éƒ½å¯ä»¥å®ç° **Invert** è¿‡ç¨‹ã€‚

**Play**

å³ä» **Invert** å›åˆ°æœ€ç»ˆçŠ¶æ€ï¼Œæœ‰äº†ä¸¤ä¸ªç‚¹çš„ä½ç½®ä¿¡æ¯ï¼Œä¸­é—´çš„è¿‡æ¸¡åŠ¨ç”»å°±å¯ä»¥ä½¿ç”¨ `transition` å®ç°ã€‚æœ¬æ–‡é‡‡ç”¨ Web Animation API[3] å®ç°ï¼ŒåŠ¨ç”»æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šæ·»åŠ  CSS åˆ° DOM ä¸Šï¼Œç›¸å½“å¹²å‡€ã€‚

![](https://mmbiz.qpic.cn/mmbiz_gif/3O9fy5mPFqpDuY1AiacN5ib20iciba9afClWOmLrUdWjNcKvbQy9t8m0WNMLrVekAh4wnKlV7C8pzfichJA47Bw7s3w/640?wx_fmt=gif)

å®ç°
--

è¿™é‡Œä¸»è¦ä½¿ç”¨ React æ–¹å¼å®ç°è¯¥æ•ˆæœï¼Œå…¶ä»–æ¡†æ¶åŸç†éƒ½ä¸€æ ·å¯å‚è€ƒã€‚

ä¸€ä¸ªåˆ—è¡¨ï¼Œå°†å­å…ƒç´  5 åˆ—ä¸ºä¸€è¡Œï¼š

```
.listÂ {Â Â display:Â flex;Â Â flex-wrap:Â wrap;Â Â width:Â 400px;}.itemÂ {Â Â display:Â flex;Â Â align-items:Â center;Â Â justify-content:Â center;Â Â width:Â 80px;Â Â height:Â 80px;Â Â border:Â 1pxÂ solidÂ #eee;}
```

```
functionÂ ListShuffler()Â {Â Â constÂ [data,Â setData]Â =Â useState([0,Â 1,Â 2,Â 3,Â 4,Â 5]);Â Â constÂ listRefÂ =Â useRef<HTMLDivElement>(null);Â Â returnÂ (Â Â Â Â <divÂ className={styles.list}Â ref={listRef}>Â Â Â Â Â Â {data.map((item)Â =>Â (Â Â Â Â Â Â Â Â <divÂ key={item}Â className={styles.item}>Â Â Â Â Â Â Â Â Â Â {item}Â Â Â Â Â Â Â Â </div>Â Â Â Â Â Â ))}Â Â Â Â </div>Â Â );}
```

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è®°å½• `First` å’Œ `Last` çš„ä½ç½®ä¿¡æ¯ï¼Œå¹¶ç”¨æ¥è®¡ç®— `Invert` åç§»å·®ï¼Œå› æ­¤ç”¨ `Map` å¯¹è±¡æ¥å­˜å‚¨æœ€åˆé€‚ä¸è¿‡äº†ï¼Œæœ‰äº†è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨å®ƒæ¥ç”Ÿæˆå‰åå¿«ç…§ï¼š

```
functionÂ createChildElementRectMap(nodes:Â HTMLElementÂ |Â nullÂ |Â undefined)Â {Â Â ifÂ (!nodes)Â {Â Â Â Â returnÂ newÂ Map();Â Â }Â Â constÂ elementsÂ =Â Array.from(nodes.childNodes)Â asÂ HTMLElement[];Â Â //Â ä½¿ç”¨èŠ‚ç‚¹ä½œä¸ºÂ MapÂ çš„Â keyÂ å­˜å‚¨å½“å‰å¿«ç…§ï¼Œä¸‹æ¬¡ç›´æ¥ç”¨Â nodeÂ å¼•ç”¨å–å€¼ï¼Œç›¸å½“æ–¹ä¾¿Â Â returnÂ newÂ Map(elements.map((node)Â =>Â [node,Â node.getBoundingClientRect()]));}
```

ç‚¹å‡»æ·»åŠ çš„æ—¶å€™è®°å½• **First** å¿«ç…§ï¼š

```
//Â ä½¿ç”¨Â refÂ å­˜å‚¨Â DOMÂ ä¹‹å‰çš„ä½ç½®ä¿¡æ¯constÂ lastRectRefÂ =Â useRef<Map<HTMLElement,Â DOMRect>>(newÂ Map());functionÂ handleAdd()Â {Â Â //Â æ·»åŠ ä¸€æ¡åˆ°é¡¶éƒ¨ï¼Œè®©åé¢èŠ‚ç‚¹è¿åŠ¨Â Â setData((prev)Â =>Â [prev.length,Â ...prev]);Â Â //Â å¹¶å­˜å‚¨æ”¹å˜å‰çš„Â DOMÂ å¿«ç…§Â Â lastRectRef.currentÂ =Â createChildElementRectMap(listRef.current);}
```

æ¥ä¸‹æ¥ DOM æ›´æ–°åè¿˜éœ€è¦æ”¹å˜åçš„å¿«ç…§ï¼Œåœ¨ React ä¸­ï¼Œæ— è®ºæ˜¯ `useEffect` è¿˜æ˜¯ `useLayoutEffect` è¿™é‡Œéƒ½å¯ä»¥æ‹¿åˆ°ï¼š

```
useLayoutEffect(()Â =>Â {Â Â //Â æ”¹å˜åçš„Â DOMÂ å¿«ç…§ï¼Œæ­¤æ—¶Â UIÂ å¹¶æœªæ›´æ–°Â Â constÂ currentRectMapÂ =Â createChildElementRectMap(listRef.current);},Â [data]);
```

ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠä¹‹å‰çš„å¿«ç…§è¿›è¡Œéå†ï¼Œå®ç° `Invert` å¹¶ `Play`ï¼š

```
//Â éå†ä¹‹å‰çš„å¿«ç…§lastRectRef.current.forEach((prevRect,Â node)Â =>Â {Â Â //Â å‰åå¿«ç…§çš„Â DOMÂ å¼•ç”¨ä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥è·å–Â Â constÂ currentRectÂ =Â currentRectMap.get(node);Â Â //Â InvertÂ Â constÂ invertÂ =Â {Â Â Â Â left:Â prevRect.leftÂ -Â currentRect.left,Â Â Â Â top:Â prevRect.topÂ -Â currentRect.top,Â Â };Â Â constÂ keyframesÂ =Â [Â Â Â Â {Â Â Â Â Â Â transform:Â `translate(${invert.left}px,Â ${invert.top}px)`,Â Â Â Â },Â Â Â Â {Â transform:Â 'translate(0,Â 0)'Â },Â Â ];Â Â //Â PlayÂ æ‰§è¡ŒåŠ¨ç”»Â Â node.animate(keyframes,Â {Â Â Â Â duration:Â 800,Â Â Â Â easing:Â 'cubic-bezier(0.25,Â 0.8,Â 0.25,Â 1)',Â Â });});
```

å¤§åŠŸå‘Šæˆï¼è¿™é‡Œæ¯ä¸ªèŠ‚ç‚¹æœ‰å•ç‹¬çš„åŠ¨ç”»ï¼Œå„ä¸ªèŠ‚ç‚¹ä¹‹é—´äº’ä¸å†²çªã€‚ä¹Ÿå°±æ˜¯è¯´æ— è®ºèŠ‚ç‚¹ä½ç½®å¤šä¹ˆå¤æ‚ï¼Œå¤„ç†èµ·æ¥éƒ½èƒ½ä»å®¹åº”å¯¹ã€‚

æ¯”å¦‚å›¾ç‰‡ä¹±åºåªéœ€è¦ä» `lodash` å¼•å…¥ `shuffle` ä¿®æ”¹æ•°æ®å°±å¯ä»¥å®Œç¾å®ç°å±•ç°ã€‚

```
importÂ {Â shuffleÂ }Â fromÂ 'lodash-es';functionÂ shuffleList()Â {Â Â setData(shuffle);Â Â //Â å¹¶å­˜å‚¨æ”¹å˜å‰çš„Â DOMÂ å¿«ç…§Â Â lastRectRef.currentÂ =Â createChildElementRectMap(listRef.current);}
```

ä»¥ä¸Šæ€»ä½“æ€è·¯å°±æ˜¯ **First -> Last -> Invert -> Play** çš„ä¸€ä¸ªå˜æ¢è¿‡ç¨‹ã€‚é¢„è§ˆä¸‹ï¼š

![](https://mmbiz.qpic.cn/mmbiz_gif/3O9fy5mPFqpDuY1AiacN5ib20iciba9afClWOXPXYwHvfz1jyLz3gsnibcUVSWyKM2GyibFtewZm8CrSoB9Ut7pBWBQw/640?wx_fmt=gif)

ä½ å‘ç°æ²¡æœ‰ï¼Œæ¯æ¬¡åšå®Œæ“ä½œéƒ½éœ€è¦æ‰‹åŠ¨æ›´æ–°å¿«ç…§ï¼Œä½œä¸ºå¼€å‘è€…ä¸èƒ½å¿ï¼Œæˆ‘ä»¬è¦æ‡’åˆ°æè‡´ï¼Œå¥½å¥½å°è£…ä¸€ä¸‹ã€‚

ç›´ç™½éœ€æ±‚ï¼š

1.  æ•°æ®å˜åŒ–åè‡ªåŠ¨æ‰§è¡ŒåŠ¨ç”»
    
2.  å¯ä»¥ä¸å…³å¿ƒä»»ä½•åŠ¨ç”»é€»è¾‘
    
3.  ä¸è¦é™åˆ¶ DOM ç»“æ„
    
4.  ç”¨æ³•è¦ç®€å•
    
5.  æ€§èƒ½è¦å¥½
    

å¼€å¹²ï¼

åœ¨ React æ›´æ–°æ¨¡å‹ä¸­ï¼Œæ‰§è¡Œé¡ºåºä¸ºï¼š**setState -> render -> layoutEffect**ã€‚å› æ­¤å¯ä»¥æŠŠ `setState` ç”Ÿæˆå¿«ç…§çš„æ­¥éª¤æ”¾åˆ° `render` ä¸­ï¼Œä»è€Œä¸æ“ä½œè§£è€¦ã€‚ï¼ˆå¦‚æœæ”¾åˆ° `useLayoutEffect` ä¸­åŠ¨ç”»é¢‘ç¹ä¼šå‡ºç°ä½ç½®è®¡ç®—ä¸å‡†ç¡®çš„é—®é¢˜ï¼‰

```
useMemo(()Â =>Â {Â Â //Â renderÂ æ—¶ç«‹å³æ‰§è¡ŒÂ Â lastRectRef.current.forEach((item)Â =>Â {Â Â Â Â item.rectÂ =Â item.node.getBoundingClientRect();Â Â });},Â [data]);
```

åŠ ä¸Šä¹‹å‰ `useLayoutEffect` é‚£éƒ¨åˆ†é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥æŠ½åˆ°ä¸€ä¸ªç‹¬ç«‹ç»„ä»¶ä¸­ï¼ˆ`Flipper`ï¼‰ï¼Œç”¨ `flipKey` æ¥æ§åˆ¶ï¼Œåªè¦ `flipKey` å˜åŒ–å°±æ‰§è¡ŒåŠ¨ç”»ï¼Œå³å®ç° 1ã€2 ä¸¤ç‚¹ã€‚

Flipper.tsx

```
exportÂ defaultÂ functionÂ Flipper({Â flipKey,Â childrenÂ }:Â FlipperProps)Â {Â Â constÂ lastRectRefÂ =Â useRef<Map<number,Â FlipItemType>>(newÂ Map());Â Â constÂ uniqueIdRefÂ =Â useRef(0);Â Â //Â é€šè¿‡Â refÂ åˆ›å»ºå‡½æ•°ï¼Œä¼ é€’Â contextÂ é¿å…å¼•èµ·ç©¿é€æ¸²æŸ“Â Â constÂ fnRefÂ =Â useRef<IFlipContext>({Â Â Â Â add(flipItem)Â {Â Â Â Â Â Â lastRectRef.current.set(flipItem.flipId,Â flipItem);Â Â Â Â },Â Â Â Â remove(flipId)Â {Â Â Â Â Â Â lastRectRef.current.delete(flipId);Â Â Â Â },Â Â Â Â nextId()Â {Â Â Â Â Â Â returnÂ (uniqueIdRef.currentÂ +=Â 1);Â Â Â Â },Â Â });Â Â useMemo(()Â =>Â {Â Â Â Â lastRectRef.current.forEach((item)Â =>Â {Â Â Â Â Â Â item.rectÂ =Â item.node.getBoundingClientRect();Â Â Â Â });Â Â },Â [flipKey]);Â Â useLayoutEffect(()Â =>Â {Â Â Â Â constÂ currentRectMapÂ =Â newÂ Map<number,Â DOMRect>();Â Â Â Â lastRectRef.current.forEach((item)Â =>Â {Â Â Â Â Â Â currentRectMap.set(item.flipId,Â item.node.getBoundingClientRect());Â Â Â Â });Â Â Â Â lastRectRef.current.forEach(()Â =>Â {Â Â Â Â Â Â //Â ä¹‹å‰çš„Â FLIPÂ ä»£ç Â Â Â Â });Â Â },Â [flipKey]);Â Â returnÂ <FlipContext.ProviderÂ value={fnRef}>{children}</FlipContext.Provider>;}
```

æœ€å¼€å§‹çš„æ–¹å¼æ˜¯é€šè¿‡åŸç”Ÿæ–¹æ³•éå† DOMï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½é™åˆ¶å­èŠ‚ç‚¹ä¸€ä¸ªå±‚çº§ï¼Œå¹¶ä¸”æ“ä½œæ–¹å¼ä¹Ÿè„±ç¦»çš„ React çš„ç¼–å†™æ¨¡å‹ï¼ŒåŠ ä»¥æ”¹è¿›å¯ä»¥ä½¿ç”¨ `Context` æ¥é€šä¿¡å­˜å‚¨ï¼š

FlipContext.ts

```
importÂ React,Â {Â createContextÂ }Â fromÂ 'react';exportÂ typeÂ FlipItemTypeÂ =Â {Â Â //Â å­ç»„ä»¶çš„å”¯ä¸€æ ‡è¯†Â Â flipId:Â number;Â Â //Â å­ç»„ä»¶é€šè¿‡Â refÂ è·å–çš„èŠ‚ç‚¹Â Â node:Â HTMLElement;Â Â //Â å­ç»„ä»¶çš„ä½ç½®å¿«ç…§Â Â rect?:Â DOMRect;};exportÂ interfaceÂ IFlipContextÂ {Â Â //Â mountÂ åæ‰§è¡ŒÂ addÂ Â add:Â (item:Â FlipItemType)Â =>Â void;Â Â //Â unoutÂ åæ‰§è¡ŒÂ removeÂ Â remove:Â (flipId:Â number)Â =>Â void;Â Â //Â è‡ªå¢å”¯ä¸€Â idÂ Â nextId:Â ()Â =>Â number;}exportÂ constÂ FlipContextÂ =Â createContext(Â Â undefinedÂ asÂ unknownÂ asÂ React.MutableRefObject<IFlipContext>,);
```

æœ€ååˆ™æ˜¯è¦å®ç°é‡‡é›†æ¯ä¸ªåŠ¨ç”»å…ƒç´ çš„èŠ‚ç‚¹ã€‚å°†åŠ¨ç”»çš„èŠ‚ç‚¹ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶ `Flipped` åŒ…è£¹å¹¶ `cloneElement(children { ref })` åŠ«æŒ refï¼Œ`mount` æ—¶å°†å­ç»„ä»¶ `ref` æ·»åŠ åˆ° `Context`ï¼Œ`unmount` æ—¶åˆ™ç§»é™¤ã€‚react-photo-view[4] çš„å°è£…æ–¹å¼ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å³å®ç° 3ã€4 ä¸¤ç‚¹ã€‚

Flipped.tsx

```
importÂ React,Â {Â Â cloneElement,Â Â memo,Â Â useContext,Â Â useLayoutEffect,Â Â useRef,}Â fromÂ 'react';importÂ {Â FlipContextÂ }Â fromÂ './FlipContext';exportÂ interfaceÂ FlippedPropsÂ {Â Â children:Â React.ReactElement;Â Â innerRef?:Â React.RefObject<HTMLElement>;}functionÂ Flipped({Â children,Â innerRefÂ }:Â FlippedProps)Â {Â Â //Â Flipper.tsxÂ å°†Â refÂ é€šè¿‡Â ContextÂ ä¼ é€’ï¼Œé¿å…ç©¿é€æ¸²æŸ“Â Â constÂ ctxRefÂ =Â useContext(FlipContext);Â Â constÂ refÂ =Â useRef<HTMLElement>(null);Â Â constÂ currentRefÂ =Â innerRefÂ ||Â ref;Â Â useLayoutEffect(()Â =>Â {Â Â Â Â constÂ ctxÂ =Â ctxRef.current;Â Â Â Â constÂ nodeÂ =Â currentRef.current;Â Â Â Â //Â ç”Ÿæˆå”¯ä¸€Â IDÂ Â Â Â constÂ flipIdÂ =Â ctx.nextId();Â Â Â Â ifÂ (node)Â {Â Â Â Â Â Â //Â mountÂ åæ·»åŠ èŠ‚ç‚¹Â Â Â Â Â Â ctx.add({Â flipId,Â nodeÂ });Â Â Â Â }Â Â Â Â returnÂ ()Â =>Â {Â Â Â Â Â Â //Â unmoutÂ ååˆ é™¤èŠ‚ç‚¹Â Â Â Â Â Â ctx.remove(flipId);Â Â Â Â };Â Â },Â []);Â Â returnÂ cloneElement(children,Â {Â ref:Â currentRefÂ });}exportÂ defaultÂ memo(Flipped);
```

å¥½äº†ï¼Œçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ï¼Œä¸€å…±å°±ä¸¤ä¸ª APIï¼Œä»åŸæœ¬çš„ JSX åªéœ€åŒ…è£¹ä¸€ä¸‹å°±æœ‰åŠ¨ç”»äº†ï¼š

```
<FlipperÂ flipKey={data}>Â Â <divÂ className={styles.list}>Â Â Â Â {data.map((item)Â =>Â (Â Â Â Â Â Â <FlippedÂ key={item}>Â Â Â Â Â Â Â Â <divÂ className={styles.item}>{item}</div>Â Â Â Â Â Â </Flipped>Â Â Â Â ))}Â Â </div></Flipper>
```

æ˜¯ä¸æ˜¯è¶…ç®€å•ï¼æœ€åï¼Œè¿˜å‰©æ€§èƒ½é—®é¢˜ä¸€ä¸ªéå¸¸é‡è¦çš„æŒ‡æ ‡ã€‚å› ä¸ºæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ç‹¬ç«‹çš„åŠ¨ç”»ï¼Œæ•°æ®é‡å¤§äº†ä¹‹åæ¸²æŸ“è‚¯å®šå¡é¡¿ã€‚ç»è¿‡æµ‹è¯•ï¼Œ5000 ä¸ª DIV èŠ‚ç‚¹çš„æ•°å­—æ•°ç»„çš„éšæœºåŠ¨ç”»å®Œæˆæ›´æ–°æ—¶é—´ä¸ºå¤§çº¦ 2 ç§’ï¼Œè¿™æ˜¯å¾ˆä¸èƒ½æ¥å—çš„ã€‚æˆ‘ä»¬å¯ä»¥åªå…è®¸å±å¹•å†…çš„èŠ‚ç‚¹æœ‰åŠ¨ç”»ï¼Œå…¶ä»–èŠ‚ç‚¹å°±è·³è¿‡ï¼Œåªéœ€è¦ç¨å¾®åˆ¤æ–­ä¸€ä¸‹ä¸¤ä¸ªçŠ¶æ€éƒ½ä¸åœ¨å±å¹•å†…å°±å¥½äº†ï¼Œè¿™å¯ä»¥èŠ‚çº¦ 2 / 3 çš„æ—¶é—´ï¼š

```
constÂ isLastRectOverflowÂ =Â Â rect.rightÂ <Â 0Â ||Â Â rect.leftÂ >Â innerWidthÂ ||Â Â rect.bottomÂ <Â 0Â ||Â Â rect.topÂ >Â innerHeight;constÂ isCurrentRectOverflowÂ =Â Â currentRect.rightÂ <Â 0Â ||Â Â currentRect.leftÂ >Â innerWidthÂ ||Â Â currentRect.bottomÂ <Â 0Â ||Â Â currentRect.topÂ >Â innerHeight;ifÂ (isLastRectOverflowÂ &&Â isCurrentRectOverflow)Â {Â Â return;}//Â node.animate()Â ...
```

è®°å¾—ä¹‹å‰ react-beautiful-dnd[5] åº“åˆšå‡ºæ¥çš„æ—¶å€™æ‹–æ‹½åŠ¨ç”»è¿·å€’äº†ä¸å°‘äººã€‚ä½†æ˜¯ç°åœ¨æœ‰äº† FLIP å†é…åˆ react-dnd[6] å°±å¯ä»¥è½»æ¾å®ç°æ­¤ç±»åŠ¨ç”»ï¼ŒåŠŸèƒ½ä¸Šå°±æ›´æ˜¯å±äºç¢¾å‹çŠ¶æ€ã€‚è€Œ react-motion[7] ä¹‹ç±»çš„åŠ¨ç”»åº“å®ç°è¯¥åŠ¨ç”»å°±ç¹æ‚å¾ˆå¤šï¼Œå› ä¸ºå®ƒç”¨çš„æ˜¯ç»å¯¹å®šä½æ§åˆ¶çš„ç±»å‹ã€‚ä¸‹é¢çš„ä¾‹å­ä»…ä»…ç”¨åˆšå°è£…çš„ `Flipper`Â åŒ…è£¹äº†ä¸€ä¸‹ï¼š

![](https://mmbiz.qpic.cn/mmbiz_gif/3O9fy5mPFqpDuY1AiacN5ib20iciba9afClWwsn3l7VCP7CTUibJEU0sicWibHck6G0nH6sIvskh48jO6UXOVSqpicV2vg/640?wx_fmt=gif)

  

ä»¥ä¸‹æ˜¯æºç ï¼š

https://github.com/MinJieLiu/react-flip-demo[8] å…¶ä¸­é‡Œé¢çš„ `Flipper` ç»„ä»¶ç›®å½•å¯ä»¥ç›´æ¥æ‹·è´åˆ°é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œ100 æ¥è¡Œä»£ç ç›¸å½“è½»é‡ ğŸ¤­ã€‚

æ³¨æ„ï¼š`Web Animation` åªå…¼å®¹ `Chrome 75` ä»¥ä¸Šï¼Œå…¼å®¹å¤è‘£æµè§ˆå™¨å¯ä»¥è€ƒè™‘ Web Animations API polyfill[9]ã€‚

ç°æˆçš„æ–¹æ¡ˆ
-----

ä»€ä¹ˆï¼Ÿä½ æœ‰æ›´å¤æ‚çš„åŠ¨ç”»éœ€æ±‚ï¼Œè‡ªå·±ä¸æƒ³åŠ¨æ‰‹ï¼Œå¯ä»¥çœ‹çœ‹è¿™ä¸ªï¼Œæ”¯æŒæ›´å¤šç‰¹æ€§

react-flip-toolkit[10] ä¸€æ¬¾æœ‰ 3.4K Star FLIP çš„åº“ã€‚å®ç°äº†ä½ æ‰€èƒ½æƒ³åˆ°çš„åŠŸèƒ½ã€‚

äº¤é”™æ•ˆæœï¼š

![](https://mmbiz.qpic.cn/mmbiz_gif/3O9fy5mPFqpDuY1AiacN5ib20iciba9afClWAZErYhtY1cgXmw42OtCdAH3rG2iad6jIicdO223Uh1fnbiaMtIWQ2oSBw/640?wx_fmt=gif)

  

åµŒå¥—æ¯”ä¾‹å˜æ¢ï¼š

![](https://mmbiz.qpic.cn/mmbiz_gif/3O9fy5mPFqpDuY1AiacN5ib20iciba9afClWAaK4rV5mEHGYBKRnKn0zicS0RLgItySdl0xNGic8oPtnMoYBqoCR0eYw/640?wx_fmt=gif)

  

è·¯ç”±åŠ¨ç”»ï¼š

![](https://mmbiz.qpic.cn/mmbiz_gif/3O9fy5mPFqpDuY1AiacN5ib20iciba9afClWsS4icnxLlm1yIKPicg2DUmMXia3x07Gd48s9hEHUmzqCericRiaG1SNiaFLA/640?wx_fmt=gif)

  

ä»¥åŠæ›´å¤š

*   Guitar å•†åŸ [11]
    
*   React-flip-toolkit logo[12]
    
*   ä½¿ç”¨ Portals[13]
    

ç»“è¯­
--

ç›¸ä¿¡è¿™ç§åŠ¨ç”»æ€è·¯è‚¯å®šèƒ½å¤§å¹…åº¦ç®€åŒ–ç¼–å†™åŠ¨ç”»çš„é—¨æ§›ï¼Œæƒ³èµ·è‡ªå·±ä»¥å‰å‚»å‚»çš„ç”¨ç»å¯¹å®šä½è®¡ç®—ä½ç½®ï¼ŒçœŸæ˜¯å¯ç¬‘å¯ç¬‘~ ğŸ˜‚ğŸ˜‚

æ–‡æœ«åŠ æˆ‘å¥½å‹æˆ–ç¾¤ä¸€èµ·æ¢è®¨å­¦ä¹ ~

### å‚è€ƒèµ„æ–™

[1]

https://minjieliu.github.io/react-flip-demo:Â _https://minjieliu.github.io/react-flip-demo_

[2]

DOM ä½ç½®ä¿¡æ¯æ”¹å˜äº†ï¼Œè€Œæµè§ˆå™¨è¿˜æ²¡æ¸²æŸ“:Â _https://juejin.cn/post/6844904165462769678_

[3]

Web Animation API:Â _https://developer.mozilla.org/zh-CN/docs/Web/API/Animation_

[4]

react-photo-view:Â _https://react-photo-view.vercel.app_

[5]

react-beautiful-dnd:Â _https://react-beautiful-dnd.netlify.app_

[6]

react-dnd:Â _https://react-dnd.github.io/react-dnd/examples/sortable/simple_

[7]

react-motion:Â _http://chenglou.github.io/react-motion/demos/demo8-draggable-list_

[8]

https://github.com/MinJieLiu/react-flip-demo:Â _https://github.com/MinJieLiu/react-flip-demo_

[9]

Web Animations API polyfill:Â _https://github.com/web-animations/web-animations-js_

[10]

react-flip-toolkit:Â _https://github.com/aholachek/react-flip-toolkit_

[11]

Guitar å•†åŸ:Â _https://react-flip-toolkit-demos.surge.sh/guitar_

[12]

React-flip-toolkit logo:Â _https://codepen.io/aholachek/pen/ERRpEj_

[13]

ä½¿ç”¨ Portals:Â _https://react-flip-toolkit-demos.surge.sh/portal_

[14]

Vue å®ç°:Â _https://juejin.cn/post/6844904179572424711_

![](https://mmbiz.qpic.cn/mmbiz_gif/7QRTvkK2qC6D2OhibHUMz1XiaC7v0RcUA1thKEXck4AzcEnKnOXEHJibw1OEpzrL0n2O4FNrfgNaAZRcDyzDkKqiaw/640?wx_fmt=gif)

ä¸€èµ·å˜å¼ºï¼ä¸€èµ·é¢å‘å¿«ä¹ç¼–ç¨‹ï¼Â ğŸ˜‰

é•¿æŒ‰ / æ‰«ææ·»åŠ æˆ‘ï¼

å›å¤Â [åŠ ç¾¤]ï¼Œè¿›ç¾¤ä¸å¤§ä½¬ä»¬ä¸€èµ·å…±åŒè¿›æ­¥ï¼

Â Â  Â ![](https://mmbiz.qpic.cn/mmbiz_jpg/3O9fy5mPFqowfcia2rLdnYW1bNrS0ZrCjH2IZIn1Mno0CGvjT1wB4UtUpfezDQgibfhU0icJMdxA6lmdVdRZnLVhQ/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_gif/7QRTvkK2qC6D2OhibHUMz1XiaC7v0RcUA1thKEXck4AzcEnKnOXEHJibw1OEpzrL0n2O4FNrfgNaAZRcDyzDkKqiaw/640?wx_fmt=gif)

![](https://mmbiz.qpic.cn/mmbiz_png/SF6Qw1pKVEDVOBD6hTWx2iaK1GUBicMTxby2tceLawtbZSWmN8QW5JBBHho1MjPiaTVJ3D7Iuic1icoh35hZyTREt2A/640?wx_fmt=png)

ç‚¹ä¸ªåœ¨çœ‹ä½ æœ€å¥½çœ‹