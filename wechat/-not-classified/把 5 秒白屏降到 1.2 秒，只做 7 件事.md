> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/2rma-vbXmaldGUeU80c3Xg)

> â
> 
> çœŸå®é¡¹ç›®ä¼˜åŒ–å®å½•ï¼šä» 5 ç§’ç™½å±åˆ° 1.2 ç§’åŠ è½½å®Œæˆï¼ŒVite é¡¹ç›®æ€§èƒ½ä¼˜åŒ–å…¨æ”»ç•¥ï¼Œé™„å¯ç›´æ¥å¤ç”¨çš„ä»£ç ç‰‡æ®µã€‚
> 
> â

* * *

ğŸ“Š ä¼˜åŒ–æˆç»©å•
--------

<table><thead><tr><th><section>æŒ‡æ ‡</section></th><th><section>ä¼˜åŒ–å‰</section></th><th><section>ä¼˜åŒ–å</section></th><th><section>æ”¶ç›Š</section></th></tr></thead><tbody><tr><td><strong>ã€Œé¦–å±åŠ è½½ã€</strong></td><td><section>5.2 s</section></td><td><section>1.2 s</section></td><td><section>â†“ 77 %</section></td></tr><tr><td><strong>ã€ŒLCPï¼ˆæœ€å¤§å†…å®¹ç»˜åˆ¶ï¼‰ã€</strong></td><td><section>4.1 s</section></td><td><section>1.0 s</section></td><td><section>â†“ 76 %</section></td></tr><tr><td><strong>ã€ŒJS ä½“ç§¯ã€</strong></td><td><section>1.8 MB</section></td><td><section>480 KB</section></td><td><section>â†“ 73 %</section></td></tr><tr><td><strong>ã€Œå›¾ç‰‡æ€»é‡ã€</strong></td><td><section>6.4 MB</section></td><td><section>1.9 MB</section></td><td><section>â†“ 70 %</section></td></tr></tbody></table>

* * *

ä¸€ã€ä»£ç ä½“ç§¯ç˜¦èº«ï¼šVite + ä¼˜åŒ–
------------------

### 1. ä»£ç åˆ†å‰² + Tree-Shaking

```
// vite.config.jsimportÂ { defineConfig }Â from'vite';importÂ vueÂ from'@vitejs/plugin-vue';exportdefaultÂ defineConfig({plugins: [vue()],build: {Â  Â Â rollupOptions: {Â  Â  Â Â output: {Â  Â  Â  Â  manualChunks(id) {Â  Â  Â  Â  Â Â ifÂ (id.includes('node_modules')) {Â  Â  Â  Â  Â  Â Â returnÂ id.toString().split('node_modules/')[1].split('/')[0];Â  Â  Â  Â  Â  }Â  Â  Â  Â  },Â  Â  Â  },Â  Â  },Â  },});
```

*   **ã€Œä»£ç åˆ†å‰²ã€**ï¼šVite é»˜è®¤æ”¯æŒä»£ç åˆ†å‰²ï¼Œé€šè¿‡Â `manualChunks`Â å¯ä»¥è¿›ä¸€æ­¥è‡ªå®šä¹‰ä»£ç åˆ†å‰²é€»è¾‘ã€‚
    
*   **ã€ŒTree-Shakingã€**ï¼šVite é»˜è®¤å¯ç”¨ï¼Œç§»é™¤æœªä½¿ç”¨çš„ä»£ç ã€‚
    

### 2. å‹ç¼©ä»£ç 

```
// vite.config.jsimportÂ { defineConfig }Â from'vite';importÂ vueÂ from'@vitejs/plugin-vue';importÂ { terser }Â from'rollup-plugin-terser';exportdefaultÂ defineConfig({plugins: [Â  Â  vue(),Â  Â  terser({Â  Â  Â Â compress: {Â  Â  Â  Â Â drop_console:Â true,Â // ç§»é™¤ console.logÂ  Â  Â  Â Â drop_debugger:Â true,Â // ç§»é™¤ debuggerÂ  Â  Â  },Â  Â  }),Â  ],build: {Â  Â Â minify:Â 'terser',Â // æŒ‡å®šä½¿ç”¨ terser è¿›è¡Œå‹ç¼©Â  },});
```

*   **ã€Œterserã€**ï¼šè¿›ä¸€æ­¥å‹ç¼©ä»£ç ï¼Œç§»é™¤Â `console.log`Â ç­‰è°ƒè¯•ä¿¡æ¯ã€‚
    

* * *

äºŒã€èµ„æºä¼˜åŒ–ï¼šå›¾ç‰‡ã€å­—ä½“ã€é™æ€èµ„æº
-----------------

### 1. å›¾ç‰‡ä¼˜åŒ–

*   **ã€ŒWebP/AVIFã€**ï¼šä½¿ç”¨ç°ä»£å›¾ç‰‡æ ¼å¼ï¼Œä½“ç§¯æ›´å°ï¼Œè´¨é‡æ›´é«˜ã€‚
    
*   **ã€Œæ‡’åŠ è½½ã€**ï¼šæŒ‰éœ€åŠ è½½å›¾ç‰‡ï¼Œå‡å°‘é¦–å±åŠ è½½æ—¶é—´ã€‚
    

```
// vite.config.jsimportÂ { defineConfig }Â fromÂ 'vite';importÂ vueÂ fromÂ '@vitejs/plugin-vue';importÂ { VitePluginLazyload }Â fromÂ 'vite-plugin-lazyload';exportÂ defaultÂ defineConfig({Â Â plugins: [vue(), VitePluginLazyload()],});
```

```
<imgÂ data-src="image.webp"Â class="lazy"Â /><script>Â Â newÂ IntersectionObserver((entries) =>Â {Â  Â  entries.forEach((entry) =>Â {Â  Â  Â Â ifÂ (entry.isIntersecting) {Â  Â  Â  Â Â constÂ img = entry.target;Â  Â  Â  Â  img.src = img.dataset.src;Â  Â  Â  Â  img.classList.remove('lazy');Â  Â  Â  }Â  Â  });Â  }).observe(document.querySelectorAll('.lazy'));</script>
```

### 2. å­—ä½“ä¼˜åŒ–

*   **ã€ŒæŒ‰éœ€åŠ è½½ã€**ï¼šåªåŠ è½½éœ€è¦çš„å­—ä½“æ ·å¼ã€‚
    
*   **ã€Œé¢„åŠ è½½ã€**ï¼šä½¿ç”¨Â `<link rel="preload">`Â é¢„åŠ è½½å…³é”®å­—ä½“ã€‚
    

```
<linkÂ rel="preload"Â href="/fonts/Roboto.woff2"Â as="font"Â type="font/woff2"Â crossoriginÂ />
```

* * *

ä¸‰ã€ç½‘ç»œä¼˜åŒ–ï¼šCDNã€ç¼“å­˜
-------------

### 1. ä½¿ç”¨ CDN

*   **ã€ŒCDNã€**ï¼šå°†é™æ€èµ„æºéƒ¨ç½²åˆ° CDNï¼Œå‡å°‘æœåŠ¡å™¨å‹åŠ›ï¼ŒåŠ é€ŸåŠ è½½ã€‚
    

```
// vite.config.jsimportÂ { defineConfig }Â from'vite';importÂ vueÂ from'@vitejs/plugin-vue';exportdefaultÂ defineConfig({plugins: [vue()],build: {Â  Â Â assetsDir:Â 'static',Â  Â Â assetsInlineLimit:Â 4096,Â // å°äº 4KB çš„èµ„æºå†…è”Â  },});
```

### 2. ç¼“å­˜ç­–ç•¥

*   **ã€Œç¼“å­˜æ§åˆ¶ã€**ï¼šéƒ¨ç½²æ—¶ç¼“å­˜é…ç½®ç¤ºä¾‹ï¼ˆNginxï¼‰, æŠŠä»¥ä¸‹ç‰‡æ®µæ”¾è¿›ä½ çš„ Nginx é…ç½®å³å¯ï¼Œä¸è¦å†™ vite.config.jsï¼š
    

```
# é™æ€èµ„æºç¼“å­˜Â 1Â å¹´location ~* \.(?:js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|avif|webp)$ {Â  expiresÂ 1y;Â  add_header Cache-ControlÂ "public, immutable";}
```

* * *

å››ã€é¦–å±ä¼˜åŒ–ï¼šéª¨æ¶å±ã€é¢„æ¸²æŸ“
--------------

### 1. éª¨æ¶å±

*   **ã€Œéª¨æ¶å±ã€**ï¼šåœ¨å†…å®¹åŠ è½½å®Œæˆå‰æ˜¾ç¤ºå ä½å›¾ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚
    

```
<divÂ class="skeleton">Â Â <divÂ class="skeleton-header"></div>Â Â <divÂ class="skeleton-content"></div></div>
```

```
.skeletonÂ {display: flex;flex-direction: column;align-items: center;justify-content: center;}.skeleton-headerÂ {width:Â 100%;height:Â 50px;background:Â linear-gradient(90deg, #f0f0f0, #e0e0e0, #f0f0f0);background-size:Â 200%200%;animation: skeletonÂ 1.5sÂ infinite;}.skeleton-contentÂ {width:Â 100%;height:Â 200px;background:Â linear-gradient(90deg, #f0f0f0, #e0e0e0, #f0f0f0);background-size:Â 200%200%;animation: skeletonÂ 1.5sÂ infinite;}@keyframesÂ skeleton {Â  0% {Â  Â Â background-position: -200%0;Â  }Â  100% {Â  Â Â background-position:Â 200%0;Â  }}
```

### 2. é¢„æ¸²æŸ“

*   **ã€Œé¢„æ¸²æŸ“ã€**ï¼šä½¿ç”¨ Vite æ’ä»¶è¿›è¡Œé¢„æ¸²æŸ“ï¼Œå‡å°‘é¦–å±åŠ è½½æ—¶é—´ã€‚
    

```
// vite.config.jsimportÂ { defineConfig }Â from'vite';importÂ vueÂ from'@vitejs/plugin-vue';importÂ vitePrerenderÂ from'vite-plugin-prerender';exportdefaultÂ defineConfig({plugins: [Â  Â  vue(),Â  Â  vitePrerender({Â  Â  Â Â routes: ['/',Â '/about'],Â // å¿…å¡«Â  Â  }),Â  ],});
```

* * *

äº”ã€æ€§èƒ½ç›‘æ§ï¼šLighthouseã€Web Vitals
----------------------------

### 1. Lighthouse

*   **ã€ŒLighthouseã€**ï¼šä½¿ç”¨ Lighthouse å®šæœŸæ£€æŸ¥æ€§èƒ½ï¼Œæ‰¾å‡ºç“¶é¢ˆã€‚
    

```
npm install -g lighthouselighthouse https://your-site.com --view
```

### 2. Web Vitals

*   **ã€ŒWeb Vitalsã€**ï¼šç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚ LCPã€FIDã€CLSã€‚
    

```
importÂ { getCLS, getFID, getLCP }Â fromÂ 'web-vitals';getCLS(console.log);getFID(console.log);getLCP(console.log);
```

* * *

å…­ã€ä»£ç ä¼˜åŒ–ï¼šå‡å°‘é‡ç»˜ã€é‡æ’
--------------

### 1. é¿å…å¼ºåˆ¶åŒæ­¥å¸ƒå±€ï¼ˆFLSï¼‰

*   **ã€ŒFLSã€**ï¼šé¿å…åœ¨ JavaScript ä¸­é¢‘ç¹è¯»å†™å¸ƒå±€å±æ€§ã€‚
    

```
// é¿å…constÂ width = element.offsetWidth;element.style.width = width +Â 10Â +Â 'px';// æ¨èelement.style.width = element.offsetWidth +Â 10Â +Â 'px';
```

### 2. ä½¿ç”¨ CSS åŠ¨ç”»

*   **ã€ŒCSS åŠ¨ç”»ã€**ï¼šä½¿ç”¨ CSS åŠ¨ç”»è€Œä¸æ˜¯ JavaScript åŠ¨ç”»ï¼Œå‡å°‘é‡ç»˜å’Œé‡æ’ã€‚
    

```
@keyframesÂ fadeIn {Â Â fromÂ {Â opacity:Â 0; }Â Â toÂ {Â opacity:Â 1; }}
```

```
<divÂ class="fade-in"></div>
```

* * *

ä¸ƒã€æ€»ç»“ï¼š7 æ­¥ä¼˜åŒ–æµç¨‹
------------

1.  **ã€Œä»£ç åˆ†å‰² + Tree-Shakingã€**ï¼šå‡å°‘ä»£ç ä½“ç§¯ã€‚
    
2.  **ã€Œå›¾ç‰‡ä¼˜åŒ–ã€**ï¼šä½¿ç”¨ç°ä»£æ ¼å¼ã€æ‡’åŠ è½½ã€‚
    
3.  **ã€Œç½‘ç»œä¼˜åŒ–ã€**ï¼šä½¿ç”¨ CDNã€è®¾ç½®ç¼“å­˜ã€‚
    
4.  **ã€Œé¦–å±ä¼˜åŒ–ã€**ï¼šéª¨æ¶å±ã€é¢„æ¸²æŸ“ã€‚
    
5.  **ã€Œæ€§èƒ½ç›‘æ§ã€**ï¼šLighthouseã€Web Vitalsã€‚
    
6.  **ã€Œä»£ç ä¼˜åŒ–ã€**ï¼šå‡å°‘é‡ç»˜ã€é‡æ’ã€‚
    
7.  **ã€ŒæŒç»­ä¼˜åŒ–ã€**ï¼šå®šæœŸæ£€æŸ¥ã€ä¼˜åŒ–ã€‚
    

* * *

ğŸ ä¸€å¥è¯æ€»ç»“
--------

é€šè¿‡ Vite + 7 æ‹›ä¼˜åŒ–ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä» 5 ç§’ç™½å±é™åˆ° 1.2 ç§’åŠ è½½å®Œæˆï¼Œæ€§èƒ½æå‡ 77%ã€‚æŠŠè¿™ä»½ä¼˜åŒ–æ¸…å•è´´åœ¨å·¥ä½