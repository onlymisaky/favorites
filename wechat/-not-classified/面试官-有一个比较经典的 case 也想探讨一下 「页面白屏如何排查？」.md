> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/8XJiwILdCy6IgkMHayRPSg)

```
ç‚¹å‡»ä¸Šæ–¹Â ç¨‹åºå‘˜æˆé•¿æŒ‡åŒ—ï¼Œå…³æ³¨å…¬ä¼—å·

å›å¤1ï¼ŒåŠ å…¥é«˜çº§Nodeäº¤æµç¾¤

```

hello å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯è€ƒæ‹‰ğŸ¨ã€‚

ã€å¦‚ä½•æ’æŸ¥é¡µé¢ç™½å±ã€‘ï¼Œç®—æ˜¯å‰ç«¯é¢è¯•ä¸­ä¸€ä¸ªå¾ˆç»å…¸çš„é¢˜ç›®äº†ï¼Œé™¤äº†åŸºç¡€çš„å‰ç«¯ä»£ç çš„æ’æŸ¥ï¼Œè¿˜æ¶‰åŠåˆ°å¤§é‡çš„è®¡ç®—æœºç½‘ç»œã€DNS è§£æã€CDN ç­‰æ–¹é¢çš„çŸ¥è¯†ï¼Œå¯¹å‰ç«¯ er ç»¼åˆèƒ½åŠ›è¦æ±‚æ¯”è¾ƒé«˜ã€‚ä»Šå¤©å¸¦æ¥ä¸€ç¯‡æ–‡ç« ï¼Œç³»ç»Ÿæ€§çš„è®²äº†ä½œè€…å…³äºé¡µé¢ç™½å±é—®é¢˜çš„æ¢³ç†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥äº†è§£ä¸‹ã€‚

ä¸‹é¢æ˜¯æ­£æ–‡éƒ¨åˆ†ã€‚

â

å‰æ®µæ—¶é—´é¢è¯•å­—èŠ‚ï¼Œé¢è¯•å®˜å¯¹æˆ‘çš„åŸ‹ç‚¹é¡¹ç›®æ¯”è¾ƒæ„Ÿå…´è¶£ï¼ŒèŠç€èŠç€çªç„¶æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼ˆåŸè¯ï¼‰ï¼š**æ—¢ç„¶è¯´åˆ°äº†è¿™æ ·ä¸€ä¸ªå«åšç›‘æ§ï¼Œå…¶å®æœ‰ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„ case ä¹Ÿæƒ³æ¢è®¨ä¸€ä¸‹ï¼Œå°±æ˜¯æ¯”å¦‚è¯´ä½ æœ‰åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå‡å¦‚ä½ çš„é¡µé¢è¢«åé¦ˆè¯´ç™½å±äº†ï¼Œå¯¹å§ï¼Ÿæ­£å¸¸æƒ…å†µä¸‹ä½ è¦å»æ’æŸ¥é—®é¢˜ã€è§£å†³é—®é¢˜ï¼Œé‚£æˆ‘æƒ³è®©ä½ å°±æ˜¯ç®€å•çš„æè¿°ä¸€ä¸‹ä½ ä¼šå»æ€ä¹ˆå»åšï¼Œå°±æ˜¯æŠŠä½ è¦å‡†å¤‡å¤„ç†çš„è¿‡ç¨‹ä¹Ÿæè¿°ä¸€ä¸‹ã€‚**

æˆ‘çš„**å›ç­”**ï¼šæœ‰æåˆ°æ£€æŸ¥ `DOM æŒ‚è½½`Â /Â `ç½‘ç»œè¯·æ±‚çŠ¶æ€`Â / `JS æ‰§è¡Œé”™è¯¯`ï¼Œä½†æœªè¦†ç›–`èµ„æºåŠ è½½å¤±è´¥`ã€`CDN å¼‚å¸¸`Â ç­‰åœºæ™¯ã€‚è™½ç„¶æœ‰ç®€å•äº†è§£è¿‡é¡µé¢ç™½å±ç›¸å…³çš„å†…å®¹ï¼Œä¸è¿‡è¿˜æ²¡åœ¨å®ä¹ å·¥ä½œä¸­é‡åˆ°è¿‡è¿™ç±»é—®é¢˜ï¼Œè¿˜æ˜¯ç¼ºå°‘äº†äº›ç³»ç»Ÿæ€§æ’æŸ¥çš„æ€ç»´ï¼Œè¿™ç¯‡æ–‡ç« å°±æ¥æ€»ç»“å­¦ä¹ ä¸€ä¸‹ã€‚ï¼ˆå…ˆäº†è§£é¡µé¢ç™½å±åŸå›  -> æ¢³ç†ä¸€ä¸‹æ’æŸ¥æ€è·¯ -> å­¦ä¹ ä¸‹å¦‚ä½•åœ¨ SDK ä¸­å®ç°ç™½å±æ£€æµ‹ï¼‰

ä¸€ã€å…ˆæ¥æ€»è§ˆä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯é¡µé¢ç™½å±ï¼Ÿ
-----------------

*   å‰ç«¯ç™½å±æ˜¯æŒ‡ç”¨æˆ·æ‰“å¼€ç½‘é¡µæ—¶ï¼Œé¡µé¢æœªèƒ½æ­£å¸¸åŠ è½½æˆ–æ¸²æŸ“ï¼Œå¯¼è‡´æµè§ˆå™¨æ˜¾ç¤ºä¸€ç‰‡ç©ºç™½ã€‚
    
*   ä¸€èˆ¬æƒ…å†µä¸‹ æ˜¯ç”± JS æ‰§è¡Œé”™è¯¯ / èµ„æºåŠ è½½å¤±è´¥ / ç½‘ç»œé—®é¢˜ / æ¸²æŸ“é€»è¾‘é”™è¯¯ å¼•èµ·çš„ã€‚
    
*   åœ¨å•é¡µé¢åº”ç”¨ä¸­ï¼ˆSPAï¼‰ï¼Œå‰ç«¯ç™½å±é—®é¢˜ä¼šå˜å¾—æ›´åŠ å¤æ‚ï¼Œå¯èƒ½å¯¼è‡´ç”¨æˆ·æ— æ³•çœ‹åˆ°ä»»ä½•æœ‰æ•ˆå†…å®¹ã€‚
    
*   è€Œè§£å†³ç™½å±é—®é¢˜çš„å…³é”®æ˜¯ï¼šå¿«é€Ÿå®šä½å¹¶ä¿®å¤é”™è¯¯ï¼Œç¡®ä¿èµ„æºæ­£ç¡®åŠ è½½å’Œæ¸²æŸ“ã€‚
    

â

ç™½å±é—®é¢˜æœ¬è´¨ä¸Šæ˜¯æµè§ˆå™¨æ¸²æŸ“æµæ°´çº¿çš„æ–­è£‚ï¼Œä» DNS è§£æ -> èµ„æºåŠ è½½ -> JS æ‰§è¡Œ -> DOM æ„å»º -> æ¸²æŸ“æ ‘ç”Ÿæˆ -> é¡µé¢ç»˜åˆ¶çš„å®Œæ•´é“¾è·¯ä¸­ï¼Œä»»ä¸€ç¯èŠ‚çš„å¼‚å¸¸éƒ½å¯èƒ½å¯¼è‡´æœ€ç»ˆå‘ˆç°çš„ç©ºç™½ã€‚

äºŒã€å†æ¥ç³»ç»Ÿæ€§æ¢³ç†ä¸€ä¸‹æ’æŸ¥æ€è·¯
---------------

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/U0WXqkJLdLQDmfFtaycq6fl3icZollxO5C1wEWQ7wscnkkthgpoemyo4MfAbh6NhMsn5jqe44xWhS4RPYsyWldA/640?wx_fmt=other&from=appmsg&watermark=1#imgIndex=0)

å›¾ä¸ºåŸåˆ›, è‹¥éœ€è½¬è½½ å¯ä»¥å¤‡æ³¨å‡ºå¤„âœ¨

â

çœ‹å®Œè¿™ä¹ˆå¤æ‚çš„æ’æŸ¥æµç¨‹, æ¥æ€è€ƒä¸‹ä¸€ä¸ªé¡µé¢ç™½å± çœŸçš„å€¼å¾—å¦‚æ­¤è®¤çœŸå¯¹å¾…å—? (é—®é—®é‚£äº›å¤§å‚ c ç«¯çš„å¤§ä½¬ä»¬å°±çŸ¥é“äº†)

ç”¨æˆ·ä½“é‡è¶Šå¤§, é¡µé¢ç™½å±æ—¶é—´èƒ½å¸¦æ¥çš„è´Ÿé¢å½±å“å°±è¶Šèƒ½å‘ˆç°æŒ‡æ•°çº§å¢é•¿, æ¯”å¦‚è¯´:

*   **ä¸šåŠ¡å±‚é¢**
    
    ï¼šç”µå•†åœºæ™¯ä¸‹æ¯å¢åŠ  1 ç§’ç™½å±æ—¶é—´è½¬åŒ–ç‡ä¸‹é™ 7%
    
*   **æŠ€æœ¯å±‚é¢**
    
    ï¼šå¯èƒ½å¼•å‘é›ªå´©æ•ˆåº”ï¼ˆå¦‚ CDN æ•…éšœå¯¼è‡´å…¨ç«™ä¸å¯ç”¨ï¼‰
    
*   **ä½“éªŒå±‚é¢**
    
    ï¼šç”¨æˆ·ç•™å­˜ç‡ä¸‹é™ 40%+
    

### 1. ç¬¬ä¸€é˜¶æ®µï¼šå¿«é€Ÿå®šä½é—®é¢˜å±‚çº§

#### æµè§ˆå™¨æ§åˆ¶å°å››æ­¥è¯Šæ–­æ³•

```
// Step 1 - æ£€æµ‹æ–‡æ¡£åŠ è½½é˜¶æ®µ
console.log('DOMContentLoaded:', performance.timing.domContentLoadedEventEndÂ - performance.timing.navigationStart);
console.log('Load Event:', performance.timing.loadEventEndÂ - performance.timing.navigationStart);

// Step 2 - æ£€æŸ¥å…³é”®é”™è¯¯
window.addEventListener('error',Â eÂ =>Â {
console.error('Global Error:', e.message, e.filename, e.lineno);
},Â true);

// Step 3 - éªŒè¯ DOM æŒ‚è½½ç‚¹ï¼ˆReact/Vue é‡ç‚¹ï¼‰
constÂ rootNode =Â document.getElementById('root');
ifÂ (!rootNode || rootNode.childNodes.lengthÂ ===Â 0) {
console.error('æŒ‚è½½èŠ‚ç‚¹å¼‚å¸¸:', rootNode);
}

// Step 4 - ç½‘ç»œçŠ¶æ€æ£€æµ‹
fetch('/health-check').catch(eÂ =>Â {
console.error('ç½‘ç»œè¿é€šæ€§å¼‚å¸¸:', e);
});

// Step 1 - æ£€æµ‹æ–‡æ¡£åŠ è½½é˜¶æ®µ
console.log('DOMContentLoaded:', performance.timing.domContentLoadedEventEndÂ - performance.timing.navigationStart);
console.log('Load Event:', performance.timing.loadEventEndÂ - performance.timing.navigationStart);

// Step 2 - æ£€æŸ¥å…³é”®é”™è¯¯
window.addEventListener('error',Â eÂ =>Â {
console.error('Global Error:', e.message, e.filename, e.lineno);
},Â true);

// Step 3 - éªŒè¯ DOM æŒ‚è½½ç‚¹ï¼ˆReact/Vue é‡ç‚¹ï¼‰
constÂ rootNode =Â document.getElementById('root');
ifÂ (!rootNode || rootNode.childNodes.lengthÂ ===Â 0) {
console.error('æŒ‚è½½èŠ‚ç‚¹å¼‚å¸¸:', rootNode);
}

// Step 4 - ç½‘ç»œçŠ¶æ€æ£€æµ‹
fetch('/health-check').catch(eÂ =>Â {
console.error('ç½‘ç»œè¿é€šæ€§å¼‚å¸¸:', e);
});


```

**å…¸å‹é—®é¢˜åœºæ™¯**ï¼š

*   Vue/React æœªæ•è·çš„åˆå§‹åŒ–é”™è¯¯å¯¼è‡´ root èŠ‚ç‚¹ä¸ºç©º
    
*   æµè§ˆå™¨æ’ä»¶æ³¨å…¥çš„è„šæœ¬å¼•å‘å…¨å±€é”™è¯¯
    

### 2. ç¬¬äºŒé˜¶æ®µï¼šç½‘ç»œå±‚æ·±åº¦æ£€æµ‹

#### ï¼ˆ1ï¼‰å…³é”®èµ„æºç€‘å¸ƒæµåˆ†æ

ä½¿ç”¨ Chrome DevTools çš„Â **Network é¢æ¿**ï¼š

1.  è¿‡æ»¤Â `JS|CSS|IMG`Â ç±»å‹èµ„æº
    
2.  æ£€æŸ¥å…³é”®èµ„æºçš„ï¼š
    

*   **HTTP çŠ¶æ€ç **
    
    ï¼ˆé‡ç‚¹ 404/403/500ï¼‰
    
*   **Timing æ˜ç»†**
    
    ï¼ˆTTFB æ˜¯å¦å¼‚å¸¸ï¼‰
    

4.  å³é”®èµ„æº â†’Â `Copy as cURL`Â éªŒè¯ CDN å¯ç”¨æ€§
    

#### ï¼ˆ2ï¼‰CDN æ•…éšœä¸“é¡¹æ’æŸ¥

```
# å¤šèŠ‚ç‚¹æ¢æµ‹ï¼ˆéœ€å®‰è£… httpieï¼‰
http https://cdn.example.com/main.js --verify=no \
Â  --headers \Â 
Â  --proxy=http:http://1.1.1.1:8080 \ Â # åˆ‡æ¢ä¸åŒä»£ç†èŠ‚ç‚¹
Â  --download > /dev/null

# DNS æ±¡æŸ“æ£€æµ‹
nslookup cdn.example.com 8.8.8.8 Â  # å¯¹æ¯”ä¸åŒ DNS ç»“æœ
nslookup cdn.example.com 114.114.114.114

# å¤šèŠ‚ç‚¹æ¢æµ‹ï¼ˆéœ€å®‰è£… httpieï¼‰
http https://cdn.example.com/main.js --verify=no \
Â  --headers \Â 
Â  --proxy=http:http://1.1.1.1:8080 \ Â # åˆ‡æ¢ä¸åŒä»£ç†èŠ‚ç‚¹
Â  --download > /dev/null

# DNS æ±¡æŸ“æ£€æµ‹
nslookup cdn.example.com 8.8.8.8 Â  # å¯¹æ¯”ä¸åŒ DNS ç»“æœ
nslookup cdn.example.com 114.114.114.114


```

**ç»å…¸æ¡ˆä¾‹**ï¼š  
æŸç«™ç‚¹å›  CDN èŠ‚ç‚¹æœªåŒæ­¥æœ€æ–°è¯ä¹¦ï¼Œå¯¼è‡´éƒ¨åˆ†ç”¨æˆ·æµè§ˆå™¨æ‹¦æˆª HTTPS è¯·æ±‚å¼•å‘ç™½å±

#### ï¼ˆ3ï¼‰èµ„æºå®Œæ•´æ€§æ ¡éªŒï¼ˆSRI å®æˆ˜ï¼‰

```
<!-- å¸¦ SRI æ ¡éªŒçš„èµ„æºåŠ è½½ -->
<scriptsrc="https://cdn.example.com/react.production.min.js"
integrity="sha384-xxxx"
crossorigin="anonymous"></script>

<!-- å¸¦ SRI æ ¡éªŒçš„èµ„æºåŠ è½½ -->
<scriptsrc="https://cdn.example.com/react.production.min.js"
integrity="sha384-xxxx"
crossorigin="anonymous"></script>


```

**æ’æŸ¥è¦ç‚¹**ï¼š

*   æ§åˆ¶å°å‡ºç°Â `Integrity checksum failed`Â é”™è¯¯
    
*   æ¯”å¯¹æœåŠ¡å™¨èµ„æº hash å€¼ï¼š
    

```
openssl dgst -sha384 -binary react.production.min.js | openssl base64 -A

openssl dgst -sha384 -binary react.production.min.js | openssl base64 -A


```

### 3. ç¬¬ä¸‰é˜¶æ®µï¼šæ¸²æŸ“å±‚æ•…éšœå®šä½

#### ï¼ˆ1ï¼‰SPA æ¡†æ¶ç‰¹æœ‰é™·é˜±

**Vue åœºæ™¯**ï¼š

```
newVue({
render:Â hÂ =>h(App)
}).$mount('#app') Â // è‹¥Â #appÂ èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œé™é»˜å¤±è´¥ï¼

newVue({
render:Â hÂ =>h(App)
}).$mount('#app') Â // è‹¥Â #appÂ èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œé™é»˜å¤±è´¥ï¼


```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```
constÂ root =Â document.getElementById('app');
ifÂ (!root) {
document.write('å®¹å™¨ä¸¢å¤±ï¼Œé™çº§æ˜¾ç¤ºåŸºç¡€å†…å®¹');Â 
}Â elseÂ {
newVue({Â render:Â hÂ =>h(App) }).$mount(root);
}

constÂ root =Â document.getElementById('app');
ifÂ (!root) {
document.write('å®¹å™¨ä¸¢å¤±ï¼Œé™çº§æ˜¾ç¤ºåŸºç¡€å†…å®¹');Â 
}Â elseÂ {
newVue({Â render:Â hÂ =>h(App) }).$mount(root);
}


```

**React åœºæ™¯**ï¼š

```
// é”™è¯¯è¾¹ç•Œç»„ä»¶ï¼ˆæ•è·æ¸²æŸ“å±‚é”™è¯¯ï¼‰
classErrorBoundaryextendsReact.ComponentÂ {
componentDidCatch(error) {
Sentry.captureException(error);
window.location.reload(); Â // é™çº§ç­–ç•¥
Â  }
render() {Â returnthis.props.children; }
}

// ä½¿ç”¨æ–¹å¼
<ErrorBoundary>
<AppÂ />
</ErrorBoundary>

// é”™è¯¯è¾¹ç•Œç»„ä»¶ï¼ˆæ•è·æ¸²æŸ“å±‚é”™è¯¯ï¼‰
classErrorBoundaryextendsReact.ComponentÂ {
componentDidCatch(error) {
Sentry.captureException(error);
window.location.reload(); Â // é™çº§ç­–ç•¥
Â  }
render() {Â returnthis.props.children; }
}

// ä½¿ç”¨æ–¹å¼
<ErrorBoundary>
<AppÂ />
</ErrorBoundary>


```

#### ï¼ˆ2ï¼‰CSS æ¸²æŸ“é˜»å¡

**æ£€æµ‹æ–¹æ³•**ï¼š

1.  æµè§ˆå™¨åœ°å€æ è¾“å…¥Â `about:blank`Â æ¸…ç©ºé¡µé¢
    
2.  é€æ­¥åŠ è½½ CSS æ–‡ä»¶ï¼Œè§‚å¯Ÿå¸ƒå±€å˜åŒ–
    
3.  æ£€æŸ¥Â `z-index`Â å¼‚å¸¸å¯¼è‡´å…ƒç´ ä¸å¯è§
    

**å…¸å‹æ¡ˆä¾‹**ï¼š  
æŸé¡µé¢å› Â `body { display: none !important; }`Â å†…è”æ ·å¼å¯¼è‡´ç™½å±

### 4. ç¬¬å››é˜¶æ®µï¼šæ€§èƒ½ç»´åº¦æ·±åº¦åˆ†æ

#### ï¼ˆ1ï¼‰ä¸»çº¿ç¨‹é˜»å¡æ£€æµ‹

**Long Tasks API**ï¼š

```
constÂ observer =Â newPerformanceObserver(listÂ =>Â {
Â  list.getEntries().forEach(entryÂ =>Â {
ifÂ (entry.durationÂ >Â 50) {
console.warn('ä¸»çº¿ç¨‹é˜»å¡:', entry);
Â  Â  }
Â  });
});
observer.observe({Â entryTypes: ['longtask'] });

constÂ observer =Â newPerformanceObserver(listÂ =>Â {
Â  list.getEntries().forEach(entryÂ =>Â {
ifÂ (entry.durationÂ >Â 50) {
console.warn('ä¸»çº¿ç¨‹é˜»å¡:', entry);
Â  Â  }
Â  });
});
observer.observe({Â entryTypes: ['longtask'] });


```

#### ï¼ˆ2ï¼‰å†…å­˜æ³„æ¼è¿½è¸ª

**Chrome Memory é¢æ¿æ“ä½œ**ï¼š

1.  ç”Ÿæˆå †å¿«ç…§ï¼ˆHeap Snapshotï¼‰
    
2.  ç­›é€‰Â `Detached DOM tree`Â æ£€æŸ¥æœªé‡Šæ”¾èŠ‚ç‚¹
    
3.  å¯¹æ¯”å¤šæ¬¡å¿«ç…§ï¼ŒæŸ¥æ‰¾æŒç»­å¢é•¿çš„å¯¹è±¡
    

**å…¸å‹æ¡ˆä¾‹**ï¼š  
æœªé”€æ¯çš„ WebSocket ç›‘å¬å™¨æŒç»­ç´¯ç§¯å¯¼è‡´å†…å­˜æº¢å‡º

#### ï¼ˆ3ï¼‰å…³é”®æŒ‡æ ‡é˜ˆå€¼

<table><thead><tr><th><section>æŒ‡æ ‡</section></th><th><section>è­¦å‘Šé˜ˆå€¼</section></th><th><section>ä¸¥é‡é˜ˆå€¼</section></th><th><section>æµ‹é‡å·¥å…·</section></th></tr></thead><tbody><tr><td><section>FCP</section></td><td><section>&gt;2s</section></td><td><section>&gt;4s</section></td><td><section>Lighthouse</section></td></tr><tr><td><section>JS æ€»æ‰§è¡Œæ—¶é—´</section></td><td><section>&gt;3s</section></td><td><section>&gt;5s</section></td><td><section>Chrome Performance é¢æ¿</section></td></tr><tr><td><section>æœªå‹ç¼©èµ„æºå æ¯”</section></td><td><section>&gt;30%</section></td><td><section>&gt;50%</section></td><td><section>Webpack Bundle Analyzer</section></td></tr></tbody></table>

### 5. ç¬¬äº”é˜¶æ®µï¼šç¯å¢ƒç‰¹å¼‚æ€§é—®é¢˜

#### ï¼ˆ1ï¼‰æµè§ˆå™¨å…¼å®¹æ€§

```
// ä½¿ç”¨ Feature Detection ä»£æ›¿ UA æ£€æµ‹
ifÂ (!('IntersectionObserver'inwindow)) {
loadPolyfill('intersection-observer').then(initApp);
}

// ä½¿ç”¨ Feature Detection ä»£æ›¿ UA æ£€æµ‹
ifÂ (!('IntersectionObserver'inwindow)) {
loadPolyfill('intersection-observer').then(initApp);
}


```

#### ï¼ˆ2ï¼‰è¿è¥å•†åŠ«æŒæ£€æµ‹

```
// æ£€æŸ¥é¡µé¢æ˜¯å¦è¢«æ³¨å…¥ç¬¬ä¸‰æ–¹è„šæœ¬
constÂ thirdPartyScripts =Â Array.from(document.scripts).filter(
sÂ =>Â !s.src.includes(window.location.hostname)
);
ifÂ (thirdPartyScripts.lengthÂ >Â 0) {
reportException('è¿è¥å•†åŠ«æŒ', thirdPartyScripts);
}

// æ£€æŸ¥é¡µé¢æ˜¯å¦è¢«æ³¨å…¥ç¬¬ä¸‰æ–¹è„šæœ¬
constÂ thirdPartyScripts =Â Array.from(document.scripts).filter(
sÂ =>Â !s.src.includes(window.location.hostname)
);
ifÂ (thirdPartyScripts.lengthÂ >Â 0) {
reportException('è¿è¥å•†åŠ«æŒ', thirdPartyScripts);
}


```

#### ï¼ˆ3ï¼‰æœ¬åœ°ç¯å¢ƒå¹²æ‰°

*   ç¦ç”¨æ‰€æœ‰æµè§ˆå™¨æ’ä»¶ï¼ˆå°¤å…¶æ˜¯å¹¿å‘Šæ‹¦æˆªå™¨ï¼‰
    
*   æ¸…é™¤Â `Service Worker`Â ç¼“å­˜ï¼š
    

```
navigator.serviceWorker.getRegistrations().then(regsÂ =>Â {
Â  regs.forEach(regÂ =>Â reg.unregister())
})

navigator.serviceWorker.getRegistrations().then(regsÂ =>Â {
Â  regs.forEach(regÂ =>Â reg.unregister())
})


```

#### ï¼ˆ4ï¼‰å…œåº•ç­–ç•¥

*   ç”¨æˆ·æ“ä½œè§†é¢‘å½•åˆ¶ï¼ˆæ¥å…¥ rrweb ç­‰å·¥å…·, å¤§å…¬å¸ç›‘æ§ä½“ç³»ä¸‹ä¸€èˆ¬éƒ½æœ‰ç”¨åˆ°, æ²¡æœ‰ç”¨ä¸Šçš„å»ºè®®ä¹Ÿå¯ä»¥åŠ ä¸Šï¼‰
    
*   ç‰¹å®šè®¾å¤‡è¿œç¨‹è°ƒè¯•ï¼ˆä½¿ç”¨ Chrome Remote Debuggingï¼‰
    

ä¸‰ã€ç™½å±æ£€æµ‹ SDK Â è¦æ€ä¹ˆå†™?
-----------------

â

è¿™é‡Œå°±ç»™å¤§å®¶æ”¾éƒ¨åˆ†æœ€è¿‘å†™çš„ä»£ç , ä¸»è¦ç”¨çš„æ˜¯`åŠ¨æ€æ£€æµ‹æ ¹èŠ‚ç‚¹`+`é»„é‡‘æ¯”ä¾‹é‡‡æ ·ç®—æ³•`+`é‡‡æ ·ç‚¹æ£€æµ‹`ä¸‰ç§æ–¹æ³•æ¥æ£€æµ‹ç™½å±æƒ…å†µ, æ„Ÿå…´è¶£çš„ä¹Ÿå¯ä»¥å»æˆ‘çš„ä»£ç ä»“åº“çœ‹ä¸‹å®Œæ•´çš„ä»£ç  - ByteTop - è½»é‡çº§ Web ç«¯åŸ‹ç‚¹ç›‘æ§å¹³å°

### æ ¸å¿ƒä»£ç 

#### 1. æ™ºèƒ½æ ¹èŠ‚ç‚¹æ£€æµ‹

```
constÂ rootSelectors = ["#root",Â "#app",Â "#main",Â "#container"];
constÂ rootNode = rootSelectors.find(selectorÂ =>
document.querySelector(selector)
) ||Â "body";
constÂ wrapperSet =Â newSet(["html",Â "body", rootNode.toLowerCase()]);

constÂ rootSelectors = ["#root",Â "#app",Â "#main",Â "#container"];
constÂ rootNode = rootSelectors.find(selectorÂ =>
document.querySelector(selector)
) ||Â "body";
constÂ wrapperSet =Â newSet(["html",Â "body", rootNode.toLowerCase()]);


```

*   **ç­–ç•¥**
    
    ï¼šä¼˜å…ˆçº§éå†å¸¸è§æ¡†æ¶æŒ‚è½½ç‚¹é€‰æ‹©å™¨ï¼ˆ[#root](javascript:;)Â â†’Â [#app](javascript:;)Â â†’Â [#main](javascript:;)Â â†’ ...ï¼‰
    
*   **é™çº§**
    
    ï¼šæœªåŒ¹é…æ—¶è‡ªåŠ¨é™çº§åˆ° body å…ƒç´ 
    
*   **ä¼˜åŒ–**
    
    ï¼šä½¿ç”¨ Set æ•°æ®ç»“æ„å®ç° O(1) å¤æ‚åº¦æŸ¥è¯¢
    

#### 2. é»„é‡‘æ¯”ä¾‹é‡‡æ ·ç®—æ³•

```
constÂ goldenRatio =Â 0.618;
constÂ points =Â Array.from({Â length: config.sampleCountÂ },Â (_, i) =>Â ({
x: i %Â 2Â ===Â 0
Â  Â  ?Â window.innerWidthÂ * goldenRatio *Â Math.random()
Â  Â  :Â window.innerWidthÂ -Â window.innerWidthÂ * goldenRatio *Â Math.random(),
y:Â window.innerHeightÂ * goldenRatio *Â Math.random()
}));

constÂ goldenRatio =Â 0.618;
constÂ points =Â Array.from({Â length: config.sampleCountÂ },Â (_, i) =>Â ({
x: i %Â 2Â ===Â 0
Â  Â  ?Â window.innerWidthÂ * goldenRatio *Â Math.random()
Â  Â  :Â window.innerWidthÂ -Â window.innerWidthÂ * goldenRatio *Â Math.random(),
y:Â window.innerHeightÂ * goldenRatio *Â Math.random()
}));


```

*   **è§†è§‰èšç„¦**
    
    ï¼š61.8% åŒºåŸŸå¯†é›†é‡‡æ ·ï¼Œç¬¦åˆäººç±»è§†è§‰ç„¦ç‚¹åˆ†å¸ƒè§„å¾‹
    
*   **æŠ—å¯¹ç§°å¹²æ‰°**
    
    ï¼šé€šè¿‡å¥‡å¶ç´¢å¼•å®ç°å·¦å³é•œåƒåˆ†å¸ƒï¼Œç ´è§£å±…ä¸­å¸ƒå±€è¯¯åˆ¤
    
*   **éšæœºæ‰°åŠ¨**
    
    ï¼šåœ¨é»„é‡‘æ¯”ä¾‹åŒºåŸŸå†…å¼•å…¥éšæœºåæ ‡ï¼Œé¿å…å›ºå®šè·¯å¾„é‡‡æ ·
    

#### 3. å¤åˆç‰¹å¾æ£€æµ‹

```
constÂ identifiers = [
Â  element.tagName.toLowerCase(), Â  Â  Â  Â  Â // æ ‡ç­¾ç‰¹å¾
Â  element.idÂ ?Â `#${element.id}`Â :Â "", Â  Â // ID ç‰¹å¾
Â  ...Array.from(element.classList).map(cÂ =>`.${c}`)Â // ç±»åç‰¹å¾
];

ifÂ (identifiers.some(idÂ =>Â wrapperSet.has(id))) {
Â  emptyCount++;
}

constÂ identifiers = [
Â  element.tagName.toLowerCase(), Â  Â  Â  Â  Â // æ ‡ç­¾ç‰¹å¾
Â  element.idÂ ?Â `#${element.id}`Â :Â "", Â  Â // ID ç‰¹å¾
Â  ...Array.from(element.classList).map(cÂ =>`.${c}`)Â // ç±»åç‰¹å¾
];

ifÂ (identifiers.some(idÂ =>Â wrapperSet.has(id))) {
Â  emptyCount++;
}


```

*   **ä¸‰çº§ç‰¹å¾æå–**
    
    ï¼šæ ‡ç­¾åã€IDã€ç±»åå…¨æ–¹ä½æ ‡è¯†å…ƒç´ 
    
*   **åŠ¨æ€ç±»åæ”¯æŒ**
    
    ï¼šå…¼å®¹ CSS Modules ç­‰å“ˆå¸Œç±»ååœºæ™¯
    
*   **é«˜æ•ˆåŒ¹é…**
    
    ï¼šSet æ•°æ®ç»“æ„å®ç°å¿«é€Ÿç‰¹å¾æ¯”å¯¹
    

#### 4. åŠ¨æ€é˜ˆå€¼ç­–ç•¥

```
returnÂ emptyCount / config.sampleCountÂ >= config.threshold;

returnÂ emptyCount / config.sampleCountÂ >= config.threshold;


```

*   **æ¯”ä¾‹æ§åˆ¶**
    
    ï¼šé€šè¿‡é˜ˆå€¼å‚æ•°æ§åˆ¶è¯¯æŠ¥ç‡ä¸æ¼æŠ¥ç‡çš„å¹³è¡¡
    
*   **åœºæ™¯é€‚é…**
    
    ï¼šç§»åŠ¨ç«¯æ¨è 0.7-0.8ï¼ŒPC ç«¯æ¨è 0.8-0.9
    
*   **åŠ¨æ€æ„ŸçŸ¥**
    
    ï¼šæ ¹æ®è®¾å¤‡ç±»å‹è‡ªåŠ¨è°ƒèŠ‚é˜ˆå€¼ï¼ˆéœ€æ‰©å±•å®ç°ï¼‰
    

### å®Œæ•´ä»£ç 

```
interfaceCheckWhiteScreenOptionsÂ {
Â Â /** é‡‡æ ·ç‚¹æ•°é‡ (é»˜è®¤: 20) */
Â  sampleCount?:Â number;
Â Â /** ç©ºç™½ç‚¹åˆ¤å®šé˜ˆå€¼ (0-1, é»˜è®¤ 0.8) */
Â  threshold?:Â number;
Â Â /** æ’é™¤çš„éª¨æ¶å±ç±»å (é»˜è®¤: 'skeleton') */
Â  skeletonClass?:Â string;
}
constÂ checkWhiteScreen = (options?:Â CheckWhiteScreenOptions):Â booleanÂ =>Â {
Â Â constÂ config = {
Â  Â Â sampleCount:Â 20,
Â  Â Â threshold:Â 0.8,
Â  Â Â skeletonClass:Â "skeleton",
Â  Â  ...options,
Â  };
Â Â tryÂ {
Â  Â Â // 1. æ’é™¤éª¨æ¶å±åœºæ™¯
Â  Â Â ifÂ (document.getElementsByClassName(config.skeletonClass).lengthÂ >Â 0) {
Â  Â  Â Â returnfalse;
Â  Â  } Â 

Â  Â Â // 2. åŠ¨æ€æ£€æµ‹æ ¹èŠ‚ç‚¹
Â  Â Â constÂ rootSelectors = ["#root",Â "#app",Â "#main",Â "#container"];
Â  Â Â constÂ rootNode =
Â  Â  Â  rootSelectors.find((selector) =>document.querySelector(selector)) ||
Â  Â  Â Â "body";
Â  Â Â constÂ wrapperSet =Â newSet(["html",Â "body", rootNode.toLowerCase()]);

Â  Â Â // 3. é»„é‡‘æ¯”ä¾‹é‡‡æ ·ç®—æ³•
Â  Â Â constÂ goldenRatio =Â 0.618;
Â  Â Â constÂ points =Â Array.from({Â length: config.sampleCountÂ },Â (_, i) =>Â ({
Â  Â  Â Â x:
Â  Â  Â  Â  i %Â 2Â ===Â 0
Â  Â  Â  Â  Â  ?Â window.innerWidthÂ * goldenRatio *Â Math.random()
Â  Â  Â  Â  Â  :Â window.innerWidthÂ -Â window.innerWidthÂ * goldenRatio *Â Math.random(),
Â  Â  Â Â y:Â window.innerHeightÂ * goldenRatio *Â Math.random(),
Â  Â  })); Â 

Â  Â Â // 4. é‡‡æ ·ç‚¹æ£€æµ‹
Â  Â Â letÂ emptyCount =Â 0;
Â  Â  points.forEach((point) =>Â {
Â  Â  Â Â constÂ element =Â document.elementFromPoint(point.x, point.y);
Â  Â  Â Â ifÂ (!element) {
Â  Â  Â  Â  emptyCount++;
Â  Â  Â  Â Â return;
Â  Â  Â  }
Â  Â  Â Â constÂ identifiers = [
Â  Â  Â  Â  element.tagName.toLowerCase(),
Â  Â  Â  Â  element.idÂ ?Â `#${element.id}`Â :Â "",
Â  Â  Â  Â  ...Array.from(element.classList).map((c) =>`.${c}`),
Â  Â  Â  ];
Â  Â  Â Â ifÂ (identifiers.some((id) =>Â wrapperSet.has(id))) {
Â  Â  Â  Â  emptyCount++;
Â  Â  Â  }
Â  Â  });
Â  Â Â console.log("emptyCount", emptyCount,Â " config:", config);

Â  Â Â // 5. é˜ˆå€¼åˆ¤æ–­
Â  Â Â returnÂ emptyCount / config.sampleCountÂ >= config.threshold;
Â  }Â catchÂ (e) {
Â  Â Â console.error("[ç™½å±æ£€æµ‹å¼‚å¸¸]", e);
Â  Â Â returnfalse;
Â  }
};

exportdefaultÂ checkWhiteScreen;
// // è‡ªå®šä¹‰é…ç½®
// const isWhite = checkWhiteScreen({
// Â  sampleCount: 30,
// Â  threshold: 0.75,
// Â  skeletonClass: 'loading-skeleton'
// });

// // ç§»åŠ¨ç«¯é€‚é…é…ç½®

// checkWhiteScreen({
// Â  sampleCount: 15, Â // å‡å°‘é‡‡æ ·ç‚¹
// Â  threshold: 0.7 Â  Â // é™ä½é˜ˆå€¼
// });

// // åå°ç®¡ç†ç³»ç»Ÿ
// checkWhiteScreen({
// Â  skeletonClass: 'ant-skeleton' // åŒ¹é…UIæ¡†æ¶
// });

// // é«˜ç²¾åº¦æ£€æµ‹
// checkWhiteScreen({
// Â  sampleCount: 50, Â // å¢åŠ é‡‡æ ·å¯†åº¦
// Â  threshold: 0.9 Â  Â // ä¸¥æ ¼åˆ¤å®š
// });

interfaceCheckWhiteScreenOptionsÂ {
Â Â /** é‡‡æ ·ç‚¹æ•°é‡ (é»˜è®¤: 20) */
Â  sampleCount?:Â number;
Â Â /** ç©ºç™½ç‚¹åˆ¤å®šé˜ˆå€¼ (0-1, é»˜è®¤ 0.8) */
Â  threshold?:Â number;
Â Â /** æ’é™¤çš„éª¨æ¶å±ç±»å (é»˜è®¤: 'skeleton') */
Â  skeletonClass?:Â string;
}
constÂ checkWhiteScreen = (options?:Â CheckWhiteScreenOptions):Â booleanÂ =>Â {
Â Â constÂ config = {
Â  Â Â sampleCount:Â 20,
Â  Â Â threshold:Â 0.8,
Â  Â Â skeletonClass:Â "skeleton",
Â  Â  ...options,
Â  };
Â Â tryÂ {
Â  Â Â // 1. æ’é™¤éª¨æ¶å±åœºæ™¯
Â  Â Â ifÂ (document.getElementsByClassName(config.skeletonClass).lengthÂ >Â 0) {
Â  Â  Â Â returnfalse;
Â  Â  } Â 

Â  Â Â // 2. åŠ¨æ€æ£€æµ‹æ ¹èŠ‚ç‚¹
Â  Â Â constÂ rootSelectors = ["#root",Â "#app",Â "#main",Â "#container"];
Â  Â Â constÂ rootNode =
Â  Â  Â  rootSelectors.find((selector) =>document.querySelector(selector)) ||
Â  Â  Â Â "body";
Â  Â Â constÂ wrapperSet =Â newSet(["html",Â "body", rootNode.toLowerCase()]);

Â  Â Â // 3. é»„é‡‘æ¯”ä¾‹é‡‡æ ·ç®—æ³•
Â  Â Â constÂ goldenRatio =Â 0.618;
Â  Â Â constÂ points =Â Array.from({Â length: config.sampleCountÂ },Â (_, i) =>Â ({
Â  Â  Â Â x:
Â  Â  Â  Â  i %Â 2Â ===Â 0
Â  Â  Â  Â  Â  ?Â window.innerWidthÂ * goldenRatio *Â Math.random()
Â  Â  Â  Â  Â  :Â window.innerWidthÂ -Â window.innerWidthÂ * goldenRatio *Â Math.random(),
Â  Â  Â Â y:Â window.innerHeightÂ * goldenRatio *Â Math.random(),
Â  Â  })); Â 

Â  Â Â // 4. é‡‡æ ·ç‚¹æ£€æµ‹
Â  Â Â letÂ emptyCount =Â 0;
Â  Â  points.forEach((point) =>Â {
Â  Â  Â Â constÂ element =Â document.elementFromPoint(point.x, point.y);
Â  Â  Â Â ifÂ (!element) {
Â  Â  Â  Â  emptyCount++;
Â  Â  Â  Â Â return;
Â  Â  Â  }
Â  Â  Â Â constÂ identifiers = [
Â  Â  Â  Â  element.tagName.toLowerCase(),
Â  Â  Â  Â  element.idÂ ?Â `#${element.id}`Â :Â "",
Â  Â  Â  Â  ...Array.from(element.classList).map((c) =>`.${c}`),
Â  Â  Â  ];
Â  Â  Â Â ifÂ (identifiers.some((id) =>Â wrapperSet.has(id))) {
Â  Â  Â  Â  emptyCount++;
Â  Â  Â  }
Â  Â  });
Â  Â Â console.log("emptyCount", emptyCount,Â " config:", config);

Â  Â Â // 5. é˜ˆå€¼åˆ¤æ–­
Â  Â Â returnÂ emptyCount / config.sampleCountÂ >= config.threshold;
Â  }Â catchÂ (e) {
Â  Â Â console.error("[ç™½å±æ£€æµ‹å¼‚å¸¸]", e);
Â  Â Â returnfalse;
Â  }
};

exportdefaultÂ checkWhiteScreen;
// // è‡ªå®šä¹‰é…ç½®
// const isWhite = checkWhiteScreen({
// Â  sampleCount: 30,
// Â  threshold: 0.75,
// Â  skeletonClass: 'loading-skeleton'
// });

// // ç§»åŠ¨ç«¯é€‚é…é…ç½®

// checkWhiteScreen({
// Â  sampleCount: 15, Â // å‡å°‘é‡‡æ ·ç‚¹
// Â  threshold: 0.7 Â  Â // é™ä½é˜ˆå€¼
// });

// // åå°ç®¡ç†ç³»ç»Ÿ
// checkWhiteScreen({
// Â  skeletonClass: 'ant-skeleton' // åŒ¹é…UIæ¡†æ¶
// });

// // é«˜ç²¾åº¦æ£€æµ‹
// checkWhiteScreen({
// Â  sampleCount: 50, Â // å¢åŠ é‡‡æ ·å¯†åº¦
// Â  threshold: 0.9 Â  Â // ä¸¥æ ¼åˆ¤å®š
// });


```

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/U0WXqkJLdLQDmfFtaycq6fl3icZollxO55BmTAjiaWYBYiakpUgrefkDBjsmINjshgbicHrIn52rg0AU0Oia25TClQQ/640?wx_fmt=other&from=appmsg&watermark=1#imgIndex=1)

> åŸæ–‡é“¾æ¥ï¼š
> 
> https://juejin.cn/post/7494167764916256803

Node ç¤¾ç¾¤

```
æˆ‘ç»„å»ºäº†ä¸€ä¸ªæ°›å›´ç‰¹åˆ«å¥½çš„ Node.js ç¤¾ç¾¤ï¼Œé‡Œé¢æœ‰å¾ˆå¤š Node.jså°ä¼™ä¼´ï¼Œå¦‚æœä½ å¯¹Node.jså­¦ä¹ æ„Ÿå…´è¶£çš„è¯ï¼ˆåç»­æœ‰è®¡åˆ’ä¹Ÿå¯ä»¥ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·è¿›è¡ŒNode.jsç›¸å…³çš„äº¤æµã€å­¦ä¹ ã€å…±å»ºã€‚ä¸‹æ–¹åŠ  è€ƒæ‹‰ å¥½å‹å›å¤ã€ŒNodeã€å³å¯ã€‚

Â Â Â â€œåˆ†äº«ã€ç‚¹èµã€åœ¨çœ‹â€ æ”¯æŒä¸€æ³¢ğŸ‘

```