> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Pi-5wIjlmHfU5izE9xDQzA)

大家平时在开发的时候有没被 new Date()折磨过？就是它的诸多怪异的设定让你每每用的时候，都可能不小心踩坑。造成程序意外出错，却一下子找不到问题出处，那叫一个烦透了…… 下面，我就列举它的 “四宗罪” 及应用思考

可恶的四宗罪
------

### 1. Safari 浏览器不兼容 YYYY-MM-DD 这样的格式

```
new Date('2023-1-1');复制代码
```

这行代码无论在 Macbook 中还是 iPhone 中的 Safari 浏览器，返回的都是 Invalid Date, Safari 浏览器目前还理解不了 YYYY-MM-DD 这样的格式，只支持 YYYY/MM/DD。这就造成你在 Windows 环境下的代码正常原型，而你的其他部分用户异常显示；

### 2、月份的索引是以 0 为起点的，而年份、日期却不是

```
new Date(2023,1,1);复制代码
```

得到的是一个反直觉的结果：2023 年 2 月 1 日！！！

```
Wed Feb 01 2023 00:00:00 GMT+0800 (中国标准时间)复制代码
```

同样的，对应的方法. setMonth() 也是从 0 开始设置的。就…… 很无语！

### 3、年份小于 100，默认以 19xx 或 20xx 开头

一般的应用可能碰不到这样的情况，毕竟现在是 21 世纪了，我们在应用中看到的大部分时间都是现代的。但是当你需要格式化公元元年 - 公元 100 年之间的时间，你就该懵了！

举个栗子：

```
new Date(2023,1,1);复制代码
```

能正常返回时间对象

```
Wed Feb 01 2023 00:00:00 GMT+0800 (中国标准时间)复制代码
```

但是当年份调到了东汉时期，公元 50 年 2 月 1 日

```
new Date(50,2,1);复制代码
```

恭喜你，你直接迎接了新中国！见证了历史：

```
Wed Mar 01 1950 00:00:00 GMT+0800 (中国标准时间)复制代码
```

是的，Date 直接帮你加了 1900 年的时间！如果需要获得公元 50 年 2 月 1 日，得这么写

```
new Date('0050-02-01');复制代码
```

返回：

```
Tue Feb 01 0050 08:05:43 GMT+0805 (中国标准时间)复制代码
```

请千万不要尝试添加时间，因为你又要裂开了……

```
new Date('0050-02-01 00:00:00');复制代码
```

返回：

```
Wed Feb 01 1950 00:00:00 GMT+0800 (中国标准时间)复制代码
```

你就说，它任性吧？！别气馁，别忘了标题还有 20xx 的情况

```
new Date('10-11-12');复制代码
```

返回：

```
Thu Oct 11 2012 00:00:00 GMT+0800 (中国标准时间)复制代码
```

就是说，当年份为 2 位数的时候，这种字符串格式的，构造函数把最后面那个当作年份，而且默认它为 20xx 年

### 4、日期初始化不统一，存在时区差异

你相信吗？'2018-01-01'和'2018/01/01'是不同的，存在一定时差

```
new Date('2018-01-01');复制代码
```

返回：

```
Mon Jan 01 2018 08:00:00 GMT+0800 (中国标准时间)复制代码
```

然而……

```
new Date('2018/01/01');复制代码
```

返回：

```
Mon Jan 01 2018 00:00:00 GMT+0800 (中国标准时间)复制代码
```

看到差异了吗？两种格式返回的时间是不同的，查了个北京时间与格林尼治时间的时差，8 个小时啊！

应用思考
----

在日常开发中，我们应用 new Date() 无非就是对时间运算及时间的格式化。

### 1. 时间的计算

需要方便对比两个时间的早晚，可以分别对年份、月份、日期、小时等进行单独比较。而我们现有的操作还比较麻烦。

比如，我想知道 2003 年 7 月 13 日北京申奥成功到 2008 年 8 月 8 日北京奥运开幕中间差了几天，如何快速计算？这样的计算在日常开发中还比较常见，特别是电商网站对抢购环节的倒计时。

还有诸如，当前时间在 100 天以后又是几月几号呢？

### 2. 时间的比较

给定两个时间，判断哪个在前，哪个在后；给定一个时间返回，判断某个时间是不是在这两者之间。

### 3. 时间的格式化

在网站开发中，我们最常见的就是对后台返回时间戳的格式化显示。而原生带来的仅有年份如何获取，月份如何获取，日期如何获取的方法，就方便的无非就是 toISOString() 这样的方法，但是返回的却不一定是你要的格式。如何快速实现自定义格式化字符串，这也是一门技术。

困境的解决
-----

想必大家日常中也用过 moment.js、dayjs、data-format 这些工具吧？确实挺好用的，我也就顺便说一下而已。因为我要开始打广告了…… 面对着 new Date() 各种无语的坑，我慢慢的也弄了一个不大的库 (250 行左右代码)。

你要说我的库和前面的几个库对比，有啥改进的或者有啥特点的吗？

😂确实也没有，我只是想用自己造的 “轮子”，走自己路。它更符合我自己的使用习惯罢了

【项目开源地址】github.com/mumuy/datex[1]

【项目演示地址】passer-by.com/datex/[2]

提供的方法足以解决以上 “四宗罪” 及日常应用。它提供多种初始化时间的方式：

### 实例化对象

```
// 通过时间戳datex(123456789);// 通过多个参数初始化datex(2018,8,8);// 通过时间字符串初始化datex('2018-08-08');datex('2018-04-04T16:00:00.000Z');// 通过时间对象初始化datex({year:2008,month:8,day:8,hour:8,minute:0,second:0});// 通过时间数组初始化datex([2018,8,8,8,8,0]);// 无参数初始化datex();复制代码
```

### 时间戳及克隆

```
// 返回时间戳(毫秒)datex().getTime();// 返回时间戳(秒)datex().getUnix();// 克隆datex().clone();复制代码
```

### 时间对象输出

```
// 返回原生Date对象datex().toDate();// 返回时间字段对象datex().toObject();// 返回时间字段数组datex().toArray();// 返回字符串datex().toString();// 返回ISO字符串datex().toISOString();复制代码
```

### 时间格式化

```
datex(123456789).format('YYYY-MM-DD');复制代码
```

### 时间计算及比较

```
// 设置某字段值datex(2022,10,1).set('year',2020).format();// 增减某字段值，负值为减datex(2022,10,1).change('year',1).format();// 返回某字段值datex().get('month');// 获取某字段起始时// 例如：获取这个月初是星期几？datex().startOf('month').format('W');// 获取某字段末尾时// 例如：获取这个月有多少天？(是不是很容易理解？end of month then get day!)datex().endOf('month').get('day');// 与某时间点差值// 例如：北京2008年奥运会开幕式过去多少天了？datex().diffWith('2008-8-8','day');// 是否在某个时间点之前datex('2008-08-08').isBefore('2022-02-02');// 是否在某个时间点之后datex('2008-08-08').isAfter('2022-02-02');// 是否和某个时间点相等datex('2008-08-08').isSame('2018-02-02','year');// 是否在两个时间点之间datex('2008-08-08').isBetween('2003-07-13','2022-02-02');复制代码
```

### 有效性

```
datex('2008-13-12').isValid();复制代码
```

ok, that is it. 你还遇到过哪些特别奇葩的问题，或者棘手的需求呢？不妨告诉我下，反正……😉我也不一定会做。

[1]

https://github.com/mumuy/datex

[2]

https://passer-by.com/datex/

关于本文  

来自：passer-by6061

https://juejin.cn/post/7221884988492382267

最后
--

欢迎关注「三分钟学前端」

号内回复：  

「网络」，自动获取三分钟学前端网络篇小书（90 + 页）

「JS」，自动获取三分钟学前端 JS 篇小书（120 + 页）

「算法」，自动获取 github 2.9k+ 的前端算法小书

「面试」，自动获取 github 23.2k+ 的前端面试小书

「简历」，自动获取程序员系列的 `120` 套模版

》》面试官也在看的前端面试资料《《  

“在看和转发” 就是最大的支持