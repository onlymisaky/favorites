> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/FcyWj-jItFyVi9-Fql2UWg)

ç¬¬ä¸€æ®µå®ä¹ å°±æ¥åˆ°äº†ä¸ªå·¥ç¨‹åŒ–çš„éœ€æ±‚ - å†™æ’ä»¶ï¼Œå¯¹æˆ‘è¿™ç§å·¥ç¨‹åŒ–å°ç™½æ¥è¯´æ— ç–‘æ˜¯å·¨å¤§çš„æŒ‘æˆ˜ï¼Œå‘å¤šä½å‰è¾ˆè¯·æ•™è¿‡åï¼Œå†³å®šå…ˆä» webpack å­¦èµ·ï¼Œç„¶åå†åˆ°ç¼–è¯‘å™¨ + ASTï¼Œä¸€æ­¥ä¸€æ­¥æŠŠå·¥ç¨‹åŒ–ç†è§£ä½“ç³»æ­èµ·æ¥ã€‚å¦‚æœè§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµå…³æ³¨ğŸ˜˜

ä¸€ã€æ¦‚è§ˆ
----

**Babel**Â ï¼šå°† es6 + çš„ JavaScript ä»£ç ç¼–è¯‘æˆ ç›®æ ‡ç¯å¢ƒæ”¯æŒçš„è¯­æ³•ç¯å¢ƒï¼Œå¹¶ä¸”å¯¹ç›®æ ‡ç¯å¢ƒä¸æ”¯æŒçš„ api è‡ªåŠ¨ polyfillã€‚ç¼–è¯‘è¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ ï¼ˆè§£æï¼Œè½¬æ¢ï¼Œç”Ÿæˆï¼‰

**AST**(æŠ½è±¡è¯­æ³•æ ‘): æ˜¯Â `Babel`ã€`tsc`Â ç­‰ç¼–è¯‘å™¨ è¿›è¡Œä»£ç è½¬æ¢çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œè¡¨ç¤ºäº†æºä»£ç çš„æŠ½è±¡è¯­æ³•ç»“æ„ï¼Œä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚ä½¿å¾—Â `Babel`Â èƒ½å¤Ÿç†è§£å’Œæ“ä½œä»£ç ã€‚

**TSC**ï¼ˆTypeScript Compilerï¼‰: typescript å®˜æ–¹çš„ç¼–è¯‘å™¨ï¼Œå¯ä»¥å°† typescript ä»£ç è½¬æ¢ä¸º JavaScript ä»£ç , ä¹Ÿå¯ä»¥åƒ Babel é‚£æ ·å¯¹ä»£ç è¿›è¡Œç¼–è¯‘ï¼ŒåŒæ ·ä½¿ç”¨äº† AST ä½œä¸ºä»£ç è½¬æ¢å’Œä¼˜åŒ–çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œå’Œ babel çš„åŒºåˆ«åœ¨åé¢ç¬¬äº”ç‚¹æœ‰ä»‹ç»ï½

#### ä»€ä¹ˆæ˜¯ ASTï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ ASTï¼Ÿ

1.  è¯´ç™½äº†å°±æ˜¯ä»¥ JSON å½¢å¼å­˜åœ¨çš„ä¸€æ£µæ ‘ï¼š`Babel`ï¼Œ`tsc`ï¼Œ`Vue-cli`Â å’ŒÂ `EsLint`Â ç­‰å¾ˆå¤šçš„å·¥å…·å’Œåº“çš„æ ¸å¿ƒéƒ½æ˜¯é€šè¿‡ AST æŠ½è±¡è¯­æ³•æ ‘è¿™ä¸ªæ¦‚å¿µæ¥å®ç°å¯¹ä»£ç çš„æ£€æŸ¥ã€åˆ†æç­‰æ“ä½œçš„ã€‚åœ¨å‰ç«¯å½“ä¸­ AST çš„ä½¿ç”¨åœºæ™¯éå¸¸å¹¿ï¼Œæ¯”å¦‚åœ¨Â `Vue.js`Â å½“ä¸­ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­ç¼–å†™çš„Â `template`Â è½¬åŒ–æˆ render function çš„è¿‡ç¨‹å½“ä¸­ç¬¬ä¸€æ­¥å°±æ˜¯è§£ææ¨¡ç‰ˆå­—ç¬¦ä¸²ç”Ÿæˆ ASTã€‚
    
2.  JS çš„è®¸å¤šè¯­æ³•ä¸ºäº†ç»™å¼€å‘è€…æ›´å¥½çš„ç¼–ç¨‹ä½“éªŒï¼ˆä¾‹å¦‚ï¼šES6+ æ–°å¢çš„è¯­æ³•ï¼‰ï¼Œå¹¶ä¸é€‚åˆç¨‹åºçš„ç†è§£ï¼Œæ‰€ä»¥éœ€è¦æŠŠæºç è½¬åŒ–ä¸º AST æ¥æ›´é€‚åˆç¨‹åºåˆ†æï¼Œæµè§ˆå™¨çš„ç¼–è¯‘å™¨ä¸€èˆ¬ä¼šæŠŠæºç è½¬åŒ–ä¸º AST æ¥è¿›è¡Œä¸‹ä¸€æ­¥çš„åˆ†ææ¥æ‰§è¡Œå…¶ä»–æ“ä½œã€‚é€šè¿‡äº†è§£Â `AST`Â è¿™ä¸ªæ¦‚å¿µï¼Œå¯¹æ·±å…¥äº†è§£å‰ç«¯çš„ä¸€äº›æ¡†æ¶å’Œå·¥å…·æ˜¯å¾ˆæœ‰å¸®åŠ©çš„
    

#### äº†è§£åˆ°ä»€ä¹ˆæ˜¯ AST äº†ï¼Œå†æ¥äº†è§£ä¸€ä¸ªå®Œæ•´çš„ç¼–è¯‘å™¨æ•´ä½“æ‰§è¡Œè¿‡ç¨‹

å‚è€ƒæ–‡ç« ï¼šå‰ç«¯å·¥ç¨‹åŒ–åŸºçŸ³ -- AST ğŸ”¥[1]

æˆ‘è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œç”¨ä¸€å¼ ç²¾ç¾çš„å›¾ç‰‡å±•ç¤ºï¼šÂ ![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHqDZic62FnQbIotFs9GX3icqAHH9KA56ib9fPRgiaIOTcbAOI7xGmfTOkWfTyc82cr0dwUAbz6e5jqnYQ/640?wx_fmt=other&from=appmsg)

äºŒ. ç¼–è¯‘å™¨ - æ ¸å¿ƒåŠŸèƒ½ä»‹ç»ï¼ˆä»¥ babel ä¸ºä¾‹ï¼‰
---------------------------

Babel æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ JavaScript ç¼–è¯‘å™¨ï¼Œå®ƒèƒ½å¤Ÿå°†ç°ä»£ JavaScript ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript ç‰ˆæœ¬ï¼Œä»¥ä¾¿åœ¨æ—§ç¯å¢ƒä¸­è¿è¡Œã€‚Babel çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å®ƒçš„**æ’ä»¶ç³»ç»Ÿ**ï¼Œå…è®¸å¼€å‘è€…è‡ªå®šä¹‰ä»£ç è½¬æ¢çš„é€»è¾‘ã€‚ä¸‹é¢ï¼Œæˆ‘å°†ç»“åˆä¸€äº›å®é™…çš„ä»£ç ç¤ºä¾‹æ¥ä»‹ç» Babel çš„æ’ä»¶ç³»ç»Ÿï¼ˆé…ç½®æ–‡ä»¶ + preset é¢„è®¾ï¼‰ã€‚

åœ¨ Babel ä¸­ï¼Œé…ç½®æ–‡ä»¶ï¼ˆå¦‚Â `.babelrc`Â æˆ–Â `babel.config.json`ï¼‰å’Œ preset æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œä½†å®ƒä»¬å…±åŒä½œç”¨äº Babel çš„è½¬æ¢è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å’Œè¯¦ç»†è¯´æ˜ï¼š

#### é…ç½®æ–‡ä»¶ï¼š

ç”¨äº**æŒ‡å®šè½¬æ¢ä»£ç çš„è§„åˆ™ã€æ’ä»¶å’Œé¢„è®¾**ã€‚å¼€å‘è€…å¯ä»¥æ ¹æ®é¡¹ç›®çš„éœ€è¦åˆ›å»ºå’Œé…ç½®è‡ªå·±çš„Â `.babelrc`Â æ–‡ä»¶æˆ–è€…`babel.config.json`ã€‚

*   `.babelrc`ï¼šæ–‡ä»¶ç›¸å¯¹çš„é…ç½®æ–‡ä»¶ï¼Œé€‚ç”¨äºé¡¹ç›®çš„ç‰¹å®šéƒ¨åˆ†æˆ–å­ç›®å½•ã€‚
    
*   `babel.config.json`ï¼šé¡¹ç›®èŒƒå›´çš„é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œå¯¹æ•´ä¸ªé¡¹ç›®ç”Ÿæ•ˆã€‚
    

#### preset é¢„è®¾ï¼š

ä¸€ç»„**æ’ä»¶çš„é›†åˆ**ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ä½¿ç”¨é¢„è®¾æ¥å¿«é€Ÿé…ç½®Â `Babel`Â çš„è½¬æ¢è¡Œä¸ºï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªä¸ªæ‰‹åŠ¨æ·»åŠ å’Œé…ç½®å„ä¸ªæ’ä»¶ã€‚ä¾‹å¦‚ï¼Œ`@babel/preset-env`Â æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„Â `Babel`Â é¢„è®¾ï¼Œå®ƒæ ¹æ®ç›®æ ‡ç¯å¢ƒçš„é…ç½®ï¼Œè‡ªåŠ¨é€‰æ‹©éœ€è¦çš„è½¬æ¢è§„åˆ™ï¼Œä»¥ä¾¿å°†è¾ƒæ–°çš„Â `JavaScript`Â è¯­æ³•è½¬æ¢ä¸ºç›®æ ‡ç¯å¢ƒå…¼å®¹çš„ä»£ç ã€‚

**å¸¸è§é¢„è®¾**ï¼š

*   `@babel/preset-env`ï¼šæ ¹æ®ç›®æ ‡ç¯å¢ƒå’Œé…ç½®é€‰é¡¹è‡ªåŠ¨é€‰æ‹©é€‚åˆçš„æ’ä»¶ï¼Œä»¥å®ç°å¯¹æœ€æ–°çš„ ECMAScript è¯­æ³•å’ŒåŠŸèƒ½çš„è½¬æ¢ã€‚
    
*   `@babel/preset-react`ï¼šç”¨äºè½¬æ¢ JSX è¯­æ³•å’Œ React ç›¸å…³çš„ç‰¹æ€§ã€‚
    
*   `@babel/preset-typescript`ï¼šç”¨äºè½¬æ¢ TypeScript ä»£ç ã€‚
    

**ä¸é…ç½®æ–‡ä»¶çš„å…³ç³»**ï¼š

*   Preset é€šå¸¸åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šï¼Œä½œä¸ºÂ `presets`Â æ•°ç»„çš„ä¸€ä¸ªå…ƒç´ ã€‚
    
*   é…ç½®æ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ª presetï¼Œæ¯ä¸ª preset éƒ½ä¼šæŒ‰ç…§å£°æ˜çš„é¡ºåºï¼ˆä½†åœ¨æ‰§è¡Œæ—¶å¯èƒ½æ˜¯é€†åºï¼Œå–å†³äº Babel çš„ç‰ˆæœ¬å’Œå…·ä½“å®ç°ï¼‰åº”ç”¨äºä»£ç è½¬æ¢è¿‡ç¨‹ã€‚
    

#### å°ç»“

*   **é…ç½®æ–‡ä»¶**ï¼šæ˜¯ä¸€ä¸ªåŒ…å« Babel é…ç½®é€‰é¡¹çš„ JSONï¼ˆæˆ–å…¶ä»–æ ¼å¼ï¼‰æ–‡ä»¶ï¼Œç”¨äºæŒ‡å®š Babel çš„è¡Œä¸ºã€‚
    
*   **Preset**ï¼šæ˜¯ä¸€ç»„é¢„å®šä¹‰çš„è½¬æ¢è§„åˆ™é›†åˆï¼Œç”¨äºç®€åŒ–é…ç½®è¿‡ç¨‹å¹¶å®ç°å¯¹ç‰¹å®šç¯å¢ƒæˆ–ç‰¹æ€§çš„è½¬æ¢ã€‚
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHqDZic62FnQbIotFs9GX3icqAbvRyXT5OF9JiaciaZuTib7blnZic6RBic7ImYS9K07VcL4ddETuTy7KWplg/640?wx_fmt=other&from=appmsg)

#### é…ç½®æ–‡ä»¶æ¨èä½¿ç”¨åœºæ™¯ï¼š

*   `babel.config.json`Â ä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ª monorepoï¼ˆå¯ä»¥ç†è§£ä¸ºåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ä¼šæœ‰å¤šä¸ªå­å·¥ç¨‹ï¼‰ ä½ å¸Œæœ›ç¼–è¯‘ node_modules ä»¥åŠ symobllinked-project ä¸­çš„ä»£ç 
    
*   `.babelrc`Â ä½ çš„é…ç½®ä»…é€‚ç”¨äºé¡¹ç›®çš„å•ä¸ªéƒ¨åˆ† éœ€è¦åœ¨å­ç›®å½• / æ–‡ä»¶ä¸­è¿è¡Œä¸€äº›ç‰¹å®šçš„è½¬æ¢ï¼Œæ¯”å¦‚ä½ å¯èƒ½ä¸å¸Œæœ›ä¸€äº›ç¬¬ä¸‰æ–¹åº“è¢«è½¬ç 
    
*   `package.json`Â ä¹Ÿå¯ä»¥ç›´æ¥å°†Â `.babelrc`Â ä¸­çš„é…ç½®ä¿¡æ¯ä½œä¸ºÂ `babel`Â é”® (key) æ·»åŠ åˆ°Â `package.json`Â æ–‡ä»¶ä¸­:
    

```
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â Â "name":Â "my-package",
Â  Â  Â  Â  Â  Â Â "babel": {
Â  Â  Â  Â  Â  Â  Â  Â Â "presets": ["@babel/preset-env"],
Â  Â  Â  Â  Â  Â  Â  Â Â "plugins": ["@babel/plugin-transform-runtime"]
Â  Â  Â  Â  }


```

##### **å°ç»“ï¼š**

æ¨èä½¿ç”¨`babel.config.js`æ¥ä½œä¸ºæ•´ä¸ªé¡¹ç›®çš„ babel é…ç½®ï¼Œ

*   `.babelrc`Â åªä¼šå½±å“æœ¬é¡¹ç›®ä¸­çš„ä»£ç 
    
*   `babel.config.js`ä¼šå½±å“æ•´ä¸ªé¡¹ç›®ä¸­çš„ä»£ç ï¼ŒåŒ…å« node_modules ä¸­çš„ä»£ç 
    

éœ€è¦äº†è§£è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶æ›´å…·ä½“åŒºåˆ«çš„å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« Â ä¸å®¹é”™è¿‡çš„ Babel7 çŸ¥è¯† [2]

ä¸‰ã€babel çš„ç¼–è¯‘è¿‡ç¨‹
-------------

å‚è€ƒæ–‡ç« ï¼šbabel çš„ç¼–è¯‘è¿‡ç¨‹ [3]

babel çš„ç¼–è¯‘æ€»ä½“æµç¨‹ä¸»è¦åˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼š

*   1 parseï¼ˆè§£æï¼‰ é˜¶æ®µ: é€šè¿‡ @babel/parser[4] å°†ä»£ç è½¬åŒ–ä¸º AST
    
*   2 transformï¼ˆè½¬æ¢ï¼‰é˜¶æ®µ: é€šè¿‡Â @babel/traverse[5]Â å¯¹ AST è¿›è¡Œæ“ä½œ
    
*   3 generateï¼ˆç”Ÿæˆï¼‰é˜¶æ®µ: é€šè¿‡Â @babel/generator[6] å°† AST è½¬åŒ–ä¸ºæºä»£ç 
    

è§£æï¼šparse é˜¶æ®µçš„ç›®çš„æ˜¯æŠŠæºä»£ç å­—ç¬¦ä¸²è½¬åŒ–æˆæœºå™¨èƒ½å¤Ÿç†è§£çš„ ASTï¼Œè¿™ä¸ªè¿‡ç¨‹åˆ†æˆè¯æ³•åˆ†æã€è¯­æ³•åˆ†æ

è½¬æ¢ï¼šå¯¹ parse é˜¶æ®µç”Ÿæˆçš„ AST è¿›è¡Œéå†ï¼Œé’ˆå¯¹ä¸åŒçš„èŠ‚ç‚¹è¿›è¡Œæ“ä½œ, åœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ @babel/traverse æ“ä½œ AST

ç”Ÿæˆï¼šå°† AST è½¬åŒ–ä¸ºæºä»£ç ï¼Œå¹¶ç”Ÿæˆ source-mapã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ @babel/generate å°†æ“ä½œåçš„ AST è½¬åŒ–ä¸ºæºä»£ç 

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHqDZic62FnQbIotFs9GX3icqAE0d3491cvtFWcib6axGwPnmVKMnJVuzYsknJuxGABdTMomvLy6BoEWw/640?wx_fmt=other&from=appmsg)  

å››ã€å®è·µ
----

### ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªç®€å•çš„ Babel æ’ä»¶

ä¸€ä¸ª Babel æ’ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªåŒ…å«Â `types`Â å·¥å…·ç®±çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«ä¸€ä¸ªÂ `visitor`Â å±æ€§ï¼Œ`visitor`Â å±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶æ–¹æ³•ä¼šåœ¨éå† AST æ—¶è¢«è°ƒç”¨ã€‚

è¿™ä¸ªæ’ä»¶å°†ä¼šæŠŠ ES6 çš„Â `**`Â è¿ç®—ç¬¦è½¬æ¢ä¸ºÂ `Math.pow`Â å‡½æ•°è°ƒç”¨ã€‚ä»¥ä¸‹æ˜¯æ’ä»¶çš„ä»£ç ç¤ºä¾‹ï¼š

```
Â  Â Â // transform-to-mathpow.js
Â  Â  module.exports = function(babel) {
Â  Â  Â  const { types: t } = babel;
Â  Â  Â  return {
Â  Â  Â  Â  name:Â "transform-to-mathpow",
Â  Â  Â  Â  visitor: {
Â  Â  Â  Â  Â  BinaryExpression(path) {
Â  Â  Â  Â  Â  Â  if (path.node.operator ===Â "**") {
Â  Â  Â  Â  Â  Â  Â  const mathpowAstNode = t.callExpression(
Â  Â  Â  Â  Â  Â  Â  Â  t.memberExpression(t.identifier("Math"), t.identifier("pow")),
Â  Â  Â  Â  Â  Â  Â  Â  [path.node.left, path.node.right]
Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  path.replaceWith(mathpowAstNode);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  },
Â  Â  Â  };
Â  Â  };


```

åœ¨è¿™ä¸ªæ’ä»¶ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºäºŒå…ƒè¡¨è¾¾å¼ï¼Œå¹¶ä¸”æ“ä½œç¬¦æ˜¯å¦ä¸ºÂ `**`ã€‚å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªæ–°çš„Â `CallExpression`Â èŠ‚ç‚¹ï¼Œè¡¨ç¤ºÂ `Math.pow`Â å‡½æ•°çš„è°ƒç”¨ï¼Œå¹¶å°†åŸæ¥çš„äºŒå…ƒè¡¨è¾¾å¼çš„å·¦å³ä¸¤è¾¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™Â `Math.pow`ã€‚æœ€åï¼Œæˆ‘ä»¬ç”¨æ–°çš„Â `CallExpression`Â èŠ‚ç‚¹æ›¿æ¢åŸæ¥çš„äºŒå…ƒè¡¨è¾¾å¼èŠ‚ç‚¹ã€‚

### ï¼ˆ2ï¼‰ä½¿ç”¨ babel æ’ä»¶

è¦ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„æ’ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼ˆbabel.config.json æˆ–è€… .babelrcï¼‰ä¸­æ·»åŠ å®ƒï¼š

```
Â  Â  {
Â  Â  Â Â "plugins": ["./transform-to-mathpow.js"]
Â  Â  }


```

### ï¼ˆ3ï¼‰Babel é¢„è®¾å’Œæ’ä»¶çš„æ‰§è¡Œé¡ºåº

Babel æ’ä»¶å’Œé¢„è®¾çš„æ‰§è¡Œé¡ºåºæ˜¯å…¶åœ¨è½¬æ¢ JavaScript ä»£ç è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªé‡è¦æ–¹é¢

*   #### é¢„è®¾ï¼ˆPresetsï¼‰çš„æ‰§è¡Œé¡ºåº
    

1.  **é€†åºæ‰§è¡Œ**ï¼šä¸æ’ä»¶ä¸åŒï¼Œé¢„è®¾æ˜¯æŒ‰ç…§é…ç½®æ–‡ä»¶ä¸­å£°æ˜çš„é¡ºåºé€†åºæ‰§è¡Œçš„ã€‚è¿™æ„å‘³ç€æœ€åä¸€ä¸ªå£°æ˜çš„é¢„è®¾ä¼šé¦–å…ˆæ‰§è¡Œï¼Œç„¶åæ˜¯å€’æ•°ç¬¬äºŒä¸ªï¼Œä¾æ­¤ç±»æ¨ã€‚
    
2.  **å†…éƒ¨æ’ä»¶é¡ºåº**ï¼šæ¯ä¸ªé¢„è®¾å†…éƒ¨é€šå¸¸åŒ…å«äº†ä¸€ç³»åˆ—æ’ä»¶ã€‚è¿™äº›æ’ä»¶çš„æ‰§è¡Œé¡ºåºç”±é¢„è®¾æœ¬èº«å®šä¹‰ï¼Œå¹¶ä¸”éµå¾ªé¢„è®¾å†…éƒ¨çš„è§„åˆ™ã€‚
    

*   #### æ’ä»¶ï¼ˆPluginsï¼‰çš„æ‰§è¡Œé¡ºåº
    

1.  åœ¨æ‰€æœ‰é¢„è®¾æ‰§è¡Œå®Œä¹‹åï¼Œæ‰è½®åˆ°æ’ä»¶æ‰§è¡Œ
    
2.  **æ­£åºæ‰§è¡Œ**ï¼šBabel ä¼šæŒ‰ç…§é…ç½®æ–‡ä»¶ä¸­æ’ä»¶å£°æ˜çš„é¡ºåºï¼Œä¾æ¬¡æ‰§è¡Œè¿™äº›æ’ä»¶ã€‚è¿™æ„å‘³ç€ç¬¬ä¸€ä¸ªå£°æ˜çš„æ’ä»¶ä¼šé¦–å…ˆæ‰§è¡Œï¼Œç„¶åæ˜¯ç¬¬äºŒä¸ªï¼Œä¾æ­¤ç±»æ¨ã€‚
    
3.  **äº¤æ›¿è°ƒç”¨**ï¼šåœ¨éå†æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰çš„è¿‡ç¨‹ä¸­ï¼ŒBabel ä¼šäº¤æ›¿è°ƒç”¨ä¸åŒæ’ä»¶çš„å¤„ç†å‡½æ•°ã€‚å½“é‡åˆ°æŸä¸ªèŠ‚ç‚¹ç±»å‹æ—¶ï¼ŒBabel ä¼šä¾æ¬¡æ‰§è¡Œæ‰€æœ‰æ’ä»¶ä¸­é’ˆå¯¹è¯¥èŠ‚ç‚¹ç±»å‹çš„å¤„ç†å‡½æ•°ã€‚
    
4.  **enter å’Œ exit é˜¶æ®µ**ï¼šå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼ŒBabel æä¾›äº†ä¸¤ä¸ªå¤„ç†æ—¶æœºï¼šenter å’Œ exitã€‚enter é˜¶æ®µè¡¨ç¤ºè¿›å…¥èŠ‚ç‚¹æ—¶æ‰§è¡Œçš„å¤„ç†ï¼Œè€Œ exit é˜¶æ®µè¡¨ç¤ºç¦»å¼€èŠ‚ç‚¹æ—¶æ‰§è¡Œçš„å¤„ç†ã€‚æ’ä»¶å¯ä»¥é€‰æ‹©åœ¨ enter æˆ– exit é˜¶æ®µï¼Œæˆ–è€…ä¸¤ä¸ªé˜¶æ®µéƒ½è¿›è¡Œå¤„ç†ã€‚
    

*   #### ç¤ºä¾‹è¯´æ˜
    

å‡è®¾æœ‰ä»¥ä¸‹ Babel é…ç½®æ–‡ä»¶ï¼š

```
Â  Â  {
Â  Â  Â Â "presets": ["preset-a",Â "preset-b"],
Â  Â  Â Â "plugins": ["plugin-1",Â "plugin-2"]
Â  Â  }


```

åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼š

1.  é¢„è®¾çš„æ‰§è¡Œé¡ºåºå°†æ˜¯Â `preset-b`ï¼ˆå…ˆæ‰§è¡Œï¼‰ï¼Œç„¶åæ˜¯Â `preset-a`ï¼ˆåæ‰§è¡Œï¼‰ã€‚
    
2.  æ’ä»¶çš„æ‰§è¡Œé¡ºåºå°†æ˜¯Â `plugin-1`ï¼ˆå…ˆæ‰§è¡Œï¼‰ï¼Œç„¶åæ˜¯Â `plugin-2`ï¼ˆåæ‰§è¡Œï¼‰ã€‚
    
3.  `preset-a`Â å’ŒÂ `preset-b`Â å†…éƒ¨åŒ…å«çš„æ’ä»¶å°†åˆ†åˆ«æŒ‰ç…§å®ƒä»¬å„è‡ªçš„å†…éƒ¨è§„åˆ™æ‰§è¡Œã€‚
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHqDZic62FnQbIotFs9GX3icqAXeR5AAqW93PtPfoicDYYl9icCNZicVib0Zu1PlEhE8pAAqyecvNLaSMKeQ/640?wx_fmt=other&from=appmsg)

äº”ã€tsc å’Œ babel çš„åŒºåˆ«
-----------------

å…¶å® tsc å’Œ babel åœ¨æœ¬è´¨ä¸Šæ˜¯åŒä¸€ç±»ä¸œè¥¿ï¼ˆéƒ½æ˜¯ç¼–è¯‘å™¨ï¼‰ï¼Œåªæ˜¯å®ç°çš„åŠŸèƒ½ä¸åŒï¼Œå¦‚ï¼š

1.  tsc å¯ä»¥å¯¹ä»£ç è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œbabel ä¸èƒ½
    
2.  tsc å¯ä»¥è¾“å‡ºç±»å‹å£°æ˜æ–‡ä»¶ï¼ˆ.d.tsï¼‰ï¼Œbabel ä¸èƒ½
    
3.  tsc å¯ä»¥å¯¼å‡ºé const çš„å€¼ï¼Œbabel ä¸èƒ½
    
4.  ä¸ tsc ç›¸æ¯”ï¼Œbabel æ”¯æŒæ›´å¤šçš„è¯­è¨€ç‰¹æ€§ï¼Œå…¼å®¹æ€§æ›´å¼º
    
5.  babel çš„ç¼–è¯‘é€Ÿåº¦è¦æ¯” tsc æ›´å¿«
    

è™½ç„¶ babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨ï¼Œä½†æ˜¯é€šè¿‡æ·»åŠ  preset é¢„è®¾ä¹Ÿå¯ä»¥å¯¹ ts è¿›è¡Œç¼–è¯‘ã€‚ï¼ˆæ’ä»¶ç³»ç»ŸçœŸçš„å¼ºå¤§ï¼ï¼‰

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHqDZic62FnQbIotFs9GX3icqAzp5SsHpJxvzNVibpicpQOA7wcHSNR3P3iabreyAYHK8EOIJG4xBOtjFwA/640?wx_fmt=other&from=appmsg)

å…­ã€tsc å’Œ babel æ€ä¹ˆé€‰ï¼Ÿ
------------------

å‚è€ƒæ–‡ç« ï¼šbabel å’Œ tsc çš„ä½¿ç”¨æŒ‡å— [7]

#### æƒ…å†µä¸€

é¡¹ç›®è¿è¡Œç¯å¢ƒæ— éœ€è¿‡å¤š polyfill çš„æ”¯æŒï¼Œé¡¹ç›®æºä»£ç åˆ°è¾“å‡ºä»£ç è¿‡ç¨‹ä»…éœ€ ts=>js, æ— å¯¹æºç çš„ä¸ªæ€§åŒ–å¤„ç†ï¼Œå°±é€‰Â `tsc`ã€‚

#### æƒ…å†µäºŒ

é¡¹ç›®è¿è¡Œç¯å¢ƒéœ€è¦é€‚é…ç›®æ ‡æµè§ˆå™¨ / Node.js ç¯å¢ƒç­‰ï¼Œæºä»£ç åˆ°è¾“å‡ºç›®æ ‡ä»£ç è¿‡ç¨‹éœ€è¦é™¤ ts=>js ç¼–è¯‘å¤–çš„ä¸ªæ€§åŒ–å¤„ç†ï¼Œè¿½æ±‚æ›´å¿«çš„ç¼–è¯‘é€Ÿåº¦ï¼Œä½†æ— éœ€ç±»å‹æ£€æŸ¥å’Œç±»å‹å£°æ˜æ–‡ä»¶çš„è¾“å‡ºï¼Œå°±ä½¿ç”¨Â `babel`Â ç¼–è¯‘ã€‚

#### æƒ…å†µä¸‰ï¼ˆå¸¸è§ï¼‰

æ—¢è¦å¼•å…¥ polyfill é€‚é…ç›®æ ‡æµè§ˆå™¨ç‰ˆæœ¬ï¼Œåˆè¦è¿›è¡Œç±»å‹æ£€æŸ¥å¹¶è¾“å‡ºç±»å‹å£°æ˜æ–‡ä»¶ï¼Œå°±ä½¿ç”¨ babel è¿›è¡Œç¼–è¯‘ï¼Œç”¨ tsc è¿›è¡Œç±»å‹æ£€æŸ¥å’Œå£°æ˜æ–‡ä»¶è¾“å‡ºã€‚

ç»“å°¾
--

è¿™ç¯‡æ–‡ç« ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¥½åœ°å­¦ä¹  AST å’Œç¼–è¯‘å™¨ï¼Œå°±åªå¼•å…¥äº†é€‚ç”¨æ€§æ›´å¹¿ babel å’Œ tscï¼Œæ²¡æœ‰å¼•å…¥å…¶ä»–åœ¨ç¼–è¯‘é€Ÿåº¦ä¸Šæ›´æœ‰ä¼˜åŠ¿çš„ï¼ˆå¦‚ swcã€esbuildï¼‰ã€‚å¦‚æœä½ å¯¹è¿™ç¯‡æ–‡ç« å“ªä¸ªåœ°æ–¹æœ‰æ›´æ·±çš„è§è§£ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„è§‚ç‚¹ã€‚

  

æœ¬æ–‡ä½œè€…ï¼šLuckyfif

https://juejin.cn/post/7447444766005018624

  

  

å‚è€ƒèµ„æ–™

[1]

å‰ç«¯å·¥ç¨‹åŒ–åŸºçŸ³ -- AST ğŸ”¥:https://juejin.cn/post/7155151377013047304?searchId=202310201428043E156BF285B13E15D1B6#heading-15

[2]

ä¸å®¹é”™è¿‡çš„ Babel7 çŸ¥è¯†:https://juejin.cn/post/6844904008679686152?searchId=202412121633591F6781D5852E05005180#heading-12

[3]

babel çš„ç¼–è¯‘è¿‡ç¨‹:https://juejin.cn/post/7142158641628446733?searchId=2024121221193195B4DB3EC96D2C351CEF

[4]

@babel/parser:https://babeljs.io/docs/babel-parser

[5]

@babel/traverse:https://babeljs.io/docs/babel-traverse

[6]

@babel/generator:https://babeljs.io/docs/babel-generator

[7]

babel å’Œ tsc çš„ä½¿ç”¨æŒ‡å—:https://juejin.cn/post/7107870117878300680?from=search-suggest